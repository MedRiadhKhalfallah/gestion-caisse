define("vendor/domReady",[],function(){"use strict";function e(e){var t;for(t=0;t<e.length;t+=1)e[t](c)}function t(){var t=u;l&&t.length&&(u=[],e(t))}function n(){l||(l=!0,s&&clearInterval(s),t())}function i(e){return l?e(c):u.push(e),i}var o,r,s,a="undefined"!=typeof window&&window.document,l=!a,c=a?document:null,u=[];if(a){if(document.addEventListener)document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1);else if(window.attachEvent){window.attachEvent("onload",n),r=document.createElement("div");try{o=null===window.frameElement}catch(e){}r.doScroll&&o&&window.external&&(s=setInterval(function(){try{r.doScroll(),n()}catch(e){}},30))}"complete"===document.readyState&&n()}return i.version="2.0.1",i.load=function(e,t,n,o){o.isBuild?n(null):i(n)},i}),define("modules/shared/module",["vendor/angular"],function(e){var t=e.module("createsend",[]);return t}),define("modules/shared/services/antiforgery",["modules/shared/module"],function(e){function t(e,t){i=e.defaults.xsrfCookieName,e.defaults.xsrfHeaderName=o,this._={$b:t}}function n(e,t,n){return function(n){return n.then(function(e){return e},function(n){var i,o;return 449===n.status?(o=n.config.retries||0,o++,o>3?e.reject(n):(n.config.retries=o,(i=t.get("$http"))(n.config))):e.reject(n)})}}var i,o="__RequestVerificationToken";t.prototype.get=function(){return{key:o,value:this._.$b.cookies()[i]}},e.service("csAntiforgeryToken",["$http","$browser",t]),e.factory("csAntiforgeryAutoRetry",["$q","$injector","$timeout",n]),e.config(["$httpProvider",function(e){e.responseInterceptors.push("csAntiforgeryAutoRetry")}])}),define("modules/shared/services/retryRequest",["modules/shared/module"],function(e){function t(e,t){this.$http=e,this.request={}}t.prototype.store=function(e){this.request=e},t.prototype.retry=function(){this.$http(this.request.config)},e.service("RetryRequestSrv",["$http",t])}),define("modules/shared/services/auth",["config","modules/shared/module","modules/shared/services/retryRequest"],function(e,t){function n(t,n,i){return{responseError:function(o){if(401===o.status){e.mode.publicCanvas||(n.showLoginForm=!0);var r=t.get("RetryRequestSrv");r.store(o)}return i.reject(o)}}}t.factory("authInterceptor",["$injector","$rootScope","$q",n]),t.config(["$httpProvider",function(e){e.interceptors.push("authInterceptor")}])}),define("modules/shared/services/ajaxHeader",["modules/shared/module"],function(e){e.config(["$httpProvider",function(e){e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}])}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("vendor/raven/raven",[],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Raven=e()}}(function(){return function e(t,n,i){function o(s,a){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){var n=t[s][1][e];return o(n?n:e)},u,u.exports,e,t,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(e,t,n){function i(e,t,n,i){return JSON.stringify(e,o(t,i),n)}function o(e,t){var n=[],i=[];return null==t&&(t=function(e,t){return n[0]===t?"[Circular ~]":"[Circular ~."+i.slice(0,n.indexOf(t)).join(".")+"]"}),function(o,r){if(n.length>0){var s=n.indexOf(this);~s?n.splice(s+1):n.push(this),~s?i.splice(s,1/0,o):i.push(o),~n.indexOf(r)&&(r=t.call(this,o,r))}else n.push(r);return null==e?r:e.call(this,o,r)}}n=t.exports=i,n.getSerialize=o},{}],2:[function(e,t,n){"use strict";function i(e){this.name="RavenConfigError",this.message=e}i.prototype=new Error,i.prototype.constructor=i,t.exports=i},{}],3:[function(e,t,n){"use strict";var i=function(e,t,n){var i=e[t],o=e;if(t in e){var r="warn"===t?"warning":t;e[t]=function(){var e=[].slice.call(arguments),t=""+e.join(" "),s={level:r,logger:"console",extra:{arguments:e}};n&&n(t,s),i&&Function.prototype.apply.call(i,o,e)}}};t.exports={wrapMethod:i}},{}],4:[function(e,t,n){"use strict";function i(){return+new Date}function o(){this._hasJSON=!("object"!=typeof JSON||!JSON.stringify),this._hasDocument="undefined"!=typeof document,this._lastCapturedException=null,this._lastEventId=null,this._globalServer=null,this._globalKey=null,this._globalProject=null,this._globalContext={},this._globalOptions={logger:"javascript",ignoreErrors:[],ignoreUrls:[],whitelistUrls:[],includePaths:[],crossOrigin:"anonymous",collectWindowErrors:!0,maxMessageLength:0,stackTraceLimit:50,autoBreadcrumbs:!0},this._ignoreOnError=0,this._isRavenInstalled=!1,this._originalErrorStackTraceLimit=Error.stackTraceLimit,this._originalConsole=window.console||{},this._originalConsoleMethods={},this._plugins=[],this._startTime=i(),this._wrappedBuiltIns=[],this._breadcrumbs=[],this._lastCapturedEvent=null,this._keypressTimeout,this._location=window.location,this._lastHref=this._location&&this._location.href;for(var e in this._originalConsole)this._originalConsoleMethods[e]=this._originalConsole[e]}var r=e(7),s=e(2),a=e(6),l=e(1),c=a.isFunction,u=a.isUndefined,d=a.isError,m=a.isEmptyObject,p=a.hasKey,h=a.joinRegExp,f=a.each,g=a.objectMerge,v=a.truncate,b=a.urlencode,y=a.uuid4,w=a.htmlTreeAsString,k=a.parseUrl,_=a.isString,x=a.fill,S=e(3).wrapMethod,C="source protocol user pass host port path".split(" "),I=/^(?:(\w+):)?\/\/(?:(\w+)(:\w+)?@)?([\w\.-]+)(?::(\d+))?(\/.*)/;o.prototype={VERSION:"3.7.0",debug:!1,TraceKit:r,config:function(e,t){var n=this;if(this._globalServer)return this._logDebug("error","Error: Raven has already been configured"),this;if(!e)return this;t&&f(t,function(e,t){"tags"===e||"extra"===e?n._globalContext[e]=t:n._globalOptions[e]=t}),this.setDSN(e),this._globalOptions.ignoreErrors.push(/^Script error\.?$/),this._globalOptions.ignoreErrors.push(/^Javascript error: Script error\.? on line 0$/),this._globalOptions.ignoreErrors=h(this._globalOptions.ignoreErrors),this._globalOptions.ignoreUrls=!!this._globalOptions.ignoreUrls.length&&h(this._globalOptions.ignoreUrls),this._globalOptions.whitelistUrls=!!this._globalOptions.whitelistUrls.length&&h(this._globalOptions.whitelistUrls),this._globalOptions.includePaths=h(this._globalOptions.includePaths),this._globalOptions.maxBreadcrumbs=Math.max(0,Math.min(this._globalOptions.maxBreadcrumbs||100,100));var i={xhr:!0,console:!0,dom:!0,location:!0},o=this._globalOptions.autoBreadcrumbs;return"[object Object]"==={}.toString.call(o)?o=g(i,o):o!==!1&&(o=i),this._globalOptions.autoBreadcrumbs=o,r.collectWindowErrors=!!this._globalOptions.collectWindowErrors,this},install:function(){var e=this;return this.isSetup()&&!this._isRavenInstalled&&(r.report.subscribe(function(){e._handleOnErrorStackInfo.apply(e,arguments)}),this._instrumentTryCatch(),e._globalOptions.autoBreadcrumbs&&this._instrumentBreadcrumbs(),this._drainPlugins(),this._isRavenInstalled=!0),Error.stackTraceLimit=this._globalOptions.stackTraceLimit,this},setDSN:function(e){var t=this._parseDSN(e),n=t.path.lastIndexOf("/"),i=t.path.substr(1,n);this._dsn=e,this._globalKey=t.user,this._globalSecret=t.pass&&t.pass.substr(1),this._globalProject=t.path.substr(n+1),this._globalServer=this._getGlobalServer(t),this._globalEndpoint=this._globalServer+"/"+i+"api/"+this._globalProject+"/store/"},context:function(e,t,n){return c(e)&&(n=t||[],t=e,e=void 0),this.wrap(e,t).apply(this,n)},wrap:function(e,t,n){function i(){var i=[],r=arguments.length,s=!e||e&&e.deep!==!1;for(n&&c(n)&&n.apply(this,arguments);r--;)i[r]=s?o.wrap(e,arguments[r]):arguments[r];try{return t.apply(this,i)}catch(t){throw o._ignoreNextOnError(),o.captureException(t,e),t}}var o=this;if(u(t)&&!c(e))return e;if(c(e)&&(t=e,e=void 0),!c(t))return t;try{if(t.__raven__)return t;if(t.__raven_wrapper__)return t.__raven_wrapper__}catch(e){return t}for(var r in t)p(t,r)&&(i[r]=t[r]);return i.prototype=t.prototype,t.__raven_wrapper__=i,i.__raven__=!0,i.__inner__=t,i},uninstall:function(){return r.report.uninstall(),this._restoreBuiltIns(),Error.stackTraceLimit=this._originalErrorStackTraceLimit,this._isRavenInstalled=!1,this},captureException:function(e,t){if(!d(e))return this.captureMessage(e,g({trimHeadFrames:1,stacktrace:!0},t));this._lastCapturedException=e;try{var n=r.computeStackTrace(e);this._handleStackInfo(n,t)}catch(t){if(e!==t)throw t}return this},captureMessage:function(e,t){if(!this._globalOptions.ignoreErrors.test||!this._globalOptions.ignoreErrors.test(e)){var n=g({message:e+""},t);if(t&&t.stacktrace){var i;try{throw new Error(e)}catch(e){i=e}i.name=null,t=g({fingerprint:e,trimHeadFrames:(t.trimHeadFrames||0)+1},t);var o=r.computeStackTrace(i),s=this._prepareFrames(o,t);n.stacktrace={frames:s.reverse()}}return this._send(n),this}},captureBreadcrumb:function(e){var t=g({timestamp:i()/1e3},e);return this._breadcrumbs.push(t),this._breadcrumbs.length>this._globalOptions.maxBreadcrumbs&&this._breadcrumbs.shift(),this},addPlugin:function(e){var t=Array.prototype.slice.call(arguments,1);return this._plugins.push([e,t]),this._isRavenInstalled&&this._drainPlugins(),this},setUserContext:function(e){return this._globalContext.user=e,this},setExtraContext:function(e){return this._mergeContext("extra",e),this},setTagsContext:function(e){return this._mergeContext("tags",e),this},clearContext:function(){return this._globalContext={},this},getContext:function(){return JSON.parse(l(this._globalContext))},setEnvironment:function(e){return this._globalOptions.environment=e,this},setRelease:function(e){return this._globalOptions.release=e,this},setDataCallback:function(e){var t=this._globalOptions.dataCallback;return this._globalOptions.dataCallback=c(e)?function(n){return e(n,t)}:e,this},setShouldSendCallback:function(e){var t=this._globalOptions.shouldSendCallback;return this._globalOptions.shouldSendCallback=c(e)?function(n){return e(n,t)}:e,this},setTransport:function(e){return this._globalOptions.transport=e,this},lastException:function(){return this._lastCapturedException},lastEventId:function(){return this._lastEventId},isSetup:function(){return!!this._hasJSON&&(!!this._globalServer||(this.ravenNotConfiguredError||(this.ravenNotConfiguredError=!0,this._logDebug("error","Error: Raven has not been configured.")),!1))},afterLoad:function(){var e=window.RavenConfig;e&&this.config(e.dsn,e.config).install()},showReportDialog:function(e){if(window.document){e=e||{};var t=e.eventId||this.lastEventId();if(!t)throw new s("Missing eventId");var n=e.dsn||this._dsn;if(!n)throw new s("Missing DSN");var i=encodeURIComponent,o="";o+="?eventId="+i(t),o+="&dsn="+i(n);var r=e.user||this._globalContext.user;r&&(r.name&&(o+="&name="+i(r.name)),r.email&&(o+="&email="+i(r.email)));var a=this._getGlobalServer(this._parseDSN(n)),l=document.createElement("script");l.async=!0,l.src=a+"/api/embed/error-page/"+o,(document.head||document.body).appendChild(l)}},_ignoreNextOnError:function(){var e=this;this._ignoreOnError+=1,setTimeout(function(){e._ignoreOnError-=1})},_triggerEvent:function(e,t){var n,i;if(this._hasDocument){t=t||{},e="raven"+e.substr(0,1).toUpperCase()+e.substr(1),document.createEvent?(n=document.createEvent("HTMLEvents"),n.initEvent(e,!0,!0)):(n=document.createEventObject(),n.eventType=e);for(i in t)p(t,i)&&(n[i]=t[i]);if(document.createEvent)document.dispatchEvent(n);else try{document.fireEvent("on"+n.eventType.toLowerCase(),n)}catch(e){}}},_breadcrumbEventHandler:function(e){var t=this;return function(n){if(t._keypressTimeout=null,t._lastCapturedEvent!==n){t._lastCapturedEvent=n;var i,o=n.target;try{i=w(o)}catch(e){i="<unknown>"}t.captureBreadcrumb({category:"ui."+e,message:i})}}},_keypressEventHandler:function(){var e=this,t=1e3;return function(n){var i=n.target,o=i&&i.tagName;if(o&&("INPUT"===o||"TEXTAREA"===o)){var r=e._keypressTimeout;r||e._breadcrumbEventHandler("input")(n),clearTimeout(r),e._keypressTimeout=setTimeout(function(){e._keypressTimeout=null},t)}}},_captureUrlChange:function(e,t){var n=k(this._location.href),i=k(t),o=k(e);this._lastHref=t,n.protocol===i.protocol&&n.host===i.host&&(t=i.relative),n.protocol===o.protocol&&n.host===o.host&&(e=o.relative),this.captureBreadcrumb({category:"navigation",data:{to:t,from:e}})},_instrumentTryCatch:function(){function e(e){return function(t,i){for(var o=new Array(arguments.length),r=0;r<o.length;++r)o[r]=arguments[r];var s=o[0];return c(s)&&(o[0]=n.wrap(s)),e.apply?e.apply(this,o):e(o[0],o[1])}}function t(e){var t=window[e]&&window[e].prototype;t&&t.hasOwnProperty&&t.hasOwnProperty("addEventListener")&&(x(t,"addEventListener",function(t){return function(i,r,s,a){try{r&&r.handleEvent&&(r.handleEvent=n.wrap(r.handleEvent))}catch(e){}var l;return o&&o.dom&&("EventTarget"===e||"Node"===e)&&("click"===i?l=n._breadcrumbEventHandler(i):"keypress"===i&&(l=n._keypressEventHandler())),t.call(this,i,n.wrap(r,void 0,l),s,a)}},i),x(t,"removeEventListener",function(e){return function(t,n,i,o){try{n=n&&(n.__raven_wrapper__?n.__raven_wrapper__:n)}catch(e){}return e.call(this,t,n,i,o)}},i))}var n=this,i=n._wrappedBuiltIns,o=this._globalOptions.autoBreadcrumbs;x(window,"setTimeout",e,i),x(window,"setInterval",e,i),window.requestAnimationFrame&&x(window,"requestAnimationFrame",function(e){return function(t){return e(n.wrap(t))}},i);for(var r=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],s=0;s<r.length;s++)t(r[s]);var a=window.jQuery||window.$;a&&a.fn&&a.fn.ready&&x(a.fn,"ready",function(e){return function(t){return e.call(this,n.wrap(t))}},i)},_instrumentBreadcrumbs:function(){function e(e,n){e in n&&c(n[e])&&x(n,e,function(e){return t.wrap(e)})}var t=this,n=this._globalOptions.autoBreadcrumbs,i=t._wrappedBuiltIns;if(n.xhr&&"XMLHttpRequest"in window){var o=XMLHttpRequest.prototype;x(o,"open",function(e){return function(n,i){return _(i)&&i.indexOf(t._globalKey)===-1&&(this.__raven_xhr={method:n,url:i,status_code:null}),e.apply(this,arguments)}},i),x(o,"send",function(n){return function(i){function o(){if(r.__raven_xhr&&(1===r.readyState||4===r.readyState)){try{r.__raven_xhr.status_code=r.status}catch(e){}t.captureBreadcrumb({type:"http",category:"xhr",data:r.__raven_xhr})}}for(var r=this,s=["onload","onerror","onprogress"],a=0;a<s.length;a++)e(s[a],r);return"onreadystatechange"in r&&c(r.onreadystatechange)?x(r,"onreadystatechange",function(e){return t.wrap(e,void 0,o)}):r.onreadystatechange=o,n.apply(this,arguments)}},i)}n.dom&&this._hasDocument&&(document.addEventListener?(document.addEventListener("click",t._breadcrumbEventHandler("click"),!1),document.addEventListener("keypress",t._keypressEventHandler(),!1)):(document.attachEvent("onclick",t._breadcrumbEventHandler("click")),document.attachEvent("onkeypress",t._keypressEventHandler())));var r=window.chrome,s=r&&r.app&&r.app.runtime,a=!s&&window.history&&history.pushState;if(n.location&&a){var l=window.onpopstate;window.onpopstate=function(){var e=t._location.href;if(t._captureUrlChange(t._lastHref,e),l)return l.apply(this,arguments)},x(history,"pushState",function(e){return function(){var n=arguments.length>2?arguments[2]:void 0;return n&&t._captureUrlChange(t._lastHref,n+""),e.apply(this,arguments)}},i)}if(n.console&&"console"in window&&console.log){var u=function(e,n){t.captureBreadcrumb({message:e,level:n.level,category:"console"})};f(["debug","info","warn","error","log"],function(e,t){S(console,t,u)})}},_restoreBuiltIns:function(){for(var e;this._wrappedBuiltIns.length;){e=this._wrappedBuiltIns.shift();var t=e[0],n=e[1],i=e[2];t[n]=i}},_drainPlugins:function(){var e=this;f(this._plugins,function(t,n){var i=n[0],o=n[1];i.apply(e,[e].concat(o))})},_parseDSN:function(e){var t=I.exec(e),n={},i=7;try{for(;i--;)n[C[i]]=t[i]||""}catch(t){throw new s("Invalid DSN: "+e)}if(n.pass&&!this._globalOptions.allowSecretKey)throw new s("Do not specify your secret key in the DSN. See: http://bit.ly/raven-secret-key");return n},_getGlobalServer:function(e){var t="//"+e.host+(e.port?":"+e.port:"");return e.protocol&&(t=e.protocol+":"+t),t},_handleOnErrorStackInfo:function(){this._ignoreOnError||this._handleStackInfo.apply(this,arguments)},_handleStackInfo:function(e,t){var n=this._prepareFrames(e,t);this._triggerEvent("handle",{stackInfo:e,options:t}),this._processException(e.name,e.message,e.url,e.lineno,n,t)},_prepareFrames:function(e,t){var n=this,i=[];if(e.stack&&e.stack.length&&(f(e.stack,function(e,t){var o=n._normalizeFrame(t);o&&i.push(o)}),t&&t.trimHeadFrames))for(var o=0;o<t.trimHeadFrames&&o<i.length;o++)i[o].in_app=!1;return i=i.slice(0,this._globalOptions.stackTraceLimit)},_normalizeFrame:function(e){if(e.url){var t={filename:e.url,lineno:e.line,colno:e.column,function:e.func||"?"};return t.in_app=!(this._globalOptions.includePaths.test&&!this._globalOptions.includePaths.test(t.filename)||/(Raven|TraceKit)\./.test(t.function)||/raven\.(min\.)?js$/.test(t.filename)),t}},_processException:function(e,t,n,i,o,r){var s;if((!this._globalOptions.ignoreErrors.test||!this._globalOptions.ignoreErrors.test(t))&&(t+="",o&&o.length?(n=o[0].filename||n,o.reverse(),s={frames:o}):n&&(s={frames:[{filename:n,lineno:i,in_app:!0}]}),(!this._globalOptions.ignoreUrls.test||!this._globalOptions.ignoreUrls.test(n))&&(!this._globalOptions.whitelistUrls.test||this._globalOptions.whitelistUrls.test(n)))){var a=g({exception:{values:[{type:e,value:t,stacktrace:s}]},culprit:n},r);this._send(a)}},_trimPacket:function(e){var t=this._globalOptions.maxMessageLength;if(e.message&&(e.message=v(e.message,t)),e.exception){var n=e.exception.values[0];n.value=v(n.value,t)}return e},_getHttpData:function(){if(this._hasDocument&&document.location&&document.location.href){var e={headers:{"User-Agent":navigator.userAgent}};return e.url=document.location.href,document.referrer&&(e.headers.Referer=document.referrer),e}},_send:function(e){var t=this._globalOptions,n={project:this._globalProject,logger:t.logger,platform:"javascript"},o=this._getHttpData();o&&(n.request=o),e.trimHeadFrames&&delete e.trimHeadFrames,e=g(n,e),e.tags=g(g({},this._globalContext.tags),e.tags),e.extra=g(g({},this._globalContext.extra),e.extra),e.extra["session:duration"]=i()-this._startTime,this._breadcrumbs&&this._breadcrumbs.length>0&&(e.breadcrumbs={values:[].slice.call(this._breadcrumbs,0)}),m(e.tags)&&delete e.tags,this._globalContext.user&&(e.user=this._globalContext.user),t.environment&&(e.environment=t.environment),t.release&&(e.release=t.release),t.serverName&&(e.server_name=t.serverName),c(t.dataCallback)&&(e=t.dataCallback(e)||e),e&&!m(e)&&(c(t.shouldSendCallback)&&!t.shouldSendCallback(e)||this._sendProcessedPayload(e))},_sendProcessedPayload:function(e,t){var n=this,i=this._globalOptions;if(this._lastEventId=e.event_id||(e.event_id=y()),e=this._trimPacket(e),this._logDebug("debug","Raven about to send:",e),this.isSetup()){var o={sentry_version:"7",sentry_client:"raven-js/"+this.VERSION,sentry_key:this._globalKey};this._globalSecret&&(o.sentry_secret=this._globalSecret);var r=e.exception&&e.exception.values[0];this.captureBreadcrumb({category:"sentry",message:r?(r.type?r.type+": ":"")+r.value:e.message,event_id:e.event_id,level:e.level||"error"});var s=this._globalEndpoint;(i.transport||this._makeRequest).call(this,{url:s,auth:o,data:e,options:i,onSuccess:function(){n._triggerEvent("success",{data:e,src:s}),t&&t()},onError:function(i){n._triggerEvent("failure",{data:e,src:s}),i=i||new Error("Raven send failed (no additional details provided)"),t&&t(i)}})}},_makeRequest:function(e){function t(){200===n.status?e.onSuccess&&e.onSuccess():e.onError&&e.onError(new Error("Sentry error code: "+n.status))}var n=new XMLHttpRequest,i="withCredentials"in n||"undefined"!=typeof XDomainRequest;if(i){var o=e.url;"withCredentials"in n?n.onreadystatechange=function(){4===n.readyState&&t()}:(n=new XDomainRequest,o=o.replace(/^https?:/,""),n.onload=t),n.open("POST",o+"?"+b(e.auth)),n.send(l(e.data))}},_logDebug:function(e){this._originalConsoleMethods[e]&&this.debug&&Function.prototype.apply.call(this._originalConsoleMethods[e],this._originalConsole,[].slice.call(arguments,1))},_mergeContext:function(e,t){u(t)?delete this._globalContext[e]:this._globalContext[e]=g(this._globalContext[e]||{},t)}},o.prototype.setUser=o.prototype.setUserContext,o.prototype.setReleaseContext=o.prototype.setRelease,t.exports=o},{1:1,2:2,3:3,6:6,7:7}],5:[function(e,t,n){"use strict";var i=e(4),o=window.Raven,r=new i;r.noConflict=function(){return window.Raven=o,r},r.afterLoad(),t.exports=r},{4:4}],6:[function(e,t,n){"use strict";function i(e){return void 0===e}function o(e){return"function"==typeof e}function r(e){return"[object String]"===w.toString.call(e)}function s(e){return"object"==typeof e&&null!==e}function a(e){for(var t in e)return!1;return!0}function l(e){var t=w.toString.call(e);return s(e)&&"[object Error]"===t||"[object Exception]"===t||e instanceof Error}function c(e,t){var n,o;if(i(e.length))for(n in e)m(e,n)&&t.call(null,n,e[n]);else if(o=e.length)for(n=0;n<o;n++)t.call(null,n,e[n])}function u(e,t){return t?(c(t,function(t,n){e[t]=n}),e):e}function d(e,t){return!t||e.length<=t?e:e.substr(0,t)+"â€¦"}function m(e,t){return w.hasOwnProperty.call(e,t)}function p(e){for(var t,n=[],i=0,o=e.length;i<o;i++)t=e[i],r(t)?n.push(t.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")):t&&t.source&&n.push(t.source);return new RegExp(n.join("|"),"i")}function h(e){var t=[];return c(e,function(e,n){t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))}),t.join("&")}function f(e){var t=e.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!t)return{};var n=t[6]||"",i=t[8]||"";return{protocol:t[2],host:t[4],path:t[5],relative:t[5]+n+i}}function g(){var e=window.crypto||window.msCrypto;if(!i(e)&&e.getRandomValues){var t=new Uint16Array(8);e.getRandomValues(t),t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;var n=function(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t};return n(t[0])+n(t[1])+n(t[2])+n(t[3])+n(t[4])+n(t[5])+n(t[6])+n(t[7])}return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)})}function v(e){for(var t,n=5,i=80,o=[],r=0,s=0,a=" > ",l=a.length;e&&r++<n&&(t=b(e),!("html"===t||r>1&&s+o.length*l+t.length>=i));)o.push(t),s+=t.length,e=e.parentNode;return o.reverse().join(a)}function b(e){var t,n,i,o,s,a=[];if(!e||!e.tagName)return"";if(a.push(e.tagName.toLowerCase()),e.id&&a.push("#"+e.id),t=e.className,t&&r(t))for(n=t.split(" "),s=0;s<n.length;s++)a.push("."+n[s]);var l=["type","name","title","alt"];for(s=0;s<l.length;s++)i=l[s],o=e.getAttribute(i),o&&a.push("["+i+'="'+o+'"]');return a.join("")}function y(e,t,n,i){var o=e[t];e[t]=n(o),i&&i.push([e,t,o])}var w=Object.prototype;t.exports={isUndefined:i,isFunction:o,isString:r,isObject:s,isEmptyObject:a,isError:l,each:c,objectMerge:u,truncate:d,hasKey:m,joinRegExp:p,urlencode:h,uuid4:g,htmlTreeAsString:v,htmlElementAsString:b,parseUrl:f,fill:y}},{}],7:[function(e,t,n){"use strict";function i(){return"undefined"==typeof document?"":document.location.href}var o=e(6),r=o.hasKey,s=o.isString,a=o.isUndefined,l={collectWindowErrors:!0,debug:!1},c=[].slice,u="?",d=/^(?:Uncaught (?:exception: )?)?((?:Eval|Internal|Range|Reference|Syntax|Type|URI)Error): ?(.*)$/;l.report=function(){function e(e){m(),b.push(e)}function t(e){for(var t=b.length-1;t>=0;--t)b[t]===e&&b.splice(t,1)}function n(){p(),b=[]}function o(e,t){var n=null;if(!t||l.collectWindowErrors){for(var i in b)if(r(b,i))try{b[i].apply(null,[e].concat(c.call(arguments,2)))}catch(e){n=e}if(n)throw n}}function a(e,t,n,r,a){var c=null;if(k)l.computeStackTrace.augmentStackTraceWithInitialElement(k,t,n,e),h();else if(a)c=l.computeStackTrace(a),o(c,!0);else{var m,p={url:t,line:n,column:r},f=void 0,v=e;if(s(e)){var m=e.match(d);m&&(f=m[1],v=m[2])}p.func=u,c={name:f,message:v,url:i(),stack:[p]},o(c,!0)}return!!g&&g.apply(this,arguments)}function m(){v||(g=window.onerror,window.onerror=a,v=!0)}function p(){v&&(window.onerror=g,v=!1,g=void 0)}function h(){var e=k,t=y;y=null,k=null,w=null,o.apply(null,[e,!1].concat(t))}function f(e,t){var n=c.call(arguments,1);if(k){if(w===e)return;h()}var i=l.computeStackTrace(e);if(k=i,w=e,y=n,window.setTimeout(function(){w===e&&h()},i.incomplete?2e3:0),t!==!1)throw e}var g,v,b=[],y=null,w=null,k=null;return f.subscribe=e,f.unsubscribe=t,f.uninstall=n,f}(),l.computeStackTrace=function(){function e(e){if(!a(e.stack)&&e.stack){for(var t,n,o=/^\s*at (.*?) ?\(((?:file|https?|blob|chrome-extension|native|eval|<anonymous>).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,r=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|\[native).*?)(?::(\d+))?(?::(\d+))?\s*$/i,s=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,l=e.stack.split("\n"),c=[],d=(/^(.*) is undefined$/.exec(e.message),0),m=l.length;d<m;++d){if(t=o.exec(l[d])){var p=t[2]&&t[2].indexOf("native")!==-1;n={url:p?null:t[2],func:t[1]||u,args:p?[t[2]]:[],line:t[3]?+t[3]:null,column:t[4]?+t[4]:null}}else if(t=s.exec(l[d]))n={url:t[2],func:t[1]||u,args:[],line:+t[3],column:t[4]?+t[4]:null};else{if(!(t=r.exec(l[d])))continue;n={url:t[3],func:t[1]||u,args:t[2]?t[2].split(","):[],line:t[4]?+t[4]:null,column:t[5]?+t[5]:null}}!n.func&&n.line&&(n.func=u),c.push(n)}return c.length?(c[0].column||a(e.columnNumber)||(c[0].column=e.columnNumber+1),{name:e.name,message:e.message,url:i(),stack:c}):null}}function t(e,t,n,i){var o={url:t,line:n};if(o.url&&o.line){if(e.incomplete=!1,o.func||(o.func=u),e.stack.length>0&&e.stack[0].url===o.url){if(e.stack[0].line===o.line)return!1;if(!e.stack[0].line&&e.stack[0].func===o.func)return e.stack[0].line=o.line,!1}return e.stack.unshift(o),e.partial=!0,!0}return e.incomplete=!0,!1}function n(e,r){for(var s,a,c=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,d=[],m={},p=!1,h=n.caller;h&&!p;h=h.caller)if(h!==o&&h!==l.report){if(a={url:null,func:u,line:null,column:null},h.name?a.func=h.name:(s=c.exec(h.toString()))&&(a.func=s[1]),"undefined"==typeof a.func)try{a.func=s.input.substring(0,s.input.indexOf("{"))}catch(e){}m[""+h]?p=!0:m[""+h]=!0,d.push(a)}r&&d.splice(0,r);var f={name:e.name,message:e.message,url:i(),stack:d};return t(f,e.sourceURL||e.fileName,e.line||e.lineNumber,e.message||e.description),f}function o(t,o){var r=null;o=null==o?0:+o;try{if(r=e(t))return r}catch(e){if(l.debug)throw e}try{if(r=n(t,o+1))return r}catch(e){if(l.debug)throw e}return{name:t.name,message:t.message,url:i()}}return o.augmentStackTraceWithInitialElement=t,o.computeStackTraceFromStackProp=e,o}(),t.exports=l},{6:6}]},{},[5])(5)}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("vendor/raven/plugins/angular",[],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t=t.Raven||(t.Raven={}),t=t.Plugins||(t.Plugins={}),t.Angular=e()}}(function(){return function e(t,n,i){function o(s,a){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){var n=t[s][1][e];return o(n?n:e)},u,u.exports,e,t,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(e,t,n){"use strict";function i(e,t){function n(){this.$get=["$window",function(t){return e}]}function o(e){e.decorator("$exceptionHandler",["Raven","$delegate",r])}function r(e,t){return function(n,i){e.captureException(n,{extra:{cause:i}}),t(n,i)}}t=t||window.angular,t&&(t.module("ngRaven",[]).provider("Raven",n).config(["$provide",o]),e.setDataCallback(function(e,t){i._normalizeData(e),t&&t(e)}))}var o=/^\[((?:[$a-zA-Z0-9]+:)?(?:[$a-zA-Z0-9]+))\] (.*?)\n?(\S+)$/;i._normalizeData=function(e){var t=e.exception;if(t){t=t.values[0];var n=o.exec(t.value);n&&(t.type=n[1],t.value=n[2],e.message=t.type+": "+t.value,e.extra.angularDocs=n[3].substr(0,250))}},t.exports=i},{}]},{},[1])(1)}),define("modules/emailbuilder/module",["config","vendor/angular","vendor/angular-sanitize","vendor/angular-animate","vendor/angular-route","vendor/bindonce","modules/shared/services/antiforgery","modules/shared/services/auth","modules/shared/services/ajaxHeader","vendor/raven/raven","vendor/raven/plugins/angular"],function(e,t,n,i,o,r,s,a,l,c,u){var d=["ngSanitize","ngAnimate","ngRoute","pasvaz.bindonce","createsend"];e.canvasSentryMonitoring&&e.canvasSentryUrl&&(c.config(e.canvasSentryUrl).addPlugin(u,t).install(),d.push("ngRaven"));var m=t.module("emailbuilder",d);return m.config(["$sceDelegateProvider",function(e){e.resourceUrlWhitelist(["self","https://www.getfeedback.com/oauth/authorize**"])}]),m}),define("modules/emailbuilder/config/routeConfig",["config","vendor/angular","modules/emailbuilder/module"],function(e,t,n){function i(e){e.when("/editor",{action:"editor"}).when("/preview",{action:"preview"}).when("/signup",{action:"preview",showSignupForm:!0}).when("/firstrun",{action:"firstrun"}).when("/secondrun",{action:"secondrun"}).when("/sendtest",{action:"editor",showTestEmailForm:!0}).otherwise({redirectTo:"/editor"})}n.config(["$routeProvider",i])}),function(){var e=this,t=e._,n={},i=Array.prototype,o=Object.prototype,r=Function.prototype,s=i.push,a=i.slice,l=i.concat,c=o.toString,u=o.hasOwnProperty,d=i.forEach,m=i.map,p=i.reduce,h=i.reduceRight,f=i.filter,g=i.every,v=i.some,b=i.indexOf,y=i.lastIndexOf,w=Array.isArray,k=Object.keys,_=r.bind,x=function(e){return e instanceof x?e:this instanceof x?void(this._wrapped=e):new x(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.5.2";var S=x.each=x.forEach=function(e,t,i){if(null!=e)if(d&&e.forEach===d)e.forEach(t,i);else if(e.length===+e.length){for(var o=0,r=e.length;r>o;o++)if(t.call(i,e[o],o,e)===n)return}else for(var s=x.keys(e),o=0,r=s.length;r>o;o++)if(t.call(i,e[s[o]],s[o],e)===n)return};x.map=x.collect=function(e,t,n){var i=[];return null==e?i:m&&e.map===m?e.map(t,n):(S(e,function(e,o,r){i.push(t.call(n,e,o,r))}),i)};var C="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,i){var o=arguments.length>2;if(null==e&&(e=[]),p&&e.reduce===p)return i&&(t=x.bind(t,i)),o?e.reduce(t,n):e.reduce(t);if(S(e,function(e,r,s){o?n=t.call(i,n,e,r,s):(n=e,o=!0)}),!o)throw new TypeError(C);return n},x.reduceRight=x.foldr=function(e,t,n,i){var o=arguments.length>2;if(null==e&&(e=[]),h&&e.reduceRight===h)return i&&(t=x.bind(t,i)),o?e.reduceRight(t,n):e.reduceRight(t);var r=e.length;if(r!==+r){var s=x.keys(e);r=s.length}if(S(e,function(a,l,c){l=s?s[--r]:--r,o?n=t.call(i,n,e[l],l,c):(n=e[l],o=!0)}),!o)throw new TypeError(C);return n},x.find=x.detect=function(e,t,n){var i;return I(e,function(e,o,r){return t.call(n,e,o,r)?(i=e,!0):void 0}),i},x.filter=x.select=function(e,t,n){var i=[];return null==e?i:f&&e.filter===f?e.filter(t,n):(S(e,function(e,o,r){t.call(n,e,o,r)&&i.push(e)}),i)},x.reject=function(e,t,n){return x.filter(e,function(e,i,o){return!t.call(n,e,i,o)},n)},x.every=x.all=function(e,t,i){t||(t=x.identity);var o=!0;return null==e?o:g&&e.every===g?e.every(t,i):(S(e,function(e,r,s){return(o=o&&t.call(i,e,r,s))?void 0:n}),!!o)};var I=x.some=x.any=function(e,t,i){t||(t=x.identity);var o=!1;return null==e?o:v&&e.some===v?e.some(t,i):(S(e,function(e,r,s){return o||(o=t.call(i,e,r,s))?n:void 0}),!!o);
};x.contains=x.include=function(e,t){return null!=e&&(b&&e.indexOf===b?e.indexOf(t)!=-1:I(e,function(e){return e===t}))},x.invoke=function(e,t){var n=a.call(arguments,2),i=x.isFunction(t);return x.map(e,function(e){return(i?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t,n){return x.isEmpty(t)?n?void 0:[]:x[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.findWhere=function(e,t){return x.where(e,t,!0)},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-1/0;var i={computed:-1/0,value:-1/0};return S(e,function(e,o,r){var s=t?t.call(n,e,o,r):e;s>i.computed&&(i={value:e,computed:s})}),i.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return 1/0;var i={computed:1/0,value:1/0};return S(e,function(e,o,r){var s=t?t.call(n,e,o,r):e;s<i.computed&&(i={value:e,computed:s})}),i.value},x.shuffle=function(e){var t,n=0,i=[];return S(e,function(e){t=x.random(n++),i[n-1]=i[t],i[t]=e}),i},x.sample=function(e,t,n){return arguments.length<2||n?e[x.random(e.length-1)]:x.shuffle(e).slice(0,Math.max(0,t))};var T=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var i=T(t);return x.pluck(x.map(e,function(e,t,o){return{value:e,index:t,criteria:i.call(n,e,t,o)}}).sort(function(e,t){var n=e.criteria,i=t.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(i>n||void 0===i)return-1}return e.index-t.index}),"value")};var E=function(e){return function(t,n,i){var o={},r=null==n?x.identity:T(n);return S(t,function(n,s){var a=r.call(i,n,s,t);e(o,a,n)}),o}};x.groupBy=E(function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)}),x.indexBy=E(function(e,t,n){e[t]=n}),x.countBy=E(function(e,t){x.has(e,t)?e[t]++:e[t]=1}),x.sortedIndex=function(e,t,n,i){n=null==n?x.identity:T(n);for(var o=n.call(i,t),r=0,s=e.length;s>r;){var a=r+s>>>1;n.call(i,e[a])<o?r=a+1:s=a}return r},x.toArray=function(e){return e?x.isArray(e)?a.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return null==e?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:a.call(e,0,t)},x.initial=function(e,t,n){return a.call(e,0,e.length-(null==t||n?1:t))},x.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:a.call(e,Math.max(e.length-t,0))},x.rest=x.tail=x.drop=function(e,t,n){return a.call(e,null==t||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var P=function(e,t,n){return t&&x.every(e,x.isArray)?l.apply(n,e):(S(e,function(e){x.isArray(e)||x.isArguments(e)?t?s.apply(n,e):P(e,t,n):n.push(e)}),n)};x.flatten=function(e,t){return P(e,t,[])},x.without=function(e){return x.difference(e,a.call(arguments,1))},x.uniq=x.unique=function(e,t,n,i){x.isFunction(t)&&(i=n,n=t,t=!1);var o=n?x.map(e,n,i):e,r=[],s=[];return S(o,function(n,i){(t?i&&s[s.length-1]===n:x.contains(s,n))||(s.push(n),r.push(e[i]))}),r},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(e){var t=a.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=l.apply(i,a.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){for(var e=x.max(x.pluck(arguments,"length").concat(0)),t=new Array(e),n=0;e>n;n++)t[n]=x.pluck(arguments,""+n);return t},x.object=function(e,t){if(null==e)return{};for(var n={},i=0,o=e.length;o>i;i++)t?n[e[i]]=t[i]:n[e[i][0]]=e[i][1];return n},x.indexOf=function(e,t,n){if(null==e)return-1;var i=0,o=e.length;if(n){if("number"!=typeof n)return i=x.sortedIndex(e,t),e[i]===t?i:-1;i=0>n?Math.max(0,o+n):n}if(b&&e.indexOf===b)return e.indexOf(t,n);for(;o>i;i++)if(e[i]===t)return i;return-1},x.lastIndexOf=function(e,t,n){if(null==e)return-1;var i=null!=n;if(y&&e.lastIndexOf===y)return i?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var o=i?n:e.length;o--;)if(e[o]===t)return o;return-1},x.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;for(var i=Math.max(Math.ceil((t-e)/n),0),o=0,r=new Array(i);i>o;)r[o++]=e,e+=n;return r};var $=function(){};x.bind=function(e,t){var n,i;if(_&&e.bind===_)return _.apply(e,a.call(arguments,1));if(!x.isFunction(e))throw new TypeError;return n=a.call(arguments,2),i=function(){if(!(this instanceof i))return e.apply(t,n.concat(a.call(arguments)));$.prototype=e.prototype;var o=new $;$.prototype=null;var r=e.apply(o,n.concat(a.call(arguments)));return Object(r)===r?r:o}},x.partial=function(e){var t=a.call(arguments,1);return function(){return e.apply(this,t.concat(a.call(arguments)))}},x.bindAll=function(e){var t=a.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return S(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var i=t.apply(this,arguments);return x.has(n,i)?n[i]:n[i]=e.apply(this,arguments)}},x.delay=function(e,t){var n=a.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(a.call(arguments,1)))},x.throttle=function(e,t,n){var i,o,r,s=null,a=0;n||(n={});var l=function(){a=n.leading===!1?0:new Date,s=null,r=e.apply(i,o)};return function(){var c=new Date;a||n.leading!==!1||(a=c);var u=t-(c-a);return i=this,o=arguments,0>=u?(clearTimeout(s),s=null,a=c,r=e.apply(i,o)):s||n.trailing===!1||(s=setTimeout(l,u)),r}},x.debounce=function(e,t,n){var i,o,r,s,a;return function(){r=this,o=arguments,s=new Date;var l=function(){var c=new Date-s;t>c?i=setTimeout(l,t-c):(i=null,n||(a=e.apply(r,o)))},c=n&&!i;return i||(i=setTimeout(l,t)),c&&(a=e.apply(r,o)),a}},x.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},x.wrap=function(e,t){return function(){var n=[e];return s.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},x.keys=k||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&t.push(n);return t},x.values=function(e){for(var t=x.keys(e),n=t.length,i=new Array(n),o=0;n>o;o++)i[o]=e[t[o]];return i},x.pairs=function(e){for(var t=x.keys(e),n=t.length,i=new Array(n),o=0;n>o;o++)i[o]=[t[o],e[t[o]]];return i},x.invert=function(e){for(var t={},n=x.keys(e),i=0,o=n.length;o>i;i++)t[e[n[i]]]=n[i];return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return S(a.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=l.apply(i,a.call(arguments,1));return S(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=l.apply(i,a.call(arguments,1));for(var o in e)x.contains(n,o)||(t[o]=e[o]);return t},x.defaults=function(e){return S(a.call(arguments,1),function(t){if(t)for(var n in t)void 0===e[n]&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var A=function(e,t,n,i){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var o=c.call(e);if(o!=c.call(t))return!1;switch(o){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var r=n.length;r--;)if(n[r]==e)return i[r]==t;var s=e.constructor,a=t.constructor;if(s!==a&&!(x.isFunction(s)&&s instanceof s&&x.isFunction(a)&&a instanceof a))return!1;n.push(e),i.push(t);var l=0,u=!0;if("[object Array]"==o){if(l=e.length,u=l==t.length)for(;l--&&(u=A(e[l],t[l],n,i)););}else{for(var d in e)if(x.has(e,d)&&(l++,!(u=x.has(t,d)&&A(e[d],t[d],n,i))))break;if(u){for(d in t)if(x.has(t,d)&&!l--)break;u=!l}}return n.pop(),i.pop(),u};x.isEqual=function(e,t){return A(e,t,[],[])},x.isEmpty=function(e){if(null==e)return!0;if(x.isArray(e)||x.isString(e))return 0===e.length;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!(!e||1!==e.nodeType)},x.isArray=w||function(e){return"[object Array]"==c.call(e)},x.isObject=function(e){return e===Object(e)},S(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return c.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!(!e||!x.has(e,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(e){return"function"==typeof e}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==c.call(e)},x.isNull=function(e){return null===e},x.isUndefined=function(e){return void 0===e},x.has=function(e,t){return u.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){for(var i=Array(Math.max(0,e)),o=0;e>o;o++)i[o]=t.call(n,o);return i},x.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};M.unescape=x.invert(M.escape);var L={escape:new RegExp("["+x.keys(M.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(M.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return null==t?"":(""+t).replace(L[e],function(t){return M[e][t]})}}),x.result=function(e,t){if(null!=e){var n=e[t];return x.isFunction(n)?n.call(e):n}},x.mixin=function(e){S(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return s.apply(e,arguments),B.call(this,n.apply(x,e))}})};var F=0;x.uniqueId=function(e){var t=++F+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var D=/(.)^/,O={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},N=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var i;n=x.defaults({},n,x.templateSettings);var o=new RegExp([(n.escape||D).source,(n.interpolate||D).source,(n.evaluate||D).source].join("|")+"|$","g"),r=0,s="__p+='";e.replace(o,function(t,n,i,o,a){return s+=e.slice(r,a).replace(N,function(e){return"\\"+O[e]}),n&&(s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),i&&(s+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),o&&(s+="';\n"+o+"\n__p+='"),r=a+t.length,t}),s+="';\n",n.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{i=new Function(n.variable||"obj","_",s)}catch(e){throw e.source=s,e}if(t)return i(t,x);var a=function(e){return i.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+s+"}",a},x.chain=function(e){return x(e).chain()};var B=function(e){return this._chain?x(e).chain():e};x.mixin(x),S(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=i[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],B.call(this,n)}}),S(["concat","join","slice"],function(e){var t=i[e];x.prototype[e]=function(){return B.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),define("underscore",function(e){return function(){var t;return t||e._}}(this)),define("modules/emailbuilder/services/browser",["modules/emailbuilder/module","vendor/angular"],function(e,t){e.factory("BrowserSrv",["$window","$document",function(e,t){function n(){var e=t[0].createElement("INPUT");return e.type="file","files"in e}function i(){var e=new XMLHttpRequest;return!!(e&&"upload"in e&&"onprogress"in e.upload)}function o(){return!!e.FormData}function r(){return"undefined"!=typeof Worker}function s(){return n()&&i()&&o()}var a=e.navigator.userAgent.toLowerCase(),l=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{current:{browser:l[1]||"",version:l[2]||"0",isIE9:function(){return"msie"===l[1]&&"9.0"===l[2]}(),supports:{html5UploadWithProgress:s,webWorker:r}}}}])});var EasyWebWorker,_ExecuteStructure,_WorkerFallback,_WorkerSideController,_WorkerSideFallback,__hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var i in t)__hasProp.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},__bind=function(e,t){return function(){return e.apply(t,arguments)}};_ExecuteStructure=function(){function e(){}return e.prototype.execute=function(e){var t,n,i,o;for(o=[],n=0,i=e.length;n<i;n++)t=e[n],o.push(t);return o},e.prototype.listen=function(e){var t,n,i,o,r,s,a,l,c;if(t=e.data,r=t[0],t=t.slice(1),t.unshift(e),r.indexOf(".")!==-1){for(s=r.split("."),"window"===s[0]&&"WebWorker"===e.caller?(r=window,s=s.slice(1)):r=this.context,i=s.length,a=l=0,c=s.length;l<c;a=++l)o=s[a],r=r[o],a===i-2&&(n=r);return r.apply(n,t)}return this.context[r].apply(this.context,t)},e}(),EasyWebWorker=function(e){function t(e,t,n){var i,o,r=this;this.fileUrl=e,this.callerContext=t,this.context=this.callerContext,null!=n&&(i=this.fileUrl.indexOf("?")!==-1?"&":"?",o=null!==n?JSON.stringify(n):null,this.fileUrl+=i+o),this.worker=new Worker(this.fileUrl,this),this.worker.onmessage=function(){return r.listen.apply(r,arguments)},this.worker.onerror=function(e){return r.error.call(r,e,e.filename,e.lineno,e.message)}}return __extends(t,e),t.prototype.listen=function(e){return e.caller="WebWorker",t.__super__.listen.call(this,e)},t.prototype.execute=function(){return this.worker.postMessage(t.__super__.execute.call(this,arguments))},t.prototype.error=function(){if(this.onerror instanceof Function)return this.onerror.apply(this.callerContext,arguments)},t.prototype.terminate=function(){return this.worker.terminate()},t.prototype.close=function(){return this.worker.terminate()},t}(_ExecuteStructure),_WorkerSideController=function(e){function t(e){var t,n,i,o=this;this.self=e,this.context=this.self,t=this.self.location.href,n=t.indexOf("&")!==-1?"&":t.indexOf("?")!==-1&&"?",n!==!1&&(i=t.split(n),i=i[i.length-1]),null!==i&&void 0!==i?this.self.startupData=JSON.parse(decodeURIComponent(i)):this.self.startupData=null,this.self.onmessage=function(){return o.listen.apply(o,arguments)}}return __extends(t,e),t.prototype.listen=function(e){return e.caller="WebBrowser",t.__super__.listen.call(this,e)},t.prototype.execute=function(){return this.self.postMessage(t.__super__.execute.call(this,arguments))},t.prototype.log=function(){return this.self.execute("window.console.log",arguments)},t}(_ExecuteStructure),_WorkerSideFallback=function(e){function t(){t.__super__.constructor.call(this,{location:{href:easyWebWorkerInstance.fileUrl}}),this.startupData=this.self.startupData}return __extends(t,e),t.prototype.terminate=function(){return easyWebWorkerInstance.worker.terminate()},t.prototype.log=function(){return console.log.apply(console,arguments)},t.prototype.execute=function(){var e;return easyWebWorkerInstance.listen.call(easyWebWorkerInstance,{worker_fallback:!0,data:function(){var t,n,i;for(i=[],t=0,n=arguments.length;t<n;t++)e=arguments[t],i.push(e);return i}.apply(this,arguments)})},t}(_WorkerSideController),_WorkerFallback=function(){function _WorkerFallback(e,t,n,i,o,r){this.easyWebWorkerInstance=t,this.files=null!=n?n:{},this.quene=null!=i?i:[],this.depth=null!=o?o:0,this.worker=null!=r?r:null,this.terminate=__bind(this.terminate,this),this._initializeScript=__bind(this._initializeScript,this),this._loadFile(e,!0)}var importscripts_regexp;return importscripts_regexp=/importScripts\(["'](.*?)["']\)[;,]/gi,_WorkerFallback.prototype._loadFile=function(e,t){var n,i,o,r,s=this;null==t&&(t=!1),i=null,t||(this.files[e].content=null),n=new XMLHttpRequest||new ActiveXObject("Msxml2.XMLHTTP")||new ActiveXObject("Microsoft.XMLHTTP"),n.onreadystatechange=function(){if(4===n.readyState&&(200===n.status||window.location.href.indexOf("http")===-1))return r()},r=function(){return i=n.responseText,t?s.files.main={content:i,depth:0}:s.files[e].content=i,s._importScripts(i)};try{return n.open("GET",e,!0),n.send(null)}catch(t){if(o=t,"undefined"!=typeof XDomainRequest)return n=new XDomainRequest,n.onerror=n.onprogress=function(){},n.onload=r,n.open("GET",e,!0),n.send(null)}},_WorkerFallback.prototype._importScripts=function(e){var t,n,i,o,r,s,a,l,c,u,d=this;if(r=e.match(importscripts_regexp),null!=r)for(this.depth++,s=0,a=r.length;s<a;s++)o=r[s],this.files[o.replace(importscripts_regexp,";$1;")]={content:void 0,depth:this.depth};l=this.files;for(i in l)n=l[i],void 0===n.content&&"main"!==i&&this._loadFile(i);t=!0,c=this.files;for(i in c)n=c[i],void 0!==n.content&&null!==n.content||(t=!1);if(t){for(;this.depth--;){u=this.files;for(i in u)n=u[i],n.depth===this.depth&&(this.files[i].content=this.files[i].content.replace(importscripts_regexp,function(e,t,n,i){return d.files[t].content}))}return this._initializeScript(this.files.main.content)}},_WorkerFallback.prototype._initializeScript=function(script){var command,_i,_len,_ref,_results,_this=this;for(function(){var easyWebWorkerInstance,self;return easyWebWorkerInstance=_this.easyWebWorkerInstance,eval(script),self=new _WorkerSideFallback,_this.worker=function(command){var args,event,funcContext,funcName;return event={caller:"WebBrowser",command:command},funcName=command[0],args=command.slice(1),args.unshift(event),funcName.indexOf(".")!==-1?(funcContext=funcName.split("."),funcContext.pop(),funcContext=funcContext.join("."),funcContext=eval(funcContext)):funcContext=eval(funcName),eval(funcName).apply(funcContext,args)}}(),_ref=this.quene,_results=[],_i=0,_len=_ref.length;_i<_len;_i++)command=_ref[_i],_results.push(this.worker(command));return _results},_WorkerFallback.prototype.postMessage=function(e){return null!=this.worker?this.worker(e):this.quene.push(e)},_WorkerFallback.prototype.terminate=function(){return this.worker=function(){return null}},_WorkerFallback}(),void 0===this.document||window.Worker||(window.Worker=_WorkerFallback),void 0===this.document&&(self.caller=new _WorkerSideController(self),self.execute=self.caller.execute,self.log=self.caller.log),define("vendor/easy-web-worker",function(){}),define("modules/emailbuilder/services/webWorker",["vendor/angular","modules/emailbuilder/module","vendor/easy-web-worker"],function(e,t,n){function i(){}i.prototype.create=function(e){return new Worker(e)},t.service("WebWorkerSrv",[i])}),function(){function e(e){return e.replace(/[^A-Za-z0-9\-_.]+/g,"")}var t=function(t){var n=t.file,i=t.token,o=new XMLHttpRequest;o.open("POST",t.url,!0),o.setRequestHeader(i.key,i.value),o.setRequestHeader("x-filename",e(n.name)),o.setRequestHeader("Content-Type","X-Fileupload"),o.addEventListener("readystatechange",function(e){4==o.readyState&&(200==o.status?self.postMessage({status:"success",data:JSON.parse(o.responseText)}):449==hxr.status?self.postMessage({status:"retry"}):self.postMessage({status:"error"}))}),o.addEventListener("error",function(){self.postMessage({status:"error"})}),self.postMessage({status:"started"}),o.send(n)};self.addEventListener("message",function(e){var n=e.data;e.origin&&e.origin.indexOf("http")>-1||t(n)})}(),define("modules/emailbuilder/workers/uploadFile",function(){}),define("modules/emailbuilder/services/asyncFileUploader",["vendor/angular","modules/emailbuilder/module","modules/emailbuilder/services/browser","modules/emailbuilder/services/webWorker","modules/emailbuilder/workers/uploadFile","jquery"],function(e,t,n,i,o,r){function s(e,t){var n=null;try{n=t.target.status}catch(e){return}n!=u&&(e.onError=e.onError())}function a(e){var t=this,n=t._.wws.create("/js/modules/emailbuilder/workers/uploadFile.js"),i=function(){n.terminate(),n=null},o=3,r=function(){n.postMessage({token:t._.af.get(),url:e.action,file:e.file})};n.onmessage=function(t){var n=t.data,s=!1;switch(n.status){case"error":e.onError(),s=!0;break;case"retry":if(o--,o<=0){e.onError(),s=!0;break}r();break;case"started":e.onStart&&e.onStart();break;default:s=!0,e.onComplete(n.data)}s&&setTimeout(i,0)},r()}function l(e){e.onStart&&e.onStart(this);var t=Math.round(1e6*Math.random()),n="_iframeupload_"+t,i="_formupload_"+t,o=r("<form />").attr({id:i,name:i,action:e.action,method:"POST",enctype:"multipart/form-data",target:n}),a=this._.af.get(),l=r('<input type="text" />').attr({style:"display:none",name:a.key,value:a.value}),c=r("<iframe />").attr({style:"display:none",name:n,id:n}),u=c.get(0);u.addEventListener?u.addEventListener("onreadystatechange",function(t){s(e,t)},!1):u.attachEvent&&u.attachEvent("onreadystatechange",function(t){s(e,t)});var d=this._.$doc.find("body");e.file.wrap(o),o=e.file.parent(),o.append(l),d.append(c),c.load(function(){var t,n=c.contents().find("body").html();if(n)try{t=r.parseJSON(n),e.onComplete&&e.onComplete(t)}catch(t){e.onError&&e.onError("invalidSize")}finally{setTimeout(function(){l.remove(),e.file.unwrap(),c.remove()},200)}}),o.submit()}function c(e,t,n,i){var o=e.current.supports.html5UploadWithProgress();this._={af:i,$doc:n,wws:t},this.send=o?a:l}var u=200;t.service("AsyncFileUploaderSvc",["BrowserSrv","WebWorkerSrv","$document","csAntiforgeryToken",c])}),define("modules/emailbuilder/services/imageValidation",["vendor/angular","modules/emailbuilder/module","config"],function(e,t,n){function i(e){return e.size<=1048576*n.settings.maxFileSizeInMB}function o(e){return null!==e.type.match(a)}function r(e){var t=e.file,n=[];return o(t)||n.push("invalidType"),i(t)||n.push("invalidSize"),!!n.length&&n}function s(){return{validate:r}}var a=/image\/(?!tiff)/i;t.factory("ImageValidationSrv",[s])}),function(e,t){"object"==typeof module&&module.exports?module.exports=function(e){return e=e||require("underscore"),t(e)}:"function"==typeof define&&define.amd?define("vendor/postal",["underscore"],function(n){return t(n,e)}):e.postal=t(e._,e)}(this,function(e,t,n){var i,o=function(){var t;return function(n){var i=!1;return e.isString(n)?(i=n===t,t=n):(i=e.isEqual(n,t),t=e.clone(n)),!i}},r=function(){var t=[];return function(n){var i=!e.any(t,function(t){return e.isObject(n)||e.isArray(n)?e.isEqual(n,t):n===t});return i&&t.push(n),i}},s=function(e){this.channel=e||i.configuration.DEFAULT_CHANNEL};s.prototype.subscribe=function(){return 1===arguments.length?new a(this.channel,arguments[0].topic,arguments[0].callback):new a(this.channel,arguments[0],arguments[1])},s.prototype.publish=function(){var e=1===arguments.length?"[object String]"===Object.prototype.toString.call(arguments[0])?{topic:arguments[0]}:arguments[0]:{topic:arguments[0],data:arguments[1]};return e.channel=this.channel,i.configuration.bus.publish(e)};var a=function(e,t,n){if(3!==arguments.length)throw new Error("You must provide a channel, topic and callback when creating a SubscriptionDefinition instance.");if(0===t.length)throw new Error("Topics cannot be empty");this.channel=e,this.topic=t,this.callback=n,this.constraints=[],this.context=null,i.configuration.bus.publish({channel:i.configuration.SYSTEM_CHANNEL,topic:"subscription.created",data:{event:"subscription.created",channel:e,topic:t}}),i.configuration.bus.subscribe(this)};a.prototype={unsubscribe:function(){this.inactive||(this.inactive=!0,i.configuration.bus.unsubscribe(this),i.configuration.bus.publish({channel:i.configuration.SYSTEM_CHANNEL,topic:"subscription.removed",data:{event:"subscription.removed",channel:this.channel,topic:this.topic}}))},defer:function(){var e=this,t=this.callback;return this.callback=function(n,i){setTimeout(function(){t.call(e.context,n,i)},0)},this},disposeAfter:function(t){if(e.isNaN(t)||t<=0)throw"The value provided to disposeAfter (maxCalls) must be a number greater than zero.";var n=this,i=this.callback,o=e.after(t,e.bind(function(){this.unsubscribe()},this));return this.callback=function(){i.apply(n.context,arguments),o()},this},distinctUntilChanged:function(){return this.withConstraint(new o),this},distinct:function(){return this.withConstraint(new r),this},once:function(){return this.disposeAfter(1),this},withConstraint:function(t){if(!e.isFunction(t))throw"Predicate constraint must be a function";return this.constraints.push(t),this},withConstraints:function(t){var n=this;return e.isArray(t)&&e.each(t,function(e){n.withConstraint(e)}),n},withContext:function(e){return this.context=e,this},withDebounce:function(t,n){if(e.isNaN(t))throw"Milliseconds must be a number";var i=this.callback;return this.callback=e.debounce(i,t,!!n),this},withDelay:function(t){if(e.isNaN(t))throw"Milliseconds must be a number";var n=this,i=this.callback;return this.callback=function(e,o){setTimeout(function(){i.call(n.context,e,o)},t)},this},withThrottle:function(t){if(e.isNaN(t))throw"Milliseconds must be a number";var n=this.callback;return this.callback=e.throttle(n,t),this},subscribe:function(e){return this.callback=e,this}};var l={cache:{},regex:{},compare:function(t,n){var i,o,r,s=this.cache[n]&&this.cache[n][t];return"undefined"!=typeof s?s:((o=this.regex[t])||(i="^"+e.map(t.split("."),function(e){var t="";return r&&(t="#"!==r?"\\.\\b":"\\b"),t+="#"===e?"[\\s\\S]*":"*"===e?"[^.]+":e,r=e,t}).join("")+"$",o=this.regex[t]=new RegExp(i)),this.cache[n]=this.cache[n]||{},this.cache[n][t]=s=o.test(n),s)},reset:function(){this.cache={},this.regex={}}},c=function(t,n){!t.inactive&&i.configuration.resolver.compare(t.topic,n.topic)&&e.all(t.constraints,function(e){return e.call(t.context,n.data,n)})&&"function"==typeof t.callback&&t.callback.call(t.context,n.data,n)},u=0,d=[],m=function(){for(;d.length;)p.unsubscribe(d.shift())},p={addWireTap:function(e){var t=this;return t.wireTaps.push(e),function(){var n=t.wireTaps.indexOf(e);n!==-1&&t.wireTaps.splice(n,1)}},publish:function(t){return++u,t.timeStamp=new Date,e.each(this.wireTaps,function(e){e(t.data,t)}),this.subscriptions[t.channel]&&e.each(this.subscriptions[t.channel],function(e){for(var n,i=0,o=e.length;i<o;)(n=e[i++])&&c(n,t)}),0===--u&&m(),t},reset:function(){this.subscriptions&&(e.each(this.subscriptions,function(t){e.each(t,function(e){for(;e.length;)e.pop().unsubscribe()})}),this.subscriptions={})},subscribe:function(e){var t,n=this.subscriptions[e.channel];return n||(n=this.subscriptions[e.channel]={}),t=this.subscriptions[e.channel][e.topic],t||(t=this.subscriptions[e.channel][e.topic]=[]),t.push(e),e},subscriptions:{},wireTaps:[],unsubscribe:function(e){if(u)return void d.push(e);if(this.subscriptions[e.channel][e.topic])for(var t=this.subscriptions[e.channel][e.topic].length,n=0;n<t;){if(this.subscriptions[e.channel][e.topic][n]===e){this.subscriptions[e.channel][e.topic].splice(n,1);break}n+=1}}};if(i={configuration:{bus:p,resolver:l,DEFAULT_CHANNEL:"/",SYSTEM_CHANNEL:"postal"},ChannelDefinition:s,SubscriptionDefinition:a,channel:function(e){return new s(e)},subscribe:function(e){return new a(e.channel||i.configuration.DEFAULT_CHANNEL,e.topic,e.callback)},publish:function(e){return e.channel=e.channel||i.configuration.DEFAULT_CHANNEL,i.configuration.bus.publish(e)},addWireTap:function(e){return this.configuration.bus.addWireTap(e)},linkChannels:function(t,n){var o=[];return t=e.isArray(t)?t:[t],n=e.isArray(n)?n:[n],e.each(t,function(t){var r=t.topic||"#";e.each(n,function(n){var s=n.channel||i.configuration.DEFAULT_CHANNEL;o.push(i.subscribe({channel:t.channel||i.configuration.DEFAULT_CHANNEL,topic:r,callback:function(t,o){var r=e.clone(o);r.topic=e.isFunction(n.topic)?n.topic(o.topic):n.topic||o.topic,r.channel=s,r.data=t,i.publish(r)}}))})}),o},utils:{getSubscribersFor:function(){var e=arguments[0],t=arguments[1];return 1===arguments.length&&(e=arguments[0].channel||i.configuration.DEFAULT_CHANNEL,t=arguments[0].topic),i.configuration.bus.subscriptions[e]&&Object.prototype.hasOwnProperty.call(i.configuration.bus.subscriptions[e],t)?i.configuration.bus.subscriptions[e][t]:[]},reset:function(){i.configuration.bus.reset(),i.configuration.resolver.reset()}}},p.subscriptions[i.configuration.SYSTEM_CHANNEL]={},t&&Object.prototype.hasOwnProperty.call(t,"__postalReady__")&&e.isArray(t.__postalReady__))for(;t.__postalReady__.length;)t.__postalReady__.shift().onReady(i);return i}),define("modules/emailbuilder/services/modelActivity",["modules/emailbuilder/module","vendor/postal"],function(e,t){function n(e){this.chan=t.channel("embModelActivity"),this.active=e.active}n.prototype={contentUpdated:function(e){var t=this.active.content;!e&&t&&(e=t.tempContainer),this.chan.publish("content.updated",[e])},contentAdded:function(e){this.chan.publish("content.added",[e])},contentRemoved:function(e){this.chan.publish("content.removed",[e])},contentMoved:function(e,t){this.chan.publish("content.moved",[e,t])},sectionMoved:function(){this.chan.publish("section.moved")},sectionAdded:function(){this.chan.publish("section.added")},sectionRemoved:function(){this.chan.publish("section.removed")},sectionDuplicated:function(){this.chan.publish("section.duplicated")},sectionPropertyChanged:function(){this.chan.publish("section.propertyChanged")},dynamicContentUsed:function(){this.chan.publish("internal.dynamicContentUsed")},subscribe:function(e,t){return this.chan.subscribe(e,t)}},e.service("ModelActivity",["ActiveContentManager",n])}),define("modules/emailbuilder/services/itemWidth",["modules/emailbuilder/module"],function(e){function t(e,t){var n=e.ss.fromID(t.sectionID);return n.dropzones[t.column]}function n(e){this.ss=e}n.prototype.getBlockWidth=function(e){if("backgroundLayoutImage"===e.displayType||"backgroundEmailImage"===e.displayType)return e.tempMaxImageWidthSvc.maxBackgroundImage;if(e.tempContainer){var n=t(this,e.tempContainer),i=n.width;return"image"!==e.type&&"video"!==e.type||e.isFullWidth||(i-=n.imagePadding),i}},n.prototype.getDropzoneWidth=function(e){return t(this,e).width},e.service("ItemWidthSvc",["embAvailableSectionSelector",n])}),define("modules/emailbuilder/services/imageBuilder",["modules/emailbuilder/module","modules/emailbuilder/services/itemWidth"],function(e,t){function n(e){this.bws=e}n.prototype.resize=function(e){var t=this.getDimensions(e);e.tempHeight=t.height,e.tempWidth=t.width,e.tempResized=t.resized},n.prototype.getDimensions=function(e){var t=0,n=e.originalHeight,i=e.originalWidth,o=this.bws.getBlockWidth(e);return i>o&&(t=Math.min(o/i),i=Math.round(o),n=Math.round(n*t)),n<=0&&(n=1),{width:i,height:n,resized:i===o}},e.service("ImageBuilderSvc",["ItemWidthSvc",n])}),define("modules/emailbuilder/services/logoBestFit",["config","vendor/angular","modules/emailbuilder/module"],function(e,t,n){function i(){}i.prototype.resize=function(e){var t=this.getDimensions(e);e.height=t.height,e.width=t.width},i.prototype.getDimensions=function(t){var n=0,i=e.template.logoMaxWidth||440,o=Math.min(i,300),r=t.originalHeight,s=t.originalWidth,a=s/r;return s<=o&&r<=300?(s=Math.round(s),r=Math.round(r)):s>r?(n=Math.min(i,Math.pow(2e4*a,.5),s),s=Math.round(n),r=Math.round(s/a)):(n=Math.min(Math.pow(1/a*2e4,.5),i,r),r=Math.round(n),s=Math.round(r*a)),{width:s,height:r}},n.service("LogoBestFitSvc",i)}),define("modules/emailbuilder/services/imageDimension",["vendor/angular","modules/emailbuilder/module","modules/emailbuilder/services/imageBuilder","modules/emailbuilder/services/logoBestFit"],function(e,t,n,i){function o(e,t){this._irs=e,this._lrs=t}o.prototype.calculate=function(e){var t={};return"image"!==e.type&&"video"!==e.type||(t=this._irs.getDimensions(e)),
"header"===e.type&&(t=this._lrs.getDimensions(e)),t},t.service("ImageDimensionSvc",["ImageBuilderSvc","LogoBestFitSvc",o])}),function(){var e=function(e){var t=new FileReaderSync,n=t.readAsDataURL(e.file);self.postMessage(n)};this.addEventListener("message",function(t){var n=t.data;t.origin&&t.origin.indexOf("http")>-1||e({file:n})})}(),define("modules/emailbuilder/workers/previewImage",function(){}),define("modules/emailbuilder/services/previewImage",["vendor/angular","modules/emailbuilder/module","modules/emailbuilder/services/imageDimension","modules/emailbuilder/services/webWorker","modules/emailbuilder/workers/previewImage"],function(e,t,n,i){function o(e,t,n){this.imageDimensions=e,this.ws=t,this.q=n}o.prototype.resize=function(t,n){var i,o=e.element("<canvas />")[0],r=e.element("<img />")[0];r.src=n,t.originalHeight=r.height,t.originalWidth=r.width,i=this.imageDimensions.calculate(t),o.width=i.width,o.height=i.height;var s=o.getContext("2d");return s.drawImage(r,0,0,i.width,i.height),o.toDataURL()},o.prototype.setProperties=function(e,t){var n=new Image;n.onload=function(){var n={tempSrc:e};t.resolve(n)},n.src=e},o.prototype.loadPreview=function(e){var t=this,n=e.block(),i=t.ws.create("/js/modules/emailbuilder/workers/previewImage.js"),o=t.q.defer();return i.postMessage(e.file),i.onmessage=function(e){var r=t.resize(n,e.data);t.setProperties(r,o),setTimeout(function(){i.terminate(),i=null},0)},o.promise},t.service("PreviewImageSrv",["ImageDimensionSvc","WebWorkerSrv","$q",o])}),define("modules/emailbuilder/services/MaxImageWidth",["vendor/angular","modules/emailbuilder/module","config"],function(e,t,n){function i(e,t){var i=n.template.sections.reduce(function(e,t){return t.dropzones.reduce(function(e,t){return Math.max(e,t.width)},e)},0);return t&&(e.retina||e.devicePixelRatio>1)&&(i*=1.5),i}function o(t){return{maxSize:e.bind(this,i,t,!0),maxContainerSize:e.bind(this,i,t,!1),maxBackgroundImage:3200}}t.factory("MaxImageWidthSvc",["$window",o])}),define("modules/emailbuilder/services/imageManager",["vendor/angular","modules/emailbuilder/module","modules/emailbuilder/services/asyncFileUploader","modules/emailbuilder/services/browser","modules/emailbuilder/services/imageValidation","modules/emailbuilder/services/modelActivity","modules/emailbuilder/services/previewImage","modules/emailbuilder/services/MaxImageWidth","config"],function(e,t,n,i,o,r,s,a,l){function c(e,t,n,i,o,r,s,a,l,c){this.hasFileApi=t.current.supports.html5UploadWithProgress(),this.pis=i,this.afus=e,this.ivs=n,this.$r=s,this.$q=a,this.$win=l,this.model=o,this.max=r,this.$http=c}function u(e,t,n,i,o){var r=e.Data;t.originalWidth=r.OriginalWidth,t.originalHeight=r.OriginalHeight,t.resize(),this.ready(r.FileName,t,n,i,o)}c.prototype.maxContainerWidth=function(){return this.max.maxContainerSize()},c.prototype.error=function(e,t,n){n=n||"invalidType",e.tempValidation=[n],t.reject(e),this.$r.$broadcast("upload:error",{block:e})},c.prototype.ready=function(e,t,n,i,o){var r=this,s=new Image,a=[l.urls.imagePrefix,e,"?w=",this.max.maxSize()].join("");s.onload=function(){t.tempSrc&&(r.$win.URL.revokeObjectURL(t.tempSrc),delete t.tempSrc),n.resolve(t),t.fileName=e,i&&(t.originalFileName=e),r.model.contentUpdated(t.tempContainer),r.$r.$apply(function(){r.$r.$broadcast(o.success,{block:t})})},s.onerror=function(e){n.reject(e),r.model.contentUpdated(t.tempContainer),r.$r.$apply(function(){r.$r.$broadcast(o.error,{block:t})})},s.src=a},c.prototype.uploadAsync=function(t){var n,i,o=this,r=o.$q.defer(),s={upload:r.promise},a=t.block(!0);if(delete a.tempValidation,a.tempIsValid=!0,o.$r.$broadcast("upload:loading",{block:a}),o.hasFileApi){if(n=o.ivs.validate(t))return void(a&&(a.tempValidation=n,o.$r.$broadcast("upload:error",{block:a})));i=o.pis.loadPreview(t,a),i.then(function(n){var i=t.block();delete i.fileName,e.extend(i,n),i.resize(),o.model.contentUpdated(i.tempContainer)})}var c=o.error.bind(o,t.block,r);return o.afus.send({action:l.urls.image,file:t.file,onStart:function(){o.$r.$apply(function(){o.$r.$broadcast("upload:start",{block:a})})},onComplete:function(e){u.call(o,e,t.block(),r,!0,{error:"upload:error",success:"upload:end"})},onError:c}),s},c.prototype.requestImageDownload=function(e){var t=this,n=t.$q.defer();return t.$r.$broadcast("download:start",{block:e.block}),this.$http.post(l.urls.getImage,{imageUrl:e.url,fileName:e.block.fileName}).success(function(i,o){u.call(t,i,e.block,n,!1,{error:"download:error",success:"download:end"})}),n.promise},t.service("ImageManagerSrv",["AsyncFileUploaderSvc","BrowserSrv","ImageValidationSrv","PreviewImageSrv","ModelActivity","MaxImageWidthSvc","$rootScope","$q","$window","$http",c])}),define("modules/emailbuilder/services/trackingSvc",["config","vendor/angular","modules/emailbuilder/module"],function(e,t,n){function i(t){function n(n){return t.post(e.urls.trackAction,{action:n})}function i(n,i){return t.post(e.urls.trackDuration,{action:n,duration:i})}function o(n){return t.post(e.urls.trackActions,{actions:n})}this.logAction=n,this.logActions=o,this.logDuration=i}n.service("trackingSvc",i),i.$inject=["$http"]}),define("modules/emailbuilder/services/aviary",["config","vendor/angular","modules/emailbuilder/module","modules/emailbuilder/services/imageManager","modules/emailbuilder/services/trackingSvc","modules/emailbuilder/services/itemWidth"],function(e,t,n,i,o,r){function s(n,i,o){function r(){var e=document.getElementById("image-size-recommendation");e&&e.remove()}function s(e){var t=document.head||document.getElementsByTagName("head")[0],n=document.getElementById("image-size-recommendation");null!==n&&void 0!==n||(n=document.createElement("style"),n.setAttribute("id","image-size-recommendation"),n.type="text/css"),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e)),t.appendChild(n)}function a(t){var n=t?e.userActions.aviary[t]:e.userActions.aviary.editor;i.logAction(n)}function l(e){y&&y(),n.requestImageDownload({url:e,block:b}),S.close()}function c(e,t){l(t)}function u(e,t){l(t)}function d(){try{for(var e=JSON.parse(S.getActionList()).actions,t=[],n=0;n<e.length;n++)t.push("Aviary_"+e[n].name);t.length>0&&i.logActions(t)}catch(e){}}function m(e){if(d(),f())return S.saveHiRes(),!1}function p(){return w<b.originalWidth||w<b.originalHeight}function h(){return k<b.originalWidth&&!p()}function f(){return e.hiResImageEditingEnabled&&p()}function g(e){return e.replace(/\?w=\d*/,"")}function v(e){var t=document.createElement("img");t.src=h()?g(b.getSrc()):b.getSrc();var n={image:t,url:t.src,hiresWidth:b.originalWidth,hiresHeight:b.originalHeight,hiresMaxSize:f()?_:w};return f()&&(n.hiresUrl=g(t.src)),S.launch(n),!1}var b,y,w=1024,k=900,_=3200,x=["enhance","effects","orientation","resize","crop","warmth","brightness","sharpness","contrast","saturation","blemish"],S=new Aviary.Feather({apiKey:e.aviaryApiKey,authenticationURL:e.hiResImageEditingEnabled?e.urls.aviaryAuth:null,theme:"dark",tools:x,onSave:c,onSaveHiRes:u,onSaveButtonClicked:m,onLoad:function(){t.element("#avpw_holder").on("click",function(e){e.stopPropagation()})}});this.launchEditor=function(e,t,n,i){if(b=e,y=n,v(t),a(t),i){var l='div.avpw_resize_width:after { content:"Column width is '+o.getBlockWidth(b)+'px"; font-size:11px;color:#ABB7BD;display: block;text-align: center;}';s(l)}else r()}}n.service("AviarySvc",s),s.$inject=["ImageManagerSrv","trackingSvc","ItemWidthSvc"]}),define("modules/emailbuilder/services/imageUiState",["modules/emailbuilder/module"],function(e){function t(e){function t(e){return{initial:e===t.values.initial,uploading:e===t.values.uploading,fileUploaded:e===t.values.fileUploaded,thirdPartyUrl:e===t.values.thirdPartyUrl,thirdPartyUrlTyping:e===t.values.thirdPartyUrlTyping,thirdPartyUrlError:e===t.values.thirdPartyUrlError,hasSrc:e===t.values.fileUploaded||e===t.values.thirdPartyUrl||e===t.values.thirdPartyUrlError,value:e}}return e.$on("upload:start",function(e,n){n.block.state=t.uploading()}),e.$on("upload:end",function(e,n){n.block.state=t.fileUploaded()}),e.$on("upload:error",function(e,n){n.block.state=t.fileUploaded()}),e.$on("download:start",function(e,t){t.block.tempDownloadingImg=!0}),e.$on("download:end",function(e,t){t.block.tempDownloadingImg=!1}),e.$on("download:error",function(e,t){t.block.tempDownloadingImg=!1}),e.$on("image:deleted",function(e,n){n.block.state=t.initial()}),e.$on("thirdPartyImage:success",function(e,n){n.block.state=t.thirdPartyUrl()}),e.$on("thirdPartyImage:typing",function(e,n){n.block.state=t.thirdPartyUrlTyping()}),e.$on("thirdPartyImage:failed",function(e,n){n.block.state=t.thirdPartyUrlError()}),t.values={initial:"initial",uploading:"uploading",fileUploaded:"fileUploaded",thirdPartyUrl:"thirdPartyUrl",thirdPartyUrlTyping:"thirdPartyUrlTyping",thirdPartyUrlError:"thirdPartyUrlError"},t.current=function(e){return e.state?e.state:e.fileName?t.fileUploaded():e.thirdPartyUrl?t.thirdPartyUrl():t.initial()},t.initial=function(){return new t(t.values.initial)},t.uploading=function(){return new t(t.values.uploading)},t.fileUploaded=function(){return new t(t.values.fileUploaded)},t.thirdPartyUrl=function(){return new t(t.values.thirdPartyUrl)},t.thirdPartyUrlTyping=function(){return new t(t.values.thirdPartyUrlTyping)},t.thirdPartyUrlError=function(){return new t(t.values.thirdPartyUrlError)},{UiState:t}}e.service("ImageUiStateSvc",["$rootScope",t])}),define("modules/emailbuilder/services/thirdPartyImageDownloader",["modules/emailbuilder/module","modules/emailbuilder/services/imageBuilder"],function(e,t){function n(e,t){var n=function(n,i){i="undefined"==typeof i?new Image:i,i.onload=function(){n.originalWidth=this.width,n.originalHeight=this.height,t.resize(n),e.$broadcast("thirdPartyImage:success",{block:n})},i.onerror=function(){delete n.originalWidth,delete n.originalHeight,delete n.tempWidth,delete n.tempHeight,delete n.halign,e.$broadcast("thirdPartyImage:failed",{block:n})},i.src=n.src};return{retrieveImage:n}}e.service("ThirdPartyImageDownloaderSvc",["$rootScope","ImageBuilderSvc",n])}),define("modules/emailbuilder/services/personalisation",["modules/emailbuilder/module"],function(e){function t(){var e=function(e){function t(e){var t=i.exec(e);return t&&t.length>1?t[1]:e}if(!e)return e;var n=/\[(.+?)\]/g,i=/[^\[\]]*\[[^,\[\]]*,\s*fallback\s*=([^\[\]]*)?\]+[^\[\]]*/;return e.replace(n,t)};return{replaceWithFallback:e}}e.service("PersonalisationSvc",t)}),define("modules/emailbuilder/directives/dragEvents",["modules/emailbuilder/module","jquery"],function(e,t){var n=[{name:"csDrop",event:"drop"},{name:"csDragover",event:"dragover",dontApply:!0},{name:"csDragleave",event:"dragleave"},{name:"csDragenter",event:"dragenter"}];n.forEach(function(t){var n=t.name,i=t.event,o=!t.dontApply;e.directive(n,["$parse",function(e){return{link:function(t,r,s){var a=e(s[n]);r.on(i,function(e){a(t,{event:e}),o&&t.$apply(),e.preventDefault()})}}}])})}),define("modules/emailbuilder/directives/blockRenderImage",["vendor/angular","modules/emailbuilder/module"],function(e,t){function n(e){return{restrict:"A",link:function(t,n){e.resize(t.block),t.$watch(function(){var e=t.block,n=!1;return(t.$first||t.$last)&&e.isFullWidth&&(e.tempResized||"center"!==e.halign)&&(n="gnd-corner-image gnd-corner-image-"+e.halign,t.$first&&(n+=" gnd-corner-image-top"),t.$last&&(n+=" gnd-corner-image-bottom")),n},function(e){n.removeClass("gnd-corner-image gnd-corner-image-bottom gnd-corner-image-top gnd-corner-image-left gnd-corner-image-right gnd-corner-image-center"),e&&n.addClass(e)})}}}t.directive("embBlockRenderImage",["ImageBuilderSvc",n])}),define("vendor/text",["module"],function(e){"use strict";var t,n,i,o,r,s=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],a=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,c="undefined"!=typeof location&&location.href,u=c&&location.protocol&&location.protocol.replace(/\:/,""),d=c&&location.hostname,m=c&&(location.port||void 0),p={},h=e.config&&e.config()||{};return t={version:"2.0.10",strip:function(e){if(e){e=e.replace(a,"");var t=e.match(l);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:h.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;t<3;t+=1){n=s[t];try{e=new ActiveXObject(n)}catch(e){}if(e){s=[n];break}}return e},parseName:function(e){var t,n,i,o=!1,r=e.indexOf("."),s=0===e.indexOf("./")||0===e.indexOf("../");return r!==-1&&(!s||r>1)?(t=e.substring(0,r),n=e.substring(r+1,e.length)):t=e,i=n||t,r=i.indexOf("!"),r!==-1&&(o="strip"===i.substring(r+1),i=i.substring(0,r),n?n=i:t=i),{moduleName:t,ext:n,strip:o}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,i,o){var r,s,a,l=t.xdRegExp.exec(e);return!l||(r=l[2],s=l[3],s=s.split(":"),a=s[1],s=s[0],!(r&&r!==n||s&&s.toLowerCase()!==i.toLowerCase()||(a||s)&&a!==o))},finishLoad:function(e,n,i,o){i=n?t.strip(i):i,h.isBuild&&(p[e]=i),o(i)},load:function(e,n,i,o){if(o.isBuild&&!o.inlineText)return void i();h.isBuild=o.isBuild;var r=t.parseName(e),s=r.moduleName+(r.ext?"."+r.ext:""),a=n.toUrl(s),l=h.useXhr||t.useXhr;return 0===a.indexOf("empty:")?void i():void(!c||l(a,u,d,m)?t.get(a,function(n){t.finishLoad(e,r.strip,n,i)},function(e){i.error&&i.error(e)}):n([s],function(e){t.finishLoad(r.moduleName+"."+r.ext,r.strip,e,i)}))},write:function(e,n,i,o){if(p.hasOwnProperty(n)){var r=t.jsEscape(p[n]);i.asModule(e+"!"+n,"define(function () { return '"+r+"';});\n")}},writeFile:function(e,n,i,o,r){var s=t.parseName(n),a=s.ext?"."+s.ext:"",l=s.moduleName+a,c=i.toUrl(s.moduleName+a)+".js";t.load(l,i,function(n){var i=function(e){return o(c,e)};i.asModule=function(e,t){return o.asModule(e,c,t)},t.write(e,l,i,r)},r)}},"node"===h.env||!h.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(n=require.nodeRequire("fs"),t.get=function(e,t,i){try{var o=n.readFileSync(e,"utf8");0===o.indexOf("\ufeff")&&(o=o.substring(1)),t(o)}catch(e){i(e)}}):"xhr"===h.env||!h.env&&t.createXhr()?t.get=function(e,n,i,o){var r,s=t.createXhr();if(s.open("GET",e,!0),o)for(r in o)o.hasOwnProperty(r)&&s.setRequestHeader(r.toLowerCase(),o[r]);h.onXhr&&h.onXhr(s,e),s.onreadystatechange=function(t){var o,r;4===s.readyState&&(o=s.status,o>399&&o<600?(r=new Error(e+" HTTP status: "+o),r.xhr=s,i(r)):n(s.responseText),h.onXhrComplete&&h.onXhrComplete(s,e))},s.send(null)}:"rhino"===h.env||!h.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var n,i,o="utf-8",r=new java.io.File(e),s=java.lang.System.getProperty("line.separator"),a=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),o)),l="";try{for(n=new java.lang.StringBuffer,i=a.readLine(),i&&i.length()&&65279===i.charAt(0)&&(i=i.substring(1)),null!==i&&n.append(i);null!==(i=a.readLine());)n.append(s),n.append(i);l=String(n.toString())}finally{a.close()}t(l)}:("xpconnect"===h.env||!h.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(i=Components.classes,o=Components.interfaces,Components.utils.import("resource://gre/modules/FileUtils.jsm"),r="@mozilla.org/windows-registry-key;1"in i,t.get=function(e,t){var n,s,a,l={};r&&(e=e.replace(/\//g,"\\")),a=new FileUtils.File(e);try{n=i["@mozilla.org/network/file-input-stream;1"].createInstance(o.nsIFileInputStream),n.init(a,1,0,!1),s=i["@mozilla.org/intl/converter-input-stream;1"].createInstance(o.nsIConverterInputStream),s.init(n,"utf-8",n.available(),o.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),s.readString(n.available(),l),s.close(),n.close(),t(l.value)}catch(e){throw new Error((a&&a.path||"")+": "+e)}}),t}),define("vendor/text!modules/emailbuilder/templates/imageBlock.html",[],function(){return'<div>\r\n    <div class="c-toolbar-container">\r\n        <div class="c-toolbar" ng-if="!dragging && block.isActive && block.state.hasSrc">\r\n            <div class="c-toolbar__item" ng-if="(!block.state.uploading && block.state.fileUploaded) && !deleteConfirmation">\r\n                <button class="c-toolbar__button" ng-click="launchAviary()">Edit</button>\r\n            </div>\r\n            <div class="c-toolbar__item" ng-if="block.state.fileUploaded && !deleteConfirmation">\r\n                <div class="c-toolbar__button" ng-click="$emit(\'toolbarItemActivated\')">\r\n                    <form>\r\n                        <input emb-file-upload file="block" class="c-toolbar__upload-area emb-invisible-input" name="file" type="file" id="editor-image-chooser-figure" accepts="image/*">\r\n                    </form>\r\n                    Replace\r\n                </div>\r\n            </div>\r\n            <div class="c-toolbar__item" ng-if="canDelete">\r\n                <button emb-item-controls\r\n                        in-use="inUse"\r\n                        item-type="content"\r\n                        item="block"\r\n                        section-index="sectionIndex"\r\n                        content-index="column"\r\n                        item-hovered="hovered"\r\n                        narrow-controls="narrowControls"\r\n                        image-controls="true"\r\n                        closer="toggleDisplay"></button>\r\n            </div>\r\n        </div>\r\n        <emb-validation-messages model="block" clear-on-inactive="1"></emb-validation-messages>\r\n    </div>\r\n    <div id="emb-js-image-{{block.tempContainer.section}}-{{block.tempContainer.column}}" class="emb-content-inner emb-js-content-inner emb-js-content-handle emb-handle"\r\n         ng-class="{ \'emb-active\' :!dragging && block.isActive, \'emb-hoverable\' : !dragging && !block.isActive, \'emb-img-showing-dropzone\' :  !block.state.hasSrc }"\r\n         ng-mouseover="hovered = true; $event.stopPropagation()"\r\n         ng-mouseout="hovered = false;">\r\n        <div emb-item-controls item-type="content" item="block" section-index="sectionIndex" content-index="column" item-hovered="hovered"></div>\r\n        <div ng-show="!block.state.hasSrc && !block.state.uploading">\r\n            <div class="emb-js-img-container emb-img-dropzone emb-reset"\r\n                 ng-class="{ \'emb-error\' : !block.tempIsValid && block.isActive, \'emb-hovered\': hovered }">\r\n                <div class="emb-dropzone-container emb-js-dropzone-container">\r\n                    <div ng-class="{ \'emb-img-dropzone--is-interactive\' : !block.state.thirdPartyUrlTyping}" ng-if="!block.state.uploading">\r\n                        <form ng-hide="thirdPartyImagesEnabled">\r\n                            <input name="file" class="emb-invisible-input emb-handle" type="file" accepts="image/*" />\r\n                        </form>\r\n    \t\t            <div class="emb-drop-icon" style="display:inline-block" ng-if="!block.state.uploading">\r\n                            <span class="emb-image-well">Upload Image</span>\r\n    \t\t            </div>\r\n                        <div class="emb-image-text" ng-show="block.state.thirdPartyUrlTyping">\r\n                            <abbr cs-truncate="block.thirdPartyUrl"\r\n                                  side="{{truncateUrlSide}}"\r\n                                  max-width="{{truncateMaxWidth}}"\r\n                                  title="{{block.thirdPartyUrl}}"></abbr>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div ng-show="!block.state.hasSrc && block.state.uploading">\r\n            <div class="emb-js-img-container emb-img-dropzone emb-reset emb-image-loading">\r\n                <div class="loading-animation">\r\n                    <span></span>\r\n                    <span></span>\r\n                    <span></span>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div ng-show="block.state.hasSrc && !block.state.thirdPartyUrlError">\r\n            <div class="loading loading--stand-out" ng-show="block.tempDownloadingImg">\r\n                <div class="loading__inner">\r\n                    <span class="loading__inner__dot"></span>\r\n                    <span class="loading__inner__dot"></span>\r\n                    <span class="loading__inner__dot"></span>\r\n                </div>\r\n            </div>\r\n            <div ng-transclude\r\n                 class="emb-js-img-container emb-img-container"\r\n                 ng-class="{ \'emb-error\' : !block.tempIsValid && block.isActive }">\r\n            </div>\r\n        </div>\r\n        <div ng-show="block.state.thirdPartyUrlError">\r\n            <div class="emb-js-img-container emb-img-dropzone emb-img-error emb-reset">\r\n                <div class="emb-dropzone-container emb-js-dropzone-container">\r\n                    <div class="emb-drop-icon">\r\n                        <div class="emb-image-error"></div>\r\n                        <div class="emb-image-error-text">Unable to load image</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("ts/modules/emailbuilder/services/lockLevelSvc",["vendor/angular","modules/emailbuilder/module","config"],function(e,t,n){var i=function(){function e(){this.dragAndDropLocked=!1,this.anyLocking=!1,this.canDeleteContentItems=!0,this.canEditContentItems=!0,this.restrictedTextStyles=!1,this.canEditContentItemStyles=!0}return e}(),o=function(){function e(e){var t=this;this.getLocks=function(e){var o=new i;return n.canvasSectionPermissions?("none"!==e.lockLevel&&(t.encounteredLocking=!0),"full"===e.lockLevel&&(o.canEditContentItems=!1),"full"!==e.lockLevel&&"partial"!==e.lockLevel&&"partial-removable"!==e.lockLevel||(o.dragAndDropLocked=!0,o.anyLocking=!0,o.restrictedTextStyles=!0,o.canEditContentItemStyles=!1,o.canDeleteContentItems=!1),o):o},this.permissionsChanged=function(e,n){t.rootScope.$broadcast("permissionsChanged:"+e,n)},this.anyLocking=function(){return t.encounteredLocking},this.rootScope=e,this.encounteredLocking=!1}return e}();t.service("LockLevelSvc",["$rootScope",o])}),define("ts/modules/emailbuilder/directives/imageBlock",["config","vendor/angular","underscore","modules/emailbuilder/module","modules/emailbuilder/services/browser","modules/emailbuilder/services/imageManager","modules/emailbuilder/services/aviary","modules/emailbuilder/services/imageUiState","modules/emailbuilder/services/thirdPartyImageDownloader","modules/emailbuilder/services/personalisation","modules/emailbuilder/directives/dragEvents","modules/emailbuilder/directives/blockRenderImage","vendor/text!modules/emailbuilder/templates/imageBlock.html","ts/modules/emailbuilder/services/lockLevelSvc"],function(e,t,n,i,o,r,s,a,l,c,u,d,m,p){function h(e){return e<300}function f(i,o,r,s,a,l,c,u,d){return{restrict:"A",replace:!0,template:m,transclude:!0,scope:!0,link:function(m,p){function f(e){var t=d.getLocks(e);m.canDelete=t.canDeleteContentItems}m.deleteConfirmation=!1,f(m.section.permissions),m.$on("permissionsChanged:section-"+m.section.uiId,function(e,t){f(t)});var g=u.find(".emb-js-image-upload");m.thirdPartyImagesEnabled=e.canvasThirdPartyImageUrlEnabled,m.truncateUrlSide=h(m.width)?"left":"center",m.truncateMaxWidth=p[0].clientWidth-30,m.launchAviary=function(e){r.launchEditor(m.block,e,null,!0)},m.deleteImage=function(){m.block.reset(),g.each(function(){this.reset()})},m.block.state=s.UiState.current(m.block),m.block.src=l.replaceWithFallback(m.block.getSrc()),m.$watch("block.getSrc()",function(e,t){m.block.thirdPartyUrl&&e!==t&&c.$broadcast("thirdPartyImage:typing",{block:m.block})});var v=function(){var e=p.find('input[type="file"]');e.length>0&&e.parent()[0].reset()};m.$watch("block.getSrc()",n.debounce(function(e){v(),m.allowReplace=!e,m.block.src=l.replaceWithFallback(e),m.block.thirdPartyUrl&&a.retrieveImage(m.block)},500)),c.$$postDigest(function(){c.$$postDigest(function(){p.find(".emb-img-dropzone").css({position:"static"}).css({position:"relative"})})}),c.$on("content:showConfirmation",function(){m.deleteConfirmation=!0}),c.$on("content:hideConfirmation",function(){m.deleteConfirmation=!1});var b=i.current.supports.html5UploadWithProgress();p.on({change:function(){var e=t.element(this);if(""!==e.val()){var n=b?this.files[0]:e;o.uploadAsync({file:n,block:function(){return m.block}})}}},'input[type="file"]')}}}i.directive("embImageBlock",["BrowserSrv","ImageManagerSrv","AviarySvc","ImageUiStateSvc","ThirdPartyImageDownloaderSvc","PersonalisationSvc","$rootScope","$document","LockLevelSvc",f])}),define("vendor/text!modules/emailbuilder/templates/dropzone.html",[],function(){return'<div class="emb-js-dropzone-wrap" bindonce="relativity" bo-style="relativity">\r\n    <div class="emb-dropzone emb-reset" ng-class="dropzone" ng-if="!hasContent">\r\n        &nbsp;\r\n        <div class="emb-dz-wrap emb-js-content-dropzone" bindonce="wrapperSize" bo-style="wrapperSize" emb-sortable\r\n            connect-with=".emb-js-content-container" model="block" handle=".emb-js-content-handle" type="content">\r\n            <div class="emb-insertion-bar emb-reset" bindonce="width" bo-style="{ width: width + \'px\' }"></div>\r\n            <div class="emb-dz-container" bindonce="dark || dynamicColor" bo-class="{ \'emb-dark\': dark, \'emb-dynamic-color\': dynamicColor }">\r\n                <div class="emb-dz-inner">\r\n                    <span>Drag content here</span>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <ng-include ng-show="content.tempHasPadding" src="sectionId | topPaddingUrl : column"></ng-include>\r\n    <div cs-dragenter="captured = true" cs-dragleave="captured = false" class="emb-js-content-container" ng-class="container" cs-dropline-container emb-sortable\r\n        connect-with=".emb-js-content-container,.emb-js-content-dropzone" model="block" handle=".emb-js-content-handle" type="content">\r\n        <div class="emb-js-content-outer-wrapper emb-content-wrapper"\r\n             ng-class="{\r\n             \'emb-active\' : !readOnly && block.isActive,\r\n             \'emb-hovered\' : !readOnly && hovered && !dragging,\r\n             \'emb-block-errors\': !block.tempIsValid,\r\n             \'emb-column-padding-top\': !((block.type == \'image\' || block.type == \'video\') && block.isFullWidth) && $first,\r\n             \'emb-column-padding-bottom\': !((block.type == \'image\' || block.type == \'video\') && block.isFullWidth) && $last,\r\n             \'emb-column-padding-not-last\': !((block.type == \'image\' || block.type == \'video\') && block.isFullWidth) && !$last,\r\n             \'emb-column-padding\' : !((block.type == \'image\' || block.type == \'video\') && block.isFullWidth),\r\n             \'emb-after-image\': content.content[$index-1].type == \'image\' || content.content[$index-1].type == \'video\'\r\n             }"\r\n             ng-repeat="block in content.content"\r\n             ng-mouseover="hovered = true; $event.stopPropagation()"\r\n             cs-dragenter="hovered = true;"\r\n             ng-mouseout="hovered = false;"\r\n             cs-dragleave="hovered = false;"\r\n             bindonce="block"\r\n             bo-class="\'emb-block-type-\' + block.type"\r\n             emb-scrolled-off-screen>\r\n            <div class="emb-content-inner emb-js-content-inner"\r\n                 bo-if="block.type != \'text\' && block.type != \'image\' && block.type != \'video\'"\r\n                 ng-mouseenter="hovered = true"\r\n                 ng-mouseleave="hovered = false"\r\n                 ng-class="{\'emb-hovered\': !readOnly && hovered, \'emb-active\': !readOnly && block.isActive, \'emb-hoverable\': !readOnly && !block.isActive, \'emb-block-error\' : !block.tempIsValid && !block.tempIsNew && (block.type == \'button\' || block.type == \'survey\')}"\r\n                 bo-class="\'emb-\' + block.type + \'-inner-wrap\'">\r\n                <div ng-if="!readOnly" emb-item-controls\r\n                     item-type="content"\r\n                     item="block"\r\n                     section-index="sectionIndex"\r\n                     content-index="column"\r\n                     item-hovered="hovered"\r\n                     in-use="block.tempInUse"></div>\r\n                <emb-validation-messages ng-if="block.type === \'button\' || block.type === \'survey\'" model="block" clear-on-active="1"></emb-validation-messages>\r\n                <ng-include class="emb-handle emb-js-content-handle" src="block | contentPaddingUrl:sectionId:column"></ng-include>\r\n            </div>\r\n            <div bo-if="block.type == \'text\' || block.type == \'image\' || block.type == \'video\'">\r\n                <ng-include src="block | contentPaddingUrl:sectionId:column"></ng-include>\r\n            </div>\r\n        </div>\r\n        <div class="emb-insertion-bar emb-reset" ng-show="draggingWithin()"></div>\r\n    </div>\r\n</div>\r\n'}),define("modules/shared/shims",[],function(){Date.now||(Date.now=function(){return+new Date})}),define("vendor/text!modules/emailbuilder/templates/videoBlock.html",[],function(){return'<div id="emb-js-image-{{block.tempContainer.section}}-{{block.tempContainer.column}}" class="emb-content-inner emb-js-content-inner emb-js-content-handle emb-handle"\r\n     ng-class="{ \'emb-active\' :!dragging && block.isActive, \'emb-hoverable\' : !dragging && !block.isActive, \'emb-img-showing-dropzone\' :  !hasImage }"\r\n     ng-mouseover="hovered = true; $event.stopPropagation()"\r\n     ng-mouseout="hovered = false;">\r\n    <div emb-item-controls item-type="content" item="block" section-index="sectionIndex" content-index="column" item-hovered="hovered"></div>\r\n\r\n    <!-- if this section is active show the toolbar -->\r\n\r\n    <div class="c-toolbar" ng-if="!dragging && block.isActive && hasImage">\r\n        <div class="c-toolbar__item">\r\n\r\n            <button emb-item-controls\r\n                    in-use="inUse"\r\n                    item-type="content"\r\n                    item="block"\r\n                    section-index="sectionIndex"\r\n                    content-index="column"\r\n                    item-hovered="hovered"\r\n                    narrow-controls="narrowControls"\r\n                    image-controls="true"\r\n                    closer="toggleDisplay"></button>\r\n        </div>\r\n    </div>\r\n    <emb-validation-messages model="block" clear-on-inactive="1"></emb-validation-messages>\r\n\r\n    <div ng-show="!hasImage && !block.tempLoadingImg">\r\n        <div class="emb-js-img-container emb-img-dropzone emb-reset"\r\n             ng-class="{ \'emb-error\' : !block.tempIsValid && block.isActive, \'emb-hovered\': hovered }">\r\n            <div class="emb-dropzone-container emb-js-dropzone-container">\r\n                <p class="emb-drop-icon" ng-if="!block.tempLoadingImg">\r\n                    <span class="emb-video-well">Select Video</span>\r\n                </p>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div ng-show="!hasImage && block.tempLoadingImg">\r\n        <div class="emb-js-img-container emb-img-dropzone emb-reset emb-image-loading">\r\n            <div class="loading-animation">\r\n                <span></span>\r\n                <span></span>\r\n                <span></span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div ng-show="hasImage">\r\n        <div class="loading loading--stand-out" ng-show="block.tempDownloadingImg">\r\n            <div class="loading__inner">\r\n                <span class="loading__inner__dot"></span>\r\n                <span class="loading__inner__dot"></span>\r\n                <span class="loading__inner__dot"></span>\r\n            </div>\r\n        </div>\r\n        <div ng-transclude\r\n             class="emb-js-img-container emb-img-container"\r\n             ng-class="{ \'emb-error\' : !block.tempIsValid && block.isActive }">\r\n        </div>\r\n    </div>\r\n</div>';
}),define("modules/emailbuilder/directives/videoBlock",["config","vendor/angular","modules/emailbuilder/module","modules/emailbuilder/services/browser","modules/emailbuilder/services/imageManager","modules/emailbuilder/directives/dragEvents","modules/emailbuilder/directives/blockRenderImage","vendor/text!modules/emailbuilder/templates/videoBlock.html"],function(e,t,n,i,o,r,s,a){function l(e,t,n,i){return{restrict:"A",replace:!0,template:a,transclude:!0,link:function(e,t,o){var r=i.find(".emb-js-image-upload");e.launchAviary=function(){},e.deleteImage=function(){e.block.reset(),r.each(function(){this.reset()})},e.$watch("block.getSrc()",function(t){e.hasImage=!!t,e.allowReplace=!t}),n.$on("upload:loading",function(t,n){e.block==n.block&&e.$apply(function(){e.block.tempLoadingImg=!0})}),n.$on("upload:error",function(t,n){e.block==n.block&&e.$apply(function(){e.block.tempLoadingImg=!1})}),n.$on("upload:end",function(t,n){e.block==n.block&&e.$apply(function(){e.block.tempLoadingImg=!1})}),n.$on("download:start",function(t,n){e.block==n.block&&(e.block.tempDownloadingImg=!0)}),n.$on("download:end",function(t,n){e.block==n.block&&(e.block.tempDownloadingImg=!1)}),n.$on("download:error",function(t,n){e.block==n.block&&(e.block.tempDownloadingImg=!1)})}}}n.directive("embVideoBlock",["BrowserSrv","ImageManagerSrv","$rootScope","$document",l])}),define("ts/modules/emailbuilder/directives/dropzone",["vendor/angular","modules/emailbuilder/module","ts/modules/emailbuilder/directives/imageBlock","vendor/text!modules/emailbuilder/templates/dropzone.html","modules/shared/shims","modules/emailbuilder/directives/videoBlock","ts/modules/emailbuilder/services/lockLevelSvc"],function(e,t,n,i,o,r,s){function a(e,t){this.$s=e,e.width=t.getDropzoneWidth(this.getLocation())}function l(t){return t.toArray().map(function(t){return e.element(t).outerHeight()}).reduce(function(e,t){return e+t},0)}function c(t){return{restrict:"A",replace:!1,transclude:!1,template:i,scope:{content:"=",sectionIndex:"&",sectionId:"=",readOnly:"=",column:"@",maxColumn:"@",maxSectionIndex:"&",height:"@",dynamicColor:"@",dark:"@",independent:"@",section:"="},controller:["$scope","ItemWidthSvc",a],link:function(n,i){function o(){clearTimeout(u),n.dropzone="emb-dropzone-inactive",n.droplineActive=!1,n.$digest()}function r(){i.off("sortover dragover"),i.off("sortout sortstop sortreceive drop"),i.off("dragleave")}function s(){r(),i.on("sortover dragover",function(e){var t=e.target.tagName.toLowerCase();"input"!==t?(clearTimeout(u),n.dropzone="",n.droplineActive=!0,n.$digest()):o()}),i.on("sortout sortstop sortreceive drop",o),i.on("dragleave",function(){clearTimeout(u),u=setTimeout(o,30)})}function a(){r(),i.on("sortover dragover",function(t){var i=e.element(t.target);i.data("ui-sortable")&&(d.content[n.column].isHighlighted=!0,n.$emit("section.highlight",d))}),i.on("sortout sortstop sortreceive drop",function(t){var i=e.element(t.target);i.data("ui-sortable")&&(d.content[n.column].isHighlighted=!1,n.$emit("section.highlight",d))}),i.on("dragleave",function(t){var i=e.element(t.target);i.data("ui-sortable")&&(d.content[n.column].isHighlighted=!1,n.$emit("section.highlight",d))})}function c(e){var n=t.getLocks(e);n.dragAndDropLocked?a():s()}n.dynamicColor=!!n.dynamicColor,n.dark=!!n.dark,n.dropzone="emb-dropzone-inactive",n.wrapperSize={width:n.width},n.independent&&(n.relativity={position:"relative"},n.wrapperSize.top=-1*l(i.prevAll()),n.wrapperSize.bottom=-1*l(i.nextAll())),n.content.width<150&&i.addClass("emb-narrow-content"),n.$watch("content.content.length",function(e){var t=!!e;n.hasContent=t,n.container=t?"emb-content-container":"",n.dropzone=t?n.dropzone:"emb-dropzone-inactive"}),n.draggingWithin=function(){return!n.readOnly&&n.droplineActive&&n.dragging&&n.hasContent&&!n.captured};var u,d=n.section;c(d.permissions),n.$on("permissionsChanged:section-"+d.uiId,function(e,t){c(t)})}}}a.prototype.getLocation=function(){var e=this.$s,t=parseInt(e.column,10),n=parseInt(e.maxColumn,10),i=e.sectionIndex();return{readOnly:e.readOnly,sectionID:e.sectionId,column:t,section:i,firstColumn:0===t,firstSection:0===i,lastColumn:t===n,lastSection:i===e.maxSectionIndex()}},a.prototype.hasContent=function(){return this.$s.hasContent},t.directive("embDropzone",["LockLevelSvc",c])}),function(){function e(e){e.easing.jswing=e.easing.swing,e.extend(e.easing,{def:"easeOutQuad",swing:function(t,n,i,o,r){return e.easing[e.easing.def](t,n,i,o,r)},easeInQuad:function(e,t,n,i,o){return i*(t/=o)*t+n},easeOutQuad:function(e,t,n,i,o){return-i*(t/=o)*(t-2)+n},easeInOutQuad:function(e,t,n,i,o){return(t/=o/2)<1?i/2*t*t+n:-i/2*(--t*(t-2)-1)+n},easeInCubic:function(e,t,n,i,o){return i*(t/=o)*t*t+n},easeOutCubic:function(e,t,n,i,o){return i*((t=t/o-1)*t*t+1)+n},easeInOutCubic:function(e,t,n,i,o){return(t/=o/2)<1?i/2*t*t*t+n:i/2*((t-=2)*t*t+2)+n},easeInQuart:function(e,t,n,i,o){return i*(t/=o)*t*t*t+n},easeOutQuart:function(e,t,n,i,o){return-i*((t=t/o-1)*t*t*t-1)+n},easeInOutQuart:function(e,t,n,i,o){return(t/=o/2)<1?i/2*t*t*t*t+n:-i/2*((t-=2)*t*t*t-2)+n},easeInQuint:function(e,t,n,i,o){return i*(t/=o)*t*t*t*t+n},easeOutQuint:function(e,t,n,i,o){return i*((t=t/o-1)*t*t*t*t+1)+n},easeInOutQuint:function(e,t,n,i,o){return(t/=o/2)<1?i/2*t*t*t*t*t+n:i/2*((t-=2)*t*t*t*t+2)+n},easeInSine:function(e,t,n,i,o){return-i*Math.cos(t/o*(Math.PI/2))+i+n},easeOutSine:function(e,t,n,i,o){return i*Math.sin(t/o*(Math.PI/2))+n},easeInOutSine:function(e,t,n,i,o){return-i/2*(Math.cos(Math.PI*t/o)-1)+n},easeInExpo:function(e,t,n,i,o){return 0==t?n:i*Math.pow(2,10*(t/o-1))+n},easeOutExpo:function(e,t,n,i,o){return t==o?n+i:i*(-Math.pow(2,-10*t/o)+1)+n},easeInOutExpo:function(e,t,n,i,o){return 0==t?n:t==o?n+i:(t/=o/2)<1?i/2*Math.pow(2,10*(t-1))+n:i/2*(-Math.pow(2,-10*--t)+2)+n},easeInCirc:function(e,t,n,i,o){return-i*(Math.sqrt(1-(t/=o)*t)-1)+n},easeOutCirc:function(e,t,n,i,o){return i*Math.sqrt(1-(t=t/o-1)*t)+n},easeInOutCirc:function(e,t,n,i,o){return(t/=o/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+n:i/2*(Math.sqrt(1-(t-=2)*t)+1)+n},easeInElastic:function(e,t,n,i,o){var r=1.70158,s=0,a=i;if(0==t)return n;if(1==(t/=o))return n+i;if(s||(s=.3*o),a<Math.abs(i)){a=i;var r=s/4}else var r=s/(2*Math.PI)*Math.asin(i/a);return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*o-r)*(2*Math.PI)/s))+n},easeOutElastic:function(e,t,n,i,o){var r=1.70158,s=0,a=i;if(0==t)return n;if(1==(t/=o))return n+i;if(s||(s=.3*o),a<Math.abs(i)){a=i;var r=s/4}else var r=s/(2*Math.PI)*Math.asin(i/a);return a*Math.pow(2,-10*t)*Math.sin((t*o-r)*(2*Math.PI)/s)+i+n},easeInOutElastic:function(e,t,n,i,o){var r=1.70158,s=0,a=i;if(0==t)return n;if(2==(t/=o/2))return n+i;if(s||(s=o*(.3*1.5)),a<Math.abs(i)){a=i;var r=s/4}else var r=s/(2*Math.PI)*Math.asin(i/a);return t<1?-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*o-r)*(2*Math.PI)/s))+n:a*Math.pow(2,-10*(t-=1))*Math.sin((t*o-r)*(2*Math.PI)/s)*.5+i+n},easeInBack:function(e,t,n,i,o,r){return void 0==r&&(r=1.70158),i*(t/=o)*t*((r+1)*t-r)+n},easeOutBack:function(e,t,n,i,o,r){return void 0==r&&(r=1.70158),i*((t=t/o-1)*t*((r+1)*t+r)+1)+n},easeInOutBack:function(e,t,n,i,o,r){return void 0==r&&(r=1.70158),(t/=o/2)<1?i/2*(t*t*(((r*=1.525)+1)*t-r))+n:i/2*((t-=2)*t*(((r*=1.525)+1)*t+r)+2)+n},easeInBounce:function(t,n,i,o,r){return o-e.easing.easeOutBounce(t,r-n,0,o,r)+i},easeOutBounce:function(e,t,n,i,o){return(t/=o)<1/2.75?i*(7.5625*t*t)+n:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+n:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+n:i*(7.5625*(t-=2.625/2.75)*t+.984375)+n},easeInOutBounce:function(t,n,i,o,r){return n<r/2?.5*e.easing.easeInBounce(t,2*n,0,o,r)+i:.5*e.easing.easeOutBounce(t,2*n-r,0,o,r)+.5*o+i}})}"function"==typeof define?define("vendor/jquery.easing",["jquery"],e):e(jQuery)}(),define("modules/emailbuilder/animations/preview",["vendor/angular","modules/emailbuilder/module","vendor/jquery.easing"],function(e,t,n){function i(t,n,i){function o(){r.trigger("scroll"),s.stop().animate({bottom:0,top:0,left:"321px",right:0},475,function(){e.element(this).css({position:"relative",bottom:"auto",top:"auto","min-height":"100%",left:"auto",right:"auto","border-radius":0,overflow:"visible"})}),l.stop().animate({height:"45px"},475,"easeOutCirc",function(){e.element(this).css({overflow:"visible"})}),c.stop().animate({height:0},475,"easeOutCirc"),u.stop().animate({right:"320px"},475,"easeOutCirc"),d.stop().animate({left:0},475,"easeOutCirc",function(){e.element(this).css({overflow:"visible"}),r.css({"overflow-y":"scroll"})}),i()}var r=t.find(".emb-stage"),s=t.find("#emb-email-container"),a=s.find("#emb-js-email-body"),l=s.find(".emb-addsec-wrap "),c=s.find("#emb-preview-chrome"),u=t.find("#emb-phone-preview"),d=t.find(".emb-sidebar");"emb-show-preview"===n?a.stop().fadeIn(230,o):i()}function o(t,n,i){function o(){var e={bottom:"50px",top:"50px",left:"341px",right:"20px"},t={duration:375,complete:r,easing:"easeOutCirc"};a.css({"overflow-y":"auto"}),d.stop().animate({height:"117px"},375,"easeOutCirc"),u.stop().animate({height:0},375,"easeOutCirc"),l.stop().animate(e,t)}function r(){var e={duration:550,queue:!1,easing:"easeOutCirc"},t={duration:550,queue:!1,easing:"easeOutCirc",complete:s};l.stop().animate({left:"20px",right:"386px"},e),c.stop().fadeOut(e),m.stop().animate({right:"26px"},e),p.css({overflow:"hidden"}).stop().animate({left:"-321px"},t),i()}function s(){e.element(this).find("section.emb-top").css({left:0}).removeClass("emb-closed")}var a=t.find(".emb-stage"),l=t.find("#emb-email-container"),c=l.find("#emb-js-email-body"),u=l.find(".emb-addsec-wrap "),d=l.find("#emb-preview-chrome"),m=t.find("#emb-phone-preview"),p=t.find(".emb-sidebar");"emb-show-preview"===n?(l.css({"border-radius":"5px",position:"absolute",bottom:0,top:0,"min-height":"inherit",left:"321px",right:0,overflow:""}),u.css({overflow:"hidden"}),o()):i()}function r(){return{addClass:o,removeClass:i}}return t.animation(".emb-preview-anim",r),r}),define("modules/emailbuilder/services/templateName",["jquery","modules/emailbuilder/module","config","vendor/postal"],function(e,t,n,i){function o(e,t){this.chan=i.channel("embTemplateName"),this.hasExistingName=!n.mode.newTemplate,this.name=n.template.name,this.innerSave=t.post.bind(t,n.urls.saveTemplate),this.$injector=e}o.prototype.setName=function(e){this.hasExistingName=!0;var t=void 0!==e&&e.length>0;this.name=t?e:n.template.name,this.chan.publish("template.named")},o.prototype.resetName=function(){this.hasExistingName=!1,this.name=n.template.name},o.prototype.subscribe=function(e,t){this.chan.subscribe(e,t)},o.prototype.save=function(){var t;return n.mode.templateWithContent&&n.mode.newTemplate?(t=function(e){e.saveTemplate()},t.$inject=["SaveSvc"],void this.$injector.invoke(t)):this.innerSave(e.param({templateName:this.name}),{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}})},t.service("embTemplateNameProvider",["$injector","$http",o])}),define("modules/emailbuilder/services/screenshot",["modules/emailbuilder/module","config"],function(e,t){function n(e){this.innerEnqueueCampaignScreenshots=e.post.bind(e,t.urls.enqueueCampaignScreenshots),this.innerEnqueueTemplateScreenshots=e.post.bind(e,t.urls.enqueueTemplateScreenshots)}n.prototype.enqueueCampaignScreenshots=function(){return this.innerEnqueueCampaignScreenshots()},n.prototype.enqueueTemplateScreenshots=function(){return this.innerEnqueueTemplateScreenshots()},e.service("ScreenshotSvc",["$http",n])}),define("modules/emailbuilder/services/validation",["modules/emailbuilder/module","config"],function(e,t){function n(){}function i(e){var t=d.exec(e),n=!!t&&t.input===t[0];return n}function o(e,n){var i=(t.settings.enableImprovedLinkValidation?c:a).exec(e),o=!!i&&i.input===i[0];return!o&&n&&(o=n(e)),o}function r(e,n){var i=(t.settings.enableImprovedLinkValidation?u:l).exec(e),o=!!i&&i.input===i[0];return!o&&n&&(o=n(e)),o}function s(e,t){var n=r(e),i=o(e),s=n||i;return!s&&t&&(s=t(e)),s}var a=/\(?((?:https?|ftp):\/\/)?(?:((?:[^\W\s]|\.|-|[:]{1})+)@{1})?((?:www.)?(?:[^\W\s]|\.|-)+[\.][^\W\s]{2,4}|localhost(?=\/)|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(?::(\d*))?([\/]?[^\s\?]*[\/]{1})*(?:\/?([^\s\n\?\[\]\{\}\#]*(?:(?=\.)){1}|[^\s\n\?\[\]\{\}\.\#]*)?([\.]{1}[^\s\?\#]*)?)?(?:\?{1}([^\n\#]*))?([\#][^\s\n]*)?\)?/,l=/^(mailto:)?(?:(?:[^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,c=/^\(?(?:(https?|ftp):)?(\/\/([\w\u0080-\uFFFF\$-\.!:;=~]*@)?([\w\u0080-\uFFFF\$-\.!;=~]*|\[[a-fA-F0-9\:\.]*\])(\:\d*)?|\/[\w\u0080-\uFFFF\$-\.!;=@~]+|[\w\u0080-\uFFFF\$-\.!;=@~]+|)((?:\/[\w\u0080-\uFFFF\$-\.!:;=@~]*)*)(\?[^#]*)?(#.*)?\)?$/,u=/^(?:(mailto):(?:\/\/)?)?((?:[\w\u0080-\uFFFF\$-\-!:;=~]+|\"(?:[\w\u0080-\uFFFF\ !\$-\.\:-\>\[-\]@~]|\\\\|\\\")+\")(?:\.(?:[\w\u0080-\uFFFF\$-\-!:;=~]+|\"(?:[\w\u0080-\uFFFF\ !\$-\.\:-\>\[-\]@~]|\\\\|\\\")+\"))*@([\w\u0080-\uFFFF\$-\.!;=~]*|\[[a-fA-F0-9\:\.]*\]))$/,d=/^(([^\[\]]*\[[^,\[\]]*(,\s*fallback\s*=[^\[\]]*)?\])+[^\[\]]*)$/;n.prototype={url:{regExp:t.settings.enableImprovedLinkValidation?c:a,isValid:o},email:{regExp:t.settings.enableImprovedLinkValidation?u:l,isValid:r},variable:{regExp:d,isValid:i},emailOrUrl:{isValid:s}},e.service("ValidationSrv",[n])}),define("modules/emailbuilder/services/content",["modules/emailbuilder/module","vendor/angular","modules/emailbuilder/services/validation","modules/emailbuilder/services/imageBuilder","modules/emailbuilder/services/logoBestFit","modules/emailbuilder/services/MaxImageWidth","config"],function(e,t,n,i,o,r,s){function a(){}var l={button:function(){var e=!!this.text,t=!!this.href,n=this.tempValidationSrv.emailOrUrl.isValid(this.href,this.tempValidationSrv.variable.isValid);if(e)t?n||(this.tempValidation=["btnInvalidLink"]):this.tempValidation=["btnNoLink"];else{var i="btnNoText";t||(i="btnNoLinkNoText"),this.tempValidation=[i]}this.tempValidation=this.tempValidation||[],this.tempIsValid=this.tempValidation.length>0},survey:function(){var e=!!this.text,t=!!this.href;if(e)t||(this.tempValidation=["surveyNoLink"]);else{var n="surveyNoText";t||(n="surveyNoLinkNoText"),this.tempValidation=[n]}this.tempValidation=this.tempValidation||[],this.tempIsValid=this.tempValidation.length>0}},c={image:function(e){delete e.fileName,delete e.tempSrc,delete e.thirdPartyUrl,delete e.tempThirdPartyUrl,delete e.originalWidth,delete e.originalHeight,delete e.tempWidth,delete e.tempHeight,delete e.src},video:function(e){delete e.fileName,delete e.tempSrc,delete e.thirdPartyUrl,delete e.tempThirdPartyUrl,delete e.originalWidth,delete e.originalHeight,delete e.tempWidth,delete e.tempHeight,delete e.href,delete e.videoUrl,delete e.tempVideoUrl},header:function(e){delete e.fileName,delete e.tempSrc,delete e.originalWidth,delete e.originalHeight,delete e.width,delete e.height,delete e.contents,delete e.src}};a.prototype={isImageType:function(){return"image"===this.type||"video"===this.type},isTextType:function(){return"text"===this.type},getSrc:function(){if(this.thirdPartyUrl)return this.thirdPartyUrl;if(this.fileName){var e="?w=",t="";return"backgroundLayoutImage"===this.displayType||"backgroundEmailImage"===this.displayType?(t=this.tempMaxImageWidthSvc.maxBackgroundImage,this.originalWidth<this.originalHeight&&(e="?h=")):t=this.tempMaxImageWidthSvc.maxSize(),[s.urls.imagePrefix,this.fileName,e,t].join("")}return this.tempSrc},hasSrc:function(){return!!this.getSrc()},isDataSrc:function(){if(!this.hasSrc())return!1;var e=this.getSrc();return"data"===e.key.substring(0,4)},validate:function(){var e=l[this.type];e&&e.call(this)},reset:function(){var e=c[this.type];e&&(e(this),this.tempModelActivity.contentUpdated(this.tempContainer))},resize:function(){"image"!==this.type&&"video"!==this.type||this.tempImageBuilderSvc.resize(this),"header"===this.type&&this.tempLogoBestFitSvc.resize(this)}},e.factory("ContentSvc",["ValidationSrv","ImageBuilderSvc","LogoBestFitSvc","MaxImageWidthSvc","ModelActivity",function(e,t,n,i,o){return a.prototype.tempValidationSrv=e,a.prototype.tempImageBuilderSvc=t,a.prototype.tempLogoBestFitSvc=n,a.prototype.tempMaxImageWidthSvc=i,a.prototype.tempModelActivity=o,a}])}),define("modules/emailbuilder/services/nextButtonStyleSvc",["vendor/angular","modules/emailbuilder/module"],function(e,t){function n(){function e(e,t){t.backgroundColor=e.backgroundColor,t.color=e.color,t.fontFamily=e.fontFamily,t.halign=e.halign,t.tempBackgroundColor=e.tempBackgroundColor,t.tempTextColor=e.tempTextColor,t.borderRadius=e.borderRadius,t.buttonStyleAppearance=e.buttonStyleAppearance}function t(t,n){n&&i||(null===i&&(i={}),e(t,i))}function n(t){null!==i&&e(i,t)}var i=null;this.setNextButtonStyle=t,this.applyNextButtonStyle=n}t.service("nextButtonStyleSvc",n)}),define("modules/emailbuilder/services/contentProviderFactory",["modules/emailbuilder/module","vendor/angular","modules/emailbuilder/services/content","modules/emailbuilder/services/nextButtonStyleSvc"],function(e,t,n){function i(e,t){o=t,Object.keys(s).forEach(function(t){var n=s[t];n.provide=r(n.provide,e)})}var o,r=function(e,n){return function(){var i=e();return t.extend(i,n.prototype),i}},s={text:{sidebarEditor:!1,provide:function(){return{contents:"<p></p>",type:"text"}}},image:{sidebarEditor:!0,provide:function(){return{type:"image",isFullWidth:!0,alt:"",fileName:"",halign:"center",href:"",content:"Upload Image"}}},spacer:{provide:function(){return{type:"spacer",height:20}}},divider:{provide:function(){return{type:"divider"}}},button:{sidebarEditor:!0,provide:function(){var e={type:"button",text:"Button",href:"",halign:"",fontFamily:null,tempValidation:[],tempIsValid:!0,tempIsNew:!0};return o.applyNextButtonStyle(e),e}},survey:{sidebarEditor:!0,provide:function(){return{type:"survey",text:"Get started",href:"",halign:"",fontFamily:null,surveyId:"",tempValidation:[],tempIsValid:!0,tempIsNew:!0}}},readonlytext:{sidebarEditor:!1,provide:function(){return{type:"readonlytext",previewText:"",actualText:""}}},video:{sidebarEditor:!0,provide:function(){return{type:"video",isFullWidth:!0,alt:"",fileName:"",halign:"center",href:"",content:"Select Video",videoUrl:"",videoProvider:"vimeo",ValidVideoSelected:!1}}}};i.prototype.getProviderFor=function(e){return s[e]},e.service("ContentProviderFactory",["ContentSvc","nextButtonStyleSvc",i])}),define("modules/emailbuilder/services/styleFactory",["vendor/angular","modules/emailbuilder/module"],function(e,t){function n(){}n.prototype.addBackgroundLayoutStyle=function(t,n){return t||(t={}),t.backgroundLayoutImage||(t.backgroundLayoutImage={type:"image",displayType:"backgroundLayoutImage",href:"",src:"",fileName:"",backgroundPosition:"0 0",backgroundRepeat:"no-repeat"}),t.backgroundLayoutImage.hasOwnProperty("isImageType")||e.extend(t.backgroundLayoutImage,n.prototype),t},n.prototype.addBackgroundEmailStyle=function(t,n){return t||(t={}),t.backgroundColor||(t.backgroundColor=""),t.backgroundLayoutImage||(t.backgroundLayoutImage={type:"image",displayType:"backgroundEmailImage",href:"",src:"",fileName:"",backgroundPosition:"0 0",backgroundRepeat:"no-repeat"}),t.backgroundLayoutImage.hasOwnProperty("isImageType")||e.extend(t.backgroundLayoutImage,n.prototype),t},t.service("StyleFactory",[n])}),define("modules/emailbuilder/services/sectionId",["modules/emailbuilder/module"],function(e){function t(e,t){e=e.replace(l.spacing,""),e=e.replace(l.fullWidth,"");var n=e.indexOf("-border")!==-1;e=e.replace(l.border,"");var i="";switch(t){case"halfWidth":i=e;break;case"fullWidth":i=e+l.fullWidth;break;case"spacing":i=e+l.spacing}return n&&(i+=l.border),i}function n(e){e.bordered?e.id.indexOf("-border")===-1&&(e.id=e.id+"-border"):e.id=e.id.replace("-border","")}function i(e,t){var n="layout--double-border",i=t.indexOf(e),o=t[i+1];e.settings&&0===e.settings.verticalSpacing&&e.id.indexOf("border")!==-1?i!==-1&&void 0!==o&&null!==o&&(void 0===o.cssClasses?o.cssClasses=[]:o.cssClasses.indexOf(n)===-1&&o.cssClasses.push(n)):void 0!==o&&null!==o&&(o.cssClasses=[])}function o(e,t){var n="layout--double-border",i=t.indexOf(e),o=t[i+1],r=t[i-1];void 0!==r&&null!==r&&r.settings&&0===r.settings.verticalSpacing&&r.id.indexOf("border")!==-1?void 0!==o&&null!==o&&(void 0===o.cssClasses?o.cssClasses=[]:o.cssClasses.indexOf(n)===-1&&o.cssClasses.push(n)):void 0!==o&&null!==o&&(o.cssClasses=[])}function r(e){var t="halfWidth";return e.indexOf(l.fullWidth)!==-1&&(t="fullWidth"),e.indexOf(l.spacing)!==-1&&(t="spacing"),t}function s(e,t,n,o){var r=n>o?n:n-1;if(r>=0){var s=t[r];i(s,t)}else t[n].cssClasses=[];i(e,t);var a=o-1;if(a>=0){var l=t[a];i(l,t)}else t[o].cssClasses=[]}function a(){}e.service("SectionIdSvc",a);var l={fullWidth:"-full-width",spacing:"-gutter",border:"-border"};a.prototype.propertiesToId=t,a.prototype.idToProperties=r,a.prototype.updateBorderForSection=n,a.prototype.updateTopBorderForNextSection=i,a.prototype.updateTopBorderForNextSectionAfterRemoving=o,a.prototype.updateAfterMoving=s}),define("ts/modules/emailbuilder/services/email",["vendor/angular","modules/emailbuilder/module","modules/emailbuilder/services/content","modules/emailbuilder/services/contentProviderFactory","config","modules/emailbuilder/services/styleFactory","modules/emailbuilder/services/sectionId","ts/modules/emailbuilder/services/lockLevelSvc"],function(e,t,n,i,o,r,s,a){function l(e){var t=e.sortability,n=e.model.sections.length>1,i=e.model.sections[0],o=i&&i.content.length>1,r=i&&i.content[0].content.length>1;t.section=n,t.content=n||o||r}function c(e){if(o.isFirstRun&&!e.model.sections.length&&!o.mode.templateWithContent){var t=e.addContent({type:"text"});t.contents=o.onBoardText}}function u(t,n,i,o,r,s){return t=e.copy(t),t.forEach(function(t){var a,l=r.getProviderFor(t.type),c=l.provide();for(a in c)t.hasOwnProperty(a)&&null!==t[a]||(t[a]=c[a]);"text"!==t.type||t.contents||(t.contents=c.contents),l.validate&&l.validate(t),t.tempSidebarEditor=l.sidebarEditor,t.tempContainer={sectionID:i,section:n,column:o},e.extend(t,s.prototype)}),t}function d(t,n){var i={id:n.id,uiId:"section_options_"+f(),content:e.copy(n.dropzones),type:"section",isActive:!1,permissions:{lockLevel:"none"},style:{}};return i.content.forEach(function(e){e.content=[],e.tempHasPadding=!1}),m(t.model.sections,t.insertBefore,i),t.insertBefore=null,l(t),i}function m(e,t,n){if(t){var i=e.indexOf(t);e.splice(i,0,n)}else e.push(n)}function p(e){var t,n=e.model.sections,i=!1;if(o.canvasSectionPermissions&&n.length>0){var r=e.lockLevelSvc.getLocks(n[n.length-1].permissions);i=r.dragAndDropLocked}return n.length&&!i||(t=o.template.sections.filter(function(e){return 1===e.dropzones.length}),e.addSection(t[0])),{section:n.length-1,column:0}}function h(e,t,n){t.splice(t.indexOf(n),1),l(e)}function f(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function g(t,n,i,r,s){n.header=n.header||{type:"header",displayType:"image",href:"",src:"",fileName:""},n.footer=n.footer||{type:"footer"},n.spacing=n.spacing||{verticalSpacing:2,isDefined:!1},n.language=n.language||"English",n.sections=n.sections||[],n.social=n.social||{tweet:{on:!0},fblike:{on:!0,type:"Like this email"},webversion:{on:!0},forwardtoafriend:{on:!0},preferences:{on:!0}},n.webLinks=n.webLinks||{facebook:{On:!0,Href:null},twitter:{On:!0,Href:null},youtube:{On:!0,Href:null},instagram:{On:!0,Href:null},linkedin:{On:!0,Href:null},website:{On:!0,Href:null},pinterest:{On:!0,Href:null}},o.templateBadge?n.templateBadge&&void 0!==n.templateBadge.displayBadge&&null!==n.templateBadge.displayBadge||(n.templateBadge||(n.templateBadge={}),n.templateBadge.displayBadge=!0):n.templateBadge=null;var a=0;return e.extend(n.header,r.prototype),n.header.fileName&&(n.header.src=o.urls.imagePrefix+n.header.fileName),n.sections.forEach(function(n){var o=n.id;n.uiId="section_options_"+f(),n.style=s.addBackgroundLayoutStyle(n.style,r),n.type="section",n.isActive=!1,n.bordered=n.id.indexOf("border")!==-1,n.content.forEach(function(s,l){t.dropzoneHasPadding(s),s.content.forEach(function(t){var s=i.getProviderFor(t.type);"text"!==t.type||t.contents||(t.contents=s.provide().contents),t.tempSidebarEditor=s.sidebarEditor,t.tempContainer={sectionID:o,section:a,column:l},t.tempSection=n,e.extend(t,r.prototype),t.validate()})}),a++}),n}function v(e){e.forEach(function(e,t){e.content.forEach(function(n,i){n.content.forEach(function(n){n.tempContainer={sectionID:e.id,section:t,column:i}})})})}function b(e,t){t&&e.forEach(function(e){e.content.forEach(function(n){n.content.forEach(function(n){t(e,n)})})})}var y=function(){function t(t,n,i,r,s,a,y,w,k){var _=this;this.addSection=function(e){var t,n,i=!!e.usingSection,o=i?_.ss.fromID(e.usingSection):e,r=d(_,o),s=_;return i&&(t=_.model.sections.indexOf(r),e.content.forEach(function(e,i){var o=r.content[i];o.content=u(e,t,r.id,i,s.cpf,s.cs),s.dropzoneHasPadding(o),n||(n=o.content[0])}),n&&_.acm.setActiveContent(n)),_.$timeout(function(){s.ma.sectionAdded()}),r.style=_.isf.addBackgroundLayoutStyle(e.style,_.cs),r},this.reorderSection=function(e,t){var n=_.model.sections,i=_,r=n.splice(e,1)[0];n.splice(t,0,r),o.sectionBorderEnabled&&_.sectionIdSvc.updateAfterMoving(r,_.model.sections,e,t),v(n),_.$timeout(function(){i.ma.sectionMoved()})},this.removeSection=function(e){var t=_.acm,n=t.active.content,i=_;if(n){var o=!1;e.content.forEach(function(e){e.content.indexOf(n)!==-1&&(o=!0)}),o&&t.clearActiveContent()}_.sectionIdSvc.updateTopBorderForNextSectionAfterRemoving(e,_.model.sections),h(_,_.model.sections,e),v(_.model.sections),_.$timeout(function(){i.ma.sectionRemoved()})},this.duplicateSection=function(t){b([t],function(e,t){t.tempSection=null,t.tempModelActivity=null});var n=t.style&&t.style.backgroundLayoutImage;n&&(n.tempSection=null,n.tempModelActivity=null);var i=_.model.sections.indexOf(t),o=_,r=e.copy(t);r.uiId="section_options_"+f(),_.model.sections.splice(i+1,0,r),b([t,r],function(t,n){n.tempSection=t,e.extend(n,o.cs.prototype),t===r&&"image"===n.type&&n.tempLoadingImg&&(n.tempLoadingImg=!1,n.tempSrc=null)}),n&&(n.tempSection=t,e.extend(n,o.cs.prototype)),v(_.model.sections),l(_),_.$timeout(function(){o.ma.sectionDuplicated()})},this.setUsedDynamicContent=function(){if(!_.model.usedDynamicContent){var e=_;_.model.usedDynamicContent=!0,_.$timeout(function(){e.ma.dynamicContentUsed()})}},this.setInsertBefore=function(e){_.insertBefore=e||null},this.setContentTarget=function(e){_.contentTarget=e},this.getBlock=function(e){var t=_.model.sections;return t[e.section].content[e.column].content[e.blockIndex]},this.dropzoneHasPadding=function(e){var t=!!e.content,n=t?e.content[0]:void 0,i=!1;n&&(i="image"!==n.type&&"video"!==n.type||!n.isFullWidth),e.tempHasPadding=i},this.addContent=function(e){var t=_.contentTarget||p(_),n=_.cpf.getProviderFor(e.type),i=n.provide(),o=_.model.sections[t.section],r=o.content[t.column],s=_,a=_.lockLevelSvc.getLocks(o.permissions);return a.dragAndDropLocked?(_.insertBefore=null,_.contentTarget=null,null):(i.tempSidebarEditor=n.sidebarEditor,i.tempContainer={sectionID:o.id,section:t.section,column:t.column},m(r.content,_.insertBefore,i),_.dropzoneHasPadding(r),_.insertBefore=null,_.contentTarget=null,l(_),_.$timeout(function(){s.ma.contentAdded(i.tempContainer)}),i)},this.removeContent=function(e,t){var n=_.model.sections[e.section].content[e.column],i=_;h(_,n.content,t),_.dropzoneHasPadding(n),_.$timeout(function(){i.ma.contentRemoved(e)})},this.moveContent=function(e,t,n,i){if(i){var o=_.model.sections[i.section],r=_.lockLevelSvc.getLocks(o.permissions);if(r.dragAndDropLocked)return null}var s,a,l,c=_.model.sections[e.section].content[e.column],u=c.content,d=u.splice(t,1)[0],m=d.tempContainer;return i?(s=_.model.sections[i.section].content[i.column],a=_.model.sections[i.section],l=a.content[i.column].content,d.tempContainer={sectionID:a.id,section:i.section,column:i.column}):l=u,l.splice(n,0,d),s&&_.dropzoneHasPadding(s),_.dropzoneHasPadding(c),_.$timeout(function(){_.ma.contentMoved(m,d.tempContainer)}),d},this.isThereAMissingBackground=function(){var e;return _.model.sections.forEach(function(t){!e&&t.hasMissingBackground&&(e=t)}),e},this.model=g(this,o.email,t,n,y),this.cpf=t,this.cs=n,this.acm=r,this.ss=s,this.ma=i,this.sortability={},this.$timeout=a,this.isf=y,this.sectionIdSvc=w,this.lockLevelSvc=k,c(this),l(this)}return t}();t.service("EmailSvc",["ContentProviderFactory","ContentSvc","ModelActivity","ActiveContentManager","embAvailableSectionSelector","$timeout","StyleFactory","SectionIdSvc","LockLevelSvc",y])}),define("modules/emailbuilder/services/languages",["modules/emailbuilder/module","config"],function(e,t){function n(){return{model:t.languages}}e.factory("LanguagesSvc",n)}),define("modules/emailbuilder/services/template",["modules/emailbuilder/module","config"],function(e,t){e.constant("TemplateOptions",t.template)}),define("modules/emailbuilder/services/activeContentManager",["config","vendor/angular","modules/emailbuilder/module"],function(e,t,n){function i(){function n(){a.content&&(a.content.isActive=!1,s.removeClass("content-activated"))}function i(e){a.content&&n(),e.isActive=!0,a.content=e,s.addClass("content-activated")}function o(){var e=!!a.content;return!!e&&(a.content&&a.content.isActive)}function r(t){return"section"!==t.type&&t.tempSection&&e.canvasSectionPermissions&&"full"===t.tempSection.permissions.lockLevel||!e.mode.customisable&&l[t.type]}var s=t.element("#emb-js-email-body"),a={},l={header:1,footer:0,social:0};return{setActiveContent:i,clearActiveContent:n,hasActiveContent:o,isDisabled:r,active:a}}n.factory("ActiveContentManager",i)}),define("modules/emailbuilder/services/save",["vendor/angular","config","underscore","vendor/postal","modules/emailbuilder/module","ts/modules/emailbuilder/services/email","jquery"],function(e,t,n,i,o,r,s){function a(e){var t=e._.fn.cgt,n=e._.fn.cgc;t&&clearTimeout(t),n&&n.resolve(),l(e)}function l(e,n){var i,o,r=e._.task;n&&n.Data!==r.Data||(e._.chan.publish("generating",r),o=[t.urls.status,"/",r.Data],e._.fn.cgc=i=e._.$q.defer(),e._.$h({timeout:i.promise,method:"GET",url:o.join("")}).success(function(t){"inprogress"===t.Status?e._.cgt=setTimeout(function(){l(e,r)},300):(e._.task=t,e._.chan.publish("generated",t))}).error(function(){}))}function c(e,t){switch(e){case"$$hashKey":case"isActive":return}if(!("string"==typeof e&&e.toLowerCase().indexOf("href")>-1&&t&&"string"==typeof t&&t.match(/^['"]?data:.*;base64/)||e.substring&&"temp"===e.substring(0,4)&&"template"!==e.substring(0,8)))return t}function u(e,n,i){var o;e.isDirty&&(e._.fn.ds&&(clearTimeout(e._.fn.ds),e._.fn.ds=0),e.isDirty=!1,e.isSaving=!0,o=e._.task={Data:Date.now(),Status:"saving"},i||e._.chan.publish("saving",o),e._.$h({method:"post",url:n||t.urls.save,data:{name:e._.tnp.name,data:JSON.stringify(e._.es.model,c),taskId:o.Data},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return s.param(e)}}).success(function(t){e.isSaving=!1,t.redirectTo&&(e._.chan.publish("redirect",o),e._.$w.location.href=t.redirectTo),a(e,t),i||e._.chan.publish("saved",o)}).error(function(){o.Status="error",e.isDirty=!1,e.isSaving=!1,i||e._.chan.publish("failed",o)}))}function d(e,t,o,r,s,a){function l(){this.isDirty=!0,d(),this._.fn.ds||(this._.fn.ds=n.delay(c,2e4))}var c=u.bind(null,this),d=n.debounce(c,5e3),m=u.bind(null,this,null,!0);this.isDirty=!1,this.isSaving=!1,this._={chan:i.channel("embSaving"),tnp:e,es:t,$h:r,$q:s,$w:a,fn:{ds:0}},o.subscribe("content.#",l).withContext(this),o.subscribe("section.#",l).withContext(this),o.subscribe("internal.#",function(){this.isDirty=!0,m()}).withContext(this)}d.prototype={saveTemplate:function(){this.isDirty=!0,u(this,t.urls.saveTemplate)},subscribe:function(e,t){return this._.chan.subscribe(e,t)},poll:function(e){this._.task={Data:e},a(this)},logFinishAndSave:function(){this._.$h.post(t.urls.logFinishAndSave)}},o.service("SaveSvc",["embTemplateNameProvider","EmailSvc","ModelActivity","$http","$q","$window",d])}),define("modules/emailbuilder/services/onBoarding",["vendor/angular","modules/emailbuilder/module","config"],function(e,t,n){
function i(e){n.isSubsequentRun||e.post(n.urls.updateOnBoarding)}function o(t){return{update:e.bind(this,i,t)}}t.factory("OnBoardingSvc",["$http",o])}),define("modules/emailbuilder/services/checkOnPreview",["vendor/angular","modules/emailbuilder/module","modules/emailbuilder/services/save","config"],function(e,t,n,i){function o(e){this.saveSvc=e}o.prototype.runCheck=function(){this.saveSvc.poll("TemplateSwitch")},t.service("CheckOnPreviewSvc",["SaveSvc",o])}),define("modules/emailbuilder/directives/positionControls",["vendor/angular","modules/emailbuilder/module"],function(e,t){function n(t){return{link:function(n,o){t.subscribe("scroll",function(t){var r,s,a,l=t.offset;if(e.isDefined(l))t.relative&&(l=l+o.prop("scrollTop")-i);else{if(r=t.visible+o.prop("scrollTop")-o.offset().top,s=o.height(),r<=s-i)return;a=o.find("#emb-js-email-body"),r>a.height()-i&&(a.height(r+i),n.fakeSpacing=!0),l=r+i-s}var c=t.delay||0,u=t.duration||300,d=t.easing||"swing";setTimeout(function(){o.animate({scrollTop:l},u,d)},c)}),t.subscribe("restore",function(e){n.fakeSpacing&&(o.find("#emb-js-email-body").css("height",""),n.fakeSpacing=!1)})}}}var i=40;t.directive("embPositionControls",["ViewPortSrv",n])}),define("modules/emailbuilder/services/sectionSeparatorSelector",["modules/emailbuilder/module","config"],function(e,t){function n(e){this.conditions=t.template.sectionSeparators.map(function(t,n){return{condition:e(t),index:n}})}n.prototype.getMatchingIndex=function(e){var t=this.conditions.filter(function(t){return t.condition(e)})[0];return t&&t.index},e.service("embSectionSeparatorSelector",["$parse",n])}),define("modules/emailbuilder/services/availableSectionSelector",["modules/emailbuilder/module","config"],function(e,t){function n(){}var i={},o=[];t.template.sections.forEach(function(e){i[e.id]=e,o[e.dropzones.length]||(o[e.dropzones.length]=e)}),n.prototype.select=function(e){var t=i[e.id];return t||(t=o[e.content.length],i[e.id]=t),t},n.prototype.fromID=function(e){return i[e]},e.service("embAvailableSectionSelector",n)}),define("modules/emailbuilder/filters/memoisedTemplateUrl",["modules/emailbuilder/module","underscore","config","modules/emailbuilder/services/sectionSeparatorSelector","modules/emailbuilder/services/availableSectionSelector"],function(e,t,n){function i(e,n,i){var o=["$sce"];return e&&(o=o.concat(e)),o.push(function(e){function o(){var t,i=Array.prototype.slice.call(arguments,0);return i.unshift.apply(i,r),t=n.apply(null,i),e.trustAsResourceUrl(t)}var r=Array.prototype.slice.call(arguments,1);return t.memoize(o,i)}),o}function o(e,t,i,o){for(var r={},s=!1,a=!1,l=0;l<n.template.sectionSeparators.length&&(s=n.template.sectionSeparators[l].indexOf("location")!==-1,a=n.template.sectionSeparators[l].indexOf("first")!==-1,!s);l++);return r=i||o||a?{type:e.id,location:{first:i,last:!i&&o}}:s?{location:{between:[e.id,t.id]}}:{type:e.id}}var r={imageTemplateUrl:{service:["$templateCache","embAvailableSectionSelector"],getUrl:function(e,t,n,i){var o=n.isFullWidth?"bleed":"padded",r=["/content/image/",t.fromID(i).id,"/",o,".html"].join("");return e.get(r)||(r=["/content/image/",o,".html"].join("")),r},getHashKey:function(e,t){return[e.isFullWidth+"|"+t].join("")}},sectionSeparatorUrl:{services:["embSectionSeparatorSelector","embAvailableSectionSelector"],getUrl:function(e,t,n,i,r){var s=r===!1,a=!i;if(!s){n=t.select(n),i=i&&t.select(i);var l=o(n,i,r,a),c=e.getMatchingIndex(l);return void 0===c?void 0:["/section-separator/",c,".html"].join("")}},getHashKey:function(e,t,n){return[e.id,t&&t.id,n].map(function(e){return""+e}).join()}},sectionTemplateUrl:{services:["embAvailableSectionSelector"],getUrl:function(e,t){return["/section/",e.select(t).id,".html"].join("")},getHashKey:function(e){return e.id}},topPaddingUrl:{services:["embAvailableSectionSelector"],getUrl:function(e,t,n){return["/section/",e.fromID(t).id,"/dropzone-top/",n,".html"].join("")},getHashKey:function(e,t){return[e,t].join()}},contentPaddingUrl:{services:["$templateCache","embAvailableSectionSelector"],getUrl:function(e,t,n,i,o){var s="image"!==n.type&&"video"!==n.type||!n.isFullWidth;return s?["/section/",t.fromID(i).id,"/dropzone-padding/",o,".html"].join(""):r.contentTemplateUrl.getUrl(e,t,n,i,o)},getHashKey:function(e,t,n){var i="image"!==e.type&&"video"!==e.type||!e.isFullWidth;return i?[t,n].join():r.contentTemplateUrl.getHashKey(e,t,n)}},contentTemplateUrl:{services:["$templateCache","embAvailableSectionSelector"],getUrl:function(e,t,n,i,o){var r,s,a=n.type;if(i=t.fromID(i).id,"image"===a){if(r=n.isFullWidth?"bleed.html":"padded.html",s=["/content/",i,"/",o,"/image/",r].join(""),e.get(s))return s;if(s=["/content/image/",r].join(""),e.get(s))return s}return s=["/content/",i,"/",o,"/",a,".html"].join(""),e.get(s)||(s=["/content/",a,".html"].join("")),s},getHashKey:function(e,t,n){var i=[e.type,t,n];return"image"===e.type&&i.push(e.isFullWidth),i.join()}}};Object.keys(r).forEach(function(t){var n=r[t],o=i(n.services,n.getUrl,n.getHashKey);e.filter(t,o)})}),define("vendor/text!modules/emailbuilder/templates/sectionContainer.html",[],function(){return'<div ng-repeat="section in sections" class="emb-js-section-and-separator-wrapper" emb-disable-drag="true" ng-controller="SectionCtrl">\r\n\r\n    <ng-include src="section | sectionSeparatorUrl : undefined : $first"></ng-include>\r\n\r\n    <div class="emb-section-wrap emb-js-section-outer-wrapper c-section-highlight-container" emb-monitor-height index="{{$index}}"\r\n         ng-class="{ \'is-hovered\': hovered || section.isHighlighted, \'is-active\': section.isActive,\r\n         \'is-locked\': canvasSectionPermissions && section.permissions.lockLevel === \'full\', \'is-highlighted\': section.isHighlighted,\r\n         \'is-partially-locked\': canvasSectionPermissions && (section.permissions.lockLevel === \'partial\' || section.permissions.lockLevel === \'partial-removable\'),\r\n         \'is-partially-locked--removable\': canvasSectionPermissions && section.permissions.lockLevel === \'partial-removable\',\r\n         \'has-icon\': hasIcon() }"\r\n         ng-mouseover="hovered = !section.readOnly && !$parent.disableHover; $event.stopPropagation();"\r\n         ng-mouseout="hovered = false;">\r\n\r\n        <div class="c-section-highlight" aria-hidden="true" id="section-options-{{section.uiId}}">\r\n            <div emb-item-controls item-type="section" item="section" item-hovered="hovered" confirmation="confirmation"></div>\r\n            <div id="{{section.uiId}}" class="hmb-js-section-wrapper" ng-include="section | sectionTemplateUrl" ng-class="section.cssClasses"></div>\r\n        </div>\r\n    </div>\r\n    <ng-include id="js_section_separator_after_{{section.uiId}}" src="section | sectionSeparatorUrl : sections[$index + 1]"></ng-include>\r\n</div>\r\n<div class="emb-insertion-bar emb-section-insertion-bar hmb-reset hmb-editor-common" ng-show="sectionDragged()"></div>\r\n'}),define("modules/emailbuilder/animations/section",["modules/emailbuilder/module","vendor/jquery.easing"],function(e,t){function n(){return{leave:function(e,t){setTimeout(function(){e.animate({height:"0px"},300,"linear",t)},120)}}}return e.animation(".emb-js-section-and-separator-wrapper",n),n}),define("modules/emailbuilder/directives/sectionContainer",["config","vendor/angular","modules/emailbuilder/module","modules/emailbuilder/filters/memoisedTemplateUrl","vendor/text!modules/emailbuilder/templates/sectionContainer.html","modules/emailbuilder/animations/section"],function(e,t,n,i,o,r){function s(t,n){return{template:o,link:function(i,o,r){i.droplineActive=!0,i.dragging=!1,i.confirmation=!1,i.options=!1,i.sections=t.model.sections,i.disableHover=!1,i.sectionDragged=function(){return i.dragging&&i.droplineActive};var s=[],a=n.subscribe("content.start",function(){0===i.email.sections.length&&(i.dragging=!0),i.disableHover=!0,i.safeDigest()});s.push(a),a=n.subscribe("content.stop",function(){i.dragging=!1,i.disableHover=!1,i.safeDigest()}),s.push(a),i.$on("$destroy",function(){s.forEach(function(e){e.unsubscribe()})}),i.lockLevels=e.lockLevels,i.$on("section.highlight",function(e,t){for(var n=!1,i=0;i<t.content.length;i++)t.content[i].isHighlighted&&(n=!0);t.isHighlighted=n,e.currentScope.$digest(),e.stopPropagation()})}}}n.directive("csSectionContainer",["EmailSvc","DraggingSvc",s])}),define("vendor/text!modules/emailbuilder/components/colorpicker/colorpicker.html",[],function(){return'<div class="c-colorpicker__combined-container ff-recent-colors" ng-class="{\'emb-active\': isOpen, \'emb-upward\': isUpward }">\r\n    <div class="c-colorpicker__swatch-container js-color-swatch">\r\n        <div class="c-colorpicker__swatch color-swatch" ng-style="{\'background-color\': swatchColor}"></div>\r\n    </div>\r\n    <input class="c-colorpicker__input js-colorpicker-input" spellcheck="false" type="text" maxlength="7" ng-model="selectedColor" ng-change="updateColorFromTextbox(selectedColor);">\r\n    <div class="c-colorpicker__block-container js-colorpicker-block-container">\r\n        <div class="c-colorpicker__block emb-color-selector">\r\n            <div class="c-colorpicker__recent js-recent-colors">\r\n                <h4 class="c-colorpicker__recent-label">Recent colors</h4>\r\n                <ul class="c-colorpicker__colors-list">\r\n                    <li class="c-colorpicker__colors-list-item" ng-repeat="recentColor in recentlyUsedColors | limitTo:8 track by $index">\r\n                        <button class="c-colorpicker__saved-color" ng-style="{ \'background-color\': \'#\' + recentColor }" ng-click="$event.preventDefault();updateColorFromTextbox(recentColor);"></button>\r\n                    </li>\r\n                    <li class="c-colorpicker__colors-list-item" ng-if="colorpicker-add">\r\n                        <button class="c-colorpicker__saved-color" style="background-color: #1366b6; border-color">\r\n                            <span class="c-colorpicker__add-color">\r\n                                <svg class="c-icon c-icon--cross" width="8" height="8">\r\n                                    <g class="c-icon__color">\r\n                                        <path d="M0 3h8v2H0z" />\r\n                                        <path d="M3 0h2v8H3z" />\r\n                                    </g>\r\n                                </svg>\r\n                            </span>\r\n                        </button>\r\n                    </li>\r\n                </ul>\r\n                <button ng-if="colorpicker-edit" class="c-button c-colorpicker__edit">Edit</button>\r\n            </div>\r\n            <div class="">\r\n                <div class="color-swatch" ng-style="{\'background-color\': swatchColor}"></div>\r\n            </div>\r\n            <input spellcheck="false" type="text" maxlength="7" class="colorpicker-field qa-colorpicker-text js-colorpicker-text" ng-model="selectedColor" ng-change="updateColorFromTextbox(selectedColor);">\r\n            <button class="emb-color-reset" ng-click="selectedColor = defaultColor">Revert</button>\r\n        </div>\r\n    </div>\r\n</div>'}),function(){function e(e){var t=function(){var t='<div class="colorpicker round"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div></div>',n={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:!0,flat:!1},i=function(t,n){e(n).data("hsb",t)},o=function(t){return e(t).data("hsb")},r=function(t,n){e(n).data("colorpicker").selector.css("backgroundColor","#"+x({h:t.h,s:100,b:100})),e(n).data("colorpicker").selectorIndic.css({left:parseInt(150*t.s/100,10),top:parseInt(150*(100-t.b)/100,10)})},s=function(t,n){e(n).data("colorpicker").hue.css("top",parseInt(150-150*t.h/360,10))},a=function(t){var n,a=e(this);a.data("colorpicker").color=n=v(o(a)),t&&i(n,a.get(0)),r(n,a.get(0)),s(n,a.get(0)),a.data("colorpicker").onChange.apply(a,[x(n)])},l=function(t){var n={cal:e(this).parent(),y:e(this).offset().top};n.preview=n.cal.data("colorpicker").livePreview,e(document).bind("mouseup",n,u),e(document).bind("mousemove",n,c),e(document).bind("mousedown",n,c)},c=function(e){var t=o(e.data.cal);return t.h=parseInt(360*(150-Math.max(0,Math.min(150,e.pageY-e.data.y)))/150,10),i(t,e.data.cal),a.apply(e.data.cal.get(0),[e.data.preview]),!1},u=function(t){return e(document).unbind("mouseup",u),e(document).unbind("mousemove",c),e(document).unbind("mousedown",c),!1},d=function(t){var n={cal:e(this).parent(),pos:e(this).offset()};n.preview=n.cal.data("colorpicker").livePreview,e(document).bind("mouseup",n,p),e(document).bind("mousemove",n,m),e(document).bind("mousedown",n,m)},m=function(e){var t=o(e.data.cal);return t.s=parseInt(100*Math.max(0,Math.min(150,e.pageX-e.data.pos.left))/150,10),t.b=parseInt(100*(150-Math.max(0,Math.min(150,e.pageY-e.data.pos.top)))/150,10),i(t,e.data.cal),a.apply(e.data.cal.get(0),[e.data.preview]),!1},p=function(t){return e(document).unbind("mouseup",p),e(document).unbind("mousemove",m),e(document).unbind("mousedown",m),!1},h=function(t){var n=e("#"+e(this).data("colorpickerId")),i=n.data("lastHide"),o=new Date;return(!i||o.getTime()-i.getTime()>200)&&(n.data("colorpicker").onBeforeShow.apply(this,[n.get(0)]),n.data("colorpicker").onShow.apply(this,[n.get(0)])!==!1&&n.show(),e(document).bind("mousedown",{cal:n},f)),!1},f=function(t){if(!g(t.data.cal.get(0),t.target,t.data.cal.get(0),!0)){var n=x(t.data.cal.data("colorpicker").color);t.data.cal.data("colorpicker").onHide(t.data.cal.get(0),n)!==!1&&t.data.cal.hide(),e(document).unbind("mousedown",f),t.data.cal.data("lastHide",new Date)}},g=function(e,t,n,i){if(e===t)return!i;if(e.contains)return e.contains(t);if(e.compareDocumentPosition)return!!(16&e.compareDocumentPosition(t));for(var o=t.parentNode;o&&o!==n;){if(o===e)return!0;o=o.parentNode}return!1},v=function(e){return{h:Math.min(360,Math.max(0,e.h)),s:Math.min(100,Math.max(0,e.s)),b:Math.min(100,Math.max(0,e.b))}},b=function(e){return e=parseInt(e.indexOf("#")>-1?e.substring(1):e,16),{r:e>>16,g:(65280&e)>>8,b:255&e}},y=function(e){return w(b(e))},w=function(e){var t={h:0,s:0,b:0},n=Math.min(e.r,e.g,e.b),i=Math.max(e.r,e.g,e.b),o=i-n;return t.b=i,t.s=0!==i?255*o/i:0,0!==t.s?e.r===i?t.h=(e.g-e.b)/o:e.g===i?t.h=2+(e.b-e.r)/o:t.h=4+(e.r-e.g)/o:t.h=-1,t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.b*=100/255,t},k=function(e){var t={},n=Math.round(e.h),i=Math.round(255*e.s/100),o=Math.round(255*e.b/100);if(0===i)t.r=t.g=t.b=o;else{var r=o,s=(255-i)*o/255,a=(r-s)*(n%60)/60;360===n&&(n=0),n<60?(t.r=r,t.b=s,t.g=s+a):n<120?(t.g=r,t.b=s,t.r=r-a):n<180?(t.g=r,t.r=s,t.b=s+a):n<240?(t.b=r,t.r=s,t.g=r-a):n<300?(t.b=r,t.g=s,t.r=s+a):n<360?(t.r=r,t.g=s,t.b=r-a):(t.r=0,t.g=0,t.b=0)}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}},_=function(t){var n=[t.r.toString(16),t.g.toString(16),t.b.toString(16)];return e.each(n,function(e,t){1===t.length&&(n[e]="0"+t)}),n.join("")},x=function(e){return _(k(e))};return{init:function(o){if(o=e.extend({},n,o||{}),"string"==typeof o.color)o.color=y(o.color);else if(void 0!==o.color.r&&void 0!==o.color.g&&void 0!==o.color.b)o.color=w(o.color);else{if(void 0===o.color.h||void 0===o.color.s||void 0===o.color.b)return this;o.color=v(o.color)}return this.each(function(){if(!e(this).data("colorpickerId")){var n=e.extend({},o);n.origColor=o.color;var a=e("body").data("colorpickerIndex")||0;a++,e("body").data("colorpickerIndex",a);var c="collorpicker_"+a;e(this).data("colorpickerId",c);var u=e(t).attr("id",c);n.flat?u.appendTo(this).show():u.appendTo(document.body),n.selector=u.find("div.colorpicker_color").bind("mousedown",d),n.selectorIndic=n.selector.find("div div"),n.el=this,n.hue=u.find("div.colorpicker_hue div"),u.find("div.colorpicker_hue").bind("mousedown",l),u.data("colorpicker",n),i(n.color,u.get(0)),s(n.color,u.get(0)),r(n.color,u.get(0)),n.flat?u.css({position:"relative",display:"block"}):e(this).bind(n.eventName,h)}})},showPicker:function(){return this.each(function(){e(this).data("colorpickerId")&&h.apply(this)})},hidePicker:function(){return this.each(function(){e(this).data("colorpickerId")&&e("#"+e(this).data("colorpickerId")).hide()})},setColor:function(t){if("string"==typeof t)t=y(t);else if(void 0!==t.r&&void 0!==t.g&&void 0!==t.b)t=w(t);else{if(void 0===t.h||void 0===t.s||void 0===t.b)return this;t=v(t)}return this.each(function(){if(e(this).data("colorpickerId")){var n=e("#"+e(this).data("colorpickerId"));n.data("colorpicker").color=t,n.data("colorpicker").origColor=t,i(t,n.get(0)),s(t,n.get(0)),r(t,n.get(0))}})},rgb2hex:function(e){},hex2hsb:y}}();e.fn.extend({ColorPicker:t.init,ColorPickerHide:t.hidePicker,ColorPickerShow:t.showPicker,ColorPickerSetColor:t.setColor,ColorPickerHex2HSB:t.hex2hsb})}"function"==typeof define?define("vendor/jquery.colorpicker",["jquery"],e):e(jQuery)}(),define("modules/shared/colorList",[],function(){return{aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}}),define("modules/emailbuilder/services/preload",["config","modules/emailbuilder/module"],function(e,t){function n(e){this.$q=e}function i(e,t){function n(){return document.createElement("link")}function i(){return new Image}function o(e,t){t.rel="prefetch",t.href=e,document.getElementsByTagName("head")[0].appendChild(t)}function r(e,t){t.src=e}var s,a=!!window.localStorage;s=function(e){var s,a,l;return e?(s=i,a=r,l=!0):(s=n,a=o),function(e){var n=s(),i=t.defer();return n.onload=function(e){i.resolve()},l&&(n.onerror=function(e){i.resolve()}),a(e,n),i.promise}}(navigator.userAgent.indexOf("Trident")>0),e.forEach(function(e,t){if(a){var n,i=["preload2",e].join("-"),o=!localStorage[i];o&&(n=s(e),n.then(function(){}),localStorage[i]=!0)}})}n.prototype.images=function(t){this.urlsFrom(e.urls.imageDomain,t)},n.prototype.css=function(t){this.urlsFrom(e.urls.cssDomain,t)},n.prototype.resource=function(t){this.urlsFrom(e.urls.staticResourceBase,t)},n.prototype.urlsFrom=function(e,t){t.forEach(function(n,i){t[i]=e+"/"+n}),i(t,this.$q)},n.prototype.urls=function(e){i(e,this.$q)},t.service("PreloadSvc",["$q",n])}),define("modules/emailbuilder/services/performanceSvc",["config","vendor/angular","modules/emailbuilder/module"],function(e,t,n){function i(){}var o=function(){},r=window.performance,s=window.console=window.console||{};if(e.canvasPerformanceMeasure&&void 0!==window.performance.mark)n.service("performanceSvc",i);else{var a=function(){return{getDuration:o,createMark:o,createMeasure:o,logDuration:o}};n.service("performanceSvc",a)}i.prototype.getDuration=function(e){var t=r.getEntriesByName(e);return e+": "+t[0].duration},i.prototype.logDuration=function(e){s.log(this.getDuration(e))},i.prototype.createMark=function(e,t){t&&r.clearMarks(e),r.mark(e)},i.prototype.createMeasure=function(e,t,n){r.getEntriesByName(e)!==[]&&r.clearMeasures(e),r.measure(e,t,n),r.getEntriesByName("mark")>50&&r.clearMarks()}}),define("modules/emailbuilder/components/colorpicker/colorpicker.directive",["config","vendor/angular","modules/emailbuilder/module","vendor/text!modules/emailbuilder/components/colorpicker/colorpicker.html","vendor/jquery.colorpicker","modules/shared/colorList","modules/emailbuilder/services/preload","underscore","modules/emailbuilder/services/performanceSvc"],function(e,t,n,i,o,r,s,a,l){function c(e,n,i,o,r,s){var a=this;if(this.$emit("content:popupopened"),!this.isOpen){var l=!1,c=n.offset();if(r=t.element(r),b||(b=r.outerHeight()),e){var u=e.offset().top,d=u+e.height(),m=c.top+n.outerHeight()+b;this.isUpward=l=m>d}var p=0,h=0;l?(h-=b,r.addClass(i)):(h+=n.outerHeight(),r.removeClass(i)),r.css({left:p+"px",top:h+"px"}),y?y=!1:(y=!0,n.focus()),a.isOpen=!0,a.$digest()}}function u(e,t){var n=this;this.isOpen&&(w=!w,this.$emit("recentColors:addNew",this.selectedColor),n.isOpen=!1,n.isUpward=!1,n.$digest())}function d(e){return e?"#"===e[0]?e:"#"+e:e}function m(e){return"#"===e[0]?e.substring(1):e}function p(e,t,n,i){var o=this;if(o.isOpen){var r=i||this.defaultColor;e.val(r),this.swatchColor=d(r),t(r),n.createMark("changeColorPicker",!0)}}function h(e,t,n,i){return void 0===n?void(this.swatchColor=""):(n=m(n).toLowerCase(),n=r[n]||n,void(/(^[0-9A-F]{6}$)|(^[0-9A-F]{3}$)/i.test(n)&&(i&&e.ColorPickerSetColor(n),this.swatchColor=d(n),this.selectedColor=n,t.$setViewValue(n))))}function f(e,t){var n=e.has(t).length>0,i=e[0]==t;return n||i}function g(n,i,o,r,s,a,l,d,m,g,v){var b=s.find(".js-color-swatch"),k=s.find("input"),_=s.find(".js-colorpicker-text"),x=t.bind(n,u,k,o),S=t.element(r[0]),C=t.bind(n,h,b,d),I=t.bind(n,c,a?t.element(a):null,k,l,o),T=function(e){return function(){var t=k.val();C(t,e),n.onSelectedColorChanged&&n.onSelectedColorChanged()(),o(function(){n.$digest()},1)}};n.updateColorFromTextbox=t.bind(n,p,k,T(!0),v),n.updateColorFromPicker=t.bind(n,p,k,T(!1),v),b.ColorPicker({onShow:I,onChange:n.updateColorFromPicker,onHide:x,flat:n.alwaysOpen}),k.on("paste",function(){o(function(){n.updateColorFromTextbox(k.val())},100)});var E=b.data().colorpickerId;o(function(){var o=t.element("#"+E),a=o.find(".colorpicker_hue"),l=!1,c=function(){n.alwaysOpen?n.$emit("colorPicker:confirm"):(o.hide(),x())},u=function(e){e.stopPropagation(),e.preventDefault(),s.trigger("mousedown"),c()};k.on("keypress",function(e){13===e.which&&u(e)}),k.on("keydown",function(e){9===e.which&&c()}),a.on("click",function(e){e.stopPropagation(),e.preventDefault()}),k.on("mousedown",function(e){e.stopPropagation()});var m=s.find(".js-recent-colors");m.on("mousedown",function(t){t.stopPropagation(),g.logAction(e.userActions.recentColors.swatchClicked)}),o.on("mousedown",function(e){_.focus(),S.on("mousemove",function(){l=!0,r.unbind("mousemove")})}).on("mouseup",function(e){w=!0;var t=l;l=!1,v.createMark("endColorPicker"),v.createMeasure("color","changeColorPicker","endColorPicker"),v.logDuration("color"),S.unbind("mousemove");var n=f(a,e.target);t||n||(w=!1,k.blur())}),n.alwaysOpen||(k.on("focus",function(e){y?y=!1:(y=!0,b.ColorPickerShow())}),k.on("blur",function(e){!1!==n.vaidateInputOnBlur&&(k.val(d.$viewValue),C(d.$viewValue,!0),n.$apply())})),i.$on("content:deactivated",function(){c()}),i.$on("content:popupopened",function(){c()}),o.detach(),s.find(".c-colorpicker__block").append(o)},0),n.isOpen=n.alwaysOpen,n.isUpward=!1,n.recentlyUsedColors=[],i.$on("recentColors:loaded",function(){n.recentlyUsedColors=e.recentlyUsedColors}),d.$render=function(){n.recentlyUsedColors=e.recentlyUsedColors,n.defaultColor=m,n.selectedColor=d.$viewValue,C(n.selectedColor||m,!0),k&&k.length>1?k.map(function(e){t.element(k[e]).val(n.selectedColor)}):k.val(n.selectedColor)}}function v(e){return function(t,n,o,r,s,a,l){return{restrict:"A",replace:!0,template:i,require:"ngModel",scope:e,compile:function(e,i){var c=this.name,u=function(e,i,u,d){s.resource(["img/emailbuilder/colorpicker/gamut@2x.png","img/emailbuilder/colorpicker/gamut.png","img/emailbuilder/colorpicker/triangle@2x.png","img/emailbuilder/colorpicker/triangle.png","img/emailbuilder/colorpicker/select@2x.png","img/emailbuilder/colorpicker/select.png","img/emailbuilder/colorpicker/hue.png","img/emailbuilder/colorpicker/hue-indicator@2x.png","img/emailbuilder/colorpicker/hue-indicator.png"]);var m=o(u[c])(e);g(e,t,n,r,i,u.csViewport,u.csColorSelectorUpwardClass,d,m,a,l)};return u}}}}var b,y=!1,w=!1,k=v(!0);n.directive("csColorSelector",["$rootScope","$timeout","$parse","$window","PreloadSvc","trackingSvc","performanceSvc",k]),n.directive("csScopedColorSelector",["$rootScope","$timeout","$parse","$window","PreloadSvc","trackingSvc","performanceSvc",v({onSelectedColorChanged:"&csColorSelectorChanged",vaidateInputOnBlur:"=csColorSelectorValidateOnBlur",alwaysOpen:"=csColorSelectorAlwaysOpen"})])}),define("modules/emailbuilder/services/textTrim",["modules/emailbuilder/module"],function(e){function t(e,t){if(!e||t>=e.length)return e;var n=(e=e.substr(0,t+1)).lastIndexOf(" ");return e.substr(0,n>t/2?n:t)+"â€¦"}function n(){}n.prototype.ellipsis=t,e.service("TextTrimSvc",[n])}),define("vendor/text!modules/emailbuilder/templates/sectionControls.html",[],function(){return'<div>\r\n    <button class="c-section-highlight__label c-section-highlight__label--partially-locked" ng-if="!block.readOnly &&!isPublicCanvas">\r\n        <span class="c-section-highlight__label-text">Edit content only</span>\r\n    </button>\r\n    <button class="c-section-highlight__label c-section-highlight__label--locked" ng-if="!block.readOnly && !isPublicCanvas">\r\n        <span class="c-section-highlight__label-text">Locked</span>\r\n    </button>\r\n\r\n    <div class="c-section-bar-container">\r\n        <div class="c-section-bar">\r\n            <button class="c-section-highlight__label c-section-highlight__label--segments" ng-if="!block.readOnly && !isPublicCanvas && !isTransactional && recipientInfo()" ng-click="chooseSegments($event);">\r\n                <span class="c-section-highlight__label-text">Who should see this?</span>\r\n                <span class="c-section-highlight__label-text-highlight">{{recipientInfo()}}</span>\r\n            </button>\r\n\r\n            <span class="c-section-bar__label c-section-bar__label--locked" ng-if="!block.readOnly && !isPublicCanvas">Locked</span>\r\n            <span class="c-section-bar__label c-section-bar__label--partially-locked" ng-if="!block.readOnly && !isPublicCanvas">Edit content only</span>\r\n            <span class="c-section-bar__label c-section-bar__label--partially-locked-removable" ng-if="!block.readOnly && !isPublicCanvas" ng-hide="confirmation">Edit content</span>\r\n\r\n            <div class="c-section-controls" ng-class="{ \'is-active\': confirmation }" ng-show="(block.isActive) && !dragInOperation">\r\n                <a href="#" ng-if="sortable" class="c-section-controls__button c-section-controls__button--move emb-js-section-reorder" ng-hide="confirmation">\r\n                    Move\r\n                </a>\r\n                <button class="c-section-controls__button c-section-controls__button--duplicate" ng-click="duplicateSection(); $event.stopPropagation();" ng-hide="confirmation">\r\n                    Duplicate\r\n                </button>\r\n                <button class="c-section-controls__button c-section-controls__button--delete" ng-click="$event.preventDefault(); $event.stopPropagation(); showConfirmation();" ng-hide="confirmation">\r\n                    Delete\r\n                </button>\r\n\r\n                <div class="c-section-controls__confirm-button-panel" ng-show="confirmation">\r\n                    <strong>Do you really want to delete?</strong>\r\n                    <button class="c-section-controls__button" ng-click="remove(); $event.preventDefault(); $event.stopPropagation()">Yes</button>\r\n                    <button class="c-section-controls__button" ng-click="hideConfirmation(); $event.stopPropagation()">No</button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("vendor/text!modules/emailbuilder/templates/contentControls.html",[],function(){return'<div ng-class="{\'emb-content-controls emb-reset\' : !imageControls && !textControls && (!narrowControls || (narrowControls && !active))}">\r\n    <div class="c-button-delete"\r\n        id="content-confirm-{{$parent.$index}}"\r\n        ng-if="!textControls &&\r\n            (\r\n                (item.type !== \'image\' && item.type !== \'video\' && item.type !== \'button\' && item.type !== \'divider\' && item.type !== \'spacer\') ||\r\n                (\r\n                    (item.type === \'image\' || item.type === \'video\')\r\n                    && !item.hasSrc()\r\n                    && canDelete\r\n                ) ||\r\n                (\r\n                    (item.type === \'button\' || item.type === \'divider\' || item.type === \'spacer\')\r\n                    && canDelete\r\n                )\r\n            )"\r\n        ng-show="!dragInOperation && active"\r\n        ng-click="showConfirmation()"\r\n        ng-class="{ \'is-selected\' : confirmation, \'is-active\' : active && !inUse, \'is-inactive\' : !active || (active && inUse) }">\r\n        <button id="content-delete-{{$parent.$index}}"\r\n            class="c-button-delete__confirm"\r\n            ng-click="remove(); $event.preventDefault()">Delete</button>\r\n        <button class="c-button-delete__cancel" ng-click="hideConfirmation(); $event.stopPropagation()">Cancel</button>\r\n    </div>\r\n\r\n    <div class="c-toolbar__delete-container emb-active"\r\n        id="content-confirm-{{$parent.$index}}"\r\n        ng-if="textControls"\r\n        ng-class="{ \'emb-selected\' : confirmation }">\r\n        <button class="c-toolbar__button" ng-click="showConfirmation()" ng-hide="confirmation">Delete block</button>\r\n        <div class="c-toolbar__delete-confirmation" ng-show="confirmation">\r\n            <strong class="c-toolbar__delete-container-text">Do you really want to delete?</strong>\r\n            <button id="content-delete-{{$parent.$index}}"\r\n                class="c-toolbar__button emb-confirmation"\r\n                ng-click="remove(); $event.preventDefault()">Yes</button>\r\n            <button class="c-toolbar__button emb-confirmation emb-confirmation-cancel"\r\n                ng-click="hideConfirmation(); $event.stopPropagation()">No</button>\r\n        </div>\r\n    </div>\r\n    <div ng-if="imageControls && canDelete"\r\n         class="c-toolbar__delete-container"\r\n         ng-class="{ \'is-active\' : confirmation }">\r\n        <button class="c-toolbar__button c-toolbar__button--delete"\r\n                ng-click="showConfirmation()"\r\n                ng-hide="confirmation">\r\n            Delete\r\n        </button>\r\n        <div ng-show="confirmation">\r\n            <strong class="c-toolbar__delete-container-text">Do you really want to delete?</strong>\r\n            <button class="c-toolbar__button" ng-click="remove(); $event.preventDefault()">Yes</button>\r\n            <button class="c-toolbar__button" ng-click="hideConfirmation(); $event.stopPropagation()">No</button>\r\n        </div>\r\n    </div>\r\n\r\n</div>';
}),define("vendor/text!modules/emailbuilder/templates/headerControls.html",[],function(){return'<span ng-show="itemHovered || inUse" class="emb-content-controls emb-reset">\r\n    <span id="content-confirm-header"\r\n        class="c-button-delete"\r\n        ng-click="showConfirmation(); $event.stopPropagation()"\r\n        ng-class="{ \'is-selected\' : confirmation, \'is-active\' : (active && inUse), \'is-inactive\' : !(active && inUse) }">\r\n        <button id="content-delete-header"\r\n            class="c-button-delete__confirm"\r\n            ng-click="remove(); $event.preventDefault()">Delete</button>\r\n        <button class="c-button-delete__cancel" ng-click="hideConfirmation(); $event.stopPropagation()">Cancel</button>\r\n    </span>\r\n</span>'}),define("vendor/text!modules/emailbuilder/templates/badgeControls.html",[],function(){return'<div>\r\n    <div ng-show="(block.isActive)">\r\n        <div class="c-section-controls" ng-class="{ \'is-active\': confirmation }">\r\n            <div class="c-section-controls__button-container">\r\n                <button class="c-section-controls__button c-section-controls__button--delete" ng-click="$event.preventDefault(); $event.stopPropagation(); showConfirmation();"></button>\r\n            </div>\r\n            <div class="c-section-controls__confirm-button-panel" ng-show="confirmation">\r\n                <div class="c-section-controls__confirm-button-panel-inner">\r\n                    <button class="c-section-controls__confirm-button c-section-controls__confirm-button--cancel" ng-click="hideConfirmation(); $event.stopPropagation()">\r\n                        <span class="c-section-controls__confirm-button-text">Cancel</span>\r\n                    </button>\r\n                    <button class="c-section-controls__confirm-button c-section-controls__confirm-button--delete" ng-click="remove(); $event.preventDefault(); $event.stopPropagation()">\r\n                        <span class="c-section-controls__confirm-button-text">Delete</span>\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("modules/emailbuilder/directives/itemControls",["vendor/angular","config","modules/emailbuilder/module","ts/modules/emailbuilder/services/email","modules/emailbuilder/services/textTrim","vendor/text!modules/emailbuilder/templates/sectionControls.html","vendor/text!modules/emailbuilder/templates/contentControls.html","vendor/text!modules/emailbuilder/templates/headerControls.html","vendor/text!modules/emailbuilder/templates/badgeControls.html","ts/modules/emailbuilder/services/lockLevelSvc"],function(e,t,n,i,o,r,s,a,l,c){function u(e,t,n,i,o,r,s){function a(t){var n=s.getLocks(t);e.canDelete=n.canDeleteContentItems}if(e.$watch("item.isActive",function(t){e.active=t}),e.sectionIndex){e.canDelete=!0;var l=n.model.sections[e.sectionIndex()];l&&(a(l.permissions),e.$on("permissionsChanged:section-"+l.uiId,function(e,t){a(t)}))}}function d(e){this.confirmation=!1,e.$emit("content:hideConfirmation")}function m(e){this.confirmation=!0,e.$emit("content:showConfirmation")}function p(n,i,o,r,s,a,l){return{replace:!0,scope:{item:"=",itemHovered:"=",inUse:"=",narrowControls:"=",textControls:"=",imageControls:"=",closer:"=",confirmation:"=?",sectionIndex:"="},require:"?^embDropzone",template:function(e,t){return h[t.itemType].template},link:function(c,u,p,f){var g=(p.itemType,h[p.itemType]),v=g.init;c.sortable=!1,c.dragInOperation=!1,c.confirmation=!!c.confirmation,c.block=c.item,c.hideConfirmation=e.bind(c,d,o),c.showConfirmation=e.bind(c,m,o),c.isPublicCanvas=t.mode.publicCanvas,c.remove=e.bind(c,g.remove,n,o,f,a);var b=[],y=r.subscribe("*.start",function(){c.dragInOperation=!0,c.safeDigest()});b.push(y),y=r.subscribe("*.stop",function(){c.dragInOperation=!1,c.safeDigest()}),b.push(y),c.deactivateContent=function(){o.$emit("content:deactivate")},c.$on("$destroy",function(){b.forEach(function(e){e.unsubscribe()})});var w=h[p.itemType].reset,k=function(e,t){c.confirmation&&c.hideConfirmation(),w&&w(c)};o.$on("text:command",k),o.$on("content:deactivated",k),o.$on("content:replaced",k),o.$on("content:activated",k),v&&v(c,o,n,i,s,u,l)}}}var h={section:{template:r,init:function(n,i,o,r,s,a,l){n.canvasPredefinedSections=t.canvasPredefinedSections,n.isTransactional=t.mode.isTransactional,n.$watch(function(){return o.sortability.section},function(e){n.sortable=e});var c=function(e,t,n){if(0===e)return null;var i=1<e?"s":"";return(n?"":e+" ")+t+i},u=function(e,t,n){return[c(e,"list",n),c(t,"segment",n)].filter(function(e){return e}).join(" and ")},d=function(n,i){var o;return e.forEach(t.listsAndSegments,function(t){if(i){if(n===t.listId)return void(o=t.title)}else e.forEach(t.segments,function(e){if(n===e.segmentId)return void(o=e.title)})}),r.ellipsis(o,20)},m=function(){var e=n.item.lists&&n.item.lists.length||0,t=n.item.segments&&n.item.segments.length||0;return"Deleted "+u(e,t,!0)};n.recipientInfo=function(){var i,o,r=0,s=0;e.forEach(n.item.lists,function(e){d(e,!0)&&(i=e,r++)}),e.forEach(n.item.segments,function(e){d(e,!1)&&(o=e,s++)});var a,l=t.mode.autoresponder?t.listsAndSegments[0].title:"All recipients",c=0===r&&0===s&&(n.item.lists&&n.item.lists.length||n.item.segments&&n.item.segments.length);return a=c?m():0===r&&0===s||!t.hasMultipleListsOrSegments?l:1===r&&0===s?d(i,!0):0===r&&1===s?d(o,!1):u(r,s),a||l},n.chooseSegments=function(e){n.block.subType="segments",i.$emit("content:activated",{block:n.block,tab:n.block.type})},n.duplicateSection=function(){n.deactivateContent(),o.duplicateSection(n.item);var e=a.parent(),t=e.offset().top+e.height();s.scrollStage({offset:t,relative:!0,duration:1e3,delay:200,easing:"easeInOutExpo"})},n.remove=function(){o.removeSection(this.item),n.deactivateContent()},n.item.style.backgroundColor?n.item.style.tempBackgroundColor=n.item.style.backgroundColor:n.item.style.tempBackgroundColor=o.model.styles.section.backgroundColor,n.$watch("item.style.tempBackgroundColor",function(e){null!==o.model.styles.section&&null!==o.model.styles.section.backgroundColor&&e&&e.toLowerCase()===o.model.styles.section.backgroundColor.toLowerCase()?n.item.style.backgroundColor="":n.item.style.backgroundColor=e}),i.$on("content:activated",function(e,t,i){if(t.block.uiId===n.item.uiId){var o=a.offset(),r=a.parent(),s=$("#emb-js-email-body").offset().top;o.top-s<50?(r.removeClass("has-top-margin"),r.addClass("has-top-margin")):r.removeClass("has-top-margin")}}),i.$on("content:deactivated",function(e,t,n){var i=a.parent();i.removeClass("has-extra-padding"),i.outerHeight()>0&&i.outerHeight()<10&&i.addClass("has-extra-padding")})},reset:function(e){}},content:{template:s,remove:function(e,t,n){this.item.isActive&&t.$emit("content:deactivate"),e.removeContent(n.getLocation(),this.item)},init:u},header:{template:a,remove:function(e,t){var n=e.model.header;e.model.header.hasSrc()||(n.displayType="none"),n.tempValidation&&(n.tempValidation=null),t.$emit("content:deactivate"),n.isActive=!1,n.reset()},init:u},templateBadge:{template:l,remove:function(e,t,n,i){e.model.templateBadge.displayBadge=!1,i.contentUpdated()},init:u}};n.directive("embItemControls",["EmailSvc","TextTrimSvc","$rootScope","DraggingSvc","ViewPortSrv","ModelActivity","LockLevelSvc",p])}),function(e,t){function n(t,n){var o,r,s,a=t.nodeName.toLowerCase();return"area"===a?(o=t.parentNode,r=o.name,!(!t.href||!r||"map"!==o.nodeName.toLowerCase())&&(s=e("img[usemap=#"+r+"]")[0],!!s&&i(s))):(/input|select|textarea|button|object/.test(a)?!t.disabled:"a"===a?t.href||n:n)&&i(t)}function i(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var o=0,r=/^ui-id-\d+$/;e.ui=e.ui||{},e.extend(e.ui,{version:"1.10.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({focus:function(t){return function(n,i){return"number"==typeof n?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),i&&i.call(t)},n)}):t.apply(this,arguments)}}(e.fn.focus),scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length)for(var i,o,r=e(this[0]);r.length&&r[0]!==document;){if(i=r.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(o=parseInt(r.css("zIndex"),10),!isNaN(o)&&0!==o))return o;r=r.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++o)})},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,i){return!!e.data(t,i[3])},focusable:function(t){return n(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var i=e.attr(t,"tabindex"),o=isNaN(i);return(o||i>=0)&&n(t,!o)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,i){function o(t,n,i,o){return e.each(r,function(){n-=parseFloat(e.css(t,"padding"+this))||0,i&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),o&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var r="Width"===i?["Left","Right"]:["Top","Bottom"],s=i.toLowerCase(),a={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+i]=function(n){return n===t?a["inner"+i].call(this):this.each(function(){e(this).css(s,o(this,n)+"px")})},e.fn["outer"+i]=function(t,n){return"number"!=typeof t?a["outer"+i].call(this,t):this.each(function(){e(this).css(s,o(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,n,i){var o,r=e.ui[t].prototype;for(o in i)r.plugins[o]=r.plugins[o]||[],r.plugins[o].push([n,i[o]])},call:function(e,t,n){var i,o=e.plugins[t];if(o&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(i=0;i<o.length;i++)e.options[o[i][0]]&&o[i][1].apply(e.element,n)}},hasScroll:function(t,n){if("hidden"===e(t).css("overflow"))return!1;var i=n&&"left"===n?"scrollLeft":"scrollTop",o=!1;return t[i]>0||(t[i]=1,o=t[i]>0,t[i]=0,o)}})}(jQuery),function(e,t){var n=0,i=Array.prototype.slice,o=e.cleanData;e.cleanData=function(t){for(var n,i=0;null!=(n=t[i]);i++)try{e(n).triggerHandler("remove")}catch(e){}o(t)},e.widget=function(t,n,i){var o,r,s,a,l={},c=t.split(".")[0];t=t.split(".")[1],o=c+"-"+t,i||(i=n,n=e.Widget),e.expr[":"][o.toLowerCase()]=function(t){return!!e.data(t,o)},e[c]=e[c]||{},r=e[c][t],s=e[c][t]=function(e,t){return this._createWidget?void(arguments.length&&this._createWidget(e,t)):new s(e,t)},e.extend(s,r,{version:i.version,_proto:e.extend({},i),_childConstructors:[]}),a=new n,a.options=e.widget.extend({},a.options),e.each(i,function(t,i){return e.isFunction(i)?void(l[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},o=function(e){return n.prototype[t].apply(this,e)};return function(){var t,n=this._super,r=this._superApply;return this._super=e,this._superApply=o,t=i.apply(this,arguments),this._super=n,this._superApply=r,t}}()):void(l[t]=i)}),s.prototype=e.widget.extend(a,{widgetEventPrefix:r?a.widgetEventPrefix||t:t},l,{constructor:s,namespace:c,widgetName:t,widgetFullName:o}),r?(e.each(r._childConstructors,function(t,n){var i=n.prototype;e.widget(i.namespace+"."+i.widgetName,s,n._proto)}),delete r._childConstructors):n._childConstructors.push(s),e.widget.bridge(t,s)},e.widget.extend=function(n){for(var o,r,s=i.call(arguments,1),a=0,l=s.length;a<l;a++)for(o in s[a])r=s[a][o],s[a].hasOwnProperty(o)&&r!==t&&(e.isPlainObject(r)?n[o]=e.isPlainObject(n[o])?e.widget.extend({},n[o],r):e.widget.extend({},r):n[o]=r);return n},e.widget.bridge=function(n,o){var r=o.prototype.widgetFullName||n;e.fn[n]=function(s){var a="string"==typeof s,l=i.call(arguments,1),c=this;return s=!a&&l.length?e.widget.extend.apply(null,[s].concat(l)):s,a?this.each(function(){var i,o=e.data(this,r);return o?e.isFunction(o[s])&&"_"!==s.charAt(0)?(i=o[s].apply(o,l),i!==o&&i!==t?(c=i&&i.jquery?c.pushStack(i.get()):i,!1):void 0):e.error("no such method '"+s+"' for "+n+" widget instance"):e.error("cannot call methods on "+n+" prior to initialization; attempted to call method '"+s+"'")}):this.each(function(){var t=e.data(this,r);t?t.option(s||{})._init():e.data(this,r,new o(s,this))}),c}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,i){var o,r,s,a=n;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof n)if(a={},o=n.split("."),n=o.shift(),o.length){for(r=a[n]=e.widget.extend({},this.options[n]),s=0;s<o.length-1;s++)r[o[s]]=r[o[s]]||{},r=r[o[s]];if(n=o.pop(),1===arguments.length)return r[n]===t?null:r[n];r[n]=i}else{if(1===arguments.length)return this.options[n]===t?null:this.options[n];a[n]=i}return this._setOptions(a),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,n,i){var o,r=this;"boolean"!=typeof t&&(i=n,n=t,t=!1),i?(n=o=e(n),this.bindings=this.bindings.add(n)):(i=n,n=this.element,o=this.widget()),e.each(i,function(i,s){function a(){if(t||r.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled"))return("string"==typeof s?r[s]:s).apply(r,arguments)}"string"!=typeof s&&(a.guid=s.guid=s.guid||a.guid||e.guid++);var l=i.match(/^(\w+)\s*(.*)$/),c=l[1]+r.eventNamespace,u=l[2];u?o.delegate(u,c,a):n.bind(c,a)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return("string"==typeof e?i[e]:e).apply(i,arguments)}var i=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,i){var o,r,s=this.options[t];if(i=i||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],r=n.originalEvent)for(o in r)o in n||(n[o]=r[o]);return this.element.trigger(n,i),!(e.isFunction(s)&&s.apply(this.element[0],[n].concat(i))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(i,o,r){"string"==typeof o&&(o={effect:o});var s,a=o?o===!0||"number"==typeof o?n:o.effect||n:t;o=o||{},"number"==typeof o&&(o={duration:o}),s=!e.isEmptyObject(o),o.complete=r,o.delay&&i.delay(o.delay),s&&e.effects&&e.effects.effect[a]?i[t](o):a!==t&&i[a]?i[a](o.duration,o.easing,r):i.queue(function(n){e(this)[t](),r&&r.call(i[0]),n()})}})}(jQuery),function(e,t){var n=!1;e(document).mouseup(function(){n=!1}),e.widget("ui.mouse",{version:"1.10.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){if(!0===e.data(n.target,t.widgetName+".preventClickEvent"))return e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(!n){this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var i=this,o=1===t.which,r=!("string"!=typeof this.options.cancel||!t.target.nodeName)&&e(t.target).closest(this.options.cancel).length;return!(o&&!r&&this._mouseCapture(t))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(t)!==!1,!this._mouseStarted)?(t.preventDefault(),!0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),n=!0,!0))}},_mouseMove:function(t){return e.ui.ie&&(!document.documentMode||document.documentMode<9)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(e,t){e.widget("ui.draggable",e.ui.mouse,{version:"1.10.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var n=this.options;return!(this.helper||n.disabled||e(t.target).closest(".ui-resizable-handle").length>0)&&(this.handle=this._getHandle(t),!!this.handle&&(e(n.iframeFix===!0?"iframe":n.iframeFix).each(function(){e("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0))},_mouseStart:function(t){var n=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,n){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),!n){var i=this._uiHash();if(this._trigger("drag",t,i)===!1)return this._mouseUp({}),!1;this.position=i.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var n=this,i=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(i=e.ui.ddmanager.drop(this,t)),this.dropped&&(i=this.dropped,this.dropped=!1),!("original"===this.options.helper&&!e.contains(this.element[0].ownerDocument,this.element[0]))&&("invalid"===this.options.revert&&!i||"valid"===this.options.revert&&i||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,i)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){n._trigger("stop",t)!==!1&&n._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1)},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return!this.options.handle||!!e(t.target).closest(this.element.find(this.options.handle)).length},_createHelper:function(t){var n=this.options,i=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t])):"clone"===n.helper?this.element.clone().removeAttr("id"):this.element;return i.parents("body").length||i.appendTo("parent"===n.appendTo?this.element[0].parentNode:n.appendTo),i[0]===this.element[0]||/(fixed|absolute)/.test(i.css("position"))||i.css("position","absolute"),i},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,n,i,o=this.options;return o.containment?"window"===o.containment?void(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===o.containment?void(this.containment=[0,0,e(document).width()-this.helperProportions.width-this.margins.left,(e(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):o.containment.constructor===Array?void(this.containment=o.containment):("parent"===o.containment&&(o.containment=this.helper[0].parentNode),n=e(o.containment),i=n[0],void(i&&(t="hidden"!==n.css("overflow"),this.containment=[(parseInt(n.css("borderLeftWidth"),10)||0)+(parseInt(n.css("paddingLeft"),10)||0),(parseInt(n.css("borderTopWidth"),10)||0)+(parseInt(n.css("paddingTop"),10)||0),(t?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(n.css("borderRightWidth"),10)||0)-(parseInt(n.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(n.css("borderBottomWidth"),10)||0)-(parseInt(n.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=n))):void(this.containment=null)},_convertPositionTo:function(t,n){n||(n=this.position);var i="absolute"===t?1:-1,o="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:o.scrollTop(),left:o.scrollLeft()}),{top:n.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*i,left:n.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*i}},_generatePosition:function(t){var n,i,o,r,s=this.options,a="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=t.pageX,c=t.pageY;return this.offset.scroll||(this.offset.scroll={top:a.scrollTop(),left:a.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(i=this.relative_container.offset(),n=[this.containment[0]+i.left,this.containment[1]+i.top,this.containment[2]+i.left,this.containment[3]+i.top]):n=this.containment,t.pageX-this.offset.click.left<n[0]&&(l=n[0]+this.offset.click.left),t.pageY-this.offset.click.top<n[1]&&(c=n[1]+this.offset.click.top),t.pageX-this.offset.click.left>n[2]&&(l=n[2]+this.offset.click.left),t.pageY-this.offset.click.top>n[3]&&(c=n[3]+this.offset.click.top)),s.grid&&(o=s.grid[1]?this.originalPageY+Math.round((c-this.originalPageY)/s.grid[1])*s.grid[1]:this.originalPageY,c=n?o-this.offset.click.top>=n[1]||o-this.offset.click.top>n[3]?o:o-this.offset.click.top>=n[1]?o-s.grid[1]:o+s.grid[1]:o,r=s.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/s.grid[0])*s.grid[0]:this.originalPageX,l=n?r-this.offset.click.left>=n[0]||r-this.offset.click.left>n[2]?r:r-this.offset.click.left>=n[0]?r-s.grid[0]:r+s.grid[0]:r)),{top:c-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,n,i){return i=i||this._uiHash(),e.ui.plugin.call(this,t,[n,i]),"drag"===t&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,n,i)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,n){var i=e(this).data("ui-draggable"),o=i.options,r=e.extend({},n,{item:i.element});i.sortables=[],e(o.connectToSortable).each(function(){var n=e.data(this,"ui-sortable");n&&!n.options.disabled&&(i.sortables.push({instance:n,shouldRevert:n.options.revert}),n.refreshPositions(),n._trigger("activate",t,r))})},stop:function(t,n){var i=e(this).data("ui-draggable"),o=e.extend({},n,{item:i.element});e.each(i.sortables,function(){this.instance.isOver?(this.instance.isOver=0,i.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,"original"===i.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,o));
})},drag:function(t,n){var i=e(this).data("ui-draggable"),o=this;e.each(i.sortables,function(){var r=!1,s=this;this.instance.positionAbs=i.positionAbs,this.instance.helperProportions=i.helperProportions,this.instance.offset.click=i.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(r=!0,e.each(i.sortables,function(){return this.instance.positionAbs=i.positionAbs,this.instance.helperProportions=i.helperProportions,this.instance.offset.click=i.offset.click,this!==s&&this.instance._intersectsWith(this.instance.containerCache)&&e.contains(s.instance.element[0],this.instance.element[0])&&(r=!1),r})),r?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(o).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return n.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=i.offset.click.top,this.instance.offset.click.left=i.offset.click.left,this.instance.offset.parent.left-=i.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=i.offset.parent.top-this.instance.offset.parent.top,i._trigger("toSortable",t),i.dropped=this.instance.element,i.currentItem=i.element,this.instance.fromOutside=i),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),i._trigger("fromSortable",t),i.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),n=e(this).data("ui-draggable").options;t.css("cursor")&&(n._cursor=t.css("cursor")),t.css("cursor",n.cursor)},stop:function(){var t=e(this).data("ui-draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,n){var i=e(n.helper),o=e(this).data("ui-draggable").options;i.css("opacity")&&(o._opacity=i.css("opacity")),i.css("opacity",o.opacity)},stop:function(t,n){var i=e(this).data("ui-draggable").options;i._opacity&&e(n.helper).css("opacity",i._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("ui-draggable");t.scrollParent[0]!==document&&"HTML"!==t.scrollParent[0].tagName&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var n=e(this).data("ui-draggable"),i=n.options,o=!1;n.scrollParent[0]!==document&&"HTML"!==n.scrollParent[0].tagName?(i.axis&&"x"===i.axis||(n.overflowOffset.top+n.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity?n.scrollParent[0].scrollTop=o=n.scrollParent[0].scrollTop+i.scrollSpeed:t.pageY-n.overflowOffset.top<i.scrollSensitivity&&(n.scrollParent[0].scrollTop=o=n.scrollParent[0].scrollTop-i.scrollSpeed)),i.axis&&"y"===i.axis||(n.overflowOffset.left+n.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity?n.scrollParent[0].scrollLeft=o=n.scrollParent[0].scrollLeft+i.scrollSpeed:t.pageX-n.overflowOffset.left<i.scrollSensitivity&&(n.scrollParent[0].scrollLeft=o=n.scrollParent[0].scrollLeft-i.scrollSpeed))):(i.axis&&"x"===i.axis||(t.pageY-e(document).scrollTop()<i.scrollSensitivity?o=e(document).scrollTop(e(document).scrollTop()-i.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<i.scrollSensitivity&&(o=e(document).scrollTop(e(document).scrollTop()+i.scrollSpeed))),i.axis&&"y"===i.axis||(t.pageX-e(document).scrollLeft()<i.scrollSensitivity?o=e(document).scrollLeft(e(document).scrollLeft()-i.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<i.scrollSensitivity&&(o=e(document).scrollLeft(e(document).scrollLeft()+i.scrollSpeed)))),o!==!1&&e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(n,t)}}),e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("ui-draggable"),n=t.options;t.snapElements=[],e(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var n=e(this),i=n.offset();this!==t.element[0]&&t.snapElements.push({item:this,width:n.outerWidth(),height:n.outerHeight(),top:i.top,left:i.left})})},drag:function(t,n){var i,o,r,s,a,l,c,u,d,m,p=e(this).data("ui-draggable"),h=p.options,f=h.snapTolerance,g=n.offset.left,v=g+p.helperProportions.width,b=n.offset.top,y=b+p.helperProportions.height;for(d=p.snapElements.length-1;d>=0;d--)a=p.snapElements[d].left,l=a+p.snapElements[d].width,c=p.snapElements[d].top,u=c+p.snapElements[d].height,v<a-f||g>l+f||y<c-f||b>u+f||!e.contains(p.snapElements[d].item.ownerDocument,p.snapElements[d].item)?(p.snapElements[d].snapping&&p.options.snap.release&&p.options.snap.release.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[d].item})),p.snapElements[d].snapping=!1):("inner"!==h.snapMode&&(i=Math.abs(c-y)<=f,o=Math.abs(u-b)<=f,r=Math.abs(a-v)<=f,s=Math.abs(l-g)<=f,i&&(n.position.top=p._convertPositionTo("relative",{top:c-p.helperProportions.height,left:0}).top-p.margins.top),o&&(n.position.top=p._convertPositionTo("relative",{top:u,left:0}).top-p.margins.top),r&&(n.position.left=p._convertPositionTo("relative",{top:0,left:a-p.helperProportions.width}).left-p.margins.left),s&&(n.position.left=p._convertPositionTo("relative",{top:0,left:l}).left-p.margins.left)),m=i||o||r||s,"outer"!==h.snapMode&&(i=Math.abs(c-b)<=f,o=Math.abs(u-y)<=f,r=Math.abs(a-g)<=f,s=Math.abs(l-v)<=f,i&&(n.position.top=p._convertPositionTo("relative",{top:c,left:0}).top-p.margins.top),o&&(n.position.top=p._convertPositionTo("relative",{top:u-p.helperProportions.height,left:0}).top-p.margins.top),r&&(n.position.left=p._convertPositionTo("relative",{top:0,left:a}).left-p.margins.left),s&&(n.position.left=p._convertPositionTo("relative",{top:0,left:l-p.helperProportions.width}).left-p.margins.left)),!p.snapElements[d].snapping&&(i||o||r||s||m)&&p.options.snap.snap&&p.options.snap.snap.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[d].item})),p.snapElements[d].snapping=i||o||r||s||m)}}),e.ui.plugin.add("draggable","stack",{start:function(){var t,n=this.data("ui-draggable").options,i=e.makeArray(e(n.stack)).sort(function(t,n){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(n).css("zIndex"),10)||0)});i.length&&(t=parseInt(e(i[0]).css("zIndex"),10)||0,e(i).each(function(n){e(this).css("zIndex",t+n)}),this.css("zIndex",t+i.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,n){var i=e(n.helper),o=e(this).data("ui-draggable").options;i.css("zIndex")&&(o._zIndex=i.css("zIndex")),i.css("zIndex",o.zIndex)},stop:function(t,n){var i=e(this).data("ui-draggable").options;i._zIndex&&e(n.helper).css("zIndex",i._zIndex)}})}(jQuery),function(e,t){function n(e,t,n){return e>t&&e<t+n}function i(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))}e.widget("ui.sortable",e.ui.mouse,{version:"1.10.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=!!this.items.length&&("x"===e.axis||i(this.items[0].item)),this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,n){"disabled"===t?(this.options[t]=n,this.widget().toggleClass("ui-sortable-disabled",!!n)):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,n){var i=null,o=!1,r=this;return!this.reverting&&(!this.options.disabled&&"static"!==this.options.type&&(this._refreshItems(t),e(t.target).parents().each(function(){if(e.data(this,r.widgetName+"-item")===r)return i=e(this),!1}),e.data(t.target,r.widgetName+"-item")===r&&(i=e(t.target)),!!i&&(!(this.options.handle&&!n&&(e(this.options.handle,i).find("*").addBack().each(function(){this===t.target&&(o=!0)}),!o))&&(this.currentItem=i,this._removeCurrentsFromItems(),!0))))},_mouseStart:function(t,n,i){var o,r,s=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,s.cursorAt&&this._adjustOffsetFromHelper(s.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),s.containment&&this._setContainment(),s.cursor&&"auto"!==s.cursor&&(r=this.document.find("body"),this.storedCursor=r.css("cursor"),r.css("cursor",s.cursor),this.storedStylesheet=e("<style>*{ cursor: "+s.cursor+" !important; }</style>").appendTo(r)),s.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",s.opacity)),s.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",s.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!i)for(o=this.containers.length-1;o>=0;o--)this.containers[o]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!s.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var n,i,o,r,s=this.options,a=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<s.scrollSensitivity?this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop+s.scrollSpeed:t.pageY-this.overflowOffset.top<s.scrollSensitivity&&(this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop-s.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<s.scrollSensitivity?this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft+s.scrollSpeed:t.pageX-this.overflowOffset.left<s.scrollSensitivity&&(this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft-s.scrollSpeed)):(t.pageY-e(document).scrollTop()<s.scrollSensitivity?a=e(document).scrollTop(e(document).scrollTop()-s.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<s.scrollSensitivity&&(a=e(document).scrollTop(e(document).scrollTop()+s.scrollSpeed)),t.pageX-e(document).scrollLeft()<s.scrollSensitivity?a=e(document).scrollLeft(e(document).scrollLeft()-s.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<s.scrollSensitivity&&(a=e(document).scrollLeft(e(document).scrollLeft()+s.scrollSpeed))),a!==!1&&e.ui.ddmanager&&!s.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),n=this.items.length-1;n>=0;n--)if(i=this.items[n],o=i.item[0],r=this._intersectsWithPointer(i),r&&i.instance===this.currentContainer&&!(o===this.currentItem[0]||this.placeholder[1===r?"next":"prev"]()[0]===o||e.contains(this.placeholder[0],o)||"semi-dynamic"===this.options.type&&e.contains(this.element[0],o))){if(this.direction=1===r?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(i))break;this._rearrange(t,i),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,n){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var i=this,o=this.placeholder.offset(),r=this.options.axis,s={};r&&"x"!==r||(s.left=o.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),r&&"y"!==r||(s.top=o.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(s,parseInt(this.options.revert,10)||500,function(){i._clear(t)})}else this._clear(t,n);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var n=this._getItemsAsjQuery(t&&t.connected),i=[];return t=t||{},e(n).each(function(){var n=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);n&&i.push((t.key||n[1]+"[]")+"="+(t.key&&t.expression?n[1]:n[2]))}),!i.length&&t.key&&i.push(t.key+"="),i.join("&")},toArray:function(t){var n=this._getItemsAsjQuery(t&&t.connected),i=[];return t=t||{},n.each(function(){i.push(e(t.item||this).attr(t.attribute||"id")||"")}),i},_intersectsWith:function(e){var t=this.positionAbs.left,n=t+this.helperProportions.width,i=this.positionAbs.top,o=i+this.helperProportions.height,r=e.left,s=r+e.width,a=e.top,l=a+e.height,c=this.offset.click.top,u=this.offset.click.left,d="x"===this.options.axis||i+c>a&&i+c<l,m="y"===this.options.axis||t+u>r&&t+u<s,p=d&&m;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:r<t+this.helperProportions.width/2&&n-this.helperProportions.width/2<s&&a<i+this.helperProportions.height/2&&o-this.helperProportions.height/2<l},_intersectsWithPointer:function(e){var t="x"===this.options.axis||n(this.positionAbs.top+this.offset.click.top,e.top,e.height),i="y"===this.options.axis||n(this.positionAbs.left+this.offset.click.left,e.left,e.width),o=t&&i,r=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return!!o&&(this.floating?s&&"right"===s||"down"===r?2:1:r&&("down"===r?2:1))},_intersectsWithSides:function(e){var t=n(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),i=n(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),o=this._getDragVerticalDirection(),r=this._getDragHorizontalDirection();return this.floating&&r?"right"===r&&i||"left"===r&&!i:o&&("down"===o&&t||"up"===o&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){function n(){a.push(this)}var i,o,r,s,a=[],l=[],c=this._connectWith();if(c&&t)for(i=c.length-1;i>=0;i--)for(r=e(c[i]),o=r.length-1;o>=0;o--)s=e.data(r[o],this.widgetFullName),s&&s!==this&&!s.options.disabled&&l.push([e.isFunction(s.options.items)?s.options.items.call(s.element):e(s.options.items,s.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),s]);for(l.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),i=l.length-1;i>=0;i--)l[i][0].each(n);return e(a)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var n=0;n<t.length;n++)if(t[n]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var n,i,o,r,s,a,l,c,u=this.items,d=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],m=this._connectWith();if(m&&this.ready)for(n=m.length-1;n>=0;n--)for(o=e(m[n]),i=o.length-1;i>=0;i--)r=e.data(o[i],this.widgetFullName),r&&r!==this&&!r.options.disabled&&(d.push([e.isFunction(r.options.items)?r.options.items.call(r.element[0],t,{item:this.currentItem}):e(r.options.items,r.element),r]),this.containers.push(r));for(n=d.length-1;n>=0;n--)for(s=d[n][1],a=d[n][0],i=0,c=a.length;i<c;i++)l=e(a[i]),l.data(this.widgetName+"-item",s),u.push({item:l,instance:s,width:0,height:0,left:0,top:0})},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var n,i,o,r;for(n=this.items.length-1;n>=0;n--)i=this.items[n],i.instance!==this.currentContainer&&this.currentContainer&&i.item[0]!==this.currentItem[0]||(o=this.options.toleranceElement?e(this.options.toleranceElement,i.item):i.item,t||(i.width=o.outerWidth(),i.height=o.outerHeight()),r=o.offset(),i.left=r.left,i.top=r.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(n=this.containers.length-1;n>=0;n--)r=this.containers[n].element.offset(),this.containers[n].containerCache.left=r.left,this.containers[n].containerCache.top=r.top,this.containers[n].containerCache.width=this.containers[n].element.outerWidth(),this.containers[n].containerCache.height=this.containers[n].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var n,i=t.options;i.placeholder&&i.placeholder.constructor!==String||(n=i.placeholder,i.placeholder={element:function(){var i=t.currentItem[0].nodeName.toLowerCase(),o=e("<"+i+">",t.document[0]).addClass(n||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===i?t.currentItem.children().each(function(){e("<td>&#160;</td>",t.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(o)}):"img"===i&&o.attr("src",t.currentItem.attr("src")),n||o.css("visibility","hidden"),o},update:function(e,o){n&&!i.forcePlaceholderSize||(o.height()||o.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),o.width()||o.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(i.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),i.placeholder.update(t,t.placeholder)},_contactContainers:function(t){var o,r,s,a,l,c,u,d,m,p,h=null,f=null;for(o=this.containers.length-1;o>=0;o--)if(!e.contains(this.currentItem[0],this.containers[o].element[0]))if(this._intersectsWith(this.containers[o].containerCache)){if(h&&e.contains(this.containers[o].element[0],h.element[0]))continue;h=this.containers[o],f=o}else this.containers[o].containerCache.over&&(this.containers[o]._trigger("out",t,this._uiHash(this)),this.containers[o].containerCache.over=0);if(h)if(1===this.containers.length)this.containers[f].containerCache.over||(this.containers[f]._trigger("over",t,this._uiHash(this)),this.containers[f].containerCache.over=1);else{for(s=1e4,a=null,p=h.floating||i(this.currentItem),l=p?"left":"top",c=p?"width":"height",u=this.positionAbs[l]+this.offset.click[l],r=this.items.length-1;r>=0;r--)e.contains(this.containers[f].element[0],this.items[r].item[0])&&this.items[r].item[0]!==this.currentItem[0]&&(p&&!n(this.positionAbs.top+this.offset.click.top,this.items[r].top,this.items[r].height)||(d=this.items[r].item.offset()[l],m=!1,Math.abs(d-u)>Math.abs(d+this.items[r][c]-u)&&(m=!0,d+=this.items[r][c]),Math.abs(d-u)<s&&(s=Math.abs(d-u),a=this.items[r],this.direction=m?"up":"down")));if(!a&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[f])return;a?this._rearrange(t,a,null,!0):this._rearrange(t,null,this.containers[f].element,!0),this._trigger("change",t,this._uiHash()),this.containers[f]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[f],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[f]._trigger("over",t,this._uiHash(this)),this.containers[f].containerCache.over=1}},_createHelper:function(t){var n=this.options,i=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t,this.currentItem])):"clone"===n.helper?this.currentItem.clone():this.currentItem;return i.parents("body").length||e("parent"!==n.appendTo?n.appendTo:this.currentItem[0].parentNode)[0].appendChild(i[0]),i[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),i[0].style.width&&!n.forceHelperSize||i.width(this.currentItem.width()),i[0].style.height&&!n.forceHelperSize||i.height(this.currentItem.height()),i},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,n,i,o=this.options;"parent"===o.containment&&(o.containment=this.helper[0].parentNode),"document"!==o.containment&&"window"!==o.containment||(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e("document"===o.containment?document:window).width()-this.helperProportions.width-this.margins.left,(e("document"===o.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(o.containment)||(t=e(o.containment)[0],n=e(o.containment).offset(),i="hidden"!==e(t).css("overflow"),this.containment=[n.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,n.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,n.left+(i?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,n.top+(i?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,n){n||(n=this.position);var i="absolute"===t?1:-1,o="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,r=/(html|body)/i.test(o[0].tagName);return{top:n.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():r?0:o.scrollTop())*i,left:n.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():r?0:o.scrollLeft())*i}},_generatePosition:function(t){var n,i,o=this.options,r=t.pageX,s=t.pageY,a="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(a[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(r=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(s=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(r=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(s=this.containment[3]+this.offset.click.top)),o.grid&&(n=this.originalPageY+Math.round((s-this.originalPageY)/o.grid[1])*o.grid[1],s=this.containment?n-this.offset.click.top>=this.containment[1]&&n-this.offset.click.top<=this.containment[3]?n:n-this.offset.click.top>=this.containment[1]?n-o.grid[1]:n+o.grid[1]:n,i=this.originalPageX+Math.round((r-this.originalPageX)/o.grid[0])*o.grid[0],r=this.containment?i-this.offset.click.left>=this.containment[0]&&i-this.offset.click.left<=this.containment[2]?i:i-this.offset.click.left>=this.containment[0]?i-o.grid[0]:i+o.grid[0]:i)),{top:s-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:a.scrollTop()),left:r-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:a.scrollLeft())}},_rearrange:function(e,t,n,i){n?n[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var o=this.counter;this._delay(function(){o===this.counter&&this.refreshPositions(!i)})},_clear:function(e,t){function n(e,t,n){return function(i){n._trigger(e,i,t._uiHash(t))}}this.reverting=!1;var i,o=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(i in this._storedCSS)"auto"!==this._storedCSS[i]&&"static"!==this._storedCSS[i]||(this._storedCSS[i]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&o.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||o.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(o.push(function(e){this._trigger("remove",e,this._uiHash())}),o.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),o.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),i=this.containers.length-1;i>=0;i--)t||o.push(n("deactivate",this,this.containers[i])),this.containers[i].containerCache.over&&(o.push(n("out",this,this.containers[i])),this.containers[i].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!t){for(this._trigger("beforeStop",e,this._uiHash()),i=0;i<o.length;i++)o[i].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!1}if(t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!t){for(i=0;i<o.length;i++)o[i].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var n=t||this;return{helper:n.helper,placeholder:n.placeholder||e([]),position:n.position,originalPosition:n.originalPosition,offset:n.positionAbs,item:n.currentItem,sender:t?t.element:null}}})}(jQuery),define("jqueryui",["jquery"],function(e){return function(){var t;return t||e.$}}(this)),define("modules/emailbuilder/helper/jquery-ui-fixes",["jqueryui"],function(e){function t(e,t){var n=t.currentContainer,i=1e4,o=null,r=t.positionAbs.top+t.offset.click.top;t.items.forEach(function(e){if(n.element.has(e[0]).length&&t.currentItem[0]!==e[0]){var s=e.item.offset().top,a=!1;Math.abs(s-r)>Math.abs(s+e.height-r)&&(a=!0,s+=e.height),Math.abs(s-r)<i&&(i=Math.abs(s-r),o=e,t.direction=a?"up":"down")}}),o?t._rearrange(e,o,null,!0):t._rearrange(e,null,t.currentContainer.element,!0),t._trigger("change",e,t._uiHash()),t.currentContainer._trigger("change",e,t._uiHash(t))}var n=e.ui.sortable.prototype,i=e.ui.draggable.prototype,o=i.plugins.stop.filter(function(e){return"connectToSortable"===e[0]})[0],r=i.plugins.drag.filter(function(e){return"connectToSortable"===e[0]})[0],s=i.plugins.start.filter(function(e){return"connectToSortable"===e[0]})[0],a=o[1],l=i._generatePosition,c=n._contactContainers,u=n._mouseDown,d=n._mouseStart;n._convertPositionTo;i._generatePosition=function(e){return this.offset.scroll=!1,
l.call(this,e)},s[1]=function(t,n){var i=e(this).data("ui-draggable"),o=i.options,r=e.extend({},n,{item:i.element});i.sortables=[],i.currentSortable=!1;var s=Date.now();e(o.connectToSortable).filter(":visible").each(function(){var t=e.data(this,"ui-sortable");t&&(i.sortables.push({instance:t,shouldRevert:t.options.revert}),t.refreshVersion={current:s})}),i.sortables.forEach(function(e){e.instance.refreshVersion.completed!==s&&e.instance.refreshPositions(),e.instance._trigger("activate",t,r)}),i.sortables.forEach(function(e){delete e.instance.refreshVersion})},r[1]=function(t,n){var i,o,r=e(this),s=r.data("ui-draggable"),a=({top:t.pageY,left:t.pageX},!1),l=s.sortables.filter(function(e){var t,n=e.instance;return a||(t=n.element.scrollParent(),a={top:s.position.top+t.scrollTop(),left:s.position.left+t.scrollLeft()}),n.positionAbs=a,n.helperProportions=s.helperProportions,n.offset.click=s.offset.click,n._intersectsWith(n.containerCache)}).pop();l?l!==s.currentSortable&&(i=l.instance,o=s.currentSortable,s.currentSortable=l):(o=s.currentSortable,s.currentSortable=l),o&&(o.instance.cancelHelperRemoval=!0,o.instance.options.revert=!1,o.instance._trigger("out",t,o.instance._uiHash(o.instance)),o.instance._mouseStop(t,!0),o.instance.options.helper=o.instance.options._helper,o.instance.currentItem.remove(),o.instance.placeholder&&o.instance.placeholder.remove(),s._trigger("fromSortable",t),s.dropped=!1),i&&(i.currentItem=r.clone().removeAttr("id").appendTo(i.element).data("ui-sortable-item",!0),i.options._helper=i.options.helper,i.options.helper=function(){return n.helper[0]},t.target=i.currentItem[0],i._mouseCapture(t,!0),i._mouseStart(t,!0,!0),i.offset.click.top=s.offset.click.top,i.offset.click.left=s.offset.click.left,i.offset.parent.left-=s.offset.parent.left-i.offset.parent.left,i.offset.parent.top-=s.offset.parent.top-i.offset.parent.top,s._trigger("toSortable",t),s.dropped=i.element,s.currentItem=s.element,i.fromOutside=s,i._trigger("over",t,i._uiHash(i))),l&&l.instance&&l.instance.currentItem&&l.instance._mouseDrag(t)},o[1]=function(t,n){var i=e(this).data("ui-draggable").currentSortable;i&&(i.instance.isOver=1),a.call(this,t,n)},n._mouseStart=function(e,t,n){var i=this.currentItem.hide;this.currentItem.hide=function(){},d.call(this,e,t,n),this.currentItem.hide=i,this.currentContainer===this&&this._trigger("over",e,this._uiHash(this))},n._mouseMove=function(e){return this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},e("html").is(".ie9")&&(n._mouseDown=function(e){return e.preventDefault=function(){},u.call(this,e)}),n._convertPositionTo=function(e,t){t||(t=this.position);var n="absolute"===e?1:-1;return{top:t.top+this.offset.relative.top*n+this.offset.parent.top*n- -this.scrollParent.scrollTop()*n,left:t.left+this.offset.relative.left*n+this.offset.parent.left*n- -this.scrollParent.scrollLeft()*n}},n._contactContainers=function(e){if("content"!==this.element.attr("type"))return c.call(this,e);var n,i=this,o=this.containers.filter(function(e){return i._intersectsWith(e.containerCache)})[0];o?o!==this.currentContainer&&(n=this.currentContainer,this.currentContainer=o,o._trigger("over",e,this._uiHash(this)),this.containers.length>1&&t(e,this)):(n=this.currentContainer,this.currentContainer=o||this),n&&n._trigger("out",e,this._uiHash(this))}}),define("modules/emailbuilder/services/dropzoneDimensions",["modules/emailbuilder/module"],function(e){function t(e,t,n,i){var o=t.next(".emb-js-section-and-separator-wrapper"),r=o.offset().top,s=e.outerHeight();return n.top+i+s+(r-(n.top+s))/2}function n(e,t,n){var i=e.prev(".emb-js-section-and-separator-wrapper"),o=i.find(".hmb-js-section-wrapper"),r=o.offset().top,s=o.outerHeight();return t.top+n-(t.top-(r+s))/2}function i(e,i,o){var r=i.scrollParent().scrollTop(),s=i.offset(),a=i.closest(".emb-js-section-and-separator-wrapper"),l=o.firstSection?0:n(a,s,r),c=o.lastSection?Number.MAX_VALUE:t(i,a,s,r);return{width:i.outerWidth(),left:s.left,top:l,height:c-l}}function o(e){this.$doc=e}o.prototype.getDimensions=function(e,t,n){var o=e.offset(),r=e.outerWidth(),s=i(this,t,n);return n.firstColumn&&n.lastColumn?r=s.width:n.firstColumn?r+=o.left-s.left:n.lastColumn&&(r=s.width-(o.left-s.left)),{left:n.firstColumn?s.left:o.left,top:s.top,width:r,height:s.height,sepHeight:s.sepHeight}},e.service("embDropzoneDimensions",["$document",o])}),define("ts/modules/emailbuilder/directives/sortable",["modules/emailbuilder/module","vendor/angular","modules/emailbuilder/helper/jquery-ui-fixes","ts/modules/emailbuilder/services/email","modules/shared/shims","modules/emailbuilder/services/dropzoneDimensions","ts/modules/emailbuilder/services/lockLevelSvc"],function(e,t,n,i,o,r,s){function a(e,t,n){return e.is(".ui-draggable")||t||n&&!n.has(e).length}function l(e,t){t.placeholder.height(0)}function c(e,t,n,i,o){if(a(o.item,o.sender))return void o.item.remove();var r=t.children(":not(.emb-insertion-bar,.emb-dz-container)");this.oldPos=r.index(o.item),this.draggedItem=u(o.item,this.model,this.type),l(i,o),e.start({type:this.type,contentType:this.draggedItem.type,mouseX:i.pageX,mouseY:i.pageY}),n.$emit("content:deactivate")}function u(e,t,n){var i=e;return e.show(),"section"===n&&(i=e.find(".emb-js-section-outer-wrapper")),i.fadeTo(0,.5),e.scope()[t]}function d(e,t,n,i,o,r,s){var l=s.item.closest(".emb-js-section-outer-wrapper").scope();if(l){var c=o.getLocks(l.section.permissions);if(c.dragAndDropLocked)return void n.sortable("cancel")}var u=f(r,t),d=u||a(s.item,s.sender,n),m=u||!d,p=v[this.type](n,s.item);if(m&&n.sortable("cancel"),!d&&p!==this.oldPos){var g=i&&i.getLocation();h(e,this.type,this.oldPos,g,null,n,s.item)}}function m(e,t,n,i,o,r,s,l,c){a(c.item,c.sender)||(t.insertBefore=null,this.draggedItem=null,p(c.item,this.type),e.stop(),d.call(this,n,i,o,r,s,l,c))}function p(e,t){var n=e;"section"===t&&(n=e.find(".emb-js-section-outer-wrapper")),n.fadeTo(0,1)}function h(e,t,n,i,o,r,s){var a=v[t](r,s);e.$broadcast(t+".moved",n,a,i,o)}function f(e,t){return e.clientX<0||e.clientX>t.innerWidth||e.clientY<0}function g(e,n,i,o,r,s){function u(e){i.move({mouseX:e.pageX,mouseY:e.pageY})}return{require:"?^embDropzone",link:function(d,p,f,g){function v(e){var t=s.getLocks(e);t.dragAndDropLocked?w():k()}if(d.buttonType=f.type,d.model=f.model,d.type=f.type,p.sortable({handle:f.handle,delay:50,distance:10,cursor:"move",tolerance:"pointer",cancel:"textarea,button,select,option",connectWith:f.connectWith||!1,over:l,start:t.bind(d,c,i,p,e),sort:u,stop:t.bind(d,m,i,n,e,r,p,g,s),helper:function(){return t.element("<span />").hide()},receive:function(t,i){var o=s.getLocks(d.section.permissions);if(o.dragAndDropLocked&&i.sender.hasClass("ui-sortable")&&i.sender.sortable("cancel"),a(i.item))"content"===d.type&&n.setContentTarget(g.getLocation());else{var r=i.sender.controller("embDropzone"),l=i.item.scope();h(e,d.type,l.oldPos,r.getLocation(),g.getLocation(),p,i.item)}}}),"content"===d.type){var b=!0,y=!0;if(p.hasClass("emb-js-content-container")){var w=function(){y=!1,p.sortable("option","handle","doesnotexist"),p.toggleClass("emb-active-sortable",!1)},k=function(){y=!0,t.element(p).off("dragstart"),p.sortable("option","handle",f.handle),b&&p.toggleClass("emb-active-sortable",!0)};v(d.section.permissions),d.$on("permissionsChanged:section-"+d.section.uiId,function(e,t){v(t)})}d.$watch(function(){return n.sortability.content},function(e){e?(b=!0,p.data("ui-sortable")&&p.sortable("enable"),y&&p.toggleClass("emb-active-sortable",!0)):(b=!1,p.data("ui-sortable")&&p.sortable("disable"),p.toggleClass("emb-active-sortable",!1))}),p.sortable("option","custom",{refreshContainers:function(){this.containers=this.containers.filter(function(e){var n=e.containerCache,i=e.element,r=i.controller("embDropzone"),s=r?r.getLocation():{},a=i.closest(".hmb-js-section-wrapper");if(e.refreshVersion&&(e.refreshVersion.completed=e.refreshVersion.current),!a.length||!a.parents("html").length)return!1;var l=o.getDimensions(i,a,s);return t.extend(n,l),!0})}})}}}}var v={section:function(e,t){var n=e.find(".emb-js-section-outer-wrapper"),i=n.siblings(".emb-insertion-bar"),o=n.add(i).not(t.find(".emb-js-section-outer-wrapper"));return o.index(i)},content:function(e,t){var n=e.children().not(t),i=n.filter(".emb-insertion-bar,.emb-dz-container");return n.index(i)}};e.directive("embSortable",["$rootScope","EmailSvc","DraggingSvc","embDropzoneDimensions","$window","LockLevelSvc",g])}),define("modules/emailbuilder/directives/droplineContainer",["vendor/angular","modules/emailbuilder/module"],function(e,t){function n(e,t,n,r){var s=t.offset().top,a=t.height(),l=o(e.y,s,a,t,n);i(l,t,r)&&(l=o(e.y,s,a,t,n,!0)),l&&(l.before?l.before.before(r):l.after.after(r))}function i(e,t,n){if(!e)return!1;var i=e.check,o=e.before?"prev":"next";return i||(i=t,o="next"),i[o]().is(n)}function o(e,t,n,i,o,r){var s=r?.45:.5,a=t+n*s,l=t+n-n*s;return e<=a?{before:i,check:o}:e>=l?o?{before:o,check:i}:{after:i,check:i}:void 0}function r(e,t,n,i){var o,r,s=t.offset().top,a=s+t.height();e<=s?(o="first",r="before"):e>=a&&(o="last",r="after"),o&&t.find(i)[o]()[r](n)}function s(e,t){var n=e.offset().left,i=e.width(),o=n+i,r=t.x;(r<=n||r>=o)&&(t.x=n+i/2)}function a(t,i,o,a,c,u){var d=t.mouse;if(d&&t.dragging&&t.droplineActive){s(c,d);var m,p,h,f,g=e.element(a.elementFromPoint(d.x,d.y)),v=".emb-js-"+u+"-outer-wrapper:not(.ui-sortable-placeholder)";g.is(".emb-js-"+u+"-dragger")?(g.hide(),m=e.element(a.elementFromPoint(d.x,d.y)),g.show()):m=g,p=m.closest(v),p.length?(h=c.find(v),f=h.eq(h.index(p)+1),f.length||(f=void 0),n(d,p,f,o)):r(d.y,c,o,v),l(t,i,o,v,u)}}function l(t,n,i,o,r){var s,a,l=i.nextAll(o).get(0);l&&(a=e.element(l).scope(),s=a["section"===r?r:"block"]),n.setInsertBefore(s)}function c(e,t,n){return function(i,o,r){function s(e){i.mouse={x:e.mouseX,y:e.mouseY},a(i,t,l,c,o,u)}var l=o.find(".emb-insertion-bar"),c=e[0],u=r.type,d=[],m=n.subscribe(u+".stop",function(){i.dragging=!1,i.safeDigest()});d.push(m),m=n.subscribe(u+".move",s),d.push(m),m=n.subscribe(u+".start",function(e){i.dragging=!0,s(e),i.safeDigest()}),d.push(m),"content"===u&&(m=n.subscribe("content.captured",function(){i.captured=!0,i.safeDigest()}),d.push(m),m=n.subscribe("content.released",function(){i.captured=!1,i.safeDigest()}),d.push(m)),i.$on("$destroy",function(){d.forEach(function(e){e.unsubscribe()})})}}t.directive("csDroplineContainer",["$document","EmailSvc","DraggingSvc",c])}),define("modules/emailbuilder/directives/cancelModal",function(){}),define("vendor/text!modules/emailbuilder/templates/tile.html",[],function(){return'<span class="section-tiles__thumbnail-name" bindonce="name" bo-text="name"></span>'}),define("modules/emailbuilder/services/viewPort",["modules/emailbuilder/module","vendor/angular","vendor/postal"],function(e,t,n){function i(e,i,o){this.chan=n.channel("embStageScrolling"),this.$w=t.element(e),this.s=i.find("#emb-js-sidebar"),this.stage=i.find("#emb-js-stage"),this.editorHeader=i.find("#emb-js-editor-header"),this.$timeout=o}i.prototype={overflowTop:function(e,n){var i=this.$w.scrollTop(),o=t.element(e);return i>=o.offset().top-n.threshold&&-o.offset().top-o.outerHeight()<=0},checkVertOffStage:function(e,n){var i=t.element(e),o=i.offset().top,r=i.height(),s=this.stage.height(),a=n.threshold||0,l=o+r-s-a,c={};return c.screenPos=l,c.scrollTo=c.screenPos+this.stage.scrollTop(),c},ignoreContentDrop:function(e,t){var n=this.s.offset();return e>n.left&&t>n.top&&e<n.left+this.s.width()&&t<n.top+this.s.height()},scrollStage:function(e){this.chan.publish("scroll",e)},restoreScroll:function(){this.chan.publish("restore")},subscribe:function(e,t){return this.chan.subscribe(e,t)},ensureTheElementInViewport:function(e){var n=t.element(e),i=n.offset().top-this.editorHeader.height();this.scrollStage({offset:i,relative:!0})}},e.service("ViewPortSrv",["$window","$document","$timeout",i])}),define("modules/emailbuilder/services/dragging",["modules/emailbuilder/module","vendor/angular","vendor/postal"],function(e,t,n){function i(){this.chan=n.channel("embDragging"),this.state={}}i.prototype.start=function(e){this.state.dragging||(e.dragging=!0,this.setState(e),this.chan.publish(e.type+".start",this.state))},i.prototype.capture=function(){this.state.dragging&&!this.state.captured&&"file"===this.state.contentType&&(this.setState({captured:!0}),this.chan.publish(this.state.type+".captured",this.state))},i.prototype.release=function(){var e=this.state;e.dragging&&!e.captured&&"file"===e.contentType&&(this.setState({captured:!1}),this.chan.publish(e.type+".released",e))},i.prototype.move=function(e){this.state.dragging&&(this.setState(e),this.chan.publish(this.state.type+".move",this.state))},i.prototype.stop=function(){var e,t=this.state;t.dragging&&(e=t.captured,this.setState({dragging:!1,captured:!1}),this.chan.publish(t.type+".stop",t),e&&this.chan.publish(t.type+".released",t))},i.prototype.setState=function(e){t.extend(this.state,e)},i.prototype.subscribe=function(e,t){return this.chan.subscribe(e,t)},e.service("DraggingSvc",i)}),define("modules/emailbuilder/directives/tile",["jqueryui","vendor/angular","config","modules/emailbuilder/module","vendor/text!modules/emailbuilder/templates/tile.html","modules/emailbuilder/services/viewPort","modules/emailbuilder/services/dragging"],function(e,t,n,i,o){function r(){return t.element("<span></span>").hide()}function s(e,t){var n=c.prefix+t.toLowerCase().replace(" ","-");e.addClass(n)}function a(e){e.$emit(e.type+".add",e.item)}function l(e,i,l){function d(e){i.move({mouseX:e.pageX,mouseY:e.pageY})}return{scope:{name:"@",type:"@",subtype:"@",item:"=",appendTo:"@"},restrict:"A",replace:!1,transclude:!1,template:o,link:function(o,l,m){o.element=l,o.buttonType=o.subtype||o.type,l.addClass(u),l.on({click:function(e){a(o),e.stopPropagation()}}),l.draggable({appendTo:c.appendHelperTo,delay:50,distance:5,drag:d,start:function(e){l.addClass("emb-tile-placeholder"),i.start({type:o.type,contentType:o.buttonType,mouseX:e.pageX,mouseY:e.pageY})},stop:function(t){var n="content"!==o.type||!e.ignoreContentDrop(t.pageX,t.pageY);n&&a(o),l.removeClass("emb-tile-placeholder"),i.stop()},scroll:!0,scrollSpeed:50,helper:t.bind(o,r)}),m.connectTo&&l.draggable("option","connectToSortable",m.connectTo),m.$observe("name",function(e){e&&s(l,e)}),n.surveysEnabled||"survey"!==o.subtype||l.hide()}}}i.directive("embTile",["ViewPortSrv","DraggingSvc","$rootScope",l]);var c={name:"tile",prefix:"emb-",appendHelperTo:"#emb-js-stage"},u=c.prefix+c.name}),define("vendor/text!modules/emailbuilder/templates/addSection.html",[],function(){return'<div class="add-section-container emb-addsec-wrap" id="emb-js-addsec-wrapper" data-addsection="true">\r\n\r\n    <div class="add-section emb-new-section emb-reset" id="emb-js-new-section" ng-click="toggle();switchPane();" ng-show="newSectionShown">\r\n\r\n        <button class="c-button-add-section qa-add-section" ng-class="buttonClass" id="emb-new-section-btn">Add section</button>\r\n\r\n        <div class="section-chooser" ng-style="{ \'z-index\' : (menuShown) ? 11 : -1 }" ng-show="menuShown" bindonce="empty" bo-class="{\'ng-hide\': !empty}" id="emb-section-chooser">\r\n            <div class="section-chooser__container emb-popout-wrap">\r\n                <div class="section-chooser__inner emb-popout-inner">\r\n                    <div class="l-gap--top-large l-gap--bottom-medium section-tiles emb-section-tiles-wrap" ng-if="sections.length > 0" ng-show="!showDesigns || !designs.length" cs-custom-scroll>\r\n\r\n                        <ol role="tablist" class="l-grid l-parent-offset--bottom-right-tiles l-offset--left-large section-tiles__list emb-section-tiles">\r\n                            <li role="presentation" class="l-grid__item section-tiles__list-item" ng-repeat="section in sections | filter: { hidden: false }" bindonce="section">\r\n                                <div class="section-tiles__thumbnail emb-section-tile qa-section-tile-{{$index}}" id="section-tile-{{$index}}"\r\n                                    emb-tile\r\n                                    item="section"\r\n                                    type="section"\r\n                                    ng-class="[\'emb-\' + section.id, \'is-\' + item.tileActive]"\r\n                                    ng-mousedown="item.tileActive = \'active\'"\r\n                                    ng-mouseover="item.tileHovered = true"\r\n                                    ng-mouseout="item.tileHovered = false; item.tileActive = \'inactive\'"\r\n                                ></div>\r\n                            </li>\r\n                        </ol>\r\n                    </div>\r\n\r\n                    <div class="l-gap--top-large l-gap--bottom-medium section-tiles emb-section-tiles-wrap" ng-if="designs.length > 0" ng-show="showDesigns || !sections.length">\r\n                        <ol class="l-grid l-parent-offset--bottom-right-tiles l-offset--left-large section-tiles__list emb-section-tiles">\r\n                            <li role="presentation" class="l-grid__item section-tiles__list-item" ng-repeat="design in designs | filter: { hidden: false }" bindonce="design">\r\n                                <div class="section-tiles__thumbnail emb-section-tile" id="design-tile-{{$index}}"\r\n                                    emb-tile\r\n                                    item="design"\r\n                                    type="section"\r\n                                    ng-class="[\'emb-design-\' + $index, \'is-\' + item.tileActive]"\r\n                                    ng-mousedown="item.tileActive = \'active\'"\r\n                                    ng-mouseover="item.tileHovered = true"\r\n                                    ng-mouseout="item.tileHovered = false; item.tileActive = \'inactive\'"\r\n                                ></div>\r\n                            </li>\r\n                        </ol>\r\n                    </div>\r\n                    <div cs-switch switch-left-text="Sample content" switch-right-text="No content" ng-model="$parent.showDesigns" class="section-switch emb-section-switch-wrap" ng-if="sections.length > 0 && designs.length > 0"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("modules/emailbuilder/directives/addSection",["vendor/angular","config","jqueryui","modules/emailbuilder/module","modules/emailbuilder/directives/cancelModal","modules/emailbuilder/directives/tile","vendor/text!modules/emailbuilder/templates/addSection.html"],function(e,t,n,i,o,r,s){function a(e,t){var n=e.find("#emb-section-chooser"),i=e.offset().top+e.height()+n.height();t.scrollStage({visible:i})}function l(e){this.newSectionShown=e,this.menuShown=!1,this.safeDigest()}function c(e){return!t.isFirstRun&&"true"===e}function u(i,o,r,u){return{restrict:"A",scope:{sections:"=",designs:"=",empty:"@"},transclude:!1,replace:!0,template:s,link:function(s,d){function m(t){var n=e.element(t.target).inheritedData("addsection");n||(s.toggle(),e.element("body").off("mousedown",m))}var p=l.bind(s,!0);s.toggle=function(){s.menuShown?e.element("body").off("mousedown",m):e.element("body").on("mousedown",m),s.menuShown=!s.menuShown},s.newSectionShown=!0,s.menuShown=c(s.empty),s.showDesigns=!!t.settings.layoutMenuOpt,s.scrollSections=s.sections.length>12,s.scrollDesigns=s.designs.length>12,i.$on("section.add",p),u.subscribe("#.stop",p),u.subscribe("#.start",l.bind(s,!1)),i.$on("content:activated",function(){s.menuShown=!1}),s.deactivate=function(){s.menuShown?a(d,r):r.restoreScroll(),s.buttonClass=s.menuShown?"is-active":"",e.element("body").off("mousedown",m)},t.mode.templateWithContent||s.$watch("showDesigns",function(e){o.post(t.urls.saveLayoutOpt,n.param({newOption:0|e}),{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}})}),s.$watch("menuShown",function(e){var t=e?"show":"hide";i.$broadcast("sectionMenu."+t),s.deactivate()})}}}i.directive("csAddSection",["$rootScope","$http","ViewPortSrv","DraggingSvc",u])}),define("modules/emailbuilder/services/thumbnail",["vendor/angular","modules/emailbuilder/module"],function(e,t){function n(t){var n={position:"relative"};if(!o(t)){r(t);var l=s(t);e.extend(n,a(t,l))}i(t,n)}function i(t,n){var i=e.element("<img />");i.hide();var o=t.image.thirdPartyUrl&&t.image.src?t.image.src:t.image.getSrc(),r=/\?w=[0-9]*$/,s=/\?h=[0-9]*$/;o&&(null!==o.match(r)?o=o.replace(r,"?w="+Math.floor(n.width)):null!==o.match(s)&&(o=o.replace(s,"?h="+Math.floor(n.height))),i.attr({src:o}),i.css(n),setTimeout(function(){t.container.empty().append(i),i.show()},50))}function o(e){return e.image.tempWidth<e.width&&e.image.tempHeight<e.height}function r(e){e.container.css({overflow:"hidden",padding:"0px"})}function s(e){var t=e.image,n=e.width/t.tempWidth;return e.method&&"resize"==e.method?e.height/t.tempHeight<n&&(n=e.height/t.tempHeight):e.height/t.tempHeight>n&&(n=e.height/t.tempHeight),n}function a(e,t){var n,i=e.image,o=i.tempWidth*t,r=i.tempHeight*t,s=0,a=0,l=e.direction;if(r<e.height)switch(l.v){case"center":s=-(r-e.height)/2;break;case"bottom":s=-(r-e.height),n="bottom";break;case"top":s=0,n="top"}else if(r>e.height)switch(l.v){case"center":s=-(r-e.height)/2;break;case"bottom":s=-(r-e.height)}if(o<e.width)switch(l.h){case"center":a=-(o-e.width)/2;break;case"right":a=-(o-e.width)}else if(o>e.width)switch(l.h){case"center":a=-(o-e.width)/2;break;case"right":a=-(o-e.width)}return{width:o,height:r,top:s,left:a}}function l(){return{create:e.bind(this,n)}}t.factory("ThumbnailSrv",[l])}),define("modules/emailbuilder/services/safeDigest",["vendor/angular","modules/emailbuilder/module"],function(e,t){t.config(["$provide",function(e){e.decorator("$rootScope",["$delegate",function(e){return Object.getPrototypeOf(e).safeDigest=function(){var e=this.$root.$$phase;"$apply"!=e&&"$digest"!=e&&this.$digest()},e}])}])}),define("vendor/text!modules/emailbuilder/templates/uploader.html",[],function(){return'<div class="c-image-controls-container l-gap--bottom-medium" ng-class="{ \'l-gap--bottom-none\' : active.content.state.initial }">\r\n    <figure ng-click="$event.stopPropagation()" ng-class="{ \'is-empty\' : active.content.state.initial,  \'has-uploaded\' : active.content.state.hasSrc, \'is-uploading\' : active.content.state.uploading || active.content.state.thirdPartyUrlTyping }" class="hmb-uploaded-image c-image-controls__uploaded-image">\r\n        <div id="emb-js-message">\r\n        </div>\r\n        <form class="emb-js-image-upload" ng-hide="active.content.state.thirdPartyUrl || active.content.state.thirdPartyUrlError">\r\n            <input emb-file-upload file="active.content" class="emb-invisible-input" name="file" type="file" id="sidebar-image-chooser-figure" accepts="image/*">\r\n        </form>\r\n        <button class="c-button c-button--choose-file">\r\n            Choose file\r\n        </button>\r\n        <div ng-show="active.content.state.uploading || active.content.state.thirdPartyUrlTyping" aria-hidden="true" class="loading-circle">\r\n            <span class="loading-circle__spinner"></span>\r\n        </div>\r\n        <div ng-show="active.content.state.hasSrc && !active.content.state.thirdPartyUrlError" class="c-image-controls__image-container emb-js-preview-holder" >\r\n        </div>\r\n        <div ng-show="active.content.state.thirdPartyUrlError" class="c-image-controls__image-container img-error">\r\n            <div class="emb-icon-error-container">\r\n                <div class="emb-drop-icon">\r\n                    <div class="emb-image-error"></div>\r\n                    <div class="emb-image-error-text">Unable to load image</div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </figure>\r\n    <span ng-show="active.content.state.hasSrc" class="hmb-upload-actions">\r\n        <div emb-image-editor image="image" uploading="active.content.state.uploading" ng-show="active.content.state.fileUploaded"></div>\r\n        <div class="emb-replacer" ng-click="$event.stopPropagation()" ng-show="active.content.state.fileUploaded">\r\n            <form class="emb-js-image-upload">\r\n                <input emb-file-upload file="active.content" class="emb-invisible-input" name="file" type="file" id="sidebar-image-chooser-replace" accepts="image/*">\r\n            </form>\r\n            <button class="hmb-replace hmb-has-invisible-input">\r\n                Replace\r\n            </button>\r\n        </div>\r\n        <button class="hmb-delete" ng-click="delete()"\r\n                ng-if="canDelete">\r\n            Delete\r\n        </button>\r\n    </span>\r\n</div>'}),define("modules/emailbuilder/directives/uploader",["vendor/angular","modules/emailbuilder/module","modules/emailbuilder/services/browser","modules/emailbuilder/services/imageManager","modules/emailbuilder/services/thumbnail","modules/emailbuilder/services/imageBuilder","modules/emailbuilder/services/safeDigest","vendor/text!modules/emailbuilder/templates/uploader.html"],function(e,t,n,i,o,r,s,a){function l(e,t,n){e.create({image:t,container:n,width:121,height:85,direction:{v:"center",h:"center"}})}function c(e,t,n,i,o){void 0!==o.tempWidth&&void 0!==o.tempHeight||n.resize(o),l(t,o,i)}function u(e){e.each(function(){this.reset()})}function d(e,t,n){this.active.content.reset(),u.call(this,t),e.$broadcast("image:deleted",{block:n})}function m(t,n,i){return{restrict:"AE",replace:!0,template:a,link:function(o,r,s){var a,m,p,h=r.find("form");t.$on("content:activated",function(s,f){var g=f.block;if(g.hasOwnProperty("type")&&"image"===g.type){o.delete=e.bind(o,d,t,h,g),m=o.$on("upload:start",function(){o.uploading=!0,o.safeDigest()});var v=r.find(".emb-js-preview-holder");p=o.$on("thirdPartyImage:success",function(e,t){l(n,t.block,v)}),a=o.$watch("active.content.src",function(){var r=e.bind(o,c,t,n,i,v),s=g.hasSrc();u(h),s?r(g):v.empty(),o.image=g})}});var f=function(){m&&(m(),m=void 0),a&&(a(),a=void 0),p&&(p(),p=void 0)};t.$on("content:deactivated",f),t.$on("content:replaced",f)}}}t.directive("embUploader",["$rootScope","ThumbnailSrv","ImageBuilderSvc",m])}),define("vendor/text!modules/emailbuilder/templates/videoEmbedder.html",[],function(){return'<div>\r\n    <figure ng-click="$event.stopPropagation()" ng-class="{ \'is-empty\' : active.content.state.initial,  \'has-uploaded\' : active.content.state.hasSrc, \'is-uploading\' : active.content.state.uploading }" class="hmb-uploaded-image c-image-controls__uploaded-image">\r\n        <div id="emb-js-message">\r\n        </div>\r\n        <div ng-show="active.content.state.uploading" aria-hidden="true" class="loading-circle">\r\n            <span class="loading-circle__spinner"></span>\r\n        </div>\r\n        <div ng-show="active.content.state.hasSrc" class="c-image-controls__image-container emb-js-preview-holder">\r\n\r\n        </div>\r\n    </figure>\r\n    <span ng-show="active.content.state.hasSrc" class="hmb-upload-actions">\r\n        <button type="button" class="hmb-delete" ng-click="delete()" ng-show="canDelete">\r\n            Delete\r\n        </button>\r\n    </span>\r\n</div>'}),define("modules/emailbuilder/directives/videoEmbedder",["vendor/angular","modules/emailbuilder/module","modules/emailbuilder/services/browser","modules/emailbuilder/services/imageManager","modules/emailbuilder/services/thumbnail","modules/emailbuilder/services/imageBuilder","modules/emailbuilder/services/safeDigest","vendor/text!modules/emailbuilder/templates/videoEmbedder.html"],function(e,t,n,i,o,r,s,a){function l(e,t,n,i){function o(){e.create({image:i,container:n,width:121,height:85,direction:{v:"center",h:"center"}})}var r=this,s=new Image;s.onload=function(){i.originalWidth=this.width,i.originalHeight=this.height,t.resize(i),o()},s.onerror=function(){i.thirdPartyUrl.match(/.*youtube\.com.*/i)?r.active.content.thirdPartyUrl=f:i.thirdPartyUrl.match(/.*vimeo\.com.*/i)?r.active.content.thirdPartyUrl=h:r.active.content.thirdPartyUrl=null,r.videoThumbnailFailed(i),m(r,"videoProviderDown")},s.src=i.thirdPartyUrl}function c(e){this.setInitialState(e),this.active.content.reset()}function u(e,t,n,i){var o=e.defer(),r={thumbnailUrl:null,href:null,errorCode:null,validVideoSelected:!1,videoProvider:n};if(i)if(i.match(/.*youtube\.com.*/i)){n="youtube",r.videoProvider=n,r.thumbnailUrl=f,r.href="https://www.youtube.com";var s=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i,a=i.match(s);if(a){r.validVideoSelected=!0;var l=a[1];r.thumbnailUrl="https://i.vimeocdn.com/filter/overlay?src=http://img.youtube.com/vi/"+l+"/0.jpg&src="+g,r.href=i,o.resolve(r)}else r.errorCode="videoNotSupportedLink",o.reject(r)}else if(i.match(/.*vimeo\.com.*/i)){n="vimeo",r.videoProvider=n,r.thumbnailUrl=h,r.href="https://www.vimeo.com";var c=/https?:\/\/(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^\/]*)\/videos\/|album\/(\d+)\/video\/|video\/|)(\d+)(?:$|\/|\?)/i,u=i.match(c);if(u){r.validVideoSelected=!0;var d=u[3],m="https://vimeo.com/api/oembed.json?width=600&url=https%3A%2F%2Fvimeo.com%2F"+d;t({method:"GET",url:m}).then(function(e){var t=/_([0-9]+)(x)?([0-9]+)?/,n=e.data.thumbnail_url_with_play_button;if(n){var s=e.data.width,a=e.data.height;if(a>480){var l=s/a;s=Math.ceil(480*l),a=480}var c="_"+s+"x"+a;r.thumbnailUrl=n.replace(t,c),r.href=i,o.resolve(r)}else r.errorCode="videoNotFoundLink",r.thumbnailUrl=null,r.href=i,o.reject(r)},function(){r.errorCode="videoNotFoundLink",r.thumbnailUrl=h,r.href=i,o.reject(r)})}else r.errorCode="videoNotSupportedLink",o.reject(r)}else r.errorCode="videoNotSupportedLink",o.reject(r);else o.reject(r);return o.promise}function d(e){e.active.content.tempValidation=[],e.active.content.tempIsValid=!0}function m(e,t){for(var n=e.active.content.tempValidation||[],i=[],o=0;o<n.length;o++){var r=n[o];r!==t&&i.push(r)}i.push(t),e.active.content.tempValidation=i,e.active.content.tempIsValid=!i.length}function p(t,n,i,o,r){return{restrict:"AE",replace:!0,template:a,link:function(s,a,p){var h,f;t.$on("content:activated",function(t,p){var g=p.block;g.hasOwnProperty("type")&&"video"===g.type&&(s.delete=e.bind(s,c,g),f=s.$watch("active.content.videoUrl",function(e,t){e!==t&&u(n,i,s.active.content.videoProvider,e).then(function(e){s.active.content.thirdPartyUrl=e.thumbnailUrl,s.active.content.href=e.href,s.active.content.validVideoSelected=e.validVideoSelected,s.active.content.videoProvider=e.videoProvider,s.videoThumbnailSucceeded(g),d(s)},function(e){s.active.content.thirdPartyUrl=e.thumbnailUrl,s.active.content.href=e.href,s.active.content.validVideoSelected=e.validVideoSelected,s.active.content.videoProvider=e.videoProvider,e.errorCode?(s.videoThumbnailFailed(g),m(s,e.errorCode)):(s.setInitialState(g),d(s),m(s,"videoNoLink"))})}),h=s.$watch("active.content.getSrc()",function(){var t=a.find(".emb-js-preview-holder"),n=e.bind(s,l,o,r,t),i=g.hasSrc();if(i)n(g);else{s.setInitialState(g);var c=t.find("img");c.attr({src:null})}s.image=g}))});var g=function(){h&&(h(),h=void 0),f&&(f(),f=void 0)};t.$on("content:deactivated",g),t.$on("content:replaced",g)}}}var h="https://integrationstore-b0c3f53658fe7a75.microservice.createsend.com/files/93328B6D-7FFD-4C31-8C82-D916264F2847/vimeo-placeholder-image.svg",f="https://integrationstore-b0c3f53658fe7a75.microservice.createsend.com/files/A51932BB-F808-4E3E-A836-4DA42666AA0B/youtube-placeholder-image.svg",g="https://integrationstore-b0c3f53658fe7a75.microservice.createsend.com/files/9392B9D9-F380-42FC-9571-7E109B7A1C26/youtube-play-button-overlay.png";t.directive("embVideoEmbedder",["$rootScope","$q","$http","ThumbnailSrv","ImageBuilderSvc",p])}),define("vendor/text!modules/emailbuilder/templates/tileHelper.html",[],function(){return'<button class="emb-{{contentType}} emb-{{type}}-dragger emb-js-{{type}}-dragger" ng-show="dragging" ng-style="position()"></button>';
}),define("modules/emailbuilder/directives/dragHelper",["vendor/angular","modules/emailbuilder/module","vendor/text!modules/emailbuilder/templates/tileHelper.html","modules/emailbuilder/services/viewPort"],function(e,t,n,i){function o(t,i){return{replace:!0,template:n,scope:{},link:function(n,i){n.position=function(){return n.size||(n.size={height:i.height(),width:i.width()}),{left:n.mouseX-.5*n.size.width,top:n.mouseY-.5*n.size.height}},t.subscribe("#",function(t){"file"!==t.contentType&&(n.dragging!=t.dragging&&(n.size=null),e.extend(n,t),n.safeDigest())})}}}t.directive("embDragHelper",["DraggingSvc","ViewPortSrv",o])}),define("modules/emailbuilder/directives/scrolledOffScreen",["vendor/angular","modules/emailbuilder/module","modules/emailbuilder/services/viewPort"],function(e,t,n){function i(e,t){var n=e.overflowTop(t.elem,t.settings);n!==this.offScreen&&(this.offScreen=n)}function o(e,t){var n=e.checkVertOffStage(t.elem,t.settings),i=80;n.screenPos+i>0&&e.scrollStage({offset:n.scrollTo+i})}function r(t,n){return{link:function(r,s,a){var l={threshold:n.find("#emb-js-editor-header").height()},c={elem:s,cssClass:a.offScreenClass,settings:l},u=e.bind(r,i,t,c);r.block&&(r.block.checkOffStage=e.bind(r,o,t,c)),n.find("#emb-js-stage").on("scroll",u)}}}t.directive("embScrolledOffScreen",["ViewPortSrv","$document",r])}),define("vendor/text!modules/emailbuilder/templates/textContent.html",[],function(){return'<div class="emb-content-inner emb-js-text-container"\r\n     emb-scrolled-off-screen\r\n     bindonce="inSection && hasCustomFields && isTransactional && fontSizes && fonts"\r\n     bo-class="{ \'emb-text-content-inner\': inSection }"\r\n     ng-class="{ \'emb-active\' : activeNotDragged(), \'emb-hoverable\' : notActive() && canEdit, \'emb-inuse\' : inUse }"\r\n     ng-mouseover="hovered = true; $event.stopPropagation()"\r\n     ng-mouseout="hovered = false"\r\n     style="position:relative">\r\n    <div bo-if="inSection" class="emb-handle emb-js-content-handle emb-text-handle">&nbsp;</div>\r\n    <div class="emb-text-editor emb-js-text-content" contenteditable ng-style="editorStyle" ng-model="block.contents" ng-show="canEdit"></div>\r\n    <div class="emb-content-placeholder" ng-bind-html="ckData()" ng-show="!canEdit"></div>\r\n    <div class="c-toolbar-outer-container emb-texttools emb-reset" ng-show="inSection && block.isActive && !dragging" ng-class="{\'c-toolbar-outer-container--fixed\' : offScreen, \'emb-narrow-controls\' : narrowControls}">\r\n        <div class="c-toolbar-container emb-toolbar" ng-class="{\'emb-narrow-toolbar\' : narrowControls }">\r\n            <div class="c-toolbar qa-toolbar">\r\n                <div class="c-toolbar__item" ng-show="!deleteConfirmation">\r\n                    <button class="c-toolbar__button has-dropdown qa-textstyle" ng-class="{ \'emb-selected\': display === \'styles\' }" ng-click="toggleDisplay(\'styles\')">{{ currentStyle.display || \'Styles\' }}</button>\r\n                    <nav class="l-toolbar-dropdown-container emb-toolbar-context-box emb-context-style emb-style-list" ng-show="display === \'styles\'" ng-click="display = false;">\r\n\r\n                        <ol class="emb-context-list emb-context-top-level emb-reset">\r\n                            <li class="emb-style emb-context-list-item emb-h1 emb-unreset" emb-text-command="h1">\r\n                                <span>Heading 1</span>\r\n                            </li>\r\n                            <li class="emb-style emb-context-list-item emb-h2 emb-unreset" emb-text-command="h2">\r\n                                <span>Heading 2</span>\r\n                            </li>\r\n                            <li class="emb-style emb-context-list-item emb-h3 emb-unreset" emb-text-command="h3">\r\n                                <span>Heading 3</span>\r\n                            </li>\r\n                            <li class="emb-style emb-context-list-item emb-p emb-unreset" emb-text-command="p">\r\n                                <span>Normal text</span>\r\n                            </li>\r\n                            <li class="emb-style emb-context-list-item emb-ol emb-unreset" emb-text-command="numberedlist">\r\n                                <ol>\r\n                                    <li>Numbered list</li>\r\n                                </ol>\r\n                            </li>\r\n                            <li class="emb-style emb-context-list-item emb-ul emb-unreset" emb-text-command="bulletedlist">\r\n                                <ul>\r\n                                    <li>Bulleted list</li>\r\n                                </ul>\r\n                            </li>\r\n                            <li class="emb-style emb-context-list-item emb-p emb-blockquote emb-unreset" emb-text-command="blockquote">\r\n                                <span>Quote</span>\r\n                            </li>\r\n                        </ol>\r\n                    </nav>\r\n                </div>\r\n                <div class="c-toolbar__item"\r\n                     ng-show="!deleteConfirmation && !restrictedTextStyles">\r\n                    <button class="c-toolbar__button has-dropdown qa-textfont" ng-class="{ \'emb-selected\': display === \'font\' }" ng-click="toggleDisplay(\'font\')">{{ currentFont || \'Font\' }}</button>\r\n                    <nav class="l-toolbar-dropdown-container emb-toolbar-context-box emb-font-family-dropdown emb-context-style emb-style-list qa-textfont-options" ng-show="display === \'font\'" ng-click="display = false;">\r\n                        <div class="toolbar__inner-overflow" cs-custom-scroll>\r\n                            <ol class="emb-context-list emb-context-top-level emb-reset">\r\n                                <li class="emb-style emb-context-list-item emb-unreset" ng-repeat="font in fonts" data-value="{{font.value}}" data-display="{{font.display}}" ng-click="setFont(font.value)" ng-class="{ \'emb-selected\': font.display === currentFont }">\r\n                                    <span ng-style="font.cssValues" class="emb-font-family" bo-text="font.display"></span>\r\n                                </li>\r\n                            </ol>\r\n                        </div>\r\n                    </nav>\r\n                </div>\r\n                <div class="c-toolbar__item"\r\n                     ng-show="!deleteConfirmation && !restrictedTextStyles">\r\n                    <button class="c-toolbar__button has-dropdown emb-font-size qa-fontsize" ng-class="{ \'emb-selected\': display === \'fontSize\' }" ng-click="toggleDisplay(\'fontSize\')">{{ currentFontSize || \'14\' }}</button>\r\n                    <nav class="l-toolbar-dropdown-container emb-toolbar-context-box emb-font-family-dropdown emb-context-style emb-style-list emb-font-size-dropdown" ng-show="display === \'fontSize\'" ng-click="display = false;">\r\n                        <div class="toolbar__inner-overflow" cs-custom-scroll>\r\n                            <ol class="emb-context-list emb-context-top-level emb-reset">\r\n                                <li class="emb-style emb-context-list-item emb-unreset" ng-repeat="size in fontSizes" ng-click="setFontSize(size[0], size[1])" ng-class="{ \'emb-selected\': size[0] == currentFontSize }">\r\n                                    <span class="emb-font-value" bo-text="size[0]"></span>\r\n                                </li>\r\n                            </ol>\r\n                        </div>\r\n                    </nav>\r\n                </div>\r\n                <div class="c-toolbar__item" ng-show="!deleteConfirmation">\r\n                    <button class="c-toolbar__button c-toolbar__button--has-icon" emb-text-command="bold">\r\n                        <span class="c-toolbar__button-icon c-toolbar__button-icon--bold"></span>\r\n                        Bold\r\n                    </button>\r\n                </div>\r\n                <div class="c-toolbar__item" ng-show="!deleteConfirmation">\r\n                    <button class="c-toolbar__button c-toolbar__button--has-icon" emb-text-command="italic">\r\n                        <span class="c-toolbar__button-icon c-toolbar__button-icon--italics"></span>\r\n                        Italics\r\n                    </button>\r\n                </div>\r\n                <div class="c-toolbar__item"\r\n                     ng-show="!deleteConfirmation && !restrictedTextStyles">\r\n                    <button class="c-toolbar__button c-toolbar__button--has-icon emb-text-color qa-textcolor" ng-class="{ \'emb-selected\': display === \'textColor\' }" emb-text-command="showTextColor">\r\n                        <span class="c-toolbar__button-icon c-toolbar__button-icon--text-color"></span>\r\n                        <span class="c-toolbar__button-icon c-toolbar__button-icon--text-color-base">\r\n                        </span>\r\n                        Text Color\r\n                    </button>\r\n                    <div class="c-colorpicker c-colorpicker--toolbar c-colorpicker--dark ff-colorpicker--recent" ng-show="display === \'textColor\'">\r\n                        <div cs-scoped-color-selector cs-color-selector-changed="setTextColor" cs-color-selector-validate-on-blur="false" cs-color-selector-always-open="true" cs-color-selector-upward-class="emb-upward" cs-viewport="" ng-model="textColor"></div>\r\n                    </div>\r\n                </div>\r\n                <div class="c-toolbar__item" ng-show="!deleteConfirmation">\r\n                    <button class="c-toolbar__button c-toolbar__button--has-icon" ng-class="{ \'emb-selected\': display === \'link\' }" emb-text-command="showLink">\r\n                        <span class="c-toolbar__button-icon c-toolbar__button-icon--link"></span>\r\n                        Link\r\n                    </button>\r\n                    <div class="l-toolbar-dropdown-container emb-toolbar-context-box emb-context-link" ng-show="display === \'link\'">\r\n                        <form novalidate ng-submit="addLink(\'addLink\', $event)">\r\n                            <fieldset class="emb-toolbar-input">\r\n                                <input type="text" class="emb-js-link-field" ng-model="url" required cs-valid-url placeholder="Web address or email" />\r\n                                <button type="submit" class="emb-tick"></button>\r\n                            </fieldset>\r\n                            <p class="emb-remove-link" emb-text-command="unlink">Remove link</p>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n                <div class="c-toolbar__item"\r\n                     ng-show="!deleteConfirmation && !restrictedTextStyles">\r\n                    <button class="c-toolbar__button c-toolbar__button--has-icon c-toolbar__button--has-alignment-icon" safe-command="true" emb-text-command="justifyleft" ng-click="toggleDisplay(\'alignment\')" ng-class="{\'is-closed\' : display !== \'alignment\'}">\r\n                        <span class="c-toolbar__button-icon c-toolbar__button-icon--justify-left"></span>\r\n                        Justify Left\r\n                    </button>\r\n                    <button class="c-toolbar__button c-toolbar__button--has-icon c-toolbar__button--has-alignment-icon" safe-command="true" emb-text-command="justifycenter" ng-click="toggleDisplay(\'alignment\')" ng-class="{\'is-closed\' : display !== \'alignment\'}">\r\n                        <span class="c-toolbar__button-icon c-toolbar__button-icon--justify-center"></span>\r\n                        Justify Center\r\n                    </button>\r\n                    <button class="c-toolbar__button c-toolbar__button--has-icon c-toolbar__button--has-alignment-icon" safe-command="true" emb-text-command="justifyright" ng-click="toggleDisplay(\'alignment\')" ng-class="{\'is-closed\' : display !== \'alignment\'}">\r\n                        <span class="c-toolbar__button-icon c-toolbar__button-icon--justify-right"></span>\r\n                        Justify Right\r\n                    </button>\r\n                    <nav class="l-toolbar-dropdown-container c-toolbar__alignment-container emb-toolbar-context-box emb-context-alignment" ng-show="display === \'alignment\'" ng-click="display = false">\r\n                        <ol class="c-toolbar__alignment-list emb-context-top-level emb-reset">\r\n                            <li class="emb-style c-toolbar__button c-toolbar__button--has-icon emb-justify-left emb-unreset" add-unselected-class="true" emb-text-command="justifyleft">\r\n                                <span class="c-toolbar__button-icon c-toolbar__button-icon--justify-left"></span>\r\n                                <span>Justify Left</span>\r\n                            </li>\r\n                            <li class="emb-style c-toolbar__button c-toolbar__button--has-icon emb-justify-center emb-unreset" add-unselected-class="true" emb-text-command="justifycenter">\r\n                                <span class="c-toolbar__button-icon c-toolbar__button-icon--justify-center"></span>\r\n                                <span>Justify Center</span>\r\n                            </li>\r\n                            <li class="emb-style c-toolbar__button c-toolbar__button--has-icon emb-justify-right emb-unreset" add-unselected-class="true" emb-text-command="justifyright">\r\n                                <span class="c-toolbar__button-icon c-toolbar__button-icon--justify-right"></span>\r\n                                <span>Justify Right</span>\r\n                            </li>\r\n                        </ol>\r\n                    </nav>\r\n                </div>\r\n                <div class="c-toolbar__item" ng-show="!deleteConfirmation">\r\n                    <button class="c-toolbar__button has-dropdown" ng-class="{ \'emb-selected\': display === \'insert\' }" ng-click="toggleDisplay(\'insert\')">Insert</button>\r\n                    <div class="l-toolbar-dropdown-container emb-toolbar-context-box emb-context-insert"\r\n                         ng-show="display === \'insert\'"\r\n                         ng-class="\'emb-showing-level-\' + displayLevel">\r\n                        <div class="emb-heirarchy-container">\r\n                            <div class="emb-levels-container">\r\n                                <ol class="emb-context-list emb-context-top-level emb-level emb-level-1">\r\n                                    <li class=\'emb-context-list-item emb-context-parent\' bo-hide="isTransactional" ng-click="toggleLevel(\'personal\', 2)">Personalization</li>\r\n                                    <li class=\'emb-context-list-item\' bo-show="isTransactional" emb-text-command="emailvariable">Email variable</li>\r\n                                    <li class=\'emb-context-list-item emb-context-parent\' ng-click="toggleLevel(\'date\', 2)">Dates</li>\r\n                                    <li class=\'emb-context-list-item emb-context-parent\' bo-if="!isTransactional && hasCustomFields" ng-click="toggleLevel(\'custom\', 2)">Custom fields</li>\r\n                                    <li class=\'emb-context-list-item emb-context-parent\' ng-click="toggleLevel(\'social\', 2)">Social sharing</li>\r\n                                </ol>\r\n                                <div class="emb-level emb-level-2" ng-show="subDisplay === \'personal\'" ng-click="toggleLevel(\'\', 1)">\r\n                                    <header class="emb-context-item emb-context-header">\r\n                                        <h5>Personalization</h5>\r\n                                    </header>\r\n                                    <ol class="emb-context-list" ng-click="display = false">\r\n                                        <li class="emb-context-list-item" emb-text-command="firstname">First name</li>\r\n                                        <li class="emb-context-list-item" emb-text-command="lastname">Last name</li>\r\n                                        <li class="emb-context-list-item" emb-text-command="fullname">Full name</li>\r\n                                        <li class="emb-context-list-item" emb-text-command="email">Email</li>\r\n                                    </ol>\r\n                                </div>\r\n                                <div class="emb-level emb-level-2" bo-if="!isTransactional && hasCustomFields" ng-show="subDisplay === \'custom\'">\r\n                                    <header class="emb-context-item emb-context-header" ng-click="toggleLevel(\'\', 1)">\r\n                                        <h5>Custom fields</h5>\r\n                                    </header>\r\n                                    <ol class="emb-context-list">\r\n                                        <li class="emb-context-list-item emb-context-parent" ng-repeat="list in lists" ng-click="toggleLevel(\'custom\', 3, list)" cs-truncate="list.title" max-width="151" side="center"></li>\r\n                                    </ol>\r\n                                </div>\r\n                                <div class="emb-level emb-level-3" bo-if="!isTransactional && hasCustomFields" ng-show="subDisplay === \'custom\'" ng-click="toggleLevel(\'\', 1)">\r\n                                    <header class="emb-context-item emb-context-header" ng-click="toggleLevel(\'custom\', 2)">\r\n                                        <h5 cs-truncate="menuItem.title" max-width="151" side="center"></h5>\r\n                                    </header>\r\n                                    <ol class="emb-context-list" ng-click="display = false">\r\n                                        <li class="emb-context-list-item" ng-repeat="field in menuItem.fields" emb-text-command="{{ field.tag }}" cs-truncate="field.title" max-width="151" side="center"></li>\r\n                                    </ol>\r\n                                </div>\r\n                                <div class="emb-level emb-level-2" ng-show="subDisplay === \'date\'" ng-click="toggleLevel(\'\', 1)">\r\n                                    <header class="emb-context-item emb-context-header">\r\n                                        <h5>Dates</h5>\r\n                                    </header>\r\n                                    <ol class="emb-context-list" ng-click="display = false">\r\n                                        <li class="emb-context-list-item" emb-text-command="currentday">Current day</li>\r\n                                        <li class="emb-context-list-item" emb-text-command="currentdayname">Current day name</li>\r\n                                        <li class="emb-context-list-item" emb-text-command="currentmonth">Current month</li>\r\n                                        <li class="emb-context-list-item" emb-text-command="currentmonthname">Current month name</li>\r\n                                        <li class="emb-context-list-item" emb-text-command="currentyear">Current year</li>\r\n                                    </ol>\r\n                                </div>\r\n                                <div class="emb-level emb-level-2" ng-show="subDisplay === \'social\'">\r\n                                    <header class="emb-context-item emb-context-header" ng-click="toggleLevel(\'\', 1)">\r\n                                        <h5>Social sharing</h5>\r\n                                    </header>\r\n                                    <ol class="emb-context-list">\r\n                                        <li class="emb-context-list-item" emb-text-command="tweet" ng-click="closeMenus()">Tweet</li>\r\n                                        <li class="emb-context-list-item" emb-text-command="like" ng-click="closeMenus()">Like this email on Facebook</li>\r\n                                        <li class="emb-context-list-item emb-context-parent" ng-click="toggleLevel(\'social\', 3)">Like a page on Facebook</li>\r\n                                    </ol>\r\n                                </div>\r\n                                <div class="emb-level emb-level-3" ng-show="subDisplay === \'social\'">\r\n                                    <header class="emb-context-item emb-context-header" ng-click="toggleLevel(\'social\', 2)">\r\n                                        <h5>Like a page on Facebook</h5>\r\n                                    </header>\r\n                                    <form novalidate ng-submit="addLink(\'like\', $event)">\r\n                                        <fieldset class="emb-toolbar-input">\r\n                                            <input type="text" class="emb-js-href-field" ng-model="url" required cs-valid-url />\r\n                                            <button type="submit" class="emb-tick"></button>\r\n                                        </fieldset>\r\n                                    </form>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class="c-toolbar__item"\r\n                     ng-if="canDelete">\r\n                    <button emb-item-controls\r\n                            in-use="inUse"\r\n                            item-type="content"\r\n                            item="block"\r\n                            section-index="sectionIndex"\r\n                            content-index="column"\r\n                            item-hovered="hovered"\r\n                            narrow-controls="narrowControls"\r\n                            text-controls="true"\r\n                            closer="toggleDisplay">whatami?</button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="js-delete-controls emb-content-controls emb-reset" ng-show="showTrashcan && hovered && canDelete">\r\n        <span id="content-confirm-optional-text"\r\n              class="c-button-delete"\r\n              ng-click="showConfirmationForTrashcan()"\r\n              ng-class="{ \'is-selected\' : confirmation,  \'is-active\' : activeNotDragged(), \'is-inactive\' : !(activeNotDragged()) }">\r\n            <a id="content-delete-optional-text" class="c-button-delete__confirm" ng-click="remove(); $event.stopPropagation();">Delete</a>\r\n            <a class="c-button-delete__cancel" ng-click="hideConfirmation(); $event.stopPropagation()">Cancel</a>\r\n        </span>\r\n    </div>\r\n</div>\r\n'}),define("modules/shared/fnutils",[],function(){function e(e,t){var n=null;return function(){var i=this,o=arguments;clearTimeout(n),n=setTimeout(function(){e.apply(i,o)},t)}}function t(e,t,n){t=t||250;var i,o;return function(){var r=n||this,s=Date.now(),a=arguments;i&&s<i+t?(clearTimeout(o),o=setTimeout(function(){i=s,e.apply(r,a)},t)):(i=s,e.apply(r,a))}}return{debounce:e,throttle:t}}),function(e){"use strict";function t(e,n,i,o,r,s,a,l){var c,u,d,m,p,h=function(e){s.text(e),s[l?"prepend":"append"](a)};return l?(c=0===o?"":i.slice(-o),u=i.slice(-r)):(c=i.slice(0,o),u=i.slice(0,r)),n<s.html(a)[e]()?0:(h(u),m=s[e](),h(c),p=s[e](),m<p?r:(d=parseInt((o+r)/2,10),c=l?i.slice(-d):i.slice(0,d),h(c),s[e]()===n?d:(s[e]()>n?r=d-1:o=d+1,t(e,n,i,o,r,s,a,l))))}e.fn.truncate=function(n){n&&n.center&&!n.side&&(n.side="center",delete n.center),n&&!/^(left|right|center)$/.test(n.side)&&delete n.side;var i={width:"auto",token:"&hellip;",side:"right",addclass:!1,addtitle:!1,multiline:!1};return n=e.extend(i,n),this.each(function(){var i,o,r,s=e(this),a={fontFamily:s.css("fontFamily"),fontSize:s.css("fontSize"),fontStyle:s.css("fontStyle"),fontWeight:s.css("fontWeight"),"font-variant":s.css("font-variant"),"text-indent":s.css("text-indent"),"text-transform":s.css("text-transform"),"letter-spacing":s.css("letter-spacing"),"word-spacing":s.css("word-spacing"),display:"none"},l=s.text(),c=e("<span/>").css(a).text(l).appendTo("body"),u=c.width(),d=parseInt(n.width,10)||s.width(),m="width";if(n.multiline?(c.width(s.width()),m="height",o=c.height(),r=s.height()+1):(o=u,r=d),i={before:"",after:""},o>r){var p,h;c.text(""),"left"===n.side?(p=t(m,r,l,0,l.length,c,n.token,!0),i.after=l.slice(-1*p)):"center"===n.side?(r=parseInt(r/2,10)-1,p=t(m,r,l,0,l.length,c,n.token,!1),h=t(m,r,l,0,l.length,c,"",!0),i.before=l.slice(0,p),i.after=l.slice(-1*h)):"right"===n.side&&(p=t(m,r,l,0,l.length,c,n.token,!1),i.before=l.slice(0,p)),n.addclass&&s.addClass(n.addclass),n.addtitle&&s.attr("title",l),i.before=c.text(i.before).html(),i.after=c.text(i.after).html(),s.empty().html(i.before+n.token+i.after)}c.remove()})}}(jQuery),define("vendor/jquery.truncate",["jquery"],function(e){return function(){var t;return t||e.$}}(this)),define("modules/emailbuilder/directives/truncate",["vendor/angular","modules/emailbuilder/module","underscore","vendor/jquery.truncate"],function(e,t,n,i){function o(e,t,n){return e.text(t).truncate(n).text()}var r=n.memoize(o,function(e,t,n){return[t,n.width,n.side].join("|")}),s=function(e,t,n){return t?r(e,t,n):""};t.directive("csTruncate",["$parse",function(e){return function(t,n,i){function o(){n.text(s(n,r(t),a))}var r=e(i.csTruncate),a={width:i.maxWidth,side:i.side};r.constant||t.$watch(i.csTruncate,o),o()}}])}),define("modules/emailbuilder/ckeditor-plugins/link",["config","vendor/ckeditor/ckeditor"],function(e,t){function n(){}function i(){}function o(){}function r(){}function s(){}function a(){}t.editor.prototype.getSelectedLink=function(e){var n,i,o,r;try{return e&&this.focus(),n=this.getSelection(),n.getType()==t.SELECTION_ELEMENT&&(i=n.getSelectedElement(),i.is("a"))?i:(o=n.getRanges(!0)[0],o.shrink(t.SHRINK_TEXT),r=o.getCommonAncestor(),r.getAscendant("a",!0))}catch(e){return null}},n.prototype.refresh=function(e,t){var n=t.lastElement&&t.lastElement.getAscendant("a",!0),i=n&&"a"===n.getName()&&n.getAttribute("href")&&n.getAttribute("data-cke-saved-href");this.setState(i)},i.prototype=new n,i.prototype.editorFocus=!1,i.prototype.exec=function(e,t){e.fire("link","link"!==t?e.getSelectedLink(!0):null)},o.prototype=new n,o.prototype.style=new t.style({element:"a",type:t.STYLE_INLINE,alwaysRemoveElement:1}),o.prototype.exec=function(e){e.removeStyle(this.style)},r.prototype.getAttributes=function(e){return{href:e.href,"data-cke-saved-href":e.href,"data-emb-href-display":e.display}},r.prototype.getContent=function(e){return e.display},r.prototype.exec=function(e,n){var i,o,r,s,a,l,c=e.getSelectedLink(),u=this.getContent(n),d=this.getAttributes(n);c?(i=c.data("emb-href-display"),o=c.getHtml(),c.setAttributes(d),(i===o||n&&n.isEmail&&o.indexOf("@")!==-1||c.$.querySelectorAll(".cs_editor_default_social").length)&&c.setHtml(u)):(r=e.getSelection(),s=r?r.getRanges(!0)[0]:{collapsed:!0},s.collapsed&&(a=t.dom.element.createFromHtml(u),s.insertNode(a),s.selectNodeContents(a)),l=new t.style({element:"a",attributes:d}),l.type=t.STYLE_INLINE,l.applyToRange(s),s.offset+=2,s.collapse(),s.select(),e.getCommand("unlink").exec())},s.prototype=new r,s.prototype.getContent=function(){return['<img data-emb-textblock-img width="51" height="20" border="0" title="Like this on Facebook" src="',e.urls.systemImages,'/img/social/facebook.png" class="cs_editor_default_social" alt="Facebook Like Button">'].join("")},s.prototype.getAttributes=function(t){var n={href:e.urls.facebook,class:"cs-editor-fblike"};return t&&t.isValid&&!t.isEmail&&(n["data-likeurl"]=t.href,n["data-cke-saved-href"]=t.href,n["data-emb-href-display"]=t.display),n},a.prototype=new r,a.prototype.getContent=function(){return['<img data-emb-textblock-img width="55" height="20" border="0" title="Share via Twitter" src="',e.urls.systemImages,'/img/social/twitter.png" class="cs_editor_default_social" alt="Tweet Button">'].join("")},a.prototype.getAttributes=function(){return{href:e.urls.twitter,class:"cs-editor-tweet"}},t.plugins.add("link",{init:function(e){e.addCommand("showLink",new i),e.addCommand("unlink",new o),e.addCommand("addLink",new r),e.addCommand("tweet",new a),e.addCommand("like",new s),e.ui.addButton("Link",{label:"",command:"showlink"}),e.filter.allow("img[!src,!data-emb-textblock-img,alt,width,height,border,title](cs_editor_default_social)","link"),e.filter.allow("a[href,data-cke-saved-href,data-emb-href-display,data-likeurl](*)","link"),e.on("selectionChange",function(n){var i=n.data.path.lastElement&&n.data.path.lastElement.getAscendant("a",!0),o=i&&"a"==i.getName()&&i.getAttribute("href")&&i.getAttribute("data-cke-saved-href"),r=o?t.TRISTATE_ON:t.TRISTATE_OFF;e.getCommand("showLink").setState(r),e.getCommand("unlink").setState(r)})}})}),define("modules/emailbuilder/ckeditor-plugins/justifylight",["vendor/ckeditor/ckeditor"],function(e){function t(e){return e.getComputedStyle("text-align")}function n(e,t,n){this.editor=e,this.name=t,this.value=n,this.context="p"}n.prototype={exec:function(t){var n=t.getSelection(),i=t.config.enterMode;if(n){for(var o,r,s=n.getRanges(),a=s.length-1;a>=0;a--)for(o=s[a].createIterator(),o.enlargeBr=i!=e.ENTER_BR;r=o.getNextParagraph(i==e.ENTER_P?"p":"div");)r.isReadOnly()||(r.removeAttribute("align"),r.removeStyle("text-align"),r.setStyle("text-align",this.value));t.forceNextSelectionCheck(),t.getSelection().selectRanges(s)}},refresh:function(n,i){var o=i.block||i.blockLimit,r=t(o)===this.value||"left"===this.value&&""===t(o);this.setState(r?e.TRISTATE_ON:e.TRISTATE_OFF)}},e.plugins.add("justifylight",{init:function(e){var t=new n(e,"justifyleft","left"),i=new n(e,"justifycenter","center"),o=new n(e,"justifyright","right");e.addCommand("justifyleft",t),e.addCommand("justifycenter",i),e.addCommand("justifyright",o)}})}),define("modules/emailbuilder/ckeditor-plugins/textcolor",["vendor/ckeditor/ckeditor"],function(e){function t(){}function n(){}t.prototype.editorFocus=!1,t.prototype.exec=function(t,n){var i=t.getSelection().getStartElement().getComputedStyle("color"),o=e.tools.convertRgbToHex(i);t.fire("textColor",o)},n.prototype.editorFocus=!1,n.prototype.exec=function(t,n){var i=t.getSelection().getRanges()[0].collapsed;if(!i&&(t.removeStyle(new e.style({element:"span",styles:{color:"inherit"}})),n)){var o=function(e){return!(e.is("a")||e.getElementsByTag("a").count())||"false"==e.getAttribute("contentEditable")||e.getAttribute("data-nostyle")};t.applyStyle(new e.style({element:"span",styles:{color:"#"+n},childRule:o}))}},e.plugins.add("textColor",{init:function(e){e.addCommand("showTextColor",new t),e.addCommand("setTextColor",new n)}})}),define("modules/emailbuilder/ckeditor-plugins/textbgcolor",["vendor/ckeditor/ckeditor"],function(e){function t(){}function n(){}t.prototype.editorFocus=!1,t.prototype.exec=function(t,n){var i=t.getSelection().getStartElement().getComputedStyle("background-color"),o=e.tools.convertRgbToHex(i);t.fire("textBgColor",o)},n.prototype.editorFocus=!1,n.prototype.exec=function(t,n){var i=t.getSelection().getRanges()[0].collapsed;if(!i&&(t.removeStyle(new e.style({element:"span",styles:{"background-color":"inherit"}})),n)){var o=function(e){return!(e.is("a")||e.getElementsByTag("a").count())||"false"==e.getAttribute("contentEditable")||e.getAttribute("data-nostyle")};t.applyStyle(new e.style({element:"span",styles:{"background-color":"#"+n},childRule:o}))}},e.plugins.add("textBgColor",{init:function(e){e.addCommand("showTextBgColor",new t),e.addCommand("setTextBgColor",new n)}})}),define("modules/emailbuilder/ckeditor-plugins/font",["config","vendor/ckeditor/ckeditor"],function(e,t){function n(){}for(var i={},o=0;o<e.email.config.availableFonts.length;o++){var r=e.email.config.availableFonts[o];i[r.value]=r.cssValues["font-family"]}n.prototype.editorFocus=!1,n.prototype.exec=function(e,n){var o=e.getSelection(),r=e.config.enterMode;if(o){for(var s,a,l=o.getRanges(),c=l.length-1;c>=0;c--)for(s=l[c].createIterator(),s.enlargeBr=r!=t.ENTER_BR;a=s.getNextParagraph(r==t.ENTER_P?"p":"div");)a.isReadOnly()||(a.removeStyle("font-family"),
a.setStyle("font-family",i[n]));e.forceNextSelectionCheck(),e.getSelection().selectRanges(l)}},t.plugins.add("font",{init:function(e){e.addCommand("setFont",new n),e.on("selectionChange",function(n){for(var o,r=n.data.path,s=r.elements,a=0;a<s.length;a++){o=s[a];for(var l in i)if(i.hasOwnProperty(l)){var c=new t.style({element:{p:1,h1:1,h2:1,h3:1,li:1},styles:{"font-family":i[l]}});if(c.checkElementMatch(o,!0))return void e.fire("font",l)}}e.fire("font","")})}})}),define("modules/emailbuilder/ckeditor-plugins/fontsize",["vendor/ckeditor/ckeditor"],function(e){function t(){}function n(){}t.prototype.editorFocus=!1,t.prototype.exec=function(e,t){var n=e.getSelection().getStartElement().getComputedStyle("font-size");e.fire("fontSize",n)},n.prototype.editorFocus=!1,n.prototype.exec=function(t,n){var i=t.getSelection(),o=t.config.enterMode;if(i){for(var r,s,a=i.getRanges(),l=a.length-1;l>=0;l--)for(r=a[l].createIterator(),r.enlargeBr=o!=e.ENTER_BR;s=r.getNextParagraph(o==e.ENTER_P?"p":"div");)s.isReadOnly()||(s.removeStyle("font-size"),s.removeStyle("line-height"),s.setStyle("font-size",n.fontSize),s.setStyle("line-height",n.lineHeight));t.forceNextSelectionCheck(),t.getSelection().selectRanges(a)}},e.plugins.add("fontSize",{init:function(e){e.addCommand("showFontSize",new t),e.addCommand("setFontSize",new n),e.on("selectionChange",function(t){var n=t.data.selection.getStartElement().getComputedStyle("font-size");e.fire("currentFontSize",n)})}})}),define("modules/emailbuilder/directives/textBlock",["config","vendor/angular","modules/emailbuilder/module","vendor/ckeditor/ckeditor","modules/emailbuilder/services/safeDigest","modules/emailbuilder/directives/scrolledOffScreen","vendor/text!modules/emailbuilder/templates/textContent.html","modules/shared/fnutils","modules/emailbuilder/directives/truncate","modules/emailbuilder/ckeditor-plugins/link","modules/emailbuilder/ckeditor-plugins/justifylight","modules/emailbuilder/ckeditor-plugins/textcolor","modules/emailbuilder/ckeditor-plugins/textbgcolor","modules/emailbuilder/ckeditor-plugins/font","modules/emailbuilder/ckeditor-plugins/fontsize","ts/modules/emailbuilder/services/email","ts/modules/emailbuilder/services/lockLevelSvc"],function(e,t,n,i,o,r,s,a,l,c,u,d,m,p,h,f,g,v){function b(){var t={};return e.listsWithCustomFields.forEach(function(e){e.fields.forEach(function(e){t[e.tag]=1})}),Object.keys(t).map(function(e){return{key:e,tag:["[",e,",fallback=]"].join(""),setCaret:!0}})}function y(e){this.tag=e.tag,this.setCaret=e.setCaret}function w(e,t,n,i){var o=this;o.$s=e,o.$timeout=t,o.lmp=n,o.rootScope=i,o.uck=[function(e){o.initCK(e)}]}function k(e){e?this.element.$.blur():(this.focus(),this.selectionChange())}var _={customConfig:"",removePlugins:"toolbar",extraPlugins:"customtoolbar,link,justifylight,textColor,textBgColor,font,fontSize",disableNativeSpellChecker:!1,toolbar:["Bold","Italic","Link","NumberedList","BulletedList","Blockquote"],title:!1,stylesSet:!1,extraAllowedContent:"p{text-align}; h1{text-align}; h2{text-align}; h3{text-align}; li{text-align}; span{color}"},x=[{key:"firstname",tag:"[firstname,fallback=]",setCaret:!0},{key:"lastname",tag:"[lastname,fallback=]",setCaret:!0},{key:"fullname",tag:"[fullname,fallback=]",setCaret:!0},{key:"email",tag:"[email]"},{key:"currentday",tag:"<currentday>"},{key:"currentdayname",tag:"<currentdayname>"},{key:"currentmonth",tag:"<currentmonth>"},{key:"currentmonthname",tag:"<currentmonthname>"},{key:"currentyear",tag:"<currentyear>"},{key:"emailvariable",tag:"[variableName, fallback=]"}];_.extraAllowedContent=_.extraAllowedContent+"; p{font-family}; h1{font-family}; h2{font-family}; h3{font-family}; li{font-family}",_.extraAllowedContent=_.extraAllowedContent+"; p{font-size,line-height}; h1{font-size,line-height}; h2{font-size,line-height}; h3{font-size,line-height}; li{font-size,line-height}",e.textBgColorEnabled&&(_.extraAllowedContent=_.extraAllowedContent+"; span{background-color}"),y.prototype.exec=function(e){var t=new i.dom.text(this.tag),n=e.getSelection(),o=n.getRanges()[0];o.collapsed||o.extractContents(),o.insertNode(t),o.selectNodeContents(t),this.setCaret&&(o.endOffset-=1),o.collapse(),o.select()},i.disableAutoInline=!0,i.plugins.add("customtoolbar",{init:function(e){e.config.toolbar.forEach(function(t){var n=e.ui.create(t);e.addFeature(n)}),x.push.apply(x,b()),x.forEach(function(t){e.addCommand(t.key,new y(t))}),["h1","h2","h3","p"].forEach(function(t){var n=new i.style({element:t}),o=e.addCommand(t,new i.styleCommand(n,{contentForms:[n]}));e.addFeature(o),e.attachStyleStateChange(n,function(t){o.setState(t),i.TRISTATE_ON===t&&e.fire("style",o.name)}),e.ui.addButton(t,{command:t})})}}),w.prototype.initCK=function(t){function n(e){for(var t=0;t<s.fonts.length;t++)if(s.fonts[t].value===e)return s.fonts[t].display;return""}function o(e){return!(!t.element||!e.focusNode)&&(t.element.$===e.focusNode.parentElement||!(!e.focusNode.parentElement||t.element.$!==e.focusNode.parentElement.parentElement))}var r=this,s=this.$s,a=s.singleline||"br"===s.enterMode;t.on("focus",function(e){s.skipFocus||(s.makeActive(),l(),s.toggleDisplay(),r.resetPlaceholder())});var l=function(){"<p></p>"===r.$s.block.contents&&r.setCursor()};t.on("blur",function(e){r.setPlaceholder();var t=window.getSelection();o(t)&&t.removeAllRanges()}),t.on("link",function(e){s.url=e.data?r.lmp.getModelFor(e.data.data("cke-saved-href")):"",s.toggleDisplay("link")}),t.on("pluginsLoaded",function(e){e.editor.dataProcessor.dataFilter.addRules({comment:function(){return!1}})}),t.on("paste",function(e){var t=/(class=\"?Mso|style=\"[^\"]*\bmso\-|w:WordDocument)/gm,n=e.data.dataValue,o=t.test(n);if(o){var r=/<style([\S\s]*?)>([\S\s]*?)<\/style>|<xml([\S\s]*?)>([\S\s]*?)<\/xml>|<span([\S\s]*?)>|<\/span>|<!--([\S\s]*?)\-->/gi;n=n.replace(r,""),e.data.dataValue=n}if(s.restrictedTextStyles&&e.data.dataTransfer.sourceEditor!==e.editor){var a=new i.filter("p h1 h2 h3 ul ol li blockquote strong em br");a.allow("a img[*](*)");var l=i.htmlParser.fragment.fromHtml(e.data.dataValue),c=new i.htmlParser.basicWriter;a.applyTo(l),l.writeHtml(c),e.data.dataValue=c.getHtml()}}),t.on("textColor",function(e){s.textColor=e.data,"textColor"===s.display&&r.rootScope.$emit("recentColors:addNew",s.textColor),s.toggleDisplay("textColor"),r.$timeout(function(){s.originalColor=s.textColor})}),t.on("textBgColor",function(e){s.textBgColor=e.data,"textBgColor"===s.display&&r.rootScope.$emit("recentColors:addNew",s.textBgColor),s.toggleDisplay("textBgColor"),r.$timeout(function(){s.originalBgColor=s.textBgColor})}),t.on("fontSize",function(e){s.fontSize=e.data,s.toggleDisplay("fontSize"),r.$timeout(function(){s.currentFontSize=s.fontSize.replace("px","")})}),t.on("currentFontSize",function(e){r.$timeout(function(){s.currentFontSize=e.data.replace("px","")})}),t.on("font",function(t){r.$timeout(function(){var i=n(t.data);if(!i&&s.currentStyle){var o=e.email.styles[s.currentStyle.value].fontFamily;i=n(o)}s.currentFont=i})}),t.on("style",function(e){var t={h1:"Heading 1",h2:"Heading 2",h3:"Heading 3"};r.$timeout(function(){s.currentStyle={value:e.data,display:t[e.data]||"Normal text"}})}),s.singleline&&t.on("key",function(e){13===e.data.keyCode&&e.cancel()}),a&&"4.3.3"===i.version&&t.on("instanceReady",function(){delete t.filter._.rules.elements.p})},w.prototype.emptyText="&nbsp;",w.prototype.resetPlaceholder=function(){var e=this.$s.block,t=this;e.isPlaceholder&&(e.isPlaceholder=!1,t.setCursor(),this.$timeout(function(){e.contents=t.emptyText},100))},w.prototype.setCursor=function(){var e=this.ck.createRange();e.moveToElementEditEnd(e.root),e.collapse(!0),e.select()},w.prototype.setPlaceholder=function(){var e=this.$s.block,t=this.$s.placeholder;e||(this.$s.block={isPlaceholder:!0,contents:t}),!t||e.contents&&e.contents!==this.emptyText||this.$timeout(function(){e.isPlaceholder=!0,e.contents=t})},w.prototype.setCK=function(e){this.ck=e,this.uck.forEach(function(t){t(e)})},w.prototype.usesCK=function(e){this.ck?e(this.ck):this.uck.push(e)},w.prototype.setInUse=function(){var e=this;e.ciu||(e.ciu=a.debounce(function(){e.$s.inUse=!1,e.$s.$digest()},500)),e.$s.inUse=!0,e.$s.safeDigest(),e.ciu()},w.prototype.getCKConfig=function(){var e=_;return("br"===this.$s.enterMode||this.$s.singleline)&&(e=t.copy(_),e.enterMode=i.ENTER_BR,e.forcePasteAsPlainText=!0),e},n.directive("embTextBlock",["ItemWidthSvc","$rootScope","$timeout","ModelActivity","EmailSvc","$sce","LockLevelSvc",function(n,i,o,r,a,l,c){return{replace:!1,transclude:!1,scope:{block:"=",editableTextKey:"@",inSection:"@",singleline:"@",enterMode:"@",placeholder:"@",showTrashcan:"@",optionalTextKey:"@",section:"=",inFooter:"@",footer:"=",inHeader:"@",header:"="},template:s,controller:["$scope","$timeout","csLinkModelProvider","$rootScope",w],require:"embTextBlock",link:function(s,a,u,d){function m(e){var t=c.getLocks(e);s.canEdit=t.canEditContentItems,s.restrictedTextStyles=t.restrictedTextStyles,s.canDelete=t.canDeleteContentItems}s.deleteConfirmation=!1,i.$on("content:showConfirmation",function(){s.deleteConfirmation=!0}),i.$on("content:hideConfirmation",function(){s.deleteConfirmation=!1});var p=a.find(".emb-js-link-field"),h=a.find(".emb-js-href-field");d.setPlaceholder(),s.ckData=function(){return l.trustAsHtml(s.block.contents)},a.on("click",function(e){e.stopPropagation()}),s.isHeading=a.hasClass("emb-js-header"),s.dragging=!1,s.singleline=!!s.singleline,s.inSection=!!s.inSection,s.inFooter=!!s.inFooter,s.inUse=!1,s.lists=t.copy(e.listsWithCustomFields),s.hasCustomFields=!!s.lists.length,s.editorStyle={},s.isTransactional=e.mode.isTransactional,s.confirmation=!1,s.singleline&&"middle"===a.css("verticalAlign")&&(s.editorStyle={lineHeight:a.height()+"px"}),s.block.editableTextKey=s.editableTextKey,s.fonts=t.copy(e.email.config.availableFonts),s.fontSizes=[[8,14],[9,16],[10,18],[11,19],[12,19],[13,21],[14,21],[15,23],[16,24],[17,26],[18,26],[20,28],[22,31],[24,32],[26,34],[28,36],[30,38],[32,40],[34,43],[36,43],[40,47],[44,50],[48,54],[56,60],[64,63]],s.textBgColorEnabled=e.textBgColorEnabled,s.canEdit=!0,s.restrictedTextStyles=!1,s.canDelete=!0,s.inSection?(m(s.section.permissions),s.$on("permissionsChanged:section-"+s.section.uiId,function(e,t){m(t)})):s.inFooter?(m(s.footer.permissions),s.$on("permissionsChanged:footer",function(e,t){m(t)})):s.inHeader&&(m(s.header.permissions),s.$on("permissionsChanged:header",function(e,t){m(t)}));var f=function(){var e="emb-js-text-";if(s.inSection){var t=s.block.tempContainer;return[e,t.section,"-",t.column].join("")}return[e,u.block].join("")};a.attr("id",f());var g=function(e){if(s.showTrashcan===!0&&e.offset().top<65){var n=t.element(".js-delete-controls",e);n&&n.css("top","8px")}};g(a),s.$watch("block.isActive",function(e,n){(e||n)&&(d.usesCK(function(i){var o=t.bind(i,k,!e&&n);"ready"===i.status?setTimeout(o,0):i.on("instanceReady",o)}),s.toggleDisplay())}),s.$watch("display",function(e){"link"===e&&p.select()}),s.toggleDisplay=function(e){"textColor"===s.display&&s.originalColor!==s.textColor&&i.$emit("recentColors:addNew",s.textColor),"textBgColor"===s.display&&s.originalBgColor!==s.textBgColor&&i.$emit("recentColors:addNew",s.textBgColor),e&&i.$emit("text:command"),e&&s.display!==e||(e=!1),s.displayLevel=1,s.display=e,s.subDisplay="",s.safeDigest()},s.toggleLevel=function(e,t,n){s.displayLevel=t||1,s.subDisplay=e||!1,s.menuItem=n||s.menuItem,3===t&&"social"===e&&setTimeout(function(){h.select()},450)},s.setTextColor=function(){d.usesCK(function(e){s.skipFocus=!0,e.execCommand("setTextColor",s.textColor),t.bind(e,k,!0)(),s.skipFocus=!1})},s.setTextBgColor=function(){d.usesCK(function(e){s.skipFocus=!0,e.execCommand("setTextBgColor",s.textBgColor),t.bind(e,k,!0)(),s.skipFocus=!1})},s.$on("colorPicker:confirm",function(){s.toggleDisplay()}),s.setFontSize=function(e,t){o(function(){d.usesCK(function(n){n.execCommand("setFontSize",{fontSize:e+"px",lineHeight:t+"px"})})},0)},s.setFont=function(e){o(function(){d.usesCK(function(t){t.execCommand("setFont",e)})},0)},s.addLink=function(e,n){t.element(n.target).is(".ng-invalid")||(s.display=!1,d.usesCK(function(i){i.execCommand(e,s.url),t.element(n.target).val(""),s.url=""}))},s.activeNotDragged=function(){return!s.dragging&&s.block&&s.block.isActive},s.notActive=function(){return!s.dragging&&s.block&&!s.block.isActive},s.narrowControls=s.inSection&&n.getBlockWidth(s.block)<600,s.fullWidthControls=function(){return s.inSection&&(!s.narrowControls||!s.block.isActive)},s.makeActive=function(){s.block.isActive||(i.$emit("content:activate",{block:s.block}),s.$apply())},s.showConfirmationForTrashcan=function(){s.confirmation=!0},s.hideConfirmation=function(){s.confirmation=!1},s.remove=function(){s.confirmation=!1,i.$emit("optionalText:removed",s.optionalTextKey),r.contentUpdated()}}}}]),n.directive("embTextCommand",["$rootScope",function(e){return{require:"^embTextBlock",scope:{safeCommand:"=safeCommand",addUnselectedClass:"=addUnselectedClass"},link:function(n,o,r,s){function a(){function t(){o.toggleClass("emb-selected",c.state===i.TRISTATE_ON),n.addUnselectedClass&&o.toggleClass("emb-unselected",c.state===i.TRISTATE_OFF)}var s,a=this,l=r.embTextCommand,c=a.commands[l];switch(l){case"p":s=null;break;case"h1":case"h2":case"h3":s=a.commands.p;break;default:s=c}c.on("state",t),t(),o.on("click",function(){if(!n.safeCommand){e.$emit("text:command");var t=c.state===i.TRISTATE_ON?s:c;t&&(t.exec(),a.fire("change"))}})}s.usesCK(function(e){"ready"===e.status?setTimeout(t.bind(e,a),0):e.on("instanceReady",a)})}}}]),n.directive("contenteditable",["ModelActivity","EmailSvc",function(e,t){return{require:["ngModel","^embTextBlock"],link:function(t,n,o,r){var s=r[0],l=r[1],c=i.inline(n[0],l.getCKConfig());c.on("instanceReady",function(e){var t=e.editor;t.setReadOnly(!1)}),c.on("change",a.throttle(function(){s.$setViewValue(this.getData()),l.setInUse(),e.contentUpdated()},100)),n.on("blur",function(){var e=window.getSelection();"Caret"!==e.type&&s.$setViewValue(c.getData())}),s.$render=function(){"ready"!==c.status&&n.html(s.$modelValue),c.setData(s.$modelValue)},t.$on("$destroy",function(){c.destroy()}),l.setCK(c)}}}])}),define("vendor/text!modules/emailbuilder/templates/slider.html",[],function(){return"<div class='slider-container'>\r\n    <div class='slider'></div>\r\n</div>"}),function(){function e(e){var t=5;e.widget("ui.slider",e.ui.mouse,{version:"1.10.4",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var t,n,i=this.options,o=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),r="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",s=[];for(n=i.values&&i.values.length||1,o.length>n&&(o.slice(n).remove(),o=o.slice(0,n)),t=o.length;t<n;t++)s.push(r);this.handles=o.add(e(s.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)})},_createRange:function(){var t=this.options,n="";t.range?(t.range===!0&&(t.values?t.values.length&&2!==t.values.length?t.values=[t.values[0],t.values[0]]:e.isArray(t.values)&&(t.values=t.values.slice(0)):t.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=e("<div></div>").appendTo(this.element),n="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(n+("min"===t.range||"max"===t.range?" ui-slider-range-"+t.range:""))):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){var e=this.handles.add(this.range).filter("a");this._off(e),this._on(e,this._handleEvents),this._hoverable(e),this._focusable(e)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var n,i,o,r,s,a,l,c,u=this,d=this.options;return!d.disabled&&(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),n={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(n),o=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var n=Math.abs(i-u.values(t));(o>n||o===n&&(t===u._lastChangedValue||u.values(t)===d.min))&&(o=n,r=e(this),s=t)}),a=this._start(t,s),a!==!1&&(this._mouseSliding=!0,this._handleIndex=s,r.addClass("ui-state-active").focus(),l=r.offset(),c=!e(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=c?{left:0,top:0}:{left:t.pageX-l.left-r.width()/2,top:t.pageY-l.top-r.height()/2-(parseInt(r.css("borderTopWidth"),10)||0)-(parseInt(r.css("borderBottomWidth"),10)||0)+(parseInt(r.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,s,i),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},n=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,n),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,n,i,o,r;return"horizontal"===this.orientation?(t=this.elementSize.width,n=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,n=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),i=n/t,i>1&&(i=1),i<0&&(i=0),"vertical"===this.orientation&&(i=1-i),o=this._valueMax()-this._valueMin(),r=this._valueMin()+i*o,this._trimAlignValue(r)},_start:function(e,t){var n={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("start",e,n)},_slide:function(e,t,n){var i,o,r;this.options.values&&this.options.values.length?(i=this.values(t?0:1),2===this.options.values.length&&this.options.range===!0&&(0===t&&n>i||1===t&&n<i)&&(n=i),n!==this.values(t)&&(o=this.values(),o[t]=n,r=this._trigger("slide",e,{handle:this.handles[t],value:n,values:o}),i=this.values(t?0:1),r!==!1&&this.values(t,n))):n!==this.value()&&(r=this._trigger("slide",e,{handle:this.handles[t],value:n}),r!==!1&&this.value(n))},_stop:function(e,t){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("stop",e,n)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._lastChangedValue=t,this._trigger("change",e,n)}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),void this._change(null,0)):this._value()},values:function(t,n){var i,o,r;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(n),this._refreshValue(),void this._change(null,t);if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();for(i=this.options.values,o=arguments[0],r=0;r<i.length;r+=1)i[r]=this._trimAlignValue(o[r]),this._change(null,r);this._refreshValue()},_setOption:function(t,n){var i,o=0;switch("range"===t&&this.options.range===!0&&("min"===n?(this.options.value=this._values(0),this.options.values=null):"max"===n&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),e.isArray(this.options.values)&&(o=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments),t){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),i=0;i<o;i+=1)this._change(null,i);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,n,i;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);if(this.options.values&&this.options.values.length){for(n=this.options.values.slice(),i=0;i<n.length;i+=1)n[i]=this._trimAlignValue(n[i]);return n}return[]},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,n=(e-this._valueMin())%t,i=e-n;return 2*Math.abs(n)>=t&&(i+=n>0?t:-t),parseFloat(i.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,n,i,o,r,s=this.options.range,a=this.options,l=this,c=!this._animateOff&&a.animate,u={};this.options.values&&this.options.values.length?this.handles.each(function(i){n=(l.values(i)-l._valueMin())/(l._valueMax()-l._valueMin())*100,u["horizontal"===l.orientation?"left":"bottom"]=n+"%",e(this).stop(1,1)[c?"animate":"css"](u,a.animate),l.options.range===!0&&("horizontal"===l.orientation?(0===i&&l.range.stop(1,1)[c?"animate":"css"]({left:n+"%"},a.animate),1===i&&l.range[c?"animate":"css"]({width:n-t+"%"},{queue:!1,duration:a.animate})):(0===i&&l.range.stop(1,1)[c?"animate":"css"]({bottom:n+"%"},a.animate),1===i&&l.range[c?"animate":"css"]({height:n-t+"%"},{queue:!1,duration:a.animate}))),t=n}):(i=this.value(),o=this._valueMin(),r=this._valueMax(),n=r!==o?(i-o)/(r-o)*100:0,u["horizontal"===this.orientation?"left":"bottom"]=n+"%",this.handle.stop(1,1)[c?"animate":"css"](u,a.animate),"min"===s&&"horizontal"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({width:n+"%"},a.animate),"max"===s&&"horizontal"===this.orientation&&this.range[c?"animate":"css"]({width:100-n+"%"},{queue:!1,duration:a.animate}),"min"===s&&"vertical"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({height:n+"%"},a.animate),"max"===s&&"vertical"===this.orientation&&this.range[c?"animate":"css"]({height:100-n+"%"},{queue:!1,duration:a.animate}))},_handleEvents:{keydown:function(n){var i,o,r,s,a=e(n.target).data("ui-slider-handle-index");switch(n.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(n.preventDefault(),!this._keySliding&&(this._keySliding=!0,e(n.target).addClass("ui-state-active"),i=this._start(n,a),i===!1))return}switch(s=this.options.step,o=r=this.options.values&&this.options.values.length?this.values(a):this.value(),n.keyCode){case e.ui.keyCode.HOME:r=this._valueMin();break;case e.ui.keyCode.END:r=this._valueMax();break;case e.ui.keyCode.PAGE_UP:r=this._trimAlignValue(o+(this._valueMax()-this._valueMin())/t);break;case e.ui.keyCode.PAGE_DOWN:r=this._trimAlignValue(o-(this._valueMax()-this._valueMin())/t);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(o===this._valueMax())return;r=this._trimAlignValue(o+s);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(o===this._valueMin())return;r=this._trimAlignValue(o-s)}this._slide(n,a,r)},click:function(e){e.preventDefault()},keyup:function(t){var n=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,n),this._change(t,n),e(t.target).removeClass("ui-state-active"))}}})}"function"==typeof define?define("vendor/jquery.ui.slider",["jquery","jqueryui"],e):e(jQuery)}(),define("modules/emailbuilder/directives/slider",["vendor/angular","modules/emailbuilder/module","vendor/text!modules/emailbuilder/templates/slider.html","vendor/jquery.ui.slider","config"],function(e,t,n,i,o){function r(e,t,n,i,r,s,l){r>l&&(r=l),isNaN(r)&&(r=o.settings.defaultVerticalSpacingValue),i.$setViewValue(r);var c=n.find(".slider"),u=!1;c.slider({orientation:"horizontal",range:"min",min:s,max:l,value:r,change:function(t,n){e(function(){i.$setViewValue(n.value)}),i.$setViewValue(n.value),a(),u=!1},slide:function(e,n){u=!0,t.$apply(function(){i.$setViewValue(n.value)}),a()}}),t.$watch("max",function(e){var t=i.$modelValue;t>e&&(i.$setViewValue(e),c.slider("option","value",e)),c.slider("option","max",e)}),t.$watch("initialValue",function(t,n){u||c.slider("option","value")===t||(isNaN(t)&&(t=o.settings.defaultVerticalSpacingValue,i.$setViewValue(t)),e(function(){c.slider("option","value",t)},200))})}function s(e){return{restrict:"A",replace:!0,template:n,require:"ngModel",scope:{initialValue:"=csSlider",max:"=csSliderMax"},link:function(t,n,i,o){r(e,t,n,o,t.initialValue,parseInt(i.csSliderMin,10),t.max)}}}function a(){/^((?!chrome).)*safari/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.body,t=e.style.display;e.style.display="none";e.offsetHeight;e.style.display=t},1)}t.directive("csSlider",["$timeout",s])}),define("vendor/text!modules/emailbuilder/templates/imageDimensions.html",[],function(){return"<div>\r\n    <div class='image-dimensions'>{{master}} x {{slave}}</div>\r\n</div>"}),define("modules/emailbuilder/directives/imageDimensions",["vendor/angular","modules/emailbuilder/module","vendor/text!modules/emailbuilder/templates/imageDimensions.html"],function(e,t,n){function i(e,t,n){return Math.round(e*t/n)}function o(){return{restrict:"A",replace:!0,template:n,scope:{master:"=embImageDimensions",slave:"=embImageDimensionsSlave",numerator:"=embImageDimensionsNumerator",denominator:"=embImageDimensionsDenominator"},link:function(e,t,n){e.$watch("master",function(){e.slave=i(e.master,e.numerator,e.denominator)})}}}t.directive("embImageDimensions",[o])}),define("modules/emailbuilder/services/imageFileDragging",["vendor/angular","modules/emailbuilder/module"],function(e,t){function n(e,t,n,i){this.state={},this.ivs=t,this.ims=n,this.e=e,this.$rootScope=i}n.prototype.setLocationProvider=function(e){this.state.locationProvider=e},n.prototype.handleDrop=function(e){var t,n,i,o,r,s,a=this,l=e.originalEvent.dataTransfer.files,c=this.state.locationProvider;if(a.setLocationProvider(null),l&&l.length){if(t=l[0],n=c?c():null,n&&(i=n.block),r=a.ivs.validate({file:t,block:i||{}}))return void(i&&a.$rootScope.$emit("content:activate",{block:i}));i?(o=function(){return i},this.$rootScope.$emit("content:activate",{block:i})):(n&&a.e.setContentTarget(n.location),i=a.e.addContent({type:"image"}),i.tempLoadingImg=!0,o=function(e){return function(t){return t||a.$rootScope.$emit("content:activate",{block:e}),e}}(i)),s=this.ims.uploadAsync({file:t,block:o})}},t.service("ImageFileDraggingSvc",["EmailSvc","ImageValidationSrv","ImageManagerSrv","$rootScope",n])}),define("modules/emailbuilder/directives/imageDropContainer",["vendor/angular","modules/emailbuilder/module","modules/emailbuilder/services/imageFileDragging"],function(e,t){t.directive("embImageDropContainer",["$parse","$compile","ImageFileDraggingSvc","DraggingSvc",function(t,n,i,o){function r(r,s,a){var l=a.embImageDropContainer,c=!!l,u=!!a.replace,d=c&&t(l);r.allowReplace=u,r.dragOver=function(t){r.allowReplace&&o.capture(),r.hovered=!0,t.isDefaultPrevented()||i.setLocationProvider(function(){return c&&r.allowReplace?{block:d(r)}:{location:e.element(t.target).controller("embDropzone").getLocation()}})},r.dragLeave=function(){r.allowReplace&&o.release(),r.hovered=!1,i.setLocationProvider()},n(s)(r)}i.setLocationProvider.bind(i);return{terminal:!0,priority:1e3,compile:function(e,t){return e.attr({"cs-dragover":"dragOver(event)","cs-dragleave":"dragLeave()"}),e.removeAttr("emb-image-drop-container"),r}}}])}),define("vendor/text!modules/emailbuilder/templates/logo.html",[],function(){return'<div class="emb-content-inner emb-js-content-inner"\r\n     ng-class="{ \'emb-active\' : block.isActive, \'emb-hoverable\' : !block.isActive, \'emb-img-showing-dropzone\' :  !hasImage }"\r\n     ng-mouseenter="hovered = true"\r\n     ng-mouseleave="hovered = false">\r\n    <div emb-item-controls item-type="header" item="block" item-hovered="hovered" in-use="block.isActive"></div>\r\n    <div class="emb-content-inner emb-js-content-inner">\r\n        <div ng-if="!hasImage">\r\n            <div \r\n                class="emb-img-dropzone emb-logo-dropzone emb-reset emb-img-container emb-js-logo-dropzone"\r\n                ng-class="{\'emb-error\' : !block.tempIsValid, \'emb-hovered\': hovered }">\r\n                <div class="emb-dropzone-container">\r\n                    <form>\r\n                        <input name="file" class="emb-invisible-input" type="file" accepts="image/*"/>\r\n                    </form>\r\n                    <p class="emb-drop-icon">\r\n                        <span class="emb-image-well"></span>\r\n                        <span class="emb-drop-text">Drag your logo here</span>\r\n                    </p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div ng-if="hasImage">\r\n            <img class="emb-js-header" emb-disable-drag ng-src="{{logoSrc}}" width="{{block.width}}" height="{{block.height}}" ng-style="{ \'max-width\': block.width }" />\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("modules/emailbuilder/directives/logo",["vendor/angular","modules/emailbuilder/module","modules/emailbuilder/services/browser","ts/modules/emailbuilder/services/email","modules/emailbuilder/services/imageManager","modules/emailbuilder/directives/imageDropContainer","vendor/text!modules/emailbuilder/templates/logo.html"],function(e,t,n,i,o,r,s){function a(t,n,i){return{restrict:"A",replace:!1,template:s,link:function(o,r,s){if(o.block=n.model.header,!o.block.halign){var a=r.closest("[default-align]").attr("default-align");"undefined"==typeof a&&(a="center"),o.block.halign=a}var l=t.current.supports.html5UploadWithProgress();r.on("change",'input[type="file"]',function(t){var n=e.element(this);if(""!==n.val()){var r=l?this.files[0]:n;i.uploadAsync({file:r,block:function(){return o.block}})}});var c=function(){var e=r.find('input[type="file"]');e.length>0&&e.parent()[0].reset()};o.$watch("block.getSrc()",function(e){e&&(o.logoSrc=e),c(),o.hasImage=!!e})}}}t.directive("embLogo",["BrowserSrv","EmailSvc","ImageManagerSrv",a])}),define("ts/modules/emailbuilder/directives/footer",["vendor/angular","modules/emailbuilder/module","ts/modules/emailbuilder/services/lockLevelSvc","ts/modules/emailbuilder/services/email"],function(e,t,n){var i=function(){function t(t,n,i){var o=this;this.restrict="A",this.replace=!1,this.scope=!0,this.link=function(t,n){function i(e){var t=r.lockLevelSvc.getLocks(e);t.anyLocking?n.addClass("is-locked"):n.removeClass("is-locked")}var r=o;t.block=e.copy(o.emailSvc.model.footer);try{var s=e.element(".address",n).scope();s.block.type="footer",s.block.subType="companyDetails"}catch(e){}i(t.block.permissions),t.$on("permissionsChanged:footer",function(e,t){i(t)}),n.mouseenter(function(){n.addClass("is-hovered")}),n.mouseout(function(){n.removeClass("is-hovered")});var a=o.$rootScope.$on("content:activated",function(e,t){"footer"===t.block.type?n.addClass("is-active"):n.removeClass("is-active");
}),l=o.$rootScope.$on("content:deactivated",function(e,t){n.removeClass("is-active")});t.$on("$destroy",function(){a(),l()})},this.compile=function(e){var t=$('<button class="c-section-highlight__label c-section-highlight__label--locked"></button>');return t.append('<span class="c-section-highlight__label-lock" aria-hidden="true"></span>'),t.append('<span class="c-section-highlight__label-text">Locked</span>'),e.append(t),o.link},this.lockLevelSvc=i,this.$rootScope=n,this.emailSvc=t}return t.factory=function(e,n,i){return new t(e,n,i)},t}();t.directive("embFooter",["EmailSvc","$rootScope","LockLevelSvc",i.factory])}),define("ts/modules/emailbuilder/directives/preheader",["vendor/angular","modules/emailbuilder/module","config"],function(e,t,n){function i(t,i){return{restrict:"A",replace:!1,scope:!0,link:function(o,r){o.block=e.copy(t.model.header),o.block.subType="preheader";var s=!1;n.canvasSectionPermissions&&("full"===o.block.permissions.lockLevel?r.addClass("is-locked"):"partial"===o.block.permissions.lockLevel&&r.addClass("is-partially-locked"),o.$on("permissionsChanged:header",function(e,t){r.removeClass("is-partially-locked"),r.removeClass("is-locked"),s||("full"===t.lockLevel?r.addClass("is-locked"):"partial"===t.lockLevel&&r.addClass("is-partially-locked"))})),r.mouseenter(function(){s||r.addClass("is-hovered")}),r.mouseout(function(){r.removeClass("is-hovered")});var a=i.$on("content:activated",function(e,t){s||"header"!==t.block.type||"preheader"!==t.block.subType?r.removeClass("is-active"):r.addClass("is-active")}),l=i.$on("content:deactivated",function(e,t){r.removeClass("is-active")}),c=i.$on("checkbox:value-changed",function(e){!t.model.social.webversion.on&&t.model.editableText.preheader.isDisabled?(s=!0,i.$emit("content:deactivate")):s=!1});o.$on("$destroy",function(){a(),l(),c()})},compile:function(e){var t=$("<button></button>");t.addClass("c-section-highlight__label"),t.addClass("c-section-highlight__label--locked");var n=$("<span></span>");n.addClass("c-section-highlight__label-lock"),n.attr("aria-hidden","true"),t.append(n);var i=$("<span>Locked</span>");i.addClass("c-section-highlight__label-text"),i.attr("aria-hidden","true"),t.append(i),e.append(t);var o=$("<button></button>");o.addClass("c-section-highlight__label"),o.addClass("c-section-highlight__label--partially-locked");var r=$("<span></span>");r.addClass("c-section-highlight__label-lock"),r.addClass("c-section-highlight__label-lock--partial"),r.attr("aria-hidden","true"),o.append(r);var s=$("<span>Edit content only</span>");return s.addClass("c-section-highlight__label-text"),s.attr("aria-hidden","true"),o.append(s),e.append(o),this.link}}}t.directive("embPreheader",["EmailSvc","$rootScope",i])}),define("ts/modules/emailbuilder/directives/sectionBackground",["config","vendor/angular","modules/emailbuilder/module"],function(e,t,n){function i(e,n,i,o){return{restrict:"A",replace:!1,scope:!0,link:function(r,s){r.isImage=function(e){var t=n.defer(),i=new Image;return i.onerror=function(){t.resolve(!1)},i.onload=function(){t.resolve(!0)},i.src=e,t.promise},r.getBackgroundStyle=function(n,i){var s=n.style,a="",l={};a=""===s.backgroundColor||void 0===s.backgroundColor?e.model.styles.section.backgroundColor:s.backgroundColor,l={"background-color":"#"+a},s&&s.backgroundLayoutImage&&s.backgroundLayoutImage.hasSrc()?(void 0!==s.backgroundLayoutImage.href&&null!==s.backgroundLayoutImage.href?(l["background-image"]="url("+s.backgroundLayoutImage.href+")",r.isImage(s.backgroundLayoutImage.href).then(function(e){e?n.hasMissingBackground=!1:(n.hasMissingBackground=!0,o.logUiErrors("sectionBackground","Image url:"+s.backgroundLayoutImage.href))})):(n.hasMissingBackground=!1,l["background-image"]="none"),l["background-repeat"]=s.backgroundLayoutImage.backgroundRepeat||"no-repeat",l["background-position"]=s.backgroundLayoutImage.backgroundPosition||"0px 0px"):(n.hasMissingBackground=!1,l["background-image"]="none"),t.element(i).css(l)},r.getBackgroundStyle(r.section,s),i.$on("section.updateBackground"+r.section.uiId,function(e,n){var i;i=n.id.indexOf("gutter")!==-1?t.element("#"+n.uiId+" .column__background"):t.element("#"+n.uiId+"  div[emb-section-background]"),i&&i.length>0&&r.getBackgroundStyle(n,i)})}}}n.directive("embSectionBackground",["EmailSvc","$q","$rootScope","errorLoggingSvc",i])}),define("ts/modules/emailbuilder/services/ravenSvc",["vendor/angular","modules/emailbuilder/module","config"],function(e,t,n){var i=function(){function e(e,t){n.canvasSentryMonitoring&&t.ajaxError(function(t,n,i,o){e.captureMessage(o||n.statusText,{extra:{type:i.type,url:i.url,data:i.data,status:n.status,error:o||n.statusText,response:n.responseText.substring(0,100)}})})}return e}();t.service("ravenService",["$document",i])}),define("modules/emailbuilder/directives/focus",["modules/emailbuilder/module"],function(e){function t(e){return function(t,n,i){var o=i.selectWhen;t.$watch(i.csFocus,function(t){t&&(setTimeout(function(){var t=o&&o===n.val();n[t?"select":"focus"](),e.focusFromOurDirective=!1},200),e.focusFromOurDirective=!0)})}}e.directive("csFocus",["$rootScope",t])}),function(e){"function"==typeof define&&define.amd?define("vendor/jquery.nicescroll",["jquery"],e):e(jQuery)}(function(e){function t(){var e=document.getElementsByTagName("script"),t=e[e.length-1].src.split("?")[0];return t.split("/").length>0?t.split("/").slice(0,-1).join("/")+"/":""}function n(e,t,n){for(var i=0;i<t.length;i++)n(e,t[i])}var i=!1,o=!1,r=5e3,s=2e3,a=0,l=e,c=["ms","moz","webkit","o"],u=window.requestAnimationFrame||!1,d=window.cancelAnimationFrame||!1;if(!u)for(var m in c){var p=c[m];u||(u=window[p+"RequestAnimationFrame"]),d||(d=window[p+"CancelAnimationFrame"]||window[p+"CancelRequestAnimationFrame"])}var h=window.MutationObserver||window.WebKitMutationObserver||!1,f={zindex:"auto",cursoropacitymin:0,cursoropacitymax:1,cursorcolor:"#424242",cursorwidth:"5px",cursorborder:"1px solid #fff",cursorborderradius:"5px",scrollspeed:60,mousescrollstep:24,touchbehavior:!1,hwacceleration:!0,usetransition:!0,boxzoom:!1,dblclickzoom:!0,gesturezoom:!0,grabcursorenabled:!0,autohidemode:!0,background:"",iframeautoresize:!0,cursorminheight:32,preservenativescrolling:!0,railoffset:!1,bouncescroll:!0,spacebarenabled:!0,railpadding:{top:0,right:0,left:0,bottom:0},disableoutline:!0,horizrailenabled:!0,railalign:"right",railvalign:"bottom",enabletranslate3d:!0,enablemousewheel:!0,enablekeyboard:!0,smoothscroll:!0,sensitiverail:!0,enablemouselockapi:!0,cursorfixedheight:!1,directionlockdeadzone:6,hidecursordelay:400,nativeparentscrolling:!0,enablescrollonselection:!0,overflowx:!0,overflowy:!0,cursordragspeed:.3,rtlmode:"auto",cursordragontouch:!1,oneaxismousemode:"auto",scriptpath:t()},g=!1,v=function(){function e(){var e=["-moz-grab","-webkit-grab","grab"];(n.ischrome&&!n.ischrome22||n.isie)&&(e=[]);for(var i=0;i<e.length;i++){var o=e[i];if(t.style.cursor=o,t.style.cursor==o)return o}return"url(http://www.google.com/intl/en_ALL/mapfiles/openhand.cur),n-resize"}if(g)return g;var t=document.createElement("DIV"),n={};n.haspointerlock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,n.isopera="opera"in window,n.isopera12=n.isopera&&"getUserMedia"in navigator,n.isoperamini="[object OperaMini]"===Object.prototype.toString.call(window.operamini),n.isie="all"in document&&"attachEvent"in t&&!n.isopera,n.isieold=n.isie&&!("msInterpolationMode"in t.style),n.isie7=n.isie&&!n.isieold&&(!("documentMode"in document)||7==document.documentMode),n.isie8=n.isie&&"documentMode"in document&&8==document.documentMode,n.isie9=n.isie&&"performance"in window&&document.documentMode>=9,n.isie10=n.isie&&"performance"in window&&document.documentMode>=10,n.isie9mobile=/iemobile.9/i.test(navigator.userAgent),n.isie9mobile&&(n.isie9=!1),n.isie7mobile=!n.isie9mobile&&n.isie7&&/iemobile/i.test(navigator.userAgent),n.ismozilla="MozAppearance"in t.style,n.iswebkit="WebkitAppearance"in t.style,n.ischrome="chrome"in window,n.ischrome22=n.ischrome&&n.haspointerlock,n.ischrome26=n.ischrome&&"transition"in t.style,n.cantouch="ontouchstart"in document.documentElement||"ontouchstart"in window,n.hasmstouch=window.navigator.msPointerEnabled||!1,n.ismac=/^mac$/i.test(navigator.platform),n.isios=n.cantouch&&/iphone|ipad|ipod/i.test(navigator.platform),n.isios4=n.isios&&!("seal"in Object),n.isandroid=/android/i.test(navigator.userAgent),n.trstyle=!1,n.hastransform=!1,n.hastranslate3d=!1,n.transitionstyle=!1,n.hastransition=!1,n.transitionend=!1;for(var i=["transform","msTransform","webkitTransform","MozTransform","OTransform"],o=0;o<i.length;o++)if("undefined"!=typeof t.style[i[o]]){n.trstyle=i[o];break}n.hastransform=0!=n.trstyle,n.hastransform&&(t.style[n.trstyle]="translate3d(1px,2px,3px)",n.hastranslate3d=/translate3d/.test(t.style[n.trstyle])),n.transitionstyle=!1,n.prefixstyle="",n.transitionend=!1;for(var i=["transition","webkitTransition","MozTransition","OTransition","OTransition","msTransition","KhtmlTransition"],r=["","-webkit-","-moz-","-o-","-o","-ms-","-khtml-"],s=["transitionend","webkitTransitionEnd","transitionend","otransitionend","oTransitionEnd","msTransitionEnd","KhtmlTransitionEnd"],o=0;o<i.length;o++)if(i[o]in t.style){n.transitionstyle=i[o],n.prefixstyle=r[o],n.transitionend=s[o];break}return n.ischrome26&&(n.prefixstyle=r[1]),n.hastransition=n.transitionstyle,n.cursorgrabvalue=e(),n.hasmousecapture="setCapture"in t,n.hasMutationObserver=h!==!1,t=null,g=n,n},b=function(e,t){function n(){var e=b.doc.css(k.trstyle);return!(!e||"matrix"!=e.substr(0,6))&&e.replace(/^.*\((.*)\)$/g,"$1").replace(/px/g,"").split(/, +/)}function c(){var e=b.win;if("zIndex"in e)return e.zIndex();for(;e.length>0;){if(9==e[0].nodeType)return!1;var t=e.css("zIndex");if(!isNaN(t)&&0!=t)return parseInt(t);e=e.parent()}return!1}function m(e,t,n){var i=e.css(t),o=parseFloat(i);if(isNaN(o)){o=S[i]||0;var r=3==o?n?b.win.outerHeight()-b.win.innerHeight():b.win.outerWidth()-b.win.innerWidth():1;return b.isie8&&o&&(o+=1),r?o:0}return o}function p(e,t,n,i){b._bind(e,t,function(i){var i=i?i:window.event,o={original:i,target:i.target||i.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==i.type?0:1,deltaX:0,deltaZ:0,preventDefault:function(){return i.preventDefault?i.preventDefault():i.returnValue=!1,!1},stopImmediatePropagation:function(){i.stopImmediatePropagation?i.stopImmediatePropagation():i.cancelBubble=!0}};return"mousewheel"==t?(o.deltaY=-.025*i.wheelDelta,i.wheelDeltaX&&(o.deltaX=-.025*i.wheelDeltaX)):o.deltaY=i.detail,n.call(e,o)},i)}function g(e,t,n){var i,o;if(0==e.deltaMode?(i=-Math.floor(e.deltaX*(b.opt.mousescrollstep/54)),o=-Math.floor(e.deltaY*(b.opt.mousescrollstep/54))):1==e.deltaMode&&(i=-Math.floor(e.deltaX*b.opt.mousescrollstep),o=-Math.floor(e.deltaY*b.opt.mousescrollstep)),t&&b.opt.oneaxismousemode&&0==i&&o&&(i=o,o=0),i&&(b.scrollmom&&b.scrollmom.stop(),b.lastdeltax+=i,b.debounced("mousewheelx",function(){var e=b.lastdeltax;b.lastdeltax=0,b.rail.drag||b.doScrollLeftBy(e)},15)),o){if(b.opt.nativeparentscrolling&&n&&!b.ispage&&!b.zoomactive)if(o<0){if(b.getScrollTop()>=b.page.maxh)return!0}else if(b.getScrollTop()<=0)return!0;b.scrollmom&&b.scrollmom.stop(),b.lastdeltay+=o,b.debounced("mousewheely",function(){var e=b.lastdeltay;b.lastdeltay=0,b.rail.drag||b.doScrollBy(e)},15)}return e.stopImmediatePropagation(),e.preventDefault()}var b=this;if(this.version="3.5.4",this.name="nicescroll",this.me=t,this.opt={doc:l("body"),win:!1},l.extend(this.opt,f),this.opt.snapbackspeed=80,e)for(var w in b.opt)"undefined"!=typeof e[w]&&(b.opt[w]=e[w]);this.doc=b.opt.doc,this.iddoc=this.doc&&this.doc[0]?this.doc[0].id||"":"",this.ispage=/^BODY|HTML/.test(b.opt.win?b.opt.win[0].nodeName:this.doc[0].nodeName),this.haswrapper=b.opt.win!==!1,this.win=b.opt.win||(this.ispage?l(window):this.doc),this.docscroll=this.ispage&&!this.haswrapper?l(window):this.win,this.body=l("body"),this.viewport=!1,this.isfixed=!1,this.iframe=!1,this.isiframe="IFRAME"==this.doc[0].nodeName&&"IFRAME"==this.win[0].nodeName,this.istextarea="TEXTAREA"==this.win[0].nodeName,this.forcescreen=!1,this.canshowonmouseevent="scroll"!=b.opt.autohidemode,this.onmousedown=!1,this.onmouseup=!1,this.onmousemove=!1,this.onmousewheel=!1,this.onkeypress=!1,this.ongesturezoom=!1,this.onclick=!1,this.onscrollstart=!1,this.onscrollend=!1,this.onscrollcancel=!1,this.onzoomin=!1,this.onzoomout=!1,this.view=!1,this.page=!1,this.scroll={x:0,y:0},this.scrollratio={x:0,y:0},this.cursorheight=20,this.scrollvaluemax=0,this.isrtlmode=!1,this.scrollrunning=!1,this.scrollmom=!1,this.observer=!1,this.observerremover=!1;do this.id="ascrail"+s++;while(document.getElementById(this.id));this.rail=!1,this.cursor=!1,this.cursorfreezed=!1,this.selectiondrag=!1,this.zoom=!1,this.zoomactive=!1,this.hasfocus=!1,this.hasmousefocus=!1,this.visibility=!0,this.locked=!1,this.hidden=!1,this.cursoractive=!0,this.wheelprevented=!1,this.overflowx=b.opt.overflowx,this.overflowy=b.opt.overflowy,this.nativescrollingarea=!1,this.checkarea=0,this.events=[],this.saved={},this.delaylist={},this.synclist={},this.lastdeltax=0,this.lastdeltay=0,this.detected=v();var k=l.extend({},this.detected);this.canhwscroll=k.hastransform&&b.opt.hwacceleration,this.ishwscroll=this.canhwscroll&&b.haswrapper,this.istouchcapable=!1,k.cantouch&&k.ischrome&&!k.isios&&!k.isandroid&&(this.istouchcapable=!0,k.cantouch=!1),k.cantouch&&k.ismozilla&&!k.isios&&!k.isandroid&&(this.istouchcapable=!0,k.cantouch=!1),b.opt.enablemouselockapi||(k.hasmousecapture=!1,k.haspointerlock=!1),this.delayed=function(e,t,n,i){var o=b.delaylist[e],r=(new Date).getTime();return!(!i&&o&&o.tt)&&(o&&o.tt&&clearTimeout(o.tt),void(o&&o.last+n>r&&!o.tt?b.delaylist[e]={last:r+n,tt:setTimeout(function(){b&&(b.delaylist[e].tt=0,t.call())},n)}:o&&o.tt||(b.delaylist[e]={last:r,tt:0},setTimeout(function(){t.call()},0))))},this.debounced=function(e,t,n){var i=b.delaylist[e];(new Date).getTime();b.delaylist[e]=t,i||setTimeout(function(){var t=b.delaylist[e];b.delaylist[e]=!1,t.call()},n)};var _=!1;if(this.synched=function(e,t){function n(){_||(u(function(){_=!1;for(e in b.synclist){var t=b.synclist[e];t&&t.call(b),b.synclist[e]=!1}}),_=!0)}return b.synclist[e]=t,n(),e},this.unsynched=function(e){b.synclist[e]&&(b.synclist[e]=!1)},this.css=function(e,t){for(var n in t)b.saved.css.push([e,n,e.css(n)]),e.css(n,t[n])},this.scrollTop=function(e){return"undefined"==typeof e?b.getScrollTop():b.setScrollTop(e)},this.scrollLeft=function(e){return"undefined"==typeof e?b.getScrollLeft():b.setScrollLeft(e)},BezierClass=function(e,t,n,i,o,r,s){this.st=e,this.ed=t,this.spd=n,this.p1=i||0,this.p2=o||1,this.p3=r||0,this.p4=s||1,this.ts=(new Date).getTime(),this.df=this.ed-this.st},BezierClass.prototype={B2:function(e){return 3*e*e*(1-e)},B3:function(e){return 3*e*(1-e)*(1-e)},B4:function(e){return(1-e)*(1-e)*(1-e)},getNow:function(){var e=(new Date).getTime(),t=1-(e-this.ts)/this.spd,n=this.B2(t)+this.B3(t)+this.B4(t);return t<0?this.ed:this.st+Math.round(this.df*n)},update:function(e,t){return this.st=this.getNow(),this.ed=e,this.spd=t,this.ts=(new Date).getTime(),this.df=this.ed-this.st,this}},this.ishwscroll){this.doc.translate={x:0,y:0,tx:"0px",ty:"0px"},k.hastranslate3d&&k.isios&&this.doc.css("-webkit-backface-visibility","hidden"),this.getScrollTop=function(e){if(!e){var t=n();if(t)return 16==t.length?-t[13]:-t[5];if(b.timerscroll&&b.timerscroll.bz)return b.timerscroll.bz.getNow()}return b.doc.translate.y},this.getScrollLeft=function(e){if(!e){var t=n();if(t)return 16==t.length?-t[12]:-t[4];if(b.timerscroll&&b.timerscroll.bh)return b.timerscroll.bh.getNow()}return b.doc.translate.x},document.createEvent?this.notifyScrollEvent=function(e){var t=document.createEvent("UIEvents");t.initUIEvent("scroll",!1,!0,window,1),e.dispatchEvent(t)}:document.fireEvent?this.notifyScrollEvent=function(e){var t=document.createEventObject();e.fireEvent("onscroll"),t.cancelBubble=!0}:this.notifyScrollEvent=function(e,t){};var x=-1;k.hastranslate3d&&b.opt.enabletranslate3d?(this.setScrollTop=function(e,t){b.doc.translate.y=e,b.doc.translate.ty=e*-1+"px",b.doc.css(k.trstyle,"translate3d("+b.doc.translate.tx+","+b.doc.translate.ty+",0px)"),t||b.notifyScrollEvent(b.win[0])},this.setScrollLeft=function(e,t){b.doc.translate.x=e,b.doc.translate.tx=e*x+"px",b.doc.css(k.trstyle,"translate3d("+b.doc.translate.tx+","+b.doc.translate.ty+",0px)"),t||b.notifyScrollEvent(b.win[0])}):(this.setScrollTop=function(e,t){b.doc.translate.y=e,b.doc.translate.ty=e*-1+"px",b.doc.css(k.trstyle,"translate("+b.doc.translate.tx+","+b.doc.translate.ty+")"),t||b.notifyScrollEvent(b.win[0])},this.setScrollLeft=function(e,t){b.doc.translate.x=e,b.doc.translate.tx=e*x+"px",b.doc.css(k.trstyle,"translate("+b.doc.translate.tx+","+b.doc.translate.ty+")"),t||b.notifyScrollEvent(b.win[0])})}else this.getScrollTop=function(){return b.docscroll.scrollTop()},this.setScrollTop=function(e){return b.docscroll.scrollTop(e)},this.getScrollLeft=function(){return b.docscroll.scrollLeft()},this.setScrollLeft=function(e){return b.docscroll.scrollLeft(e)};this.getTarget=function(e){return!!e&&(e.target?e.target:!!e.srcElement&&e.srcElement)},this.hasParent=function(e,t){if(!e)return!1;for(var n=e.target||e.srcElement||e||!1;n&&n.id!=t;)n=n.parentNode||!1;return n!==!1};var S={thin:1,medium:3,thick:5};this.getOffset=function(){if(b.isfixed)return{top:parseFloat(b.win.css("top")),left:parseFloat(b.win.css("left"))};if(!b.viewport)return b.win.offset();var e=b.win.offset(),t=b.viewport.offset();return{top:e.top-t.top+b.viewport.scrollTop(),left:e.left-t.left+b.viewport.scrollLeft()}},this.updateScrollBar=function(e){if(b.ishwscroll)b.rail.css({height:b.win.innerHeight()}),b.railh&&b.railh.css({width:b.win.innerWidth()});else{var t=b.getOffset(),n={top:t.top,left:t.left};n.top+=m(b.win,"border-top-width",!0);(b.win.outerWidth()-b.win.innerWidth())/2;n.left+=b.rail.align?b.win.outerWidth()-m(b.win,"border-right-width")-b.rail.width:m(b.win,"border-left-width");var i=b.opt.railoffset;if(i&&(i.top&&(n.top+=i.top),b.rail.align&&i.left&&(n.left+=i.left)),b.locked||b.rail.css({top:n.top,left:n.left,height:e?e.h:b.win.innerHeight()}),b.zoom&&b.zoom.css({top:n.top+1,left:1==b.rail.align?n.left-20:n.left+b.rail.width+4}),b.railh&&!b.locked){var n={top:t.top,left:t.left},o=b.railh.align?n.top+m(b.win,"border-top-width",!0)+b.win.innerHeight()-b.railh.height:n.top+m(b.win,"border-top-width",!0),r=n.left+m(b.win,"border-left-width");b.railh.css({top:o,left:r,width:b.railh.width})}}},this.doRailClick=function(e,t,n){var i,o,r,s;b.locked||(b.cancelEvent(e),t?(i=n?b.doScrollLeft:b.doScrollTop,r=n?(e.pageX-b.railh.offset().left-b.cursorwidth/2)*b.scrollratio.x:(e.pageY-b.rail.offset().top-b.cursorheight/2)*b.scrollratio.y,i(r)):(i=n?b.doScrollLeftBy:b.doScrollBy,r=n?b.scroll.x:b.scroll.y,s=n?e.pageX-b.railh.offset().left:e.pageY-b.rail.offset().top,o=n?b.view.w:b.view.h,i(r>=s?o:-o)))},b.hasanimationframe=u,b.hascancelanimationframe=d,b.hasanimationframe?b.hascancelanimationframe||(d=function(){b.cancelAnimationFrame=!0}):(u=function(e){return setTimeout(e,15-Math.floor(+new Date/1e3)%16)},d=clearInterval),this.init=function(){function e(t){if(b.selectiondrag){if(t){var n=b.win.outerHeight(),i=t.pageY-b.selectiondrag.top;i>0&&i<n&&(i=0),i>=n&&(i-=n),b.selectiondrag.df=i}if(0!=b.selectiondrag.df){var o=2*-Math.floor(b.selectiondrag.df/6);b.doScrollBy(o),b.debounced("doselectionscroll",function(){e()},50)}}}function t(e){b.iframexd=!1;try{var t="contentDocument"in this?this.contentDocument:this.contentWindow.document;t.domain}catch(e){b.iframexd=!0,t=!1}if(b.iframexd)return"console"in window&&console.log("NiceScroll error: policy restriced iframe"),!0;if(b.forcescreen=!0,b.isiframe&&(b.iframe={doc:l(t),html:b.doc.contents().find("html")[0],body:b.doc.contents().find("body")[0]},b.getContentSize=function(){return{w:Math.max(b.iframe.html.scrollWidth,b.iframe.body.scrollWidth),h:Math.max(b.iframe.html.scrollHeight,b.iframe.body.scrollHeight)}},b.docscroll=l(b.iframe.body)),!k.isios&&b.opt.iframeautoresize&&!b.isiframe){b.win.scrollTop(0),b.doc.height("");var n=Math.max(t.getElementsByTagName("html")[0].scrollHeight,t.body.scrollHeight);b.doc.height(n)}b.lazyResize(30),k.isie7&&b.css(l(b.iframe.html),{"overflow-y":"hidden"}),b.css(l(b.iframe.body),{"overflow-y":"hidden"}),k.isios&&b.haswrapper&&b.css(l(t.body),{"-webkit-transform":"translate3d(0,0,0)"}),"contentWindow"in this?b.bind(this.contentWindow,"scroll",b.onscroll):b.bind(t,"scroll",b.onscroll),b.opt.enablemousewheel&&b.bind(t,"mousewheel",b.onmousewheel),b.opt.enablekeyboard&&b.bind(t,k.isopera?"keypress":"keydown",b.onkeypress),(k.cantouch||b.opt.touchbehavior)&&(b.bind(t,"mousedown",b.ontouchstart),b.bind(t,"mousemove",function(e){b.ontouchmove(e,!0)}),b.opt.grabcursorenabled&&k.cursorgrabvalue&&b.css(l(t.body),{cursor:k.cursorgrabvalue})),b.bind(t,"mouseup",b.ontouchend),b.zoom&&(b.opt.dblclickzoom&&b.bind(t,"dblclick",b.doZoom),b.ongesturezoom&&b.bind(t,"gestureend",b.ongesturezoom))}if(b.saved.css=[],k.isie7mobile)return!0;if(k.isoperamini)return!0;if(k.hasmstouch&&b.css(b.ispage?l("html"):b.win,{"-ms-touch-action":"none"}),b.zindex="auto",b.ispage||"auto"!=b.opt.zindex?b.zindex=b.opt.zindex:b.zindex=c()||"auto",b.ispage||"auto"==b.zindex||b.zindex>a&&(a=b.zindex),b.isie&&0==b.zindex&&"auto"==b.opt.zindex&&(b.zindex="auto"),!b.ispage||!k.cantouch&&!k.isieold&&!k.isie9mobile){var n=b.docscroll;b.ispage&&(n=b.haswrapper?b.win:b.doc),k.isie9mobile||b.css(n,{"overflow-y":"hidden"}),b.ispage&&k.isie7&&("BODY"==b.doc[0].nodeName?b.css(l("html"),{"overflow-y":"hidden"}):"HTML"==b.doc[0].nodeName&&b.css(l("body"),{"overflow-y":"hidden"})),!k.isios||b.ispage||b.haswrapper||b.css(l("body"),{"-webkit-overflow-scrolling":"touch"});var s=l(document.createElement("div"));s.css({position:"relative",top:0,float:"right",width:b.opt.cursorwidth,height:"0px","background-color":b.opt.cursorcolor,border:b.opt.cursorborder,"background-clip":"padding-box","-webkit-border-radius":b.opt.cursorborderradius,"-moz-border-radius":b.opt.cursorborderradius,"border-radius":b.opt.cursorborderradius}),s.hborder=parseFloat(s.outerHeight()-s.innerHeight()),b.cursor=s;var u=l(document.createElement("div"));u.attr("id",b.id),u.addClass("nicescroll-rails");var d,m,p=["left","right"];for(var f in p)m=p[f],d=b.opt.railpadding[m],d?u.css("padding-"+m,d+"px"):b.opt.railpadding[m]=0;u.append(s),u.width=Math.max(parseFloat(b.opt.cursorwidth),s.outerWidth())+b.opt.railpadding.left+b.opt.railpadding.right,u.css({width:u.width+"px",zIndex:b.zindex,background:b.opt.background,cursor:"default"}),u.visibility=!0,u.scrollable=!0,u.align="left"==b.opt.railalign?0:1,b.rail=u,b.rail.drag=!1;var g=!1;if(!b.opt.boxzoom||b.ispage||k.isieold||(g=document.createElement("div"),b.bind(g,"click",b.doZoom),b.zoom=l(g),b.zoom.css({cursor:"pointer","z-index":b.zindex,backgroundImage:"url("+b.opt.scriptpath+"zoomico.png)",height:18,width:18,backgroundPosition:"0px 0px"}),b.opt.dblclickzoom&&b.bind(b.win,"dblclick",b.doZoom),k.cantouch&&b.opt.gesturezoom&&(b.ongesturezoom=function(e){return e.scale>1.5&&b.doZoomIn(e),e.scale<.8&&b.doZoomOut(e),b.cancelEvent(e)},b.bind(b.win,"gestureend",b.ongesturezoom))),b.railh=!1,b.opt.horizrailenabled){b.css(n,{"overflow-x":"hidden"});var s=l(document.createElement("div"));s.css({position:"relative",top:0,height:b.opt.cursorwidth,width:"0px","background-color":b.opt.cursorcolor,border:b.opt.cursorborder,"background-clip":"padding-box","-webkit-border-radius":b.opt.cursorborderradius,"-moz-border-radius":b.opt.cursorborderradius,"border-radius":b.opt.cursorborderradius}),s.wborder=parseFloat(s.outerWidth()-s.innerWidth()),b.cursorh=s;var v=l(document.createElement("div"));v.attr("id",b.id+"-hr"),v.addClass("nicescroll-rails"),v.height=Math.max(parseFloat(b.opt.cursorwidth),s.outerHeight()),v.css({height:v.height+"px",zIndex:b.zindex,background:b.opt.background}),v.append(s),v.visibility=!0,v.scrollable=!0,v.align="top"==b.opt.railvalign?0:1,b.railh=v,b.railh.drag=!1}if(b.ispage)u.css({position:"fixed",top:"0px",height:"100%"}),u.align?u.css({right:"0px"}):u.css({left:"0px"}),b.body.append(u),b.railh&&(v.css({position:"fixed",left:"0px",width:"100%"}),v.align?v.css({bottom:"0px"}):v.css({top:"0px"}),b.body.append(v));else{if(b.ishwscroll){"static"==b.win.css("position")&&b.css(b.win,{position:"relative"});var w="HTML"==b.win[0].nodeName?b.body:b.win;b.zoom&&(b.zoom.css({position:"absolute",top:1,right:0,"margin-right":u.width+4}),w.append(b.zoom)),u.css({position:"absolute",top:0}),u.align?u.css({right:0}):u.css({left:0}),w.append(u),v&&(v.css({position:"absolute",left:0,bottom:0}),v.align?v.css({bottom:0}):v.css({top:0}),w.append(v))}else{b.isfixed="fixed"==b.win.css("position");var _=b.isfixed?"fixed":"absolute";b.isfixed||(b.viewport=b.getViewport(b.win[0])),b.viewport&&(b.body=b.viewport,0==/fixed|relative|absolute/.test(b.viewport.css("position"))&&b.css(b.viewport,{position:"relative"})),u.css({position:_}),b.zoom&&b.zoom.css({position:_}),b.updateScrollBar(),b.body.append(u),b.zoom&&b.body.append(b.zoom),b.railh&&(v.css({position:_}),b.body.append(v))}k.isios&&b.css(b.win,{"-webkit-tap-highlight-color":"rgba(0,0,0,0)","-webkit-touch-callout":"none"}),k.isie&&b.opt.disableoutline&&b.win.attr("hideFocus","true"),k.iswebkit&&b.opt.disableoutline&&b.win.css({outline:"none"})}if(b.opt.autohidemode===!1?(b.autohidedom=!1,b.rail.css({opacity:b.opt.cursoropacitymax}),b.railh&&b.railh.css({opacity:b.opt.cursoropacitymax})):b.opt.autohidemode===!0||"leave"===b.opt.autohidemode?(b.autohidedom=l().add(b.rail),k.isie8&&(b.autohidedom=b.autohidedom.add(b.cursor)),b.railh&&(b.autohidedom=b.autohidedom.add(b.railh)),b.railh&&k.isie8&&(b.autohidedom=b.autohidedom.add(b.cursorh))):"scroll"==b.opt.autohidemode?(b.autohidedom=l().add(b.rail),b.railh&&(b.autohidedom=b.autohidedom.add(b.railh))):"cursor"==b.opt.autohidemode?(b.autohidedom=l().add(b.cursor),b.railh&&(b.autohidedom=b.autohidedom.add(b.cursorh))):"hidden"==b.opt.autohidemode&&(b.autohidedom=!1,b.hide(),b.locked=!1),k.isie9mobile){b.scrollmom=new y(b),b.onmangotouch=function(e){var t=b.getScrollTop(),n=b.getScrollLeft();if(t==b.scrollmom.lastscrolly&&n==b.scrollmom.lastscrollx)return!0;var i=t-b.mangotouch.sy,o=n-b.mangotouch.sx,r=Math.round(Math.sqrt(Math.pow(o,2)+Math.pow(i,2)));if(0!=r){var s=i<0?-1:1,a=o<0?-1:1,l=+new Date;if(b.mangotouch.lazy&&clearTimeout(b.mangotouch.lazy),l-b.mangotouch.tm>80||b.mangotouch.dry!=s||b.mangotouch.drx!=a)b.scrollmom.stop(),b.scrollmom.reset(n,t),b.mangotouch.sy=t,b.mangotouch.ly=t,b.mangotouch.sx=n,b.mangotouch.lx=n,b.mangotouch.dry=s,b.mangotouch.drx=a,b.mangotouch.tm=l;else{b.scrollmom.stop(),b.scrollmom.update(b.mangotouch.sx-o,b.mangotouch.sy-i);l-b.mangotouch.tm;b.mangotouch.tm=l;var c=Math.max(Math.abs(b.mangotouch.ly-t),Math.abs(b.mangotouch.lx-n));b.mangotouch.ly=t,b.mangotouch.lx=n,c>2&&(b.mangotouch.lazy=setTimeout(function(){b.mangotouch.lazy=!1,b.mangotouch.dry=0,b.mangotouch.drx=0,b.mangotouch.tm=0,b.scrollmom.doMomentum(30)},100))}}};var x=b.getScrollTop(),S=b.getScrollLeft();b.mangotouch={sy:x,ly:x,dry:0,sx:S,lx:S,drx:0,lazy:!1,tm:0},b.bind(b.docscroll,"scroll",b.onmangotouch)}else{if(k.cantouch||b.istouchcapable||b.opt.touchbehavior||k.hasmstouch){b.scrollmom=new y(b),b.ontouchstart=function(e){if(e.pointerType&&2!=e.pointerType)return!1;if(b.hasmoving=!1,!b.locked){if(k.hasmstouch)for(var t=!!e.target&&e.target;t;){var n=l(t).getNiceScroll();if(n.length>0&&n[0].me==b.me)break;if(n.length>0)return!1;if("DIV"==t.nodeName&&t.id==b.id)break;t=!!t.parentNode&&t.parentNode}b.cancelScroll();var t=b.getTarget(e);if(t){var i=/INPUT/i.test(t.nodeName)&&/range/i.test(t.type);if(i)return b.stopPropagation(e)}if(!("clientX"in e)&&"changedTouches"in e&&(e.clientX=e.changedTouches[0].clientX,e.clientY=e.changedTouches[0].clientY),b.forcescreen){var o=e,e={original:e.original?e.original:e};e.clientX=o.screenX,e.clientY=o.screenY}if(b.rail.drag={x:e.clientX,y:e.clientY,sx:b.scroll.x,sy:b.scroll.y,st:b.getScrollTop(),sl:b.getScrollLeft(),pt:2,dl:!1},b.ispage||!b.opt.directionlockdeadzone)b.rail.drag.dl="f";else{var r={w:l(window).width(),h:l(window).height()},s={w:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),h:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)},a=Math.max(0,s.h-r.h),c=Math.max(0,s.w-r.w);!b.rail.scrollable&&b.railh.scrollable?b.rail.drag.ck=a>0&&"v":b.rail.scrollable&&!b.railh.scrollable?b.rail.drag.ck=c>0&&"h":b.rail.drag.ck=!1,b.rail.drag.ck||(b.rail.drag.dl="f")}if(b.opt.touchbehavior&&b.isiframe&&k.isie){var u=b.win.position();b.rail.drag.x+=u.left,b.rail.drag.y+=u.top}if(b.hasmoving=!1,b.lastmouseup=!1,b.scrollmom.reset(e.clientX,e.clientY),!k.cantouch&&!this.istouchcapable&&!k.hasmstouch){var d=!!t&&/INPUT|SELECT|TEXTAREA/i.test(t.nodeName);if(!d)return!b.ispage&&k.hasmousecapture&&t.setCapture(),b.opt.touchbehavior?(t.onclick&&!t._onclick&&(t._onclick=t.onclick,t.onclick=function(e){return!b.hasmoving&&void t._onclick.call(this,e)}),b.cancelEvent(e)):b.stopPropagation(e);/SUBMIT|CANCEL|BUTTON/i.test(l(t).attr("type"))&&(pc={tg:t,click:!1},b.preventclick=pc)}}},b.ontouchend=function(e){return(!e.pointerType||2==e.pointerType)&&(b.rail.drag&&2==b.rail.drag.pt&&(b.scrollmom.doMomentum(),b.rail.drag=!1,b.hasmoving&&(b.lastmouseup=!0,b.hideCursor(),k.hasmousecapture&&document.releaseCapture(),!k.cantouch))?b.cancelEvent(e):void 0)};var C=b.opt.touchbehavior&&b.isiframe&&!k.hasmousecapture;b.ontouchmove=function(e,t){if(e.pointerType&&2!=e.pointerType)return!1;if(b.rail.drag&&2==b.rail.drag.pt){if(k.cantouch&&"undefined"==typeof e.original)return!0;b.hasmoving=!0,b.preventclick&&!b.preventclick.click&&(b.preventclick.click=b.preventclick.tg.onclick||!1,b.preventclick.tg.onclick=b.onpreventclick);var n=l.extend({original:e},e);if(e=n,"changedTouches"in e&&(e.clientX=e.changedTouches[0].clientX,e.clientY=e.changedTouches[0].clientY),b.forcescreen){var i=e,e={original:e.original?e.original:e};e.clientX=i.screenX,e.clientY=i.screenY}var o=ofy=0;if(C&&!t){var r=b.win.position();o=-r.left,ofy=-r.top}var s=e.clientY+ofy,a=s-b.rail.drag.y,c=e.clientX+o,u=c-b.rail.drag.x,d=b.rail.drag.st-a;if(b.ishwscroll&&b.opt.bouncescroll?d<0?d=Math.round(d/2):d>b.page.maxh&&(d=b.page.maxh+Math.round((d-b.page.maxh)/2)):(d<0&&(d=0,s=0),d>b.page.maxh&&(d=b.page.maxh,s=0)),b.railh&&b.railh.scrollable){var m=b.rail.drag.sl-u;b.ishwscroll&&b.opt.bouncescroll?m<0?m=Math.round(m/2):m>b.page.maxw&&(m=b.page.maxw+Math.round((m-b.page.maxw)/2)):(m<0&&(m=0,c=0),m>b.page.maxw&&(m=b.page.maxw,c=0))}var p=!1;if(b.rail.drag.dl)p=!0,"v"==b.rail.drag.dl?m=b.rail.drag.sl:"h"==b.rail.drag.dl&&(d=b.rail.drag.st);else{var h=Math.abs(a),f=Math.abs(u),g=b.opt.directionlockdeadzone;if("v"==b.rail.drag.ck){if(h>g&&f<=.3*h)return b.rail.drag=!1,!0;f>g&&(b.rail.drag.dl="f",l("body").scrollTop(l("body").scrollTop()))}else if("h"==b.rail.drag.ck){if(f>g&&h<=.3*f)return b.rail.drag=!1,!0;h>g&&(b.rail.drag.dl="f",l("body").scrollLeft(l("body").scrollLeft()))}}if(b.synched("touchmove",function(){b.rail.drag&&2==b.rail.drag.pt&&(b.prepareTransition&&b.prepareTransition(0),b.rail.scrollable&&b.setScrollTop(d),b.scrollmom.update(c,s),b.railh&&b.railh.scrollable?(b.setScrollLeft(m),b.showCursor(d,m)):b.showCursor(d),k.isie10&&document.selection.clear())}),k.ischrome&&b.istouchcapable&&(p=!1),p)return b.cancelEvent(e)}}}b.onmousedown=function(e,t){if(!b.rail.drag||1==b.rail.drag.pt){if(b.locked)return b.cancelEvent(e);b.cancelScroll(),b.rail.drag={x:e.clientX,y:e.clientY,sx:b.scroll.x,sy:b.scroll.y,pt:1,hr:!!t};var n=b.getTarget(e);return!b.ispage&&k.hasmousecapture&&n.setCapture(),b.isiframe&&!k.hasmousecapture&&(b.saved.csspointerevents=b.doc.css("pointer-events"),b.css(b.doc,{"pointer-events":"none"})),b.hasmoving=!1,b.cancelEvent(e)}},b.onmouseup=function(e){if(b.rail.drag){if(k.hasmousecapture&&document.releaseCapture(),b.isiframe&&!k.hasmousecapture&&b.doc.css("pointer-events",b.saved.csspointerevents),
1!=b.rail.drag.pt)return;return b.rail.drag=!1,b.hasmoving&&b.triggerScrollEnd(),b.cancelEvent(e)}},b.onmousemove=function(e){if(b.rail.drag){if(1!=b.rail.drag.pt)return;if(k.ischrome&&0==e.which)return b.onmouseup(e);if(b.cursorfreezed=!0,b.hasmoving=!0,b.rail.drag.hr){b.scroll.x=b.rail.drag.sx+(e.clientX-b.rail.drag.x),b.scroll.x<0&&(b.scroll.x=0);var t=b.scrollvaluemaxw;b.scroll.x>t&&(b.scroll.x=t)}else{b.scroll.y=b.rail.drag.sy+(e.clientY-b.rail.drag.y),b.scroll.y<0&&(b.scroll.y=0);var n=b.scrollvaluemax;b.scroll.y>n&&(b.scroll.y=n)}return b.synched("mousemove",function(){b.rail.drag&&1==b.rail.drag.pt&&(b.showCursor(),b.rail.drag.hr?b.doScrollLeft(Math.round(b.scroll.x*b.scrollratio.x),b.opt.cursordragspeed):b.doScrollTop(Math.round(b.scroll.y*b.scrollratio.y),b.opt.cursordragspeed))}),b.cancelEvent(e)}},k.cantouch||b.opt.touchbehavior?(b.onpreventclick=function(e){if(b.preventclick)return b.preventclick.tg.onclick=b.preventclick.click,b.preventclick=!1,b.cancelEvent(e)},b.bind(b.win,"mousedown",b.ontouchstart),b.onclick=!k.isios&&function(e){return!b.lastmouseup||(b.lastmouseup=!1,b.cancelEvent(e))},b.opt.grabcursorenabled&&k.cursorgrabvalue&&(b.css(b.ispage?b.doc:b.win,{cursor:k.cursorgrabvalue}),b.css(b.rail,{cursor:k.cursorgrabvalue}))):("getSelection"in document?b.hasTextSelected=function(){return document.getSelection().rangeCount>0}:"selection"in document?b.hasTextSelected=function(){return"None"!=document.selection.type}:b.hasTextSelected=function(){return!1},b.onselectionstart=function(e){b.ispage||(b.selectiondrag=b.win.offset())},b.onselectionend=function(e){b.selectiondrag=!1},b.onselectiondrag=function(t){b.selectiondrag&&b.hasTextSelected()&&b.debounced("selectionscroll",function(){e(t)},250)}),k.hasmstouch&&(b.css(b.rail,{"-ms-touch-action":"none"}),b.css(b.cursor,{"-ms-touch-action":"none"}),b.bind(b.win,"MSPointerDown",b.ontouchstart),b.bind(document,"MSPointerUp",b.ontouchend),b.bind(document,"MSPointerMove",b.ontouchmove),b.bind(b.cursor,"MSGestureHold",function(e){e.preventDefault()}),b.bind(b.cursor,"contextmenu",function(e){e.preventDefault()})),this.istouchcapable&&(b.bind(b.win,"touchstart",b.ontouchstart),b.bind(document,"touchend",b.ontouchend),b.bind(document,"touchcancel",b.ontouchend),b.bind(document,"touchmove",b.ontouchmove)),b.bind(b.cursor,"mousedown",b.onmousedown),b.bind(b.cursor,"mouseup",b.onmouseup),b.railh&&(b.bind(b.cursorh,"mousedown",function(e){b.onmousedown(e,!0)}),b.bind(b.cursorh,"mouseup",b.onmouseup)),(b.opt.cursordragontouch||!k.cantouch&&!b.opt.touchbehavior)&&(b.rail.css({cursor:"default"}),b.railh&&b.railh.css({cursor:"default"}),b.jqbind(b.rail,"mouseenter",function(){return!!b.win.is(":visible")&&(b.canshowonmouseevent&&b.showCursor(),void(b.rail.active=!0))}),b.jqbind(b.rail,"mouseleave",function(){b.rail.active=!1,b.rail.drag||b.hideCursor()}),b.opt.sensitiverail&&(b.bind(b.rail,"click",function(e){b.doRailClick(e,!1,!1)}),b.bind(b.rail,"dblclick",function(e){b.doRailClick(e,!0,!1)}),b.bind(b.cursor,"click",function(e){b.cancelEvent(e)}),b.bind(b.cursor,"dblclick",function(e){b.cancelEvent(e)})),b.railh&&(b.jqbind(b.railh,"mouseenter",function(){return!!b.win.is(":visible")&&(b.canshowonmouseevent&&b.showCursor(),void(b.rail.active=!0))}),b.jqbind(b.railh,"mouseleave",function(){b.rail.active=!1,b.rail.drag||b.hideCursor()}),b.opt.sensitiverail&&(b.bind(b.railh,"click",function(e){b.doRailClick(e,!1,!0)}),b.bind(b.railh,"dblclick",function(e){b.doRailClick(e,!0,!0)}),b.bind(b.cursorh,"click",function(e){b.cancelEvent(e)}),b.bind(b.cursorh,"dblclick",function(e){b.cancelEvent(e)})))),k.cantouch||b.opt.touchbehavior?(b.bind(k.hasmousecapture?b.win:document,"mouseup",b.ontouchend),b.bind(document,"mousemove",b.ontouchmove),b.onclick&&b.bind(document,"click",b.onclick),b.opt.cursordragontouch&&(b.bind(b.cursor,"mousedown",b.onmousedown),b.bind(b.cursor,"mousemove",b.onmousemove),b.cursorh&&b.bind(b.cursorh,"mousedown",function(e){b.onmousedown(e,!0)}),b.cursorh&&b.bind(b.cursorh,"mousemove",b.onmousemove))):(b.bind(k.hasmousecapture?b.win:document,"mouseup",b.onmouseup),b.bind(document,"mousemove",b.onmousemove),b.onclick&&b.bind(document,"click",b.onclick),!b.ispage&&b.opt.enablescrollonselection&&(b.bind(b.win[0],"mousedown",b.onselectionstart),b.bind(document,"mouseup",b.onselectionend),b.bind(b.cursor,"mouseup",b.onselectionend),b.cursorh&&b.bind(b.cursorh,"mouseup",b.onselectionend),b.bind(document,"mousemove",b.onselectiondrag)),b.zoom&&(b.jqbind(b.zoom,"mouseenter",function(){b.canshowonmouseevent&&b.showCursor(),b.rail.active=!0}),b.jqbind(b.zoom,"mouseleave",function(){b.rail.active=!1,b.rail.drag||b.hideCursor()}))),b.opt.enablemousewheel&&(b.isiframe||b.bind(k.isie&&b.ispage?document:b.win,"mousewheel",b.onmousewheel),b.bind(b.rail,"mousewheel",b.onmousewheel),b.railh&&b.bind(b.railh,"mousewheel",b.onmousewheelhr)),b.ispage||k.cantouch||/HTML|^BODY/.test(b.win[0].nodeName)||(b.win.attr("tabindex")||b.win.attr({tabindex:r++}),b.jqbind(b.win,"focus",function(e){i=b.getTarget(e).id||!0,b.hasfocus=!0,b.canshowonmouseevent&&b.noticeCursor()}),b.jqbind(b.win,"blur",function(e){i=!1,b.hasfocus=!1}),b.jqbind(b.win,"mouseenter",function(e){o=b.getTarget(e).id||!0,b.hasmousefocus=!0,b.canshowonmouseevent&&b.noticeCursor()}),b.jqbind(b.win,"mouseleave",function(){o=!1,b.hasmousefocus=!1,b.rail.drag||b.hideCursor()}))}if(b.onkeypress=function(e){if(b.locked&&0==b.page.maxh)return!0;e=e?e:window.e;var t=b.getTarget(e);if(t&&/INPUT|TEXTAREA|SELECT|OPTION/.test(t.nodeName)){var n=t.getAttribute("type")||t.type||!1;if(!n||!/submit|button|cancel/i.tp)return!0}if(l(t).attr("contenteditable"))return!0;if(b.hasfocus||b.hasmousefocus&&!i||b.ispage&&!i&&!o){var r=e.keyCode;if(b.locked&&27!=r)return b.cancelEvent(e);var s=e.ctrlKey||!1,a=e.shiftKey||!1,c=!1;switch(r){case 38:case 63233:b.doScrollBy(72),c=!0;break;case 40:case 63235:b.doScrollBy(-72),c=!0;break;case 37:case 63232:b.railh&&(s?b.doScrollLeft(0):b.doScrollLeftBy(72),c=!0);break;case 39:case 63234:b.railh&&(s?b.doScrollLeft(b.page.maxw):b.doScrollLeftBy(-72),c=!0);break;case 33:case 63276:b.doScrollBy(b.view.h),c=!0;break;case 34:case 63277:b.doScrollBy(-b.view.h),c=!0;break;case 36:case 63273:b.railh&&s?b.doScrollPos(0,0):b.doScrollTo(0),c=!0;break;case 35:case 63275:b.railh&&s?b.doScrollPos(b.page.maxw,b.page.maxh):b.doScrollTo(b.page.maxh),c=!0;break;case 32:b.opt.spacebarenabled&&(a?b.doScrollBy(b.view.h):b.doScrollBy(-b.view.h),c=!0);break;case 27:b.zoomactive&&(b.doZoom(),c=!0)}if(c)return b.cancelEvent(e)}},b.opt.enablekeyboard&&b.bind(document,k.isopera&&!k.isopera12?"keypress":"keydown",b.onkeypress),b.bind(document,"keydown",function(e){var t=e.ctrlKey||!1;t&&(b.wheelprevented=!0)}),b.bind(document,"keyup",function(e){var t=e.ctrlKey||!1;t||(b.wheelprevented=!1)}),b.bind(window,"resize",b.lazyResize),b.bind(window,"orientationchange",b.lazyResize),b.bind(window,"load",b.lazyResize),k.ischrome&&!b.ispage&&!b.haswrapper){var I=b.win.attr("style"),T=parseFloat(b.win.css("width"))+1;b.win.css("width",T),b.synched("chromefix",function(){b.win.attr("style",I)})}b.onAttributeChange=function(e){b.lazyResize(250)},b.ispage||b.haswrapper||(h!==!1?(b.observer=new h(function(e){e.forEach(b.onAttributeChange)}),b.observer.observe(b.win[0],{childList:!0,characterData:!1,attributes:!0,subtree:!1}),b.observerremover=new h(function(e){e.forEach(function(e){if(e.removedNodes.length>0)for(var t in e.removedNodes)if(e.removedNodes[t]==b.win[0])return b.remove()})}),b.observerremover.observe(b.win[0].parentNode,{childList:!0,characterData:!1,attributes:!1,subtree:!1})):(b.bind(b.win,k.isie&&!k.isie9?"propertychange":"DOMAttrModified",b.onAttributeChange),k.isie9&&b.win[0].attachEvent("onpropertychange",b.onAttributeChange),b.bind(b.win,"DOMNodeRemoved",function(e){e.target==b.win[0]&&b.remove()}))),!b.ispage&&b.opt.boxzoom&&b.bind(window,"resize",b.resizeZoom),b.istextarea&&b.bind(b.win,"mouseup",b.lazyResize),b.lazyResize(30)}"IFRAME"==this.doc[0].nodeName&&(this.doc[0].readyState&&"complete"==this.doc[0].readyState&&setTimeout(function(){t.call(b.doc[0],!1)},500),b.bind(this.doc,"load",t))},this.showCursor=function(e,t){b.cursortimeout&&(clearTimeout(b.cursortimeout),b.cursortimeout=0),b.rail&&(b.autohidedom&&(b.autohidedom.stop().css({opacity:b.opt.cursoropacitymax}),b.cursoractive=!0),b.rail.drag&&1==b.rail.drag.pt||("undefined"!=typeof e&&e!==!1&&(b.scroll.y=Math.round(1*e/b.scrollratio.y)),"undefined"!=typeof t&&(b.scroll.x=Math.round(1*t/b.scrollratio.x))),b.cursor.css({height:b.cursorheight,top:b.scroll.y}),b.cursorh&&(!b.rail.align&&b.rail.visibility?b.cursorh.css({width:b.cursorwidth,left:b.scroll.x+b.rail.width}):b.cursorh.css({width:b.cursorwidth,left:b.scroll.x}),b.cursoractive=!0),b.zoom&&b.zoom.stop().css({opacity:b.opt.cursoropacitymax}))},this.hideCursor=function(e){b.cursortimeout||b.rail&&b.autohidedom&&(b.hasmousefocus&&"leave"==b.opt.autohidemode||(b.cursortimeout=setTimeout(function(){b.rail.active&&b.showonmouseevent||(b.autohidedom.stop().animate({opacity:b.opt.cursoropacitymin}),b.zoom&&b.zoom.stop().animate({opacity:b.opt.cursoropacitymin}),b.cursoractive=!1),b.cursortimeout=0},e||b.opt.hidecursordelay)))},this.noticeCursor=function(e,t,n){b.showCursor(t,n),b.rail.active||b.hideCursor(e)},this.getContentSize=b.ispage?function(){return{w:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),h:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}}:b.haswrapper?function(){return{w:b.doc.outerWidth()+parseInt(b.win.css("paddingLeft"))+parseInt(b.win.css("paddingRight")),h:b.doc.outerHeight()+parseInt(b.win.css("paddingTop"))+parseInt(b.win.css("paddingBottom"))}}:function(){return{w:b.docscroll[0].scrollWidth,h:b.docscroll[0].scrollHeight}},this.onResize=function(e,t){if(!b||!b.win)return!1;if(!b.haswrapper&&!b.ispage){if("none"==b.win.css("display"))return b.visibility&&b.hideRail().hideRailHr(),!1;b.hidden||b.visibility||b.showRail().showRailHr()}var n=b.page.maxh,i=b.page.maxw,o={h:b.view.h,w:b.view.w};if(b.view={w:b.ispage?b.win.width():parseInt(b.win[0].clientWidth),h:b.ispage?b.win.height():parseInt(b.win[0].clientHeight)},b.page=t?t:b.getContentSize(),b.page.maxh=Math.max(0,b.page.h-b.view.h),b.page.maxw=Math.max(0,b.page.w-b.view.w),b.page.maxh==n&&b.page.maxw==i&&b.view.w==o.w){if(b.ispage)return b;var r=b.win.offset();if(b.lastposition){var s=b.lastposition;if(s.top==r.top&&s.left==r.left)return b}b.lastposition=r}if(0==b.page.maxh?(b.hideRail(),b.scrollvaluemax=0,b.scroll.y=0,b.scrollratio.y=0,b.cursorheight=0,b.setScrollTop(0),b.rail.scrollable=!1):b.rail.scrollable=!0,0==b.page.maxw?(b.hideRailHr(),b.scrollvaluemaxw=0,b.scroll.x=0,b.scrollratio.x=0,b.cursorwidth=0,b.setScrollLeft(0),b.railh.scrollable=!1):b.railh.scrollable=!0,b.locked=0==b.page.maxh&&0==b.page.maxw,b.locked)return b.ispage||b.updateScrollBar(b.view),!1;b.hidden||b.visibility?b.hidden||b.railh.visibility||b.showRailHr():b.showRail().showRailHr(),b.istextarea&&b.win.css("resize")&&"none"!=b.win.css("resize")&&(b.view.h-=20),b.cursorheight=Math.min(b.view.h,Math.round(b.view.h*(b.view.h/b.page.h))),b.cursorheight=b.opt.cursorfixedheight?b.opt.cursorfixedheight:Math.max(b.opt.cursorminheight,b.cursorheight),b.cursorwidth=Math.min(b.view.w,Math.round(b.view.w*(b.view.w/b.page.w))),b.cursorwidth=b.opt.cursorfixedheight?b.opt.cursorfixedheight:Math.max(b.opt.cursorminheight,b.cursorwidth),b.scrollvaluemax=b.view.h-b.cursorheight-b.cursor.hborder,b.railh&&(b.railh.width=b.page.maxh>0?b.view.w-b.rail.width:b.view.w,b.scrollvaluemaxw=b.railh.width-b.cursorwidth-b.cursorh.wborder),b.ispage||b.updateScrollBar(b.view),b.scrollratio={x:b.page.maxw/b.scrollvaluemaxw,y:b.page.maxh/b.scrollvaluemax};var a=b.getScrollTop();return a>b.page.maxh?b.doScrollTop(b.page.maxh):(b.scroll.y=Math.round(b.getScrollTop()*(1/b.scrollratio.y)),b.scroll.x=Math.round(b.getScrollLeft()*(1/b.scrollratio.x)),b.cursoractive&&b.noticeCursor()),b.scroll.y&&0==b.getScrollTop()&&b.doScrollTo(Math.floor(b.scroll.y*b.scrollratio.y)),b},this.resize=b.onResize,this.lazyResize=function(e){return e=isNaN(e)?30:e,b.delayed("resize",b.resize,e),b},this._bind=function(e,t,n,i){b.events.push({e:e,n:t,f:n,b:i,q:!1}),e.addEventListener?e.addEventListener(t,n,i||!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},this.jqbind=function(e,t,n){b.events.push({e:e,n:t,f:n,q:!0}),l(e).bind(t,n)},this.bind=function(e,t,n,i){var o="jquery"in e?e[0]:e;if("mousewheel"==t)if("onwheel"in b.win)b._bind(o,"wheel",n,i||!1);else{var r="undefined"!=typeof document.onmousewheel?"mousewheel":"DOMMouseScroll";p(o,r,n,i||!1),"DOMMouseScroll"==r&&p(o,"MozMousePixelScroll",n,i||!1)}else if(o.addEventListener){if(k.cantouch&&/mouseup|mousedown|mousemove/.test(t)){var s="mousedown"==t?"touchstart":"mouseup"==t?"touchend":"touchmove";b._bind(o,s,function(e){if(e.touches){if(e.touches.length<2){var t=e.touches.length?e.touches[0]:e;t.original=e,n.call(this,t)}}else if(e.changedTouches){var t=e.changedTouches[0];t.original=e,n.call(this,t)}},i||!1)}b._bind(o,t,n,i||!1),k.cantouch&&"mouseup"==t&&b._bind(o,"touchcancel",n,i||!1)}else b._bind(o,t,function(e){return e=e||window.event||!1,e&&e.srcElement&&(e.target=e.srcElement),"pageY"in e||(e.pageX=e.clientX+document.documentElement.scrollLeft,e.pageY=e.clientY+document.documentElement.scrollTop),n.call(o,e)!==!1&&i!==!1||b.cancelEvent(e)})},this._unbind=function(e,t,n,i){e.removeEventListener?e.removeEventListener(t,n,i):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=!1},this.unbindAll=function(){for(var e=0;e<b.events.length;e++){var t=b.events[e];t.q?t.e.unbind(t.n,t.f):b._unbind(t.e,t.n,t.f,t.b)}},this.cancelEvent=function(e){var e=e.original?e.original:e?e:window.event||!1;return!!e&&(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.preventManipulation&&e.preventManipulation(),e.cancelBubble=!0,e.cancel=!0,e.returnValue=!1,!1)},this.stopPropagation=function(e){var e=e.original?e.original:e?e:window.event||!1;return!!e&&(e.stopPropagation?e.stopPropagation():(e.cancelBubble&&(e.cancelBubble=!0),!1))},this.showRail=function(){return 0==b.page.maxh||!b.ispage&&"none"==b.win.css("display")||(b.visibility=!0,b.rail.visibility=!0,b.rail.css("display","block")),b},this.showRailHr=function(){return b.railh?(0==b.page.maxw||!b.ispage&&"none"==b.win.css("display")||(b.railh.visibility=!0,b.railh.css("display","block")),b):b},this.hideRail=function(){return b.visibility=!1,b.rail.visibility=!1,b.rail.css("display","none"),b},this.hideRailHr=function(){return b.railh?(b.railh.visibility=!1,b.railh.css("display","none"),b):b},this.show=function(){return b.hidden=!1,b.locked=!1,b.showRail().showRailHr()},this.hide=function(){return b.hidden=!0,b.locked=!0,b.hideRail().hideRailHr()},this.toggle=function(){return b.hidden?b.show():b.hide()},this.remove=function(){b.stop(),b.cursortimeout&&clearTimeout(b.cursortimeout),b.doZoomOut(),b.unbindAll(),k.isie9&&b.win[0].detachEvent("onpropertychange",b.onAttributeChange),b.observer!==!1&&b.observer.disconnect(),b.observerremover!==!1&&b.observerremover.disconnect(),b.events=null,b.cursor&&b.cursor.remove(),b.cursorh&&b.cursorh.remove(),b.rail&&b.rail.remove(),b.railh&&b.railh.remove(),b.zoom&&b.zoom.remove();for(var e=0;e<b.saved.css.length;e++){var t=b.saved.css[e];t[0].css(t[1],"undefined"==typeof t[2]?"":t[2])}b.saved=!1,b.me.data("__nicescroll","");var n=l.nicescroll;n.each(function(e){if(this&&this.id===b.id){delete n[e];for(var t=++e;t<n.length;t++,e++)n[e]=n[t];n.length--,n.length&&delete n[n.length]}});for(var i in b)b[i]=null,delete b[i];b=null},this.scrollstart=function(e){return this.onscrollstart=e,b},this.scrollend=function(e){return this.onscrollend=e,b},this.scrollcancel=function(e){return this.onscrollcancel=e,b},this.zoomin=function(e){return this.onzoomin=e,b},this.zoomout=function(e){return this.onzoomout=e,b},this.isScrollable=function(e){var t=e.target?e.target:e;if("OPTION"==t.nodeName)return!0;for(;t&&1==t.nodeType&&!/^BODY|HTML/.test(t.nodeName);){var n=l(t),i=n.css("overflowY")||n.css("overflowX")||n.css("overflow")||"";if(/scroll|auto/.test(i))return t.clientHeight!=t.scrollHeight;t=!!t.parentNode&&t.parentNode}return!1},this.getViewport=function(e){for(var t=!(!e||!e.parentNode)&&e.parentNode;t&&1==t.nodeType&&!/^BODY|HTML/.test(t.nodeName);){var n=l(t);if(/fixed|absolute/.test(n.css("position")))return n;var i=n.css("overflowY")||n.css("overflowX")||n.css("overflow")||"";if(/scroll|auto/.test(i)&&t.clientHeight!=t.scrollHeight)return n;if(n.getNiceScroll().length>0)return n;t=!!t.parentNode&&t.parentNode}return!!t&&l(t)},this.triggerScrollEnd=function(){if(b.onscrollend){var e=b.getScrollLeft(),t=b.getScrollTop(),n={type:"scrollend",current:{x:e,y:t},end:{x:e,y:t}};b.onscrollend.call(b,n)}},this.onmousewheel=function(e){if(!b.wheelprevented){if(b.locked)return b.debounced("checkunlock",b.resize,250),!0;if(b.rail.drag)return b.cancelEvent(e);if("auto"==b.opt.oneaxismousemode&&0!=e.deltaX&&(b.opt.oneaxismousemode=!1),b.opt.oneaxismousemode&&0==e.deltaX&&!b.rail.scrollable)return!b.railh||!b.railh.scrollable||b.onmousewheelhr(e);var t=+new Date,n=!1;if(b.opt.preservenativescrolling&&b.checkarea+600<t&&(b.nativescrollingarea=b.isScrollable(e),n=!0),b.checkarea=t,b.nativescrollingarea)return!0;var i=g(e,!1,n);return i&&(b.checkarea=0),i}},this.onmousewheelhr=function(e){if(!b.wheelprevented){if(b.locked||!b.railh.scrollable)return!0;if(b.rail.drag)return b.cancelEvent(e);var t=+new Date,n=!1;return b.opt.preservenativescrolling&&b.checkarea+600<t&&(b.nativescrollingarea=b.isScrollable(e),n=!0),b.checkarea=t,!!b.nativescrollingarea||(b.locked?b.cancelEvent(e):g(e,!0,n))}},this.stop=function(){return b.cancelScroll(),b.scrollmon&&b.scrollmon.stop(),b.cursorfreezed=!1,b.scroll.y=Math.round(b.getScrollTop()*(1/b.scrollratio.y)),b.noticeCursor(),b},this.getTransitionSpeed=function(e){var t=Math.round(10*b.opt.scrollspeed),n=Math.min(t,Math.round(e/20*b.opt.scrollspeed));return n>20?n:0},b.opt.smoothscroll?b.ishwscroll&&k.hastransition&&b.opt.usetransition?(this.prepareTransition=function(e,t){var n=t?e>20?e:0:b.getTransitionSpeed(e),i=n?k.prefixstyle+"transform "+n+"ms ease-out":"";return b.lasttransitionstyle&&b.lasttransitionstyle==i||(b.lasttransitionstyle=i,b.doc.css(k.transitionstyle,i)),n},this.doScrollLeft=function(e,t){var n=b.scrollrunning?b.newscrolly:b.getScrollTop();b.doScrollPos(e,n,t)},this.doScrollTop=function(e,t){var n=b.scrollrunning?b.newscrollx:b.getScrollLeft();b.doScrollPos(n,e,t)},this.doScrollPos=function(e,t,n){var i=b.getScrollTop(),o=b.getScrollLeft();return((b.newscrolly-i)*(t-i)<0||(b.newscrollx-o)*(e-o)<0)&&b.cancelScroll(),0==b.opt.bouncescroll&&(t<0?t=0:t>b.page.maxh&&(t=b.page.maxh),e<0?e=0:e>b.page.maxw&&(e=b.page.maxw)),(!b.scrollrunning||e!=b.newscrollx||t!=b.newscrolly)&&(b.newscrolly=t,b.newscrollx=e,b.newscrollspeed=n||!1,!b.timer&&void(b.timer=setTimeout(function(){var n=b.getScrollTop(),i=b.getScrollLeft(),o={};o.x=e-i,o.y=t-n,o.px=i,o.py=n;var r=Math.round(Math.sqrt(Math.pow(o.x,2)+Math.pow(o.y,2))),s=b.newscrollspeed&&b.newscrollspeed>1?b.newscrollspeed:b.getTransitionSpeed(r);if(b.newscrollspeed&&b.newscrollspeed<=1&&(s*=b.newscrollspeed),b.prepareTransition(s,!0),b.timerscroll&&b.timerscroll.tm&&clearInterval(b.timerscroll.tm),s>0){if(!b.scrollrunning&&b.onscrollstart){var a={type:"scrollstart",current:{x:i,y:n},request:{x:e,y:t},end:{x:b.newscrollx,y:b.newscrolly},speed:s};b.onscrollstart.call(b,a)}k.transitionend?b.scrollendtrapped||(b.scrollendtrapped=!0,b.bind(b.doc,k.transitionend,b.onScrollTransitionEnd,!1)):(b.scrollendtrapped&&clearTimeout(b.scrollendtrapped),b.scrollendtrapped=setTimeout(b.onScrollTransitionEnd,s));var l=n,c=i;b.timerscroll={bz:new BezierClass(l,b.newscrolly,s,0,0,.58,1),bh:new BezierClass(c,b.newscrollx,s,0,0,.58,1)},b.cursorfreezed||(b.timerscroll.tm=setInterval(function(){b.showCursor(b.getScrollTop(),b.getScrollLeft())},60))}b.synched("doScroll-set",function(){b.timer=0,b.scrollendtrapped&&(b.scrollrunning=!0),b.setScrollTop(b.newscrolly),b.setScrollLeft(b.newscrollx),b.scrollendtrapped||b.onScrollTransitionEnd()})},50)))},this.cancelScroll=function(){if(!b.scrollendtrapped)return!0;var e=b.getScrollTop(),t=b.getScrollLeft();return b.scrollrunning=!1,k.transitionend||clearTimeout(k.transitionend),b.scrollendtrapped=!1,b._unbind(b.doc,k.transitionend,b.onScrollTransitionEnd),b.prepareTransition(0),b.setScrollTop(e),b.railh&&b.setScrollLeft(t),b.timerscroll&&b.timerscroll.tm&&clearInterval(b.timerscroll.tm),b.timerscroll=!1,b.cursorfreezed=!1,b.showCursor(e,t),b},this.onScrollTransitionEnd=function(){b.scrollendtrapped&&b._unbind(b.doc,k.transitionend,b.onScrollTransitionEnd),b.scrollendtrapped=!1,b.prepareTransition(0),b.timerscroll&&b.timerscroll.tm&&clearInterval(b.timerscroll.tm),b.timerscroll=!1;var e=b.getScrollTop(),t=b.getScrollLeft();return b.setScrollTop(e),b.railh&&b.setScrollLeft(t),b.noticeCursor(!1,e,t),b.cursorfreezed=!1,e<0?e=0:e>b.page.maxh&&(e=b.page.maxh),t<0?t=0:t>b.page.maxw&&(t=b.page.maxw),e!=b.newscrolly||t!=b.newscrollx?b.doScrollPos(t,e,b.opt.snapbackspeed):(b.onscrollend&&b.scrollrunning&&b.triggerScrollEnd(),void(b.scrollrunning=!1))}):(this.doScrollLeft=function(e,t){var n=b.scrollrunning?b.newscrolly:b.getScrollTop();b.doScrollPos(e,n,t)},this.doScrollTop=function(e,t){var n=b.scrollrunning?b.newscrollx:b.getScrollLeft();b.doScrollPos(n,e,t)},this.doScrollPos=function(e,t,n){function i(){if(b.cancelAnimationFrame)return!0;if(b.scrollrunning=!0,m=1-m)return b.timer=u(i)||1;var e=0,t=sy=b.getScrollTop();if(b.dst.ay){t=b.bzscroll?b.dst.py+b.bzscroll.getNow()*b.dst.ay:b.newscrolly;var n=t-sy;(n<0&&t<b.newscrolly||n>0&&t>b.newscrolly)&&(t=b.newscrolly),b.setScrollTop(t),t==b.newscrolly&&(e=1)}else e=1;var o=sx=b.getScrollLeft();if(b.dst.ax){o=b.bzscroll?b.dst.px+b.bzscroll.getNow()*b.dst.ax:b.newscrollx;var n=o-sx;(n<0&&o<b.newscrollx||n>0&&o>b.newscrollx)&&(o=b.newscrollx),b.setScrollLeft(o),o==b.newscrollx&&(e+=1)}else e+=1;2==e?(b.timer=0,b.cursorfreezed=!1,b.bzscroll=!1,b.scrollrunning=!1,t<0?t=0:t>b.page.maxh&&(t=b.page.maxh),o<0?o=0:o>b.page.maxw&&(o=b.page.maxw),o!=b.newscrollx||t!=b.newscrolly?b.doScrollPos(o,t):b.onscrollend&&b.triggerScrollEnd()):b.timer=u(i)||1}var t="undefined"==typeof t||t===!1?b.getScrollTop(!0):t;if(b.timer&&b.newscrolly==t&&b.newscrollx==e)return!0;b.timer&&d(b.timer),b.timer=0;var o=b.getScrollTop(),r=b.getScrollLeft();((b.newscrolly-o)*(t-o)<0||(b.newscrollx-r)*(e-r)<0)&&b.cancelScroll(),b.newscrolly=t,b.newscrollx=e,b.bouncescroll&&b.rail.visibility||(b.newscrolly<0?b.newscrolly=0:b.newscrolly>b.page.maxh&&(b.newscrolly=b.page.maxh)),b.bouncescroll&&b.railh.visibility||(b.newscrollx<0?b.newscrollx=0:b.newscrollx>b.page.maxw&&(b.newscrollx=b.page.maxw)),b.dst={},b.dst.x=e-r,b.dst.y=t-o,b.dst.px=r,b.dst.py=o;var s=Math.round(Math.sqrt(Math.pow(b.dst.x,2)+Math.pow(b.dst.y,2)));b.dst.ax=b.dst.x/s,b.dst.ay=b.dst.y/s;var a=0,l=s;0==b.dst.x?(a=o,l=t,b.dst.ay=1,b.dst.py=0):0==b.dst.y&&(a=r,l=e,b.dst.ax=1,b.dst.px=0);var c=b.getTransitionSpeed(s);if(n&&n<=1&&(c*=n),c>0?b.bzscroll=b.bzscroll?b.bzscroll.update(l,c):new BezierClass(a,l,c,0,1,0,1):b.bzscroll=!1,!b.timer){(o==b.page.maxh&&t>=b.page.maxh||r==b.page.maxw&&e>=b.page.maxw)&&b.checkContentSize();var m=1;if(b.cancelAnimationFrame=!1,b.timer=1,b.onscrollstart&&!b.scrollrunning){var p={type:"scrollstart",current:{x:r,y:o},request:{x:e,y:t},end:{x:b.newscrollx,y:b.newscrolly},speed:c};b.onscrollstart.call(b,p)}i(),(o==b.page.maxh&&t>=o||r==b.page.maxw&&e>=r)&&b.checkContentSize(),b.noticeCursor()}},this.cancelScroll=function(){return b.timer&&d(b.timer),b.timer=0,b.bzscroll=!1,b.scrollrunning=!1,b}):(this.doScrollLeft=function(e,t){var n=b.getScrollTop();b.doScrollPos(e,n,t)},this.doScrollTop=function(e,t){var n=b.getScrollLeft();b.doScrollPos(n,e,t)},this.doScrollPos=function(e,t,n){var i=e>b.page.maxw?b.page.maxw:e;i<0&&(i=0);var o=t>b.page.maxh?b.page.maxh:t;o<0&&(o=0),b.synched("scroll",function(){b.setScrollTop(o),b.setScrollLeft(i)})},this.cancelScroll=function(){}),this.doScrollBy=function(e,t){var n=0;if(t)n=Math.floor((b.scroll.y-e)*b.scrollratio.y);else{var i=b.timer?b.newscrolly:b.getScrollTop(!0);n=i-e}if(b.bouncescroll){var o=Math.round(b.view.h/2);n<-o?n=-o:n>b.page.maxh+o&&(n=b.page.maxh+o)}return b.cursorfreezed=!1,py=b.getScrollTop(!0),n<0&&py<=0?b.noticeCursor():n>b.page.maxh&&py>=b.page.maxh?(b.checkContentSize(),b.noticeCursor()):void b.doScrollTop(n)},this.doScrollLeftBy=function(e,t){var n=0;if(t)n=Math.floor((b.scroll.x-e)*b.scrollratio.x);else{var i=b.timer?b.newscrollx:b.getScrollLeft(!0);n=i-e}if(b.bouncescroll){var o=Math.round(b.view.w/2);n<-o?n=-o:n>b.page.maxw+o&&(n=b.page.maxw+o)}return b.cursorfreezed=!1,px=b.getScrollLeft(!0),n<0&&px<=0?b.noticeCursor():n>b.page.maxw&&px>=b.page.maxw?b.noticeCursor():void b.doScrollLeft(n)},this.doScrollTo=function(e,t){var n=t?Math.round(e*b.scrollratio.y):e;n<0?n=0:n>b.page.maxh&&(n=b.page.maxh),b.cursorfreezed=!1,b.doScrollTop(e)},this.checkContentSize=function(){var e=b.getContentSize();e.h==b.page.h&&e.w==b.page.w||b.resize(!1,e)},b.onscroll=function(e){b.rail.drag||b.cursorfreezed||b.synched("scroll",function(){b.scroll.y=Math.round(b.getScrollTop()*(1/b.scrollratio.y)),b.railh&&(b.scroll.x=Math.round(b.getScrollLeft()*(1/b.scrollratio.x))),b.noticeCursor()})},b.bind(b.docscroll,"scroll",b.onscroll),this.doZoomIn=function(e){if(!b.zoomactive){b.zoomactive=!0,b.zoomrestore={style:{}};var t=["position","top","left","zIndex","backgroundColor","marginTop","marginBottom","marginLeft","marginRight"],n=b.win[0].style;for(var i in t){var o=t[i];b.zoomrestore.style[o]="undefined"!=typeof n[o]?n[o]:""}b.zoomrestore.style.width=b.win.css("width"),b.zoomrestore.style.height=b.win.css("height"),b.zoomrestore.padding={w:b.win.outerWidth()-b.win.width(),h:b.win.outerHeight()-b.win.height()},k.isios4&&(b.zoomrestore.scrollTop=l(window).scrollTop(),l(window).scrollTop(0)),b.win.css({position:k.isios4?"absolute":"fixed",top:0,left:0,"z-index":a+100,margin:"0px"});var r=b.win.css("backgroundColor");return(""==r||/transparent|rgba\(0, 0, 0, 0\)|rgba\(0,0,0,0\)/.test(r))&&b.win.css("backgroundColor","#fff"),b.rail.css({"z-index":a+101}),b.zoom.css({"z-index":a+102}),b.zoom.css("backgroundPosition","0px -18px"),b.resizeZoom(),b.onzoomin&&b.onzoomin.call(b),b.cancelEvent(e)}},this.doZoomOut=function(e){if(b.zoomactive)return b.zoomactive=!1,b.win.css("margin",""),b.win.css(b.zoomrestore.style),k.isios4&&l(window).scrollTop(b.zoomrestore.scrollTop),b.rail.css({"z-index":b.zindex}),b.zoom.css({"z-index":b.zindex}),b.zoomrestore=!1,b.zoom.css("backgroundPosition","0px 0px"),b.onResize(),b.onzoomout&&b.onzoomout.call(b),b.cancelEvent(e)},this.doZoom=function(e){return b.zoomactive?b.doZoomOut(e):b.doZoomIn(e)},this.resizeZoom=function(){if(b.zoomactive){var e=b.getScrollTop();b.win.css({width:l(window).width()-b.zoomrestore.padding.w+"px",height:l(window).height()-b.zoomrestore.padding.h+"px"}),b.onResize(),b.setScrollTop(Math.min(b.page.maxh,e))}},this.init(),l.nicescroll.push(this)},y=function(e){var t=this;this.nc=e,this.lastx=0,this.lasty=0,this.speedx=0,this.speedy=0,this.lasttime=0,this.steptime=0,this.snapx=!1,this.snapy=!1,this.demulx=0,this.demuly=0,this.lastscrollx=-1,this.lastscrolly=-1,this.chkx=0,this.chky=0,this.timer=0,this.time=function(){return+new Date},this.reset=function(e,n){t.stop();var i=t.time();t.steptime=0,t.lasttime=i,t.speedx=0,t.speedy=0,t.lastx=e,t.lasty=n,t.lastscrollx=-1,t.lastscrolly=-1},this.update=function(e,n){var i=t.time();t.steptime=i-t.lasttime,t.lasttime=i;var o=n-t.lasty,r=e-t.lastx,s=t.nc.getScrollTop(),a=t.nc.getScrollLeft(),l=s+o,c=a+r;t.snapx=c<0||c>t.nc.page.maxw,t.snapy=l<0||l>t.nc.page.maxh,t.speedx=r,t.speedy=o,t.lastx=e,t.lasty=n},this.stop=function(){t.nc.unsynched("domomentum2d"),t.timer&&clearTimeout(t.timer),t.timer=0,t.lastscrollx=-1,t.lastscrolly=-1},this.doSnapy=function(e,n){var i=!1;n<0?(n=0,i=!0):n>t.nc.page.maxh&&(n=t.nc.page.maxh,i=!0),e<0?(e=0,i=!0):e>t.nc.page.maxw&&(e=t.nc.page.maxw,i=!0),i?t.nc.doScrollPos(e,n,t.nc.opt.snapbackspeed):t.nc.triggerScrollEnd()},this.doMomentum=function(e){var n=t.time(),i=e?n+e:t.lasttime,o=t.nc.getScrollLeft(),r=t.nc.getScrollTop(),s=t.nc.page.maxh,a=t.nc.page.maxw;t.speedx=a>0?Math.min(60,t.speedx):0,t.speedy=s>0?Math.min(60,t.speedy):0;var l=i&&n-i<=60;(r<0||r>s||o<0||o>a)&&(l=!1);var c=!(!t.speedy||!l)&&t.speedy,u=!(!t.speedx||!l)&&t.speedx;if(c||u){var d=Math.max(16,t.steptime);if(d>50){var m=d/50;t.speedx*=m,t.speedy*=m,d=50}t.demulxy=0,t.lastscrollx=t.nc.getScrollLeft(),t.chkx=t.lastscrollx,t.lastscrolly=t.nc.getScrollTop(),t.chky=t.lastscrolly;var p=t.lastscrollx,h=t.lastscrolly,f=function(){var e=t.time()-n>600?.04:.02;t.speedx&&(p=Math.floor(t.lastscrollx-t.speedx*(1-t.demulxy)),t.lastscrollx=p,(p<0||p>a)&&(e=.1)),t.speedy&&(h=Math.floor(t.lastscrolly-t.speedy*(1-t.demulxy)),t.lastscrolly=h,(h<0||h>s)&&(e=.1)),t.demulxy=Math.min(1,t.demulxy+e),t.nc.synched("domomentum2d",function(){if(t.speedx){var e=t.nc.getScrollLeft();e!=t.chkx&&t.stop(),t.chkx=p,t.nc.setScrollLeft(p)}if(t.speedy){var n=t.nc.getScrollTop();n!=t.chky&&t.stop(),t.chky=h,t.nc.setScrollTop(h)}t.timer||(t.nc.hideCursor(),t.doSnapy(p,h))}),t.demulxy<1?t.timer=setTimeout(f,d):(t.stop(),t.nc.hideCursor(),t.doSnapy(p,h))};f()}else t.doSnapy(t.nc.getScrollLeft(),t.nc.getScrollTop())}},w=e.fn.scrollTop;e.cssHooks.pageYOffset={get:function(e,t,n){var i=l.data(e,"__nicescroll")||!1;return i&&i.ishwscroll?i.getScrollTop():w.call(e)},set:function(e,t){var n=l.data(e,"__nicescroll")||!1;return n&&n.ishwscroll?n.setScrollTop(parseInt(t)):w.call(e,t),this}},e.fn.scrollTop=function(e){if("undefined"==typeof e){var t=!!this[0]&&(l.data(this[0],"__nicescroll")||!1);return t&&t.ishwscroll?t.getScrollTop():w.call(this)}return this.each(function(){var t=l.data(this,"__nicescroll")||!1;t&&t.ishwscroll?t.setScrollTop(parseInt(e)):w.call(l(this),e)})};var k=e.fn.scrollLeft;l.cssHooks.pageXOffset={get:function(e,t,n){var i=l.data(e,"__nicescroll")||!1;return i&&i.ishwscroll?i.getScrollLeft():k.call(e)},set:function(e,t){var n=l.data(e,"__nicescroll")||!1;return n&&n.ishwscroll?n.setScrollLeft(parseInt(t)):k.call(e,t),this}},e.fn.scrollLeft=function(e){if("undefined"==typeof e){var t=!!this[0]&&(l.data(this[0],"__nicescroll")||!1);return t&&t.ishwscroll?t.getScrollLeft():k.call(this)}return this.each(function(){var t=l.data(this,"__nicescroll")||!1;t&&t.ishwscroll?t.setScrollLeft(parseInt(e)):k.call(l(this),e)})};var _=function(e){var t=this;if(this.length=0,this.name="nicescrollarray",this.each=function(e){for(var n=0,i=0;n<t.length;n++)e.call(t[n],i++);return t},this.push=function(e){t[t.length]=e,t.length++},this.eq=function(e){return t[e]},e)for(var n=0;n<e.length;n++){var i=l.data(e[n],"__nicescroll")||!1;i&&(this[this.length]=i,this.length++)}return this};n(_.prototype,["show","hide","toggle","onResize","resize","remove","stop","doScrollPos"],function(e,t){e[t]=function(){var e=arguments;return this.each(function(){this[t].apply(this,e)})}}),e.fn.getNiceScroll=function(e){if("undefined"==typeof e)return new _(this);var t=this[e]&&l.data(this[e],"__nicescroll")||!1;return t},e.extend(e.expr[":"],{nicescroll:function(e){return!!l.data(e,"__nicescroll")}}),l.fn.niceScroll=function(e,t){"undefined"==typeof t&&("object"!=typeof e||"jquery"in e||(t=e,e=!1));var n=new _;"undefined"==typeof t&&(t={}),e&&(t.doc=l(e),t.win=l(this));var i=!("doc"in t);return i||"win"in t||(t.win=l(this)),this.each(function(){var e=l(this).data("__nicescroll")||!1;e||(t.doc=i?l(this):t.doc,e=new b(t,l(this)),l(this).data("__nicescroll",e)),n.push(e)}),1==n.length?n[0]:n},window.NiceScroll={getjQuery:function(){return e}},l.nicescroll||(l.nicescroll=new _,l.nicescroll.options=f)}),define("vendor/text!modules/emailbuilder/templates/dropdown.html",[],function(){return'<div class="emb-js-dropdown" data-dropdown="true" ng-keydown="keyDown($event);" tabindex="0" style="outline: none;">\r\n    <div class="l-select-container emb-js-select-container emb-select-container {{csDropdownClass}}" ng-show="open" ng-mousedown="mousedown=true;" ng-mouseup="mousedown=false;" ng-class="{\'emb-mousedown\': mousedown}">\r\n        <ul class="emb-js-select-wrapper emb-select-list emb-reset">\r\n            <li ng-repeat="type in csDropdown" class="emb-select-option emb-js-option" ng-click="setValue(type); toggleOpen($event); $event.stopPropagation();" bindonce="type" data-value="{{type.value || type}}" data-display="{{type.display || type}}" data-description="{{type.description || type}}" data-selected="{{(type.value || type) == currentValue}}" data-index="{{$index}}" ng-style="type.cssValues">\r\n                <span class="c-select-list__option" bo-text="type.display || type"></span>\r\n                <span class="c-select-list__description" ng-if="type.description" bo-text="type.description"></span>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n    <span class="l-select-container emb-js-selected-option emb-select-selected {{csDropdownClass}}" ng-click="toggleOpen($event);" data-value="{{currentValue}}">{{currentDisplay}}</span>\r\n</div>';
}),define("modules/emailbuilder/directives/dropdown",["vendor/angular","vendor/jquery.nicescroll","vendor/postal","modules/emailbuilder/module","vendor/text!modules/emailbuilder/templates/dropdown.html","underscore"],function(e,t,n,i,o,r){function s(e,t){"Win32"===navigator.platform?e.niceScroll({autohidemode:!0,cursoropacitymin:.25,cursoropacitymax:.6,cursorcolor:"#000",cursorwidth:"8px",horizrailenabled:!1,cursorborder:"2px solid transparent",cursorborderradius:"10px",enablekeyboard:!1}):e.css("overflow-y","auto")}function a(e){e.csDropdownOnChange&&e.csDropdownOnChange({value:e.currentValue,display:e.currentDisplay,description:e.currentDescription})}function l(e,t){if(t){var n=e.csDropdown.filter(function(t){return t.value===e.currentValue});n.length>0&&(e.currentDisplay=n[0].display)}}function c(t){return{restrict:"A",replace:!1,template:o,require:"ngModel",scope:{csDropdown:"=",csDropdownClass:"@",csDropdownOnChange:"&"},link:function(n,i,o,c){var m=i.find(".emb-js-select-container"),p=i.find(".emb-js-select-wrapper"),h=function(){return!!(n.csDropdown&&n.csDropdown.length>0&&r.isObject(n.csDropdown[0]))};n.open=!1,n.mousedown=!1,n.$watch("csDropdown",function(e){var t;e&&(t=h(),n.dropdownType=t?"object":"primitive",s(m,p),l(n,t))}),t.subscribe("collapse",function(){n.open&&(n.open=!1)}),n.handleClicksOutside=function(t){var i=e.element(t.target).inheritedData("dropdown");i||(n.toggleOpen(),e.element("body").off("mousedown",n.handleClicksOutside))},n.toggleOpen=function(i){n.open?e.element("body").off("mousedown",n.handleClicksOutside):(e.element("body").on("mousedown",n.handleClicksOutside),t.collapse()),n.open=!n.open},n.$watch("currentValue",function(e){c.$setViewValue(e)}),n.setValue=function(e){var t=r.isObject(e);n.currentValue=t?e.value:e,n.currentDisplay=t?e.display:e,a(n)},n.scrollToCurrentSelection=function(){var e=p.find("[data-value='"+n.currentValue+"']");e.length<1||m.scrollTop(m.scrollTop()+e.position().top)},n.$watch("open",function(){if(n.open&&n.currentValue)n.scrollToCurrentSelection();else if(!n.open){var e=p.find("[data-selected='true']");d(e,p,n)}}),n.keyDown=function(e){u(e,n,p,m)};var f=function(e){n.open&&n.keyDown(e)};try{m.parents("body").keydown(f)}catch(e){}var g=i.attr("cs-dropdown-display-when-empty")||"";c.$render=function(){if(n.currentValue=c.$viewValue,h()){var e=n.csDropdown.filter(function(e){return e.value===n.currentValue});return e.length>0?n.currentDisplay=e[0].display:n.currentDisplay=g,void a(n)}n.currentDisplay=c.$viewValue||g}}}}function u(t,n,i,o){var r,s=t.key,a=t.keyCode;if(0!==a){s||(s=String.fromCharCode(a));var l=i.find("[data-selected='true']");if(27==a||9==a)n.open&&n.toggleOpen(t),d(l,i,n);else if(s.match("^[a-zA-Z0-9]$")){var c=i.children().filter(function(){return this.textContent.match(new RegExp("^"+s,"i"))});if(c.length>0){var u=m(c,l);r=e.element(c[u]),h(l,r,o),n.open||p(n,r)}}else if(n.open)if(38==a||40==a){var f=l.attr("data-index"),g=parseInt(f,10)+(38==a?-1:1);g>=0&&g<i.children().length&&(r=i.find("[data-index='"+g+"']"),h(l,r,o))}else 32!=a&&13!=a||(n.toggleOpen(t),p(n,l));else 32!=a&&38!=a&&40!=a||n.toggleOpen(t);t.stopPropagation()}}function d(e,t,n){e.attr("data-selected","false");var i=t.find("[data-value='"+n.currentValue+"']");i.attr("data-selected","true")}function m(e,t){for(var n=-1,i=0;i<e.length;i++)if(e[i].getAttribute("data-value")==t.attr("data-value")){n=i;break}return n++,n>=e.length&&(n=0),n}function p(e,t){var n=t.attr("data-value");if(e.currentValue!=n){var i=t.attr("data-display");e.setValue({value:n,display:i})}t.attr("data-description")}function h(e,t,n){e.attr("data-selected","false"),t.attr("data-selected","true");var i=t.position().top,o=t.height(),r=n.scrollTop(),s=n.height();if(i<0)n.scrollTop(r+i);else if(i+o>s){var a=i+o,l=a-s+r;n.scrollTop(l)}}function f(){this.channel=n.channel("DropdownEventsSrv")}f.prototype.collapse=function(){this.channel.publish("collapse")},f.prototype.subscribe=function(e,t){return this.channel.subscribe(e,t)},i.service("DropdownEventsSrv",f),i.directive("csDropdown",["DropdownEventsSrv",c])}),define("vendor/text!modules/emailbuilder/templates/checkbox.html",[],function(){return'<input class="checkbox-options__input emb-checkbox" ng-change="checkboxChanged(property)"\r\n       type="checkbox" id="emb-form-{{id}}" ng-model="property"/>\r\n<label class="c-sidebar__label checkbox-options__label" for="emb-form-{{id}}">{{label}}</label>'}),define("modules/emailbuilder/directives/checkbox",["modules/emailbuilder/module","vendor/text!modules/emailbuilder/templates/checkbox.html"],function(e,t){function n(e,t){var n=/\s+/;return n.test(e)&&t>0?"-":""}function i(e,i){return{restrict:"A",replace:!1,template:t,require:"ngModel",scope:{property:"=ngModel",activeSection:"=csSection"},link:function(t,o,r,s){t.label=r.label,r.checkboxId&&""!==r.checkboxId?t.id=r.checkboxId:t.id=r.label.toLowerCase().replace(/[^a-z]+/g,n),t.checkboxChanged=function(n){s.$setViewValue(n),i(function(){e.$emit("checkbox:value-changed",t.activeSection,t.id)},0)},s.$render=function(){t.property=s.$viewValue}}}}e.directive("csCheckbox",["$rootScope","$timeout",i])}),define("vendor/text!modules/emailbuilder/templates/headerLogo.html",[],function(){return'<div class="emb-header-logo" ng-if="header.displayType == \'image\' || header.displayType == \'text\'">\r\n    <div ng-if="header.displayType == \'image\'">\r\n        <div style="position:relative">\r\n            <emb-validation-messages clear-on-inactive="1" model="header"></emb-validation-messages>\r\n            <div emb-image-drop-container="header" replace="true">\r\n                <div emb-logo></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div ng-if="header.displayType == \'text\'" class="emb-content-inner emb-js-content-inner"\r\n         ng-class="{ \'emb-active\' : header.isActive, \'emb-hoverable\' : !header.isActive}"\r\n         ng-mouseenter="hovered = true"\r\n         ng-mouseleave="hovered = false">\r\n            <div emb-item-controls item-type="header" item="header" item-hovered="hovered" in-use="header.isActive"></div>\r\n            <div class="emb-js-header" emb-text-block block="header" singleline="1"></div>\r\n    </div>\r\n</div>\r\n'}),define("vendor/text!modules/emailbuilder/templates/staticHeaderLogo.html",[],function(){return'<div class="emb-header-logo" ng-if="(header.displayType == \'image\' && header.src) || (header.displayType == \'text\' && header.contents)">\r\n    <div ng-if="header.displayType == \'image\'">\r\n        <img emb-disable-drag ng-src="{{header.src}}" width="{{header.width}}" height="{{header.height}}" ng-style="{ \'max-width\': header.width }" />\r\n    </div>\r\n    <div ng-if="header.displayType == \'text\'" ng-style="{ width : header.container.width }">\r\n        {{header.contents}}\r\n    </div>\r\n</div>\r\n'}),define("modules/emailbuilder/directives/headerLogo",["config","modules/emailbuilder/module","vendor/text!modules/emailbuilder/templates/headerLogo.html","vendor/text!modules/emailbuilder/templates/staticHeaderLogo.html","ts/modules/emailbuilder/services/email"],function(e,t,n,i){function o(){return{restrict:"E",replace:!0,template:e.mode.customisable?n:i,scope:{header:"="},link:function(t,n,i){function o(){null!==m&&(t.header.hasHorizontalLogoPadding?m.addClass("header--padded--inline"):m.removeClass("header--padded--inline"))}function r(){var e="image"===t.header.displayType,n=(e?0:l).toString()+"px",i=(e?0:c).toString()+"px";p.forEach(function(e){e.style[u]=t.header.paddingTop.toString()+"px",e.style[d]=t.header.paddingBottom.toString()+"px"}),f.style.fontSize=n,f.style.lineHeight=i}var u,d,m=n.parents("#emb-email-header-container"),p=m.find(".emb-logo-padding-box").get();p.length?(u="paddingTop",d="paddingBottom"):(p=n.parents(".emb-logo-margin-box").get(),u="marginTop",d="marginBottom");var h=n.closest("#emb-email-header"),f=h.length?h[0]:null;p.length&&(null===t.header.paddingTop&&(t.header.paddingTop=s),null===t.header.paddingBottom&&(t.header.paddingBottom=a),r(),t.$watch("header.paddingTop",r),t.$watch("header.paddingBottom",r),t.$watch("header.displayType",r),e.email.isBlueprint&&(o(),t.$watch("header.hasHorizontalLogoPadding",o),t.$watch("header.displayType",o)))}}}var r=e.email.config.defaultTheme.headerAndFooter.logoContainerStyles,s=r?r.logoPaddingTop:24,a=r?r.logoPaddingBottom:24,l=r?r.textLogoFontSize:32,c=r?r.textLogoLineHeight:40;t.directive("embHeaderLogo",o)}),define("vendor/text!modules/emailbuilder/templates/header.html",[],function(){return'\r\n<header id="emb-js-editor-header" class="c-header emb-reset emb-editor-header">\r\n    <div class="l-anchor-left" ng-cloak>\r\n        <a kiss-metric="{{embState}}" flag="prev" class="c-button c-button--return" ng-href="{{navPrevHref}}" ng-click="prevClick($event)" ng-class="{\'select-choose-template\': embState == \'editor\', \'select-continue-editing\': embState == \'preview\'}">\r\n            <span class="c-button__text">{{navPrev}}</span>\r\n        </a>\r\n    </div>\r\n\r\n    <div class="status-display" ng-if="canvasPredefinedSections">\r\n        Editing a template <!-- TODO: add logic for Creating a template also -->\r\n    </div>\r\n\r\n    <div aria-live="polite" class="c-label-container c-app-progress hmb-app-progress c-template-mode" ng-show="isTemplateWithContent">\r\n        <div class="c-label">\r\n            Editing {{templateName ? "the \\"" + templateName + "\\"": "a"}} template\r\n        </div>\r\n    </div>\r\n\r\n    <div class="hmb-app-progress" ng-show="embState == \'editor\' && !isTemplateWithContent">\r\n\r\n        <span class="c-app-progress__status" ng-show="progress == \'saving\'">Saving</span>\r\n\r\n        <img class="c-app-progress__status-container" ng-src="{{imageDomain}}/img/emailbuilder/@2x/auto_saving.gif" ng-if="progress == \'saving\'" />\r\n\r\n        <span class="c-app-progress__status hmb-status" ng-show="progress == \'idle\'">Saved</span>\r\n\r\n        <span class="c-app-progress__status hmb-status" ng-show="progress == \'failed\'">Save Failed</span>\r\n        <img class="c-app-progress__status-container" ng-src="{{imageDomain}}/img/emailbuilder/@2x/auto_waiting.gif" ng-if="progress == \'idle\'" />\r\n\r\n    </div>\r\n\r\n    <div class="c-app-progress hmb-app-progress" ng-show="embState == \'preview\'">\r\n        <span class="c-app-progress__status hmb-status" ng-class="{\'c-template-mode\': isTemplateWithContent}" ng-show="previewProgress == \'generating\'">\r\n            Getting latest version\r\n        </span>\r\n        <img class="c-app-progress__status-container hmb-progress-container" ng-class="{\'c-template-mode\': isTemplateWithContent}" ng-src="{{imageDomain}}/img/emailbuilder/@2x/auto_generating.gif" ng-if="previewProgress == \'generating\'"/>\r\n    </div>\r\n\r\n    <div class="l-anchor-right" ng-cloak>\r\n        <cm-notify ng-if="newFeatureNotificationEnabled" ng-cloak></cm-notify>\r\n        <button class="c-button c-button--header" ng-show="supportTestEmail" ng-click="showTestModal($event)">\r\n            <span class="c-button__text">Send a test email</span>\r\n        </button>\r\n        <a id="header-next-button" kiss-metric="{{(embState == \'editor\') ? \'\' : embState}}" flag="next" class="c-button c-button--primary" ng-href="{{navNextHref}}"\r\n           ng-click="(isTemplateWithContent) ? (isTemplateWithContent && showSaveTemplateAs ? trySaveTemplate($event) : nextClick($event)) : nextClick2($event)"\r\n           ng-class="{\'emb-active\': showSaveTemplateAs || showSignupForm || showTestEmailForm, \'c-button--forward\': embState == \'preview\', \'c-button--preview\': embState == \'editor\' || embState == \'firstrun\', \'select-define-recipients\': embState == \'preview\', \'select-preview\': embState == \'editor\'}">\r\n            <span class="c-button__text">{{navNext}}</span>\r\n\r\n        </a>\r\n    </div>\r\n</header>'}),define("ts/modules/emailbuilder/services/ModelValidationSvc",["vendor/angular","modules/emailbuilder/module","ts/modules/emailbuilder/services/lockLevelSvc","config"],function(e,t,n,i){var o=function(){function e(){this.text=function(e){var t=/(<([^>]+)>)/gi;return!(!e||!e.contents||""===e.contents.replace(t,""))},this.image=function(e){return e&&e.hasSrc()},this.button=function(e){return e&&""!==e.href},this.video=function(e){return e&&e.hasSrc()},this.spacer=function(e){return!0},this.divider=function(e){return!0}}return e}(),r=function(){function e(){this.contentType="",this.sectionUiId=""}return e}(),s=function(){function e(){}return e}(),a=function(){function e(e){var t=this;this.isValidModel=function(e,n){var a=new o,l=new s;return l.missingTypes=new Array,l.validationItems=new Array,i.canvasSectionPermissions?(e.forEach(function(e){var i=t.lockLevelSvc.getLocks(e.permissions);(n&&!i.canEditContentItems||!n&&i.anyLocking)&&e.content.forEach(function(e){e.content.forEach(function(e){if(!a[e.type](e)){var t=new r;t.contentType=e.type,t.sectionUiId=e.sectionUiId,l.validationItems.push(t),l.missingTypes.indexOf(e.type)===-1&&l.missingTypes.push(e.type)}})})}),l):l},this.isValidFooter=function(e){var n=new s;if(n.missingTypes=new Array,n.validationItems=new Array,!i.canvasSectionPermissions)return n;var o=t.lockLevelSvc.getLocks(e.footer.permissions);if(o.anyLocking){for(var r in e.webLinks)if(e.webLinks.hasOwnProperty(r)){var a=e.webLinks[r];if(a.on&&!a.href){n.missingTypes.push("webLinks");break}}e.editableText.address.isPlaceholder&&n.missingTypes.push("address"),!e.editableText.permission.isDisabled&&e.editableText.permission.isPlaceholder&&n.missingTypes.push("permission")}return n},this.lockLevelSvc=e}return e}();t.service("ModelValidationSvc",["LockLevelSvc",a])}),define("modules/emailbuilder/directives/header",["vendor/angular","config","modules/emailbuilder/module","vendor/text!modules/emailbuilder/templates/header.html","modules/emailbuilder/services/trackingSvc","ts/modules/emailbuilder/services/ModelValidationSvc"],function(e,t,n,i,o,r){function s(n,o,r,s,a,l,c,u,d,m,p){function h(i,h,f){function g(t){27===t.which&&(a.path("#/editor"),e.element("body").off("keydown",g))}function v(t){var o=document.getElementById("header-next-button").contains(t.target),r=document.getElementById("emb-name-template").contains(t.target);o||r||(i.showSaveTemplateAs=!1,e.element("body").off("mousedown",v),n.$emit("template:closeDialog"))}var b=!1;i.progress="idle",i.previewProgress="idle",i.sidebarCurrentTab="content-tiles",i.showSaveTemplateAs=!1,i.showSignupForm=!1,i.showTestEmailForm=!1,i.sidebarEditorOpen=!1,i.imageDomain=t.urls.staticResourceBase,i.templateName=t.template.savedName,i.newFeatureNotificationEnabled=t.newFeatureNotificationEnabled,i.isTemplateWithContent=t.mode.templateWithContent,i.supportTestEmail=t.supportTestEmail,i.isTemplateChanged=0,i.prevClick=function(e){i.sidebarEditorOpen&&"editor"===i.embState&&(e.preventDefault(),n.$emit("content:deactivate"))},i.trySaveTemplate=function(e){e.preventDefault(),n.$emit("template:trySave")};var y=function(){var e=c.save();e&&e.then(function(e){var n=e.data.Data,i=t.urls.stepForward;n&&Object.keys(n).forEach(function(e){var t=new RegExp(e+"=[^&]*"),o=[e,"=",encodeURIComponent(n[e])].join("");i=i.replace(t,o)}),window.location=i})};i.nextClick2=function(n){if("preview"===i.embState&&!t.mode.publicCanvas)if(t.mode.newTemplate){if(t.mode.newTemplate&&!i.showSaveTemplateAs){var o=s("date")(new Date,"dd MMMM yyyy"),r=t.campaignName;r.length>35&&(r=r.substring(0,35));var a=r+" - "+o;c.setName(a),y(),n.preventDefault()}}else u.enqueueCampaignScreenshots();"preview"===i.embState&&t.mode.publicCanvas&&(n.preventDefault(),i.showSignupForm=!i.showSignupForm,i.showSignupForm&&(l.logFinishAndSave(),u.enqueueTemplateScreenshots())),"editor"===i.embState&&(i.validateModel(n),e.element("body").on("keydown",g),d.logAction("Preview"))},n.closeMissingBackgroundModal=function(){n.firstSectionWithMissingBackground.click(),n.showMissingBackgroundModal=!1},n.closePermissionValidationModal=function(){n.showPermissionValidationModal=!1},n.closeFooterValidationModal=function(){n.showFooterValidationModal=!1},i.nextClick=function(n){"preview"===i.embState&&(t.mode.newTemplate?t.mode.newTemplate&&!i.showSaveTemplateAs&&(n.preventDefault(),i.isTemplateWithContent&&e.element("body").on("mousedown",v),i.showSaveTemplateAs=!0):(n.preventDefault(),l.saveTemplate())),i.showSaveTemplateAs&&!n.isDefaultPrevented()&&(i.showSaveTemplateAs=!1,n.preventDefault()),"preview"!==i.embState&&(e.element("body").on("keydown",g),d.logAction("Preview")),"editor"===i.embState&&(i.validateModel(n),e.element("body").on("keydown",g),d.logAction("Preview"))},i.showTestModal=function(e){e.preventDefault(),i.showTestEmailForm=!i.showTestEmailForm},i.hideTestModal=function(e){e.preventDefault(),i.showTestEmailForm=!1},l.subscribe("saving",function(){h.addClass("qa-status-saving")}),l.subscribe("saved",function(){i.progress="saving",h.removeClass("qa-status-saving"),i.isTemplateWithContent?(i.isTemplateChanged++,i.isTemplateChanged>1&&(i.progress="saving",l.isDirty=!0)):o(function(){i.progress="idle"},3e3)}),l.subscribe("failed",function(){i.progress="failed",o(function(){i.progress=""},3e3)}),l.subscribe("generated",function(){i.previewProgress="generating",o(function(){i.previewProgress="idle"},3e3)}),i.$on("$routeChangeSuccess",function(e,t){b&&(i.embState=r.current.action),i.showSaveTemplateAs=!1,i.showSignupForm=!!r.current.showSignupForm,i.showTestEmailForm=!!r.current.showTestEmailForm}),n.$$postDigest(function(){n.$$postDigest(function(){b=!0,i.embState=r.current.action,i.$digest()})}),n.$on("currentPane.switched",function(e,t){i.sidebarCurrentTab=t}),n.$on("content:activated",function(e,t){"image"!==t.block.type&&"button"!==t.block.type&&"survey"!==t.block.type||"editor"!==i.embState||(i.sidebarEditorOpen=!0,i.navPrev="Return",i.navPrevHref="#/editor")}),n.$on("content:deactivated",function(){"editor"===i.embState&&(i.sidebarEditorOpen=!1,i.navPrev=t.previousStep,i.navPrevHref=t.urls.stepBack)}),i.$watch("embState",function(e){switch(e){case"preview":i.navPrev="Return",i.navPrevHref="#/editor",i.navNext=t.nextStep,i.navNextHref=t.urls.stepForward;break;default:i.navPrev=t.previousStep,i.navPrevHref=t.urls.stepBack,i.navNext="Preview",i.navNextHref="#/preview"}}),i.validateModel=function(i){var o=p.isValidModel(m.model.sections,t.mode.templateWithContent);if(o.missingTypes.length>0)return n.showPermissionValidationModal=!0,n.permissionValidationResult=o,void i.preventDefault();if(t.mode.templateWithContent){var r=p.isValidFooter(m.model);if(r.missingTypes.length>0)return n.showFooterValidationModal=!0,n.footerValidationResult=r,void i.preventDefault()}var s=m.isThereAMissingBackground();return s?(n.firstSectionWithMissingBackground=e.element("#"+s.uiId),n.showMissingBackgroundModal=!0,void i.preventDefault()):void 0}}var f={restrict:"EA",replace:!0,template:i,link:h};return f}n.directive("embHeader",["$rootScope","$timeout","$route","$filter","$location","SaveSvc","embTemplateNameProvider","ScreenshotSvc","trackingSvc","EmailSvc","ModelValidationSvc",s])}),define("vendor/text!modules/emailbuilder/templates/spacer.html",[],function(){return'<div id="emb-js-spacer-{{block.tempContainer.section}}-{{block.tempContainer.column}}" class="emb-spacer-measurement">\r\n    <span class="emb-spacer-handle"\r\n          ng-show="block.isActive && canResize">{{tempHeight}}px</span>\r\n</div>'}),define("modules/emailbuilder/directives/spacer",["jqueryui","vendor/angular","modules/emailbuilder/module","vendor/text!modules/emailbuilder/templates/spacer.html","ts/modules/emailbuilder/services/lockLevelSvc"],function(e,t,n,i,o){function r(t,n){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.position.top<a.top?this.position.top=a.top:this.position.top>a.bottom&&(this.position.top=a.bottom),!n){var i=this._uiHash();if(this._trigger("drag",t,i)===!1)return this._mouseUp({}),!1;this.position=i.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1}function s(e,t){return{restrict:"A",replace:!0,template:i,link:function(n,i,o){function s(e){var i=t.getLocks(e);n.canResize=i.canEditContentItemStyles}var a=i.find(".emb-spacer-handle");n.block.tempInUse=!1,i.height(n.block.height),n.tempHeight=n.block.height,s(n.section.permissions),n.$on("permissionsChanged:section-"+n.section.uiId,function(e,t){s(t)}),a.draggable({axis:"y",helper:"original",start:function(){n.block.tempInUse=!0},stop:function(t,i){var o=parseInt(i.position.top,10)+11;n.block.height!=o&&(n.block.height=o,e.contentUpdated()),n.block.tempInUse=!1,n.$digest()},drag:function(e,t){var o=t.position.top+11;i.height(o),n.tempHeight=parseInt(o,10),n.$digest()},cursor:"ns-resize"}),a.draggable().data()["ui-draggable"]._mouseDrag=function(e,t){return r.call(a.draggable().data()["ui-draggable"],e,t)}}}}var a={top:-10,bottom:989};n.directive("embSpacer",["ModelActivity","LockLevelSvc",s])}),define("modules/emailbuilder/directives/divider",["jqueryui","vendor/angular","modules/emailbuilder/module"],function(e,t,n,i){function o(){return{restrict:"A",link:function(e,t,n){var i=function(){var t=e.block.tempContainer;return["emb-js-divider-",t.section,"-",t.column].join("")};t.attr("id",i())}}}n.directive("embDivider",o)}),define("modules/emailbuilder/services/previewHtml",["config","modules/emailbuilder/module"],function(e,t){function n(e,t){this.$h=e,this.$q=t}n.prototype.get=function(t,n){var i,o=this.$q.defer(),r={cache:Date.now()};return t&&(r.forMobile=!0),i=this.$h({timeout:o.promise,method:"POST",url:e.urls.preview,params:r,data:n}),{html:i,abort:function(){o.resolve()}}},t.service("PreviewHtml",["$http","$q",n])}),define("modules/emailbuilder/directives/previewFrame",["vendor/angular","modules/emailbuilder/module","modules/emailbuilder/services/previewHtml","config","jquery"],function(e,t,n,i,o){function r(t,n,i,o){var r={};if(o){var s=o.split(":");r.listId=s[0],s.length>1&&(r.segmentIds=s[1])}else r.previewAll=!0;var a=t.data("html-request");a&&a.abort(),e.element("#emb-body").addClass("emb-preview-loading"),t.data("html-request",i.get(n,r))}function s(t){t.data("html-request").html.then(function(n){var i=t.contents()[0];i.open(),i.write(n.data),i.close(),e.element("#emb-body").removeClass("emb-preview-loading")})}function a(t,n){n.data("html-request").html.then(function(){var r={cache:Date.now()};t&&(r.forMobile=!0),n.attr("src",[i.urls.preview,"?",o.param(r)].join("")),e.element("#emb-body").removeClass("emb-preview-loading")})}function l(t,n,i,o,l){return{restrict:"A",replace:!1,scope:{state:"@embPreviewState",previewAs:"@embPreviewAs"},link:function(c,u,d){var m=!!d.forMobile,p=i.current.isIE9?e.bind(this,a,m,u):e.bind(this,s,u),h=function(){r(u,m,o,c.previewAs),"preview"==c.state&&t(function(){n.$broadcast("email:preview:loaded"),p()},800,!1)};l.subscribe("generating",function(){u.addClass("qa-status-generating")}),l.subscribe("generated",function(){u.removeClass("qa-status-generating"),h()}),c.$watch("state",function(e){"preview"===e&&p()}),c.$watch("previewAs",function(e){h()})}}}t.directive("embPreview",["$timeout","$rootScope","BrowserSrv","PreviewHtml","SaveSvc",l])}),define("vendor/text!modules/emailbuilder/templates/previewAsDropdown.html",[],function(){return'<div class="emb-preview-as-dropdown">\r\n    <span class="emb-preview-sentence" ng-class="{\'emb-preview-as-arrow-open\': options, \'emb-preview-as-arrow-closed\': !options}"><span>Previewing</span> <a href="#" ng-click="$event.preventDefault(); $event.stopPropagation(); showOptions();">{{ selectedText }}</a><span class="emb-arrow"></span></span>\r\n    <form>\r\n        <div class="emb-preview-as-menu" ng-show="options">\r\n            <div class="emb-radio-container">\r\n              <input type="radio"\r\n                     id="emb-preview-as-input-all"\r\n                     name="emb-preview-as-input-{{id}}"\r\n                     ng-model="selected"\r\n                     value=""\r\n                     class="emb-radio"/>\r\n\r\n              <label for="c-sidebar__label emb-preview-as-input-all">All available content</label>\r\n            </div>\r\n            <span class="emb-or-split">Or, as a subscriber of:</span>\r\n            <ul class="preview-list-segments" style="max-height: 350px; overflow-y: scroll; overflow-x: hidden;">\r\n              <li ng-repeat="list in lists" class="emb-radio-container"><input type="radio" id="emb-preview-as-input-{{ list.listId }}-{{id}}" name="emb-preview-as-input-{{id}}" ng-model="$parent.selected" value="{{list.listId}}" class="emb-radio"/><label for="emb-preview-as-input-{{ list.listId }}-{{id}}">{{ list.title }}</label>\r\n\r\n                <ul class="preview-list-segments" ng-if="list.segments.length > 0">\r\n                  <li ng-repeat="segment in list.segments" class="emb-radio-container"><input type="radio" id="emb-preview-as-input-{{ list.listId }}-{{ segment.segmentId }}-{{id}}" name="emb-preview-as-input-{{id}}" ng-model="$parent.$parent.$parent.selected" value="{{list.listId}}:{{segment.segmentId}}" class="emb-radio" /><label for="emb-preview-as-input-{{ list.listId }}-{{ segment.segmentId }}-{{id}}">{{ segment.title }}</label>\r\n                  </li>\r\n                </ul>\r\n              </li>\r\n            </ul>\r\n        </div>\r\n    </form>\r\n</div>\r\n'}),define("modules/emailbuilder/directives/previewAsDropdown",["vendor/angular","modules/emailbuilder/module","config","vendor/text!modules/emailbuilder/templates/previewAsDropdown.html"],function(e,t,n,i){function o(){return this.options?void this.hideOptions():(this.deactivateContent(),void(this.options=!0))}function r(){this.options=!1}function s(t){return{restrict:"A",replace:!1,require:"ngModel",template:i,scope:{id:"@embPreviewAsDropdown",options:"=?"},link:function(i,s,a,l){function c(e,t){for(var n=0;n<i.lists.length;n++){var o=i.lists[n];if(o.listId===e){for(var r=0;r<o.segments.length;r++){var s=o.segments[r];if(s.segmentId===t)return s.title}return o.title}}return""}i.lists=e.copy(n.listsAndSegments),i.options=!!i.options;var u="all available content";i.selected="",i.selectedText=u,i.deactivateContent=function(){t.$emit("content:deactivate")},i.showOptions=e.bind(i,o),i.hideOptions=e.bind(i,r),i.$watch("selected",function(e){if(""===e)i.selectedText=u;else if(e.indexOf(":")>-1){var t=e.split(":");i.selectedText="as a subscriber of "+c(t[0],t[1])}else i.selectedText="as a subscriber of "+c(e);l.$setViewValue(e)});var d=function(e,t){i.options&&i.hideOptions()};t.$on("text:command",d),t.$on("content:deactivated",d),t.$on("content:replaced",d),t.$on("content:activated",d)}}}t.directive("embPreviewAsDropdown",["$rootScope",s])}),function(e,t){"function"==typeof define&&define.amd?define("vendor/es5-shim",t):"object"==typeof exports?module.exports=t():e.returnExports=t()}(this,function(){function e(e){return e=+e,e!==e?e=0:0!==e&&e!==1/0&&e!==-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e))),e}function t(e){var t=typeof e;return null===e||"undefined"===t||"boolean"===t||"number"===t||"string"===t}function n(e){var n,i,o;if(t(e))return e;if(i=e.valueOf,f(i)&&(n=i.call(e),t(n)))return n;if(o=e.toString,f(o)&&(n=o.call(e),t(n)))return n;throw new TypeError}function i(){}var o,r=Array.prototype,s=Object.prototype,a=Function.prototype,l=String.prototype,c=Number.prototype,u=r.slice,d=r.splice,m=(r.push,r.unshift),p=a.call,h=s.toString,f=function(e){return"[object Function]"===s.toString.call(e)},g=function(e){return"[object RegExp]"===s.toString.call(e)},v=function(e){return"[object Array]"===h.call(e)},b=function(e){return"[object String]"===h.call(e)},y=function(e){var t=h.call(e),n="[object Arguments]"===t;return n||(n=!v(e)&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&f(e.callee)),n},w=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}}();o=w?function(e,t,n,i){!i&&t in e||Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:n})}:function(e,t,n,i){!i&&t in e||(e[t]=n)};var k=function(e,t,n){for(var i in t)s.hasOwnProperty.call(t,i)&&o(e,i,t[i],n)},_=function(e){if(null==e)throw new TypeError("can't convert "+e+" to object");return Object(e)},x=function(e){return e>>>0};k(a,{bind:function(e){var t=this;if(!f(t))throw new TypeError("Function.prototype.bind called on incompatible "+t);for(var n=u.call(arguments,1),o=function(){if(this instanceof l){var i=t.apply(this,n.concat(u.call(arguments)));return Object(i)===i?i:this}return t.apply(e,n.concat(u.call(arguments)))},r=Math.max(0,t.length-n.length),s=[],a=0;a<r;a++)s.push("$"+a);var l=Function("binder","return function ("+s.join(",")+"){return binder.apply(this,arguments)}")(o);return t.prototype&&(i.prototype=t.prototype,l.prototype=new i,i.prototype=null),l}});var S,C,I,T,E,P=p.bind(s.hasOwnProperty);(E=P(s,"__defineGetter__"))&&(S=p.bind(s.__defineGetter__),C=p.bind(s.__defineSetter__),I=p.bind(s.__lookupGetter__),T=p.bind(s.__lookupSetter__));var $=function(){var e=[1,2],t=e.splice();return 2===e.length&&v(t)&&0===t.length}();k(r,{splice:function(e,t){return 0===arguments.length?[]:d.apply(this,arguments)}},$);var A=function(){var e={};return r.splice.call(e,0,0,1),1===e.length}();k(r,{splice:function(t,n){if(0===arguments.length)return[];var i=arguments;return this.length=Math.max(e(this.length),0),arguments.length>0&&"number"!=typeof n&&(i=u.call(arguments),i.length<2?i.push(this.length-t):i[1]=e(n)),d.apply(this,i)}},!A);var M=1!==[].unshift(0);k(r,{unshift:function(){return m.apply(this,arguments),this.length}},M),k(Array,{isArray:v});var L=Object("a"),F="a"!==L[0]||!(0 in L),D=function(e){var t=!0,n=!0;return e&&(e.call("foo",function(e,n,i){"object"!=typeof i&&(t=!1)}),e.call([1],function(){"use strict";n="string"==typeof this},"x")),!!e&&t&&n};k(r,{forEach:function(e){var t=_(this),n=F&&b(this)?this.split(""):t,i=arguments[1],o=-1,r=n.length>>>0;if(!f(e))throw new TypeError;for(;++o<r;)o in n&&e.call(i,n[o],o,t)}},!D(r.forEach)),k(r,{map:function(e){var t=_(this),n=F&&b(this)?this.split(""):t,i=n.length>>>0,o=Array(i),r=arguments[1];if(!f(e))throw new TypeError(e+" is not a function");for(var s=0;s<i;s++)s in n&&(o[s]=e.call(r,n[s],s,t));return o}},!D(r.map)),k(r,{filter:function(e){var t,n=_(this),i=F&&b(this)?this.split(""):n,o=i.length>>>0,r=[],s=arguments[1];if(!f(e))throw new TypeError(e+" is not a function");for(var a=0;a<o;a++)a in i&&(t=i[a],e.call(s,t,a,n)&&r.push(t));return r}},!D(r.filter)),k(r,{every:function(e){var t=_(this),n=F&&b(this)?this.split(""):t,i=n.length>>>0,o=arguments[1];if(!f(e))throw new TypeError(e+" is not a function");for(var r=0;r<i;r++)if(r in n&&!e.call(o,n[r],r,t))return!1;return!0}},!D(r.every)),k(r,{some:function(e){var t=_(this),n=F&&b(this)?this.split(""):t,i=n.length>>>0,o=arguments[1];if(!f(e))throw new TypeError(e+" is not a function");for(var r=0;r<i;r++)if(r in n&&e.call(o,n[r],r,t))return!0;return!1}},!D(r.some));var O=!1;r.reduce&&(O="object"==typeof r.reduce.call("es5",function(e,t,n,i){return i})),k(r,{reduce:function(e){var t=_(this),n=F&&b(this)?this.split(""):t,i=n.length>>>0;if(!f(e))throw new TypeError(e+" is not a function");if(!i&&1===arguments.length)throw new TypeError("reduce of empty array with no initial value");var o,r=0;if(arguments.length>=2)o=arguments[1];else for(;;){if(r in n){o=n[r++];break}if(++r>=i)throw new TypeError("reduce of empty array with no initial value")}for(;r<i;r++)r in n&&(o=e.call(void 0,o,n[r],r,t));return o}},!O);var N=!1;r.reduceRight&&(N="object"==typeof r.reduceRight.call("es5",function(e,t,n,i){return i})),k(r,{reduceRight:function(e){var t=_(this),n=F&&b(this)?this.split(""):t,i=n.length>>>0;
if(!f(e))throw new TypeError(e+" is not a function");if(!i&&1===arguments.length)throw new TypeError("reduceRight of empty array with no initial value");var o,r=i-1;if(arguments.length>=2)o=arguments[1];else for(;;){if(r in n){o=n[r--];break}if(--r<0)throw new TypeError("reduceRight of empty array with no initial value")}if(r<0)return o;do r in n&&(o=e.call(void 0,o,n[r],r,t));while(r--);return o}},!N);var B=Array.prototype.indexOf&&[0,1].indexOf(1,2)!==-1;k(r,{indexOf:function(t){var n=F&&b(this)?this.split(""):_(this),i=n.length>>>0;if(!i)return-1;var o=0;for(arguments.length>1&&(o=e(arguments[1])),o=o>=0?o:Math.max(0,i+o);o<i;o++)if(o in n&&n[o]===t)return o;return-1}},B);var R=Array.prototype.lastIndexOf&&[0,1].lastIndexOf(0,-3)!==-1;k(r,{lastIndexOf:function(t){var n=F&&b(this)?this.split(""):_(this),i=n.length>>>0;if(!i)return-1;var o=i-1;for(arguments.length>1&&(o=Math.min(o,e(arguments[1]))),o=o>=0?o:i-Math.abs(o);o>=0;o--)if(o in n&&t===n[o])return o;return-1}},R);var j=!{toString:null}.propertyIsEnumerable("toString"),z=function(){}.propertyIsEnumerable("prototype"),U=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],H=U.length;k(Object,{keys:function(e){var t=f(e),n=y(e),i=null!==e&&"object"==typeof e,o=i&&b(e);if(!i&&!t&&!n)throw new TypeError("Object.keys called on a non-object");var r=[],s=z&&t;if(o||n)for(var a=0;a<e.length;++a)r.push(String(a));else for(var l in e)s&&"prototype"===l||!P(e,l)||r.push(String(l));if(j)for(var c=e.constructor,u=c&&c.prototype===e,d=0;d<H;d++){var m=U[d];u&&"constructor"===m||!P(e,m)||r.push(m)}return r}});var W=Object.keys&&function(){return 2===Object.keys(arguments).length}(1,2),V=Object.keys;k(Object,{keys:function(e){return V(y(e)?r.slice.call(e):e)}},!W);var q=-621987552e5,X="-000001",Y=Date.prototype.toISOString&&new Date(q).toISOString().indexOf(X)===-1;k(Date.prototype,{toISOString:function(){var e,t,n,i,o;if(!isFinite(this))throw new RangeError("Date.prototype.toISOString called on non-finite value.");for(i=this.getUTCFullYear(),o=this.getUTCMonth(),i+=Math.floor(o/12),o=(o%12+12)%12,e=[o+1,this.getUTCDate(),this.getUTCHours(),this.getUTCMinutes(),this.getUTCSeconds()],i=(i<0?"-":i>9999?"+":"")+("00000"+Math.abs(i)).slice(0<=i&&i<=9999?-4:-6),t=e.length;t--;)n=e[t],n<10&&(e[t]="0"+n);return i+"-"+e.slice(0,2).join("-")+"T"+e.slice(2).join(":")+"."+("000"+this.getUTCMilliseconds()).slice(-3)+"Z"}},Y);var G=!1;try{G=Date.prototype.toJSON&&null===new Date(NaN).toJSON()&&new Date(q).toJSON().indexOf(X)!==-1&&Date.prototype.toJSON.call({toISOString:function(){return!0}})}catch(e){}G||(Date.prototype.toJSON=function(e){var t,i=Object(this),o=n(i);if("number"==typeof o&&!isFinite(o))return null;if(t=i.toISOString,"function"!=typeof t)throw new TypeError("toISOString property is not callable");return t.call(i)});var K=1e15===Date.parse("+033658-09-27T01:46:40.000Z"),Z=!isNaN(Date.parse("2012-04-04T24:00:00.500Z"))||!isNaN(Date.parse("2012-11-31T23:59:59.000Z")),J=isNaN(Date.parse("2000-01-01T00:00:00.000Z"));Date.parse&&!J&&!Z&&K||(Date=function(e){function t(n,i,o,r,s,a,l){var c=arguments.length;if(this instanceof e){var u=1===c&&String(n)===n?new e(t.parse(n)):c>=7?new e(n,i,o,r,s,a,l):c>=6?new e(n,i,o,r,s,a):c>=5?new e(n,i,o,r,s):c>=4?new e(n,i,o,r):c>=3?new e(n,i,o):c>=2?new e(n,i):c>=1?new e(n):new e;return u.constructor=t,u}return e.apply(this,arguments)}function n(e,t){var n=t>1?1:0;return r[t]+Math.floor((e-1969+n)/4)-Math.floor((e-1901+n)/100)+Math.floor((e-1601+n)/400)+365*(e-1970)}function i(t){return Number(new e(1970,0,1,0,0,0,t))}var o=new RegExp("^(\\d{4}|[+-]\\d{6})(?:-(\\d{2})(?:-(\\d{2})(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:(\\.\\d{1,}))?)?(Z|(?:([-+])(\\d{2}):(\\d{2})))?)?)?)?$"),r=[0,31,59,90,120,151,181,212,243,273,304,334,365];for(var s in e)t[s]=e[s];return t.now=e.now,t.UTC=e.UTC,t.prototype=e.prototype,t.prototype.constructor=t,t.parse=function t(r){var s=o.exec(r);if(s){var a,l=Number(s[1]),t=Number(s[2]||1)-1,c=Number(s[3]||1)-1,u=Number(s[4]||0),d=Number(s[5]||0),m=Number(s[6]||0),p=Math.floor(1e3*Number(s[7]||0)),h=Boolean(s[4]&&!s[8]),f="-"===s[9]?1:-1,g=Number(s[10]||0),v=Number(s[11]||0);return u<(d>0||m>0||p>0?24:25)&&d<60&&m<60&&p<1e3&&t>-1&&t<12&&g<24&&v<60&&c>-1&&c<n(l,t+1)-n(l,t)&&(a=60*(24*(n(l,t)+c)+u+g*f),a=1e3*(60*(a+d+v*f)+m)+p,h&&(a=i(a)),-864e13<=a&&a<=864e13)?a:NaN}return e.parse.apply(this,arguments)},t}(Date)),Date.now||(Date.now=function(){return(new Date).getTime()});var Q=c.toFixed&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0)),ee={base:1e7,size:6,data:[0,0,0,0,0,0],multiply:function(e,t){for(var n=-1;++n<ee.size;)t+=e*ee.data[n],ee.data[n]=t%ee.base,t=Math.floor(t/ee.base)},divide:function(e){for(var t=ee.size,n=0;--t>=0;)n+=ee.data[t],ee.data[t]=Math.floor(n/e),n=n%e*ee.base},numToString:function(){for(var e=ee.size,t="";--e>=0;)if(""!==t||0===e||0!==ee.data[e]){var n=String(ee.data[e]);""===t?t=n:t+="0000000".slice(0,7-n.length)+n}return t},pow:function e(t,n,i){return 0===n?i:n%2===1?e(t,n-1,i*t):e(t*t,n/2,i)},log:function(e){for(var t=0;e>=4096;)t+=12,e/=4096;for(;e>=2;)t+=1,e/=2;return t}};k(c,{toFixed:function(e){var t,n,i,o,r,s,a,l;if(t=Number(e),t=t!==t?0:Math.floor(t),t<0||t>20)throw new RangeError("Number.toFixed called with invalid number of decimals");if(n=Number(this),n!==n)return"NaN";if(n<=-1e21||n>=1e21)return String(n);if(i="",n<0&&(i="-",n=-n),o="0",n>1e-21)if(r=ee.log(n*ee.pow(2,69,1))-69,s=r<0?n*ee.pow(2,-r,1):n/ee.pow(2,r,1),s*=4503599627370496,r=52-r,r>0){for(ee.multiply(0,s),a=t;a>=7;)ee.multiply(1e7,0),a-=7;for(ee.multiply(ee.pow(10,a,1),0),a=r-1;a>=23;)ee.divide(1<<23),a-=23;ee.divide(1<<a),ee.multiply(1,1),ee.divide(2),o=ee.numToString()}else ee.multiply(0,s),ee.multiply(1<<-r,0),o=ee.numToString()+"0.00000000000000000000".slice(2,2+t);return t>0?(l=o.length,o=l<=t?i+"0.0000000000000000000".slice(0,t-l+2)+o:i+o.slice(0,l-t)+"."+o.slice(l-t)):o=i+o,o}},Q);var te=l.split;2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||"t"==="tesst".split(/(s)*/)[1]||4!=="test".split(/(?:)/,-1).length||"".split(/.?/).length||".".split(/()()/).length>1?!function(){var e=void 0===/()??/.exec("")[1];l.split=function(t,n){var i=this;if(void 0===t&&0===n)return[];if("[object RegExp]"!==h.call(t))return te.call(this,t,n);var o,s,a,l,c=[],u=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.extended?"x":"")+(t.sticky?"y":""),d=0;for(t=new RegExp(t.source,u+"g"),i+="",e||(o=new RegExp("^"+t.source+"$(?!\\s)",u)),n=void 0===n?-1>>>0:x(n);(s=t.exec(i))&&(a=s.index+s[0].length,!(a>d&&(c.push(i.slice(d,s.index)),!e&&s.length>1&&s[0].replace(o,function(){for(var e=1;e<arguments.length-2;e++)void 0===arguments[e]&&(s[e]=void 0)}),s.length>1&&s.index<i.length&&r.push.apply(c,s.slice(1)),l=s[0].length,d=a,c.length>=n)));)t.lastIndex===s.index&&t.lastIndex++;return d===i.length?!l&&t.test("")||c.push(""):c.push(i.slice(d)),c.length>n?c.slice(0,n):c}}():"0".split(void 0,0).length&&(l.split=function(e,t){return void 0===e&&0===t?[]:te.call(this,e,t)});var ne=l.replace,ie=function(){var e=[];return"x".replace(/x(.)?/g,function(t,n){e.push(n)}),1===e.length&&"undefined"==typeof e[0]}();ie||(l.replace=function(e,t){var n=f(t),i=g(e)&&/\)[*?]/.test(e.source);if(n&&i){var o=function(n){var i=arguments.length,o=e.lastIndex;e.lastIndex=0;var r=e.exec(n);return e.lastIndex=o,r.push(arguments[i-2],arguments[i-1]),t.apply(this,r)};return ne.call(this,e,o)}return ne.call(this,e,t)});var oe=l.substr,re="".substr&&"b"!=="0b".substr(-1);k(l,{substr:function(e,t){return oe.call(this,e<0&&(e=this.length+e)<0?0:e,t)}},re);var se="\t\n\v\f\r Â áš€á Žâ€€â€â€‚â€ƒâ€„â€…â€†â€‡â€ˆâ€‰â€Šâ€¯âŸã€€\u2028\u2029\ufeff",ae="â€‹",le="["+se+"]",ce=new RegExp("^"+le+le+"*"),ue=new RegExp(le+le+"*$"),de=l.trim&&(se.trim()||!ae.trim());k(l,{trim:function(){if(void 0===this||null===this)throw new TypeError("can't convert "+this+" to object");return String(this).replace(ce,"").replace(ue,"")}},de),8===parseInt(se+"08")&&22===parseInt(se+"0x16")||(parseInt=function(e){var t=/^0[xX]/;return function(n,i){return n=String(n).trim(),Number(i)||(i=t.test(n)?16:10),e(n,i)}}(parseInt))}),!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("vendor/less-2.5.1",[],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.less=e()}}(function(){return function e(t,n,i){function o(s,a){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){var n=t[s][1][e];return o(n?n:e)},u,u.exports,e,t,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;i.length>s;s++)o(i[s]);return o}({1:[function(e,t){var n=e("./utils").addDataAttr,i=e("./browser");t.exports=function(e,t){n(t,i.currentScript(e)),void 0===t.isFileProtocol&&(t.isFileProtocol=/^(file|(chrome|safari)(-extension)?|resource|qrc|app):/.test(e.location.protocol)),t.async=t.async||!1,t.fileAsync=t.fileAsync||!1,t.poll=t.poll||(t.isFileProtocol?1e3:1500),t.env=t.env||("127.0.0.1"==e.location.hostname||"0.0.0.0"==e.location.hostname||"localhost"==e.location.hostname||e.location.port&&e.location.port.length>0||t.isFileProtocol?"development":"production");var o=/!dumpLineNumbers:(comments|mediaquery|all)/.exec(e.location.hash);o&&(t.dumpLineNumbers=o[1]),void 0===t.useFileCache&&(t.useFileCache=!0),void 0===t.onReady&&(t.onReady=!0)}},{"./browser":3,"./utils":9}],2:[function(e,t){e("promise/polyfill.js");var n=window.less||{};e("./add-default-options")(window,n);var i=t.exports=e("./index")(window,n);window.less=i,n.onReady&&(/!watch/.test(window.location.hash)&&i.watch(),i.registerStylesheetsImmediately(),i.pageLoadFinished=i.refresh("development"===i.env))},{"./add-default-options":1,"./index":7,"promise/polyfill.js":94}],3:[function(e,t){var n=e("./utils");t.exports={createCSS:function(e,t,i){var o=i.href||"",r="less:"+(i.title||n.extractId(o)),s=e.getElementById(r),a=!1,l=e.createElement("style");l.setAttribute("type","text/css"),i.media&&l.setAttribute("media",i.media),l.id=r,l.styleSheet||(l.appendChild(e.createTextNode(t)),a=null!==s&&s.childNodes.length>0&&l.childNodes.length>0&&s.firstChild.nodeValue===l.firstChild.nodeValue);var c=e.getElementsByTagName("head")[0];if(null===s||a===!1){var u=i&&i.nextSibling||null;u?u.parentNode.insertBefore(l,u):c.appendChild(l)}if(s&&a===!1&&s.parentNode.removeChild(s),l.styleSheet)try{l.styleSheet.cssText=t}catch(e){throw new Error("Couldn't reassign styleSheet.cssText.")}},currentScript:function(e){var t=e.document;return t.currentScript||function(){var e=t.getElementsByTagName("script");return e[e.length-1]}()}}},{"./utils":9}],4:[function(e,t){t.exports=function(e,t,n){var i=null;if("development"!==t.env)try{i="undefined"==typeof e.localStorage?null:e.localStorage}catch(e){}return{setCSS:function(e,t,o){if(i){n.info("saving "+e+" to cache.");try{i.setItem(e,o),i.setItem(e+":timestamp",t)}catch(t){n.error('failed to save "'+e+'" to local storage for caching.')}}},getCSS:function(e,t){var n=i&&i.getItem(e),o=i&&i.getItem(e+":timestamp");return o&&t.lastModified&&new Date(t.lastModified).valueOf()===new Date(o).valueOf()?n:void 0}}}},{}],5:[function(e,t){var n=e("./utils"),i=e("./browser");t.exports=function(e,t,o){function r(t,r){var s,a,l="less-error-message:"+n.extractId(r||""),c='<li><label>{line}</label><pre class="{class}">{content}</pre></li>',u=e.document.createElement("div"),d=[],m=t.filename||r,p=m.match(/([^\/]+(\?.*)?)$/)[1];u.id=l,u.className="less-error-message",a="<h3>"+(t.type||"Syntax")+"Error: "+(t.message||"There is an error in your .less file")+'</h3><p>in <a href="'+m+'">'+p+"</a> ";var h=function(e,t,n){void 0!==e.extract[t]&&d.push(c.replace(/\{line\}/,(parseInt(e.line,10)||0)+(t-1)).replace(/\{class\}/,n).replace(/\{content\}/,e.extract[t]))};t.extract&&(h(t,0,""),h(t,1,"line"),h(t,2,""),a+="on line "+t.line+", column "+(t.column+1)+":</p><ul>"+d.join("")+"</ul>"),t.stack&&(t.extract||o.logLevel>=4)&&(a+="<br/>Stack Trace</br />"+t.stack.split("\n").slice(1).join("<br/>")),u.innerHTML=a,i.createCSS(e.document,[".less-error-message ul, .less-error-message li {","list-style-type: none;","margin-right: 15px;","padding: 4px 0;","margin: 0;","}",".less-error-message label {","font-size: 12px;","margin-right: 15px;","padding: 4px 0;","color: #cc7777;","}",".less-error-message pre {","color: #dd6666;","padding: 4px 0;","margin: 0;","display: inline-block;","}",".less-error-message pre.line {","color: #ff0000;","}",".less-error-message h3 {","font-size: 20px;","font-weight: bold;","padding: 15px 0 5px 0;","margin: 0;","}",".less-error-message a {","color: #10a","}",".less-error-message .error {","color: red;","font-weight: bold;","padding-bottom: 2px;","border-bottom: 1px dashed red;","}"].join("\n"),{title:"error-message"}),u.style.cssText=["font-family: Arial, sans-serif","border: 1px solid #e00","background-color: #eee","border-radius: 5px","-webkit-border-radius: 5px","-moz-border-radius: 5px","color: #e00","padding: 15px","margin-bottom: 15px"].join(";"),"development"===o.env&&(s=setInterval(function(){var t=e.document,n=t.body;n&&(t.getElementById(l)?n.replaceChild(u,t.getElementById(l)):n.insertBefore(u,n.firstChild),clearInterval(s))},10))}function s(e,t){o.errorReporting&&"html"!==o.errorReporting?"console"===o.errorReporting?u(e,t):"function"==typeof o.errorReporting&&o.errorReporting("add",e,t):r(e,t)}function a(t){var i=e.document.getElementById("less-error-message:"+n.extractId(t));i&&i.parentNode.removeChild(i)}function l(){}function c(e){o.errorReporting&&"html"!==o.errorReporting?"console"===o.errorReporting?l(e):"function"==typeof o.errorReporting&&o.errorReporting("remove",e):a(e)}function u(e,n){var i="{line} {content}",r=e.filename||n,s=[],a=(e.type||"Syntax")+"Error: "+(e.message||"There is an error in your .less file")+" in "+r+" ",l=function(e,t,n){void 0!==e.extract[t]&&s.push(i.replace(/\{line\}/,(parseInt(e.line,10)||0)+(t-1)).replace(/\{class\}/,n).replace(/\{content\}/,e.extract[t]))};e.extract&&(l(e,0,""),l(e,1,"line"),l(e,2,""),a+="on line "+e.line+", column "+(e.column+1)+":\n"+s.join("\n")),e.stack&&(e.extract||o.logLevel>=4)&&(a+="\nStack Trace\n"+e.stack),t.logger.error(a)}return{add:s,remove:c}}},{"./browser":3,"./utils":9}],6:[function(e,t){t.exports=function(t,n){function i(){if(window.XMLHttpRequest&&!("file:"===window.location.protocol&&"ActiveXObject"in window))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){return n.error("browser doesn't support AJAX."),null}}var o=e("../less/environment/abstract-file-manager.js"),r={},s=function(){};return s.prototype=new o,s.prototype.alwaysMakePathsAbsolute=function(){return!0},s.prototype.join=function(e,t){return e?this.extractUrlParts(t,e).path:t},s.prototype.doXHR=function(e,o,r,s){function a(t,n,i){t.status>=200&&300>t.status?n(t.responseText,t.getResponseHeader("Last-Modified")):"function"==typeof i&&i(t.status,e)}var l=i(),c=t.isFileProtocol?t.fileAsync:t.async;"function"==typeof l.overrideMimeType&&l.overrideMimeType("text/css"),n.debug("XHR: Getting '"+e+"'"),l.open("GET",e,c),l.setRequestHeader("Accept",o||"text/x-less, text/css; q=0.9, */*; q=0.5"),l.send(null),t.isFileProtocol&&!t.fileAsync?0===l.status||l.status>=200&&300>l.status?r(l.responseText):s(l.status,e):c?l.onreadystatechange=function(){4==l.readyState&&a(l,r,s)}:a(l,r,s)},s.prototype.supports=function(){return!0},s.prototype.clearFileCache=function(){r={}},s.prototype.loadFile=function(e,t,n,i,o){t&&!this.isPathAbsolute(e)&&(e=t+e),n=n||{};var s=this.extractUrlParts(e,window.location.href),a=s.url;if(n.useFileCache&&r[a])try{var l=r[a];o(null,{contents:l,filename:a,webInfo:{lastModified:new Date}})}catch(e){o({filename:a,message:"Error loading file "+a+" error was "+e.message})}else this.doXHR(a,n.mime,function(e,t){r[a]=e,o(null,{contents:e,filename:a,webInfo:{lastModified:t}})},function(e,t){o({type:"File",message:"'"+t+"' wasn't found ("+e+")",href:a})})},s}},{"../less/environment/abstract-file-manager.js":14}],7:[function(e,t){var n=e("./utils").addDataAttr,i=e("./browser");t.exports=function(t,o){function r(e){return o.postProcessor&&"function"==typeof o.postProcessor&&(e=o.postProcessor.call(e,e)||e),e}function s(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function a(e,t){var n=Array.prototype.slice.call(arguments,2);return function(){var i=n.concat(Array.prototype.slice.call(arguments,0));return e.apply(t,i)}}function l(e){for(var t,n=m.getElementsByTagName("style"),i=0;n.length>i;i++)if(t=n[i],t.type.match(y)){var r=s(o);r.modifyVars=e;var l=t.innerHTML||"";r.filename=m.location.href.replace(/#.*$/,""),p.render(l,r,a(function(e,t,n){t?v.add(t,"inline"):(e.type="text/css",e.styleSheet?e.styleSheet.cssText=n.css:e.innerHTML=n.css)},null,t))}}function c(e,t,i,a,l){function c(n){var o=n.contents,s=n.filename,l=n.webInfo,c={currentDirectory:g.getPath(s),filename:s,rootFilename:s,relativeUrls:u.relativeUrls};if(c.entryPath=c.currentDirectory,c.rootpath=u.rootpath||c.currentDirectory,l&&(l.remaining=a,!u.modifyVars)){var d=b.getCSS(s,l);if(!i&&d)return l.local=!0,void t(null,d,o,e,l,s)}v.remove(s),u.rootFileInfo=c,p.render(o,u,function(n,i){n?(n.href=s,t(n)):(i.css=r(i.css),u.modifyVars||b.setCSS(e.href,l.lastModified,i.css),t(null,i.css,o,e,l,s))})}var u=s(o);n(u,e),u.mime=e.type,l&&(u.modifyVars=l),g.loadFile(e.href,null,u,h,function(e,n){return e?void t(e):void c(n)})}function u(e,t,n){for(var i=0;p.sheets.length>i;i++)c(p.sheets[i],e,t,p.sheets.length-(i+1),n)}function d(){"development"===p.env&&(p.watchTimer=setInterval(function(){p.watchMode&&(g.clearFileCache(),u(function(e,n,o,r){e?v.add(e,e.href||r.href):n&&i.createCSS(t.document,n,r)}))},o.poll))}var m=t.document,p=e("../less")();p.options=o;var h=p.environment,f=e("./file-manager")(o,p.logger),g=new f;h.addFileManager(g),p.FileManager=f,e("./log-listener")(p,o);var v=e("./error-reporting")(t,p,o),b=p.cache=o.cache||e("./cache")(t,o,p.logger);o.functions&&p.functions.functionRegistry.addMultiple(o.functions);var y=/^text\/(x-)?less$/;return p.watch=function(){return p.watchMode||(p.env="development",d()),this.watchMode=!0,!0},p.unwatch=function(){return clearInterval(p.watchTimer),this.watchMode=!1,!1},p.registerStylesheetsImmediately=function(){var e=m.getElementsByTagName("link");p.sheets=[];for(var t=0;e.length>t;t++)("stylesheet/less"===e[t].rel||e[t].rel.match(/stylesheet/)&&e[t].type.match(y))&&p.sheets.push(e[t])},p.registerStylesheets=function(){return new Promise(function(e){p.registerStylesheetsImmediately(),e()})},p.modifyVars=function(e){return p.refresh(!0,e,!1)},p.refresh=function(e,n,o){return(e||o)&&o!==!1&&g.clearFileCache(),new Promise(function(o,r){var s,a,c;s=a=new Date,u(function(e,n,l,u,d){return e?(v.add(e,e.href||u.href),void r(e)):(p.logger.info(d.local?"loading "+u.href+" from cache.":"rendered "+u.href+" successfully."),i.createCSS(t.document,n,u),p.logger.info("css for "+u.href+" generated in "+(new Date-a)+"ms"),0===d.remaining&&(c=new Date-s,p.logger.info("less has finished. css generated in "+c+"ms"),o({startTime:s,endTime:a,totalMilliseconds:c,sheets:p.sheets.length})),void(a=new Date))},e,n),l(n)})},p.refreshStyles=l,p}},{"../less":29,"./browser":3,"./cache":4,"./error-reporting":5,"./file-manager":6,"./log-listener":8,"./utils":9}],8:[function(e,t){t.exports=function(e,t){var n=4,i=3,o=2,r=1;t.logLevel="undefined"!=typeof t.logLevel?t.logLevel:"development"===t.env?i:r,t.loggers||(t.loggers=[{debug:function(e){t.logLevel>=n&&console.log(e)},info:function(e){t.logLevel>=i&&console.log(e)},warn:function(e){t.logLevel>=o&&console.warn(e)},error:function(e){t.logLevel>=r&&console.error(e)}}]);for(var s=0;t.loggers.length>s;s++)e.logger.addListener(t.loggers[s])}},{}],9:[function(e,t){t.exports={extractId:function(e){return e.replace(/^[a-z-]+:\/+?[^\/]+/,"").replace(/[\?\&]livereload=\w+/,"").replace(/^\//,"").replace(/\.[a-zA-Z]+$/,"").replace(/[^\.\w-]+/g,"-").replace(/\./g,":")},addDataAttr:function(e,t){for(var n in t.dataset)if(t.dataset.hasOwnProperty(n))if("env"===n||"dumpLineNumbers"===n||"rootpath"===n||"errorReporting"===n)e[n]=t.dataset[n];else try{e[n]=JSON.parse(t.dataset[n])}catch(e){}}}},{}],10:[function(e,t){var n={};t.exports=n;var i=function(e,t,n){if(e)for(var i=0;n.length>i;i++)e.hasOwnProperty(n[i])&&(t[n[i]]=e[n[i]])},o=["paths","relativeUrls","rootpath","strictImports","insecure","dumpLineNumbers","compress","syncImport","chunkInput","mime","useFileCache","processImports","reference","pluginManager"];n.Parse=function(e){i(e,this,o),"string"==typeof this.paths&&(this.paths=[this.paths])};var r=["paths","compress","ieCompat","strictMath","strictUnits","sourceMap","importMultiple","urlArgs","javascriptEnabled","pluginManager","importantScope"];n.Eval=function(e,t){i(e,this,r),"string"==typeof this.paths&&(this.paths=[this.paths]),this.frames=t||[],this.importantScope=this.importantScope||[]},n.Eval.prototype.inParenthesis=function(){this.parensStack||(this.parensStack=[]),this.parensStack.push(!0)},n.Eval.prototype.outOfParenthesis=function(){this.parensStack.pop()},n.Eval.prototype.isMathOn=function(){return!this.strictMath||this.parensStack&&this.parensStack.length},n.Eval.prototype.isPathRelative=function(e){return!/^(?:[a-z-]+:|\/|#)/i.test(e)},n.Eval.prototype.normalizePath=function(e){var t,n=e.split("/").reverse();for(e=[];0!==n.length;)switch(t=n.pop()){case".":break;case"..":0===e.length||".."===e[e.length-1]?e.push(t):e.pop();break;default:e.push(t)}return e.join("/")}},{}],11:[function(e,t){t.exports={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"}},{}],12:[function(e,t){t.exports={colors:e("./colors"),unitConversions:e("./unit-conversions")}},{"./colors":11,"./unit-conversions":13}],13:[function(e,t){t.exports={length:{m:1,cm:.01,mm:.001,in:.0254,px:.0254/96,pt:.0254/72,pc:.0254/72*12},duration:{s:1,ms:.001},angle:{rad:1/(2*Math.PI),deg:1/360,grad:.0025,turn:1}}},{}],14:[function(e,t){var n=function(){};n.prototype.getPath=function(e){var t=e.lastIndexOf("?");return t>0&&(e=e.slice(0,t)),t=e.lastIndexOf("/"),0>t&&(t=e.lastIndexOf("\\")),0>t?"":e.slice(0,t+1)},n.prototype.tryAppendExtension=function(e,t){return/(\.[a-z]*$)|([\?;].*)$/.test(e)?e:e+t},n.prototype.tryAppendLessExtension=function(e){return this.tryAppendExtension(e,".less")},n.prototype.supportsSync=function(){return!1},n.prototype.alwaysMakePathsAbsolute=function(){return!1},n.prototype.isPathAbsolute=function(e){return/^(?:[a-z-]+:|\/|\\|#)/i.test(e)},n.prototype.join=function(e,t){return e?e+t:t},n.prototype.pathDiff=function(e,t){var n,i,o,r,s=this.extractUrlParts(e),a=this.extractUrlParts(t),l="";if(s.hostPart!==a.hostPart)return"";for(i=Math.max(a.directories.length,s.directories.length),n=0;i>n&&a.directories[n]===s.directories[n];n++);for(r=a.directories.slice(n),o=s.directories.slice(n),n=0;r.length-1>n;n++)l+="../";for(n=0;o.length-1>n;n++)l+=o[n]+"/";return l},n.prototype.extractUrlParts=function(e,t){var n,i,o=/^((?:[a-z-]+:)?\/+?(?:[^\/\?#]*\/)|([\/\\]))?((?:[^\/\\\?#]*[\/\\])*)([^\/\\\?#]*)([#\?].*)?$/i,r=e.match(o),s={},a=[];if(!r)throw new Error("Could not parse sheet href - '"+e+"'");if(t&&(!r[1]||r[2])){if(i=t.match(o),!i)throw new Error("Could not parse page url - '"+t+"'");r[1]=r[1]||i[1]||"",r[2]||(r[3]=i[3]+r[3])}if(r[3]){for(a=r[3].replace(/\\/g,"/").split("/"),n=0;a.length>n;n++)"."===a[n]&&(a.splice(n,1),n-=1);for(n=0;a.length>n;n++)".."===a[n]&&n>0&&(a.splice(n-1,2),n-=2)}return s.hostPart=r[1],s.directories=a,s.path=(r[1]||"")+a.join("/"),s.fileUrl=s.path+(r[4]||""),s.url=s.fileUrl+(r[5]||""),s},t.exports=n},{}],15:[function(e,t){var n=e("../logger"),i=function(e,t){this.fileManagers=t||[],e=e||{};for(var n=["encodeBase64","mimeLookup","charsetLookup","getSourceMapGenerator"],i=[],o=i.concat(n),r=0;o.length>r;r++){var s=o[r],a=e[s];a?this[s]=a.bind(e):i.length>r&&this.warn("missing required function in environment - "+s)}};i.prototype.getFileManager=function(e,t,i,o,r){e||n.warn("getFileManager called with no filename.. Please report this issue. continuing."),null==t&&n.warn("getFileManager called with null directory.. Please report this issue. continuing.");var s=this.fileManagers;i.pluginManager&&(s=[].concat(s).concat(i.pluginManager.getFileManagers()));for(var a=s.length-1;a>=0;a--){var l=s[a];if(l[r?"supportsSync":"supports"](e,t,i,o))return l}return null},i.prototype.addFileManager=function(e){this.fileManagers.push(e)},i.prototype.clearFileManagers=function(){this.fileManagers=[]},t.exports=i},{"../logger":31}],16:[function(e){function t(e,t,i){var o,r,s,a,l=t.alpha,c=i.alpha,u=[];s=c+l*(1-c);for(var d=0;3>d;d++)o=t.rgb[d]/255,r=i.rgb[d]/255,a=e(o,r),s&&(a=(c*r+l*(o-c*(o+r-a)))/s),u[d]=255*a;return new n(u,s)}var n=e("../tree/color"),i=e("./function-registry"),o={multiply:function(e,t){return e*t},screen:function(e,t){return e+t-e*t},overlay:function(e,t){return e*=2,1>=e?o.multiply(e,t):o.screen(e-1,t)},softlight:function(e,t){var n=1,i=e;return t>.5&&(i=1,n=e>.25?Math.sqrt(e):((16*e-12)*e+4)*e),e-(1-2*t)*i*(n-e)},hardlight:function(e,t){return o.overlay(t,e)},difference:function(e,t){return Math.abs(e-t)},exclusion:function(e,t){return e+t-2*e*t},average:function(e,t){return(e+t)/2},negation:function(e,t){return 1-Math.abs(e+t-1)}};for(var r in o)o.hasOwnProperty(r)&&(t[r]=t.bind(null,o[r]));i.addMultiple(t)},{"../tree/color":48,"./function-registry":21}],17:[function(e){function t(e){return Math.min(1,Math.max(0,e))}function n(e){return r.hsla(e.h,e.s,e.l,e.a)}function i(e){if(e instanceof s)return parseFloat(e.unit.is("%")?e.value/100:e.value);if("number"==typeof e)return e;throw{type:"Argument",message:"color functions take numbers as parameters"}}function o(e,t){return e instanceof s&&e.unit.is("%")?parseFloat(e.value*t/100):i(e)}var r,s=e("../tree/dimension"),a=e("../tree/color"),l=e("../tree/quoted"),c=e("../tree/anonymous"),u=e("./function-registry");r={rgb:function(e,t,n){return r.rgba(e,t,n,1)},rgba:function(e,t,n,r){var s=[e,t,n].map(function(e){return o(e,255)});return r=i(r),new a(s,r)},hsl:function(e,t,n){return r.hsla(e,t,n,1)},hsla:function(e,n,o,s){function a(e){return e=0>e?e+1:e>1?e-1:e,1>6*e?c+(l-c)*e*6:1>2*e?l:2>3*e?c+(l-c)*(2/3-e)*6:c}e=i(e)%360/360,n=t(i(n)),o=t(i(o)),s=t(i(s));var l=.5>=o?o*(n+1):o+n-o*n,c=2*o-l;return r.rgba(255*a(e+1/3),255*a(e),255*a(e-1/3),s)},hsv:function(e,t,n){return r.hsva(e,t,n,1)},hsva:function(e,t,n,o){e=i(e)%360/360*360,t=i(t),n=i(n),o=i(o);var s,a;s=Math.floor(e/60%6),a=e/60-s;var l=[n,n*(1-t),n*(1-a*t),n*(1-(1-a)*t)],c=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]];return r.rgba(255*l[c[s][0]],255*l[c[s][1]],255*l[c[s][2]],o)},hue:function(e){return new s(e.toHSL().h)},saturation:function(e){return new s(100*e.toHSL().s,"%")},lightness:function(e){return new s(100*e.toHSL().l,"%")},hsvhue:function(e){return new s(e.toHSV().h)},hsvsaturation:function(e){return new s(100*e.toHSV().s,"%")},hsvvalue:function(e){return new s(100*e.toHSV().v,"%")},red:function(e){return new s(e.rgb[0])},green:function(e){return new s(e.rgb[1])},blue:function(e){return new s(e.rgb[2])},alpha:function(e){return new s(e.toHSL().a)},luma:function(e){return new s(e.luma()*e.alpha*100,"%")},luminance:function(e){var t=.2126*e.rgb[0]/255+.7152*e.rgb[1]/255+.0722*e.rgb[2]/255;return new s(t*e.alpha*100,"%")},saturate:function(e,i,o){if(!e.rgb)return null;var r=e.toHSL();return r.s+="undefined"!=typeof o&&"relative"===o.value?r.s*i.value/100:i.value/100,r.s=t(r.s),n(r)},desaturate:function(e,i,o){var r=e.toHSL();return r.s-="undefined"!=typeof o&&"relative"===o.value?r.s*i.value/100:i.value/100,r.s=t(r.s),n(r)},lighten:function(e,i,o){var r=e.toHSL();return r.l+="undefined"!=typeof o&&"relative"===o.value?r.l*i.value/100:i.value/100,r.l=t(r.l),n(r)},darken:function(e,i,o){var r=e.toHSL();return r.l-="undefined"!=typeof o&&"relative"===o.value?r.l*i.value/100:i.value/100,r.l=t(r.l),n(r)},fadein:function(e,i,o){var r=e.toHSL();return r.a+="undefined"!=typeof o&&"relative"===o.value?r.a*i.value/100:i.value/100,r.a=t(r.a),n(r)},fadeout:function(e,i,o){var r=e.toHSL();return r.a-="undefined"!=typeof o&&"relative"===o.value?r.a*i.value/100:i.value/100,r.a=t(r.a),n(r)},fade:function(e,i){var o=e.toHSL();return o.a=i.value/100,o.a=t(o.a),n(o)},spin:function(e,t){var i=e.toHSL(),o=(i.h+t.value)%360;return i.h=0>o?360+o:o,n(i)},mix:function(e,t,n){e.toHSL&&t.toHSL||(console.log(t.type),console.dir(t)),n||(n=new s(50));var i=n.value/100,o=2*i-1,r=e.toHSL().a-t.toHSL().a,l=((o*r==-1?o:(o+r)/(1+o*r))+1)/2,c=1-l,u=[e.rgb[0]*l+t.rgb[0]*c,e.rgb[1]*l+t.rgb[1]*c,e.rgb[2]*l+t.rgb[2]*c],d=e.alpha*i+t.alpha*(1-i);return new a(u,d)},greyscale:function(e){return r.desaturate(e,new s(100))},contrast:function(e,t,n,o){if(!e.rgb)return null;if("undefined"==typeof n&&(n=r.rgba(255,255,255,1)),
"undefined"==typeof t&&(t=r.rgba(0,0,0,1)),t.luma()>n.luma()){var s=n;n=t,t=s}return o="undefined"==typeof o?.43:i(o),e.luma()<o?n:t},argb:function(e){return new c(e.toARGB())},color:function(e){if(e instanceof l&&/^#([a-f0-9]{6}|[a-f0-9]{3})$/i.test(e.value))return new a(e.value.slice(1));if(e instanceof a||(e=a.fromKeyword(e.value)))return e.value=void 0,e;throw{type:"Argument",message:"argument must be a color keyword or 3/6 digit hex e.g. #FFF"}},tint:function(e,t){return r.mix(r.rgb(255,255,255),e,t)},shade:function(e,t){return r.mix(r.rgb(0,0,0),e,t)}},u.addMultiple(r)},{"../tree/anonymous":44,"../tree/color":48,"../tree/dimension":54,"../tree/quoted":71,"./function-registry":21}],18:[function(e,t){t.exports=function(t){var n=e("../tree/quoted"),i=e("../tree/url"),o=e("./function-registry"),r=function(e,t){return new i(t,e.index,e.currentFileInfo).eval(e.context)},s=e("../logger");o.add("data-uri",function(e,o){o||(o=e,e=null);var a=e&&e.value,l=o.value,c=this.currentFileInfo,u=c.relativeUrls?c.currentDirectory:c.entryPath,d=l.indexOf("#"),m="";-1!==d&&(m=l.slice(d),l=l.slice(0,d));var p=t.getFileManager(l,u,this.context,t,!0);if(!p)return r(this,o);var h=!1;if(e)h=/;base64$/.test(a);else{if(a=t.mimeLookup(l),"image/svg+xml"===a)h=!1;else{var f=t.charsetLookup(a);h=["US-ASCII","UTF-8"].indexOf(f)<0}h&&(a+=";base64")}var g=p.loadFileSync(l,u,this.context,t);if(!g.contents)return s.warn("Skipped data-uri embedding of "+l+" because file not found"),r(this,o||e);var v=g.contents;if(h&&!t.encodeBase64)return r(this,o);v=h?t.encodeBase64(v):encodeURIComponent(v);var b="data:"+a+","+v+m,y=32768;return b.length>=y&&this.context.ieCompat!==!1?(s.warn("Skipped data-uri embedding of "+l+" because its size ("+b.length+" characters) exceeds IE8-safe "+y+" characters!"),r(this,o||e)):new i(new n('"'+b+'"',b,!1,this.index,this.currentFileInfo),this.index,this.currentFileInfo)})}},{"../logger":31,"../tree/quoted":71,"../tree/url":78,"./function-registry":21}],19:[function(e,t){var n=e("../tree/keyword"),i=e("./function-registry"),o={eval:function(){var e=this.value_,t=this.error_;if(t)throw t;return null!=e?e?n.True:n.False:void 0},value:function(e){this.value_=e},error:function(e){this.error_=e},reset:function(){this.value_=this.error_=null}};i.add("default",o.eval.bind(o)),t.exports=o},{"../tree/keyword":63,"./function-registry":21}],20:[function(e,t){var n=e("../tree/expression"),i=function(e,t,n,i){this.name=e.toLowerCase(),this.index=n,this.context=t,this.currentFileInfo=i,this.func=t.frames[0].functionRegistry.get(this.name)};i.prototype.isValid=function(){return Boolean(this.func)},i.prototype.call=function(e){return Array.isArray(e)&&(e=e.filter(function(e){return"Comment"!==e.type}).map(function(e){if("Expression"===e.type){var t=e.value.filter(function(e){return"Comment"!==e.type});return 1===t.length?t[0]:new n(t)}return e})),this.func.apply(this,e)},t.exports=i},{"../tree/expression":57}],21:[function(e,t){function n(e){return{_data:{},add:function(e,t){e=e.toLowerCase(),this._data.hasOwnProperty(e),this._data[e]=t},addMultiple:function(e){Object.keys(e).forEach(function(t){this.add(t,e[t])}.bind(this))},get:function(t){return this._data[t]||e&&e.get(t)},inherit:function(){return n(this)}}}t.exports=n(null)},{}],22:[function(e,t){t.exports=function(t){var n={functionRegistry:e("./function-registry"),functionCaller:e("./function-caller")};return e("./default"),e("./color"),e("./color-blending"),e("./data-uri")(t),e("./math"),e("./number"),e("./string"),e("./svg")(t),e("./types"),n}},{"./color":17,"./color-blending":16,"./data-uri":18,"./default":19,"./function-caller":20,"./function-registry":21,"./math":23,"./number":24,"./string":25,"./svg":26,"./types":27}],23:[function(e){function t(e,t,i){if(!(i instanceof n))throw{type:"Argument",message:"argument must be a number"};return null==t?t=i.unit:i=i.unify(),new n(e(parseFloat(i.value)),t)}var n=e("../tree/dimension"),i=e("./function-registry"),o={ceil:null,floor:null,sqrt:null,abs:null,tan:"",sin:"",cos:"",atan:"rad",asin:"rad",acos:"rad"};for(var r in o)o.hasOwnProperty(r)&&(o[r]=t.bind(null,Math[r],o[r]));o.round=function(e,n){var i="undefined"==typeof n?0:n.value;return t(function(e){return e.toFixed(i)},null,e)},i.addMultiple(o)},{"../tree/dimension":54,"./function-registry":21}],24:[function(e){var t=e("../tree/dimension"),n=e("../tree/anonymous"),i=e("./function-registry"),o=function(e,i){switch(i=Array.prototype.slice.call(i),i.length){case 0:throw{type:"Argument",message:"one or more arguments required"}}var o,r,s,a,l,c,u,d,m=[],p={};for(o=0;i.length>o;o++)if(s=i[o],s instanceof t)if(a=""===s.unit.toString()&&void 0!==d?new t(s.value,d).unify():s.unify(),c=""===a.unit.toString()&&void 0!==u?u:a.unit.toString(),u=""!==c&&void 0===u||""!==c&&""===m[0].unify().unit.toString()?c:u,d=""!==c&&void 0===d?s.unit.toString():d,r=void 0!==p[""]&&""!==c&&c===u?p[""]:p[c],void 0!==r)l=""===m[r].unit.toString()&&void 0!==d?new t(m[r].value,d).unify():m[r].unify(),(e&&l.value>a.value||!e&&a.value>l.value)&&(m[r]=s);else{if(void 0!==u&&c!==u)throw{type:"Argument",message:"incompatible types"};p[c]=m.length,m.push(s)}else Array.isArray(i[o].value)&&Array.prototype.push.apply(i,Array.prototype.slice.call(i[o].value));return 1==m.length?m[0]:(i=m.map(function(e){return e.toCSS(this.context)}).join(this.context.compress?",":", "),new n((e?"min":"max")+"("+i+")"))};i.addMultiple({min:function(){return o(!0,arguments)},max:function(){return o(!1,arguments)},convert:function(e,t){return e.convertTo(t.value)},pi:function(){return new t(Math.PI)},mod:function(e,n){return new t(e.value%n.value,e.unit)},pow:function(e,n){if("number"==typeof e&&"number"==typeof n)e=new t(e),n=new t(n);else if(!(e instanceof t&&n instanceof t))throw{type:"Argument",message:"arguments must be numbers"};return new t(Math.pow(e.value,n.value),e.unit)},percentage:function(e){return new t(100*e.value,"%")}})},{"../tree/anonymous":44,"../tree/dimension":54,"./function-registry":21}],25:[function(e){var t=e("../tree/quoted"),n=e("../tree/anonymous"),i=e("../tree/javascript"),o=e("./function-registry");o.addMultiple({e:function(e){return new n(e instanceof i?e.evaluated:e.value)},escape:function(e){return new n(encodeURI(e.value).replace(/=/g,"%3D").replace(/:/g,"%3A").replace(/#/g,"%23").replace(/;/g,"%3B").replace(/\(/g,"%28").replace(/\)/g,"%29"))},replace:function(e,n,i,o){var r=e.value;return i="Quoted"===i.type?i.value:i.toCSS(),r=r.replace(new RegExp(n.value,o?o.value:""),i),new t(e.quote||"",r,e.escaped)},"%":function(e){for(var n=Array.prototype.slice.call(arguments,1),i=e.value,o=0;n.length>o;o++)i=i.replace(/%[sda]/i,function(e){var t="Quoted"===n[o].type&&e.match(/s/i)?n[o].value:n[o].toCSS();return e.match(/[A-Z]$/)?encodeURIComponent(t):t});return i=i.replace(/%%/g,"%"),new t(e.quote||"",i,e.escaped)}})},{"../tree/anonymous":44,"../tree/javascript":61,"../tree/quoted":71,"./function-registry":21}],26:[function(e,t){t.exports=function(){var t=e("../tree/dimension"),n=e("../tree/color"),i=e("../tree/expression"),o=e("../tree/quoted"),r=e("../tree/url"),s=e("./function-registry");s.add("svg-gradient",function(e){function s(){throw{type:"Argument",message:"svg-gradient expects direction, start_color [start_position], [color position,]..., end_color [end_position] or direction, color list"}}var a,l,c,u,d,m,p,h,f="linear",g='x="0" y="0" width="1" height="1"',v={compress:!1},b=e.toCSS(v);switch(2==arguments.length?(arguments[1].value.length<2&&s(),a=arguments[1].value):arguments.length<3?s():a=Array.prototype.slice.call(arguments,1),b){case"to bottom":l='x1="0%" y1="0%" x2="0%" y2="100%"';break;case"to right":l='x1="0%" y1="0%" x2="100%" y2="0%"';break;case"to bottom right":l='x1="0%" y1="0%" x2="100%" y2="100%"';break;case"to top right":l='x1="0%" y1="100%" x2="100%" y2="0%"';break;case"ellipse":case"ellipse at center":f="radial",l='cx="50%" cy="50%" r="75%"',g='x="-50" y="-50" width="101" height="101"';break;default:throw{type:"Argument",message:"svg-gradient direction must be 'to bottom', 'to right', 'to bottom right', 'to top right' or 'ellipse at center'"}}for(c='<?xml version="1.0" ?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="100%" height="100%" viewBox="0 0 1 1" preserveAspectRatio="none"><'+f+'Gradient id="gradient" gradientUnits="userSpaceOnUse" '+l+">",u=0;a.length>u;u+=1)a[u]instanceof i?(d=a[u].value[0],m=a[u].value[1]):(d=a[u],m=void 0),d instanceof n&&((0===u||u+1===a.length)&&void 0===m||m instanceof t)||s(),p=m?m.toCSS(v):0===u?"0%":"100%",h=d.alpha,c+='<stop offset="'+p+'" stop-color="'+d.toRGB()+'"'+(1>h?' stop-opacity="'+h+'"':"")+"/>";return c+="</"+f+"Gradient><rect "+g+' fill="url(#gradient)" /></svg>',c=encodeURIComponent(c),c="data:image/svg+xml,"+c,new r(new o("'"+c+"'",c,!1,this.index,this.currentFileInfo),this.index,this.currentFileInfo)})}},{"../tree/color":48,"../tree/dimension":54,"../tree/expression":57,"../tree/quoted":71,"../tree/url":78,"./function-registry":21}],27:[function(e){var t=e("../tree/keyword"),n=e("../tree/detached-ruleset"),i=e("../tree/dimension"),o=e("../tree/color"),r=e("../tree/quoted"),s=e("../tree/anonymous"),a=e("../tree/url"),l=e("../tree/operation"),c=e("./function-registry"),u=function(e,n){return e instanceof n?t.True:t.False},d=function(e,n){if(void 0===n)throw{type:"Argument",message:"missing the required second argument to isunit."};if(n="string"==typeof n.value?n.value:n,"string"!=typeof n)throw{type:"Argument",message:"Second argument to isunit should be a unit or a string."};return e instanceof i&&e.unit.is(n)?t.True:t.False},m=function(e){var t=Array.isArray(e.value)?e.value:Array(e);return t};c.addMultiple({isruleset:function(e){return u(e,n)},iscolor:function(e){return u(e,o)},isnumber:function(e){return u(e,i)},isstring:function(e){return u(e,r)},iskeyword:function(e){return u(e,t)},isurl:function(e){return u(e,a)},ispixel:function(e){return d(e,"px")},ispercentage:function(e){return d(e,"%")},isem:function(e){return d(e,"em")},isunit:d,unit:function(e,n){if(!(e instanceof i))throw{type:"Argument",message:"the first argument to unit must be a number"+(e instanceof l?". Have you forgotten parenthesis?":"")};return n=n?n instanceof t?n.value:n.toCSS():"",new i(e.value,n)},"get-unit":function(e){return new s(e.unit)},extract:function(e,t){return t=t.value-1,m(e)[t]},length:function(e){return new i(m(e).length)}})},{"../tree/anonymous":44,"../tree/color":48,"../tree/detached-ruleset":53,"../tree/dimension":54,"../tree/keyword":63,"../tree/operation":69,"../tree/quoted":71,"../tree/url":78,"./function-registry":21}],28:[function(e,t){var n=e("./contexts"),i=e("./parser/parser"),o=e("./plugins/function-importer");t.exports=function(e){var t=function(e,t){this.rootFilename=t.filename,this.paths=e.paths||[],this.contents={},this.contentsIgnoredChars={},this.mime=e.mime,this.error=null,this.context=e,this.queue=[],this.files={}};return t.prototype.push=function(t,r,s,a,l){var c=this;this.queue.push(t);var u=function(e,n,i){c.queue.splice(c.queue.indexOf(t),1);var o=i===c.rootFilename;a.optional&&e?l(null,{rules:[]},!1,null):(c.files[i]=n,e&&!c.error&&(c.error=e),l(e,n,o,i))},d={relativeUrls:this.context.relativeUrls,entryPath:s.entryPath,rootpath:s.rootpath,rootFilename:s.rootFilename},m=e.getFileManager(t,s.currentDirectory,this.context,e);if(!m)return void u({message:"Could not find a file-manager for "+t});r&&(t=m.tryAppendExtension(t,a.plugin?".js":".less"));var p=function(e){var t=e.filename,r=e.contents.replace(/^\uFEFF/,"");d.currentDirectory=m.getPath(t),d.relativeUrls&&(d.rootpath=m.join(c.context.rootpath||"",m.pathDiff(d.currentDirectory,d.entryPath)),!m.isPathAbsolute(d.rootpath)&&m.alwaysMakePathsAbsolute()&&(d.rootpath=m.join(d.entryPath,d.rootpath))),d.filename=t;var l=new n.Parse(c.context);l.processImports=!1,c.contents[t]=r,(s.reference||a.reference)&&(d.reference=!0),a.plugin?new o(l,d).eval(r,function(e,n){u(e,n,t)}):a.inline?u(null,r,t):new i(l,c,d).parse(r,function(e,n){u(e,n,t)})},h=m.loadFile(t,s.currentDirectory,this.context,e,function(e,t){e?u(e):p(t)});h&&h.then(p,u)},t}},{"./contexts":10,"./parser/parser":36,"./plugins/function-importer":38}],29:[function(e,t){t.exports=function(t,n){var i,o,r,s,a,l={version:[2,5,1],data:e("./data"),tree:e("./tree"),Environment:a=e("./environment/environment"),AbstractFileManager:e("./environment/abstract-file-manager"),environment:t=new a(t,n),visitors:e("./visitors"),Parser:e("./parser/parser"),functions:e("./functions")(t),contexts:e("./contexts"),SourceMapOutput:i=e("./source-map-output")(t),SourceMapBuilder:o=e("./source-map-builder")(i,t),ParseTree:r=e("./parse-tree")(o),ImportManager:s=e("./import-manager")(t),render:e("./render")(t,r,s),parse:e("./parse")(t,r,s),LessError:e("./less-error"),transformTree:e("./transform-tree"),utils:e("./utils"),PluginManager:e("./plugin-manager"),logger:e("./logger")};return l}},{"./contexts":10,"./data":12,"./environment/abstract-file-manager":14,"./environment/environment":15,"./functions":22,"./import-manager":28,"./less-error":30,"./logger":31,"./parse":33,"./parse-tree":32,"./parser/parser":36,"./plugin-manager":37,"./render":39,"./source-map-builder":40,"./source-map-output":41,"./transform-tree":42,"./tree":60,"./utils":81,"./visitors":85}],30:[function(e,t){var n=e("./utils"),i=t.exports=function(e,t,i){Error.call(this);var o=e.filename||i;if(t&&o){var r=t.contents[o],s=n.getLocation(e.index,r),a=s.line,l=s.column,c=e.call&&n.getLocation(e.call,r).line,u=r.split("\n");this.type=e.type||"Syntax",this.filename=o,this.index=e.index,this.line="number"==typeof a?a+1:null,this.callLine=c+1,this.callExtract=u[c],this.column=l,this.extract=[u[a-1],u[a],u[a+1]]}this.message=e.message,this.stack=e.stack};if("undefined"==typeof Object.create){var o=function(){};o.prototype=Error.prototype,i.prototype=new o}else i.prototype=Object.create(Error.prototype);i.prototype.constructor=i},{"./utils":81}],31:[function(e,t){t.exports={error:function(e){this._fireEvent("error",e)},warn:function(e){this._fireEvent("warn",e)},info:function(e){this._fireEvent("info",e)},debug:function(e){this._fireEvent("debug",e)},addListener:function(e){this._listeners.push(e)},removeListener:function(e){for(var t=0;this._listeners.length>t;t++)if(this._listeners[t]===e)return void this._listeners.splice(t,1)},_fireEvent:function(e,t){for(var n=0;this._listeners.length>n;n++){var i=this._listeners[n][e];i&&i(t)}},_listeners:[]}},{}],32:[function(e,t){var n=e("./less-error"),i=e("./transform-tree"),o=e("./logger");t.exports=function(e){var t=function(e,t){this.root=e,this.imports=t};return t.prototype.toCSS=function(t){var r,s,a={};try{r=i(this.root,t)}catch(e){throw new n(e,this.imports)}try{var l=Boolean(t.compress);l&&o.warn("The compress option has been deprecated. We recommend you use a dedicated css minifier, for instance see less-plugin-clean-css.");var c={compress:l,dumpLineNumbers:t.dumpLineNumbers,strictUnits:Boolean(t.strictUnits),numPrecision:8};t.sourceMap?(s=new e(t.sourceMap),a.css=s.toCSS(r,c,this.imports)):a.css=r.toCSS(c)}catch(e){throw new n(e,this.imports)}if(t.pluginManager)for(var u=t.pluginManager.getPostProcessors(),d=0;u.length>d;d++)a.css=u[d].process(a.css,{sourceMap:s,options:t,imports:this.imports});t.sourceMap&&(a.map=s.getExternalSourceMap()),a.imports=[];for(var m in this.imports.files)this.imports.files.hasOwnProperty(m)&&m!==this.imports.rootFilename&&a.imports.push(m);return a},t}},{"./less-error":30,"./logger":31,"./transform-tree":42}],33:[function(e,t){var n,i=e("./contexts"),o=e("./parser/parser"),r=e("./plugin-manager");t.exports=function(t,s,a){var l=function(t,s,c){if(s=s||{},"function"==typeof s&&(c=s,s={}),!c){n||(n="undefined"==typeof Promise?e("promise"):Promise);var u=this;return new n(function(e,n){l.call(u,t,s,function(t,i){t?n(t):e(i)})})}var d,m,p=new r(this);if(p.addPlugins(s.plugins),s.pluginManager=p,d=new i.Parse(s),s.rootFileInfo)m=s.rootFileInfo;else{var h=s.filename||"input",f=h.replace(/[^\/\\]*$/,"");m={filename:h,relativeUrls:d.relativeUrls,rootpath:d.rootpath||"",currentDirectory:f,entryPath:f,rootFilename:h},m.rootpath&&"/"!==m.rootpath.slice(-1)&&(m.rootpath+="/")}var g=new a(d,m);new o(d,g,m).parse(t,function(e,t){return e?c(e):void c(null,t,g,s)},s)};return l}},{"./contexts":10,"./parser/parser":36,"./plugin-manager":37,promise:void 0}],34:[function(e,t){t.exports=function(e,t){function n(t){var n=a-g;512>n&&!t||!n||(f.push(e.slice(g,a+1)),g=a+1)}var i,o,r,s,a,l,c,u,d,m=e.length,p=0,h=0,f=[],g=0;for(a=0;m>a;a++)if(c=e.charCodeAt(a),!(c>=97&&122>=c||34>c))switch(c){case 40:h++,o=a;continue;case 41:if(--h<0)return t("missing opening `(`",a);continue;case 59:h||n();continue;case 123:p++,i=a;continue;case 125:if(--p<0)return t("missing opening `{`",a);p||h||n();continue;case 92:if(m-1>a){a++;continue}return t("unescaped `\\`",a);case 34:case 39:case 96:for(d=0,l=a,a+=1;m>a;a++)if(u=e.charCodeAt(a),!(u>96)){if(u==c){d=1;break}if(92==u){if(a==m-1)return t("unescaped `\\`",a);a++}}if(d)continue;return t("unmatched `"+String.fromCharCode(c)+"`",l);case 47:if(h||a==m-1)continue;if(u=e.charCodeAt(a+1),47==u)for(a+=2;m>a&&(u=e.charCodeAt(a),!(13>=u)||10!=u&&13!=u);a++);else if(42==u){for(r=l=a,a+=2;m-1>a&&(u=e.charCodeAt(a),125==u&&(s=a),42!=u||47!=e.charCodeAt(a+1));a++);if(a==m-1)return t("missing closing `*/`",l);a++}continue;case 42:if(m-1>a&&47==e.charCodeAt(a+1))return t("unmatched `/*`",a);continue}return 0!==p?r>i&&s>r?t("missing closing `}` or `*/`",i):t("missing closing `}`",i):0!==h?t("missing closing `)`",o):(n(!0),f)}},{}],35:[function(e,t){var n=e("./chunker");t.exports=function(){var e,t,i,o,r,s,a,l=[],c={};c.save=function(){a=c.i,l.push({current:s,i:c.i,j:t})},c.restore=function(e){(c.i>i||c.i===i&&e&&!o)&&(i=c.i,o=e);var n=l.pop();s=n.current,a=c.i=n.i,t=n.j},c.forget=function(){l.pop()},c.isWhitespace=function(t){var n=c.i+(t||0),i=e.charCodeAt(n);return i===u||i===p||i===d||i===m},c.$re=function(e){c.i>a&&(s=s.slice(c.i-a),a=c.i);var t=e.exec(s);return t?(b(t[0].length),"string"==typeof t?t:1===t.length?t[0]:t):null},c.$char=function(t){return e.charAt(c.i)!==t?null:(b(1),t)},c.$str=function(t){for(var n=t.length,i=0;n>i;i++)if(e.charAt(c.i+i)!==t.charAt(i))return null;return b(n),t},c.$quoted=function(){var t=e.charAt(c.i);if("'"===t||'"'===t){for(var n=e.length,i=c.i,o=1;n>o+i;o++){var r=e.charAt(o+i);switch(r){case"\\":o++;continue;case"\r":case"\n":break;case t:var s=e.substr(i,o+1);return b(o+1),s}}return null}};var u=32,d=9,m=10,p=13,h=43,f=44,g=47,v=57;c.autoCommentAbsorb=!0,c.commentStore=[],c.finished=!1;var b=function(n){for(var i,o,l,h=c.i,f=t,v=c.i-a,y=c.i+s.length-v,w=c.i+=n,k=e;y>c.i;c.i++){if(i=k.charCodeAt(c.i),c.autoCommentAbsorb&&i===g){if(o=k.charAt(c.i+1),"/"===o){l={index:c.i,isLineComment:!0};var _=k.indexOf("\n",c.i+2);0>_&&(_=y),c.i=_,l.text=k.substr(l.i,c.i-l.i),c.commentStore.push(l);continue}if("*"===o){var x=k.indexOf("*/",c.i+2);if(x>=0){l={index:c.i,text:k.substr(c.i,x+2-c.i),isLineComment:!1},c.i+=l.text.length-1,c.commentStore.push(l);continue}}break}if(i!==u&&i!==m&&i!==d&&i!==p)break}if(s=s.slice(n+c.i-w+v),a=c.i,!s.length){if(r.length-1>t)return s=r[++t],b(0),!0;c.finished=!0}return h!==c.i||f!==t};return c.peek=function(t){if("string"==typeof t){for(var n=0;t.length>n;n++)if(e.charAt(c.i+n)!==t.charAt(n))return!1;return!0}return t.test(s)},c.peekChar=function(t){return e.charAt(c.i)===t},c.currentChar=function(){return e.charAt(c.i)},c.getInput=function(){return e},c.peekNotNumeric=function(){var t=e.charCodeAt(c.i);return t>v||h>t||t===g||t===f},c.start=function(o,l,u){e=o,c.i=t=a=i=0,r=l?n(o,u):[o],s=r[0],b(0)},c.end=function(){var t,n=c.i>=e.length;return i>c.i&&(t=o,c.i=i),{isFinished:n,furthest:c.i,furthestPossibleErrorMessage:t,furthestReachedEnd:c.i>=e.length-1,furthestChar:e[c.i]}},c}},{"./chunker":34}],36:[function(e,t){var n=e("../less-error"),i=e("../tree"),o=e("../visitors"),r=e("./parser-input"),s=e("../utils"),a=function e(t,a,l){function c(e,t){var n="[object Function]"===Object.prototype.toString.call(e)?e.call(p):h.$re(e);return n?n:void d(t||("string"==typeof e?"expected '"+e+"' got '"+h.currentChar()+"'":"unexpected token"))}function u(e,t){return h.$char(e)?e:void d(t||"expected '"+e+"' got '"+h.currentChar()+"'")}function d(e,t){throw new n({index:h.i,filename:l.filename,type:t||"Syntax",message:e},a)}function m(e){var t=l.filename;return{lineNumber:s.getLocation(e,h.getInput()).line+1,fileName:t}}var p,h=r();return{parse:function(r,s,c){var u,d,m,p,f=null,g="";if(d=c&&c.globalVars?e.serializeVars(c.globalVars)+"\n":"",m=c&&c.modifyVars?"\n"+e.serializeVars(c.modifyVars):"",t.pluginManager)for(var v=t.pluginManager.getPreProcessors(),b=0;v.length>b;b++)r=v[b].process(r,{context:t,imports:a,fileInfo:l});(d||c&&c.banner)&&(g=(c&&c.banner?c.banner:"")+d,p=a.contentsIgnoredChars,p[l.filename]=p[l.filename]||0,p[l.filename]+=g.length),r=r.replace(/\r\n?/g,"\n"),r=g+r.replace(/^\uFEFF/,"")+m,a.contents[l.filename]=r;try{h.start(r,t.chunkInput,function(e,t){throw new n({index:t,type:"Parse",message:e,filename:l.filename},a)}),u=new i.Ruleset(null,this.parsers.primary()),u.root=!0,u.firstRoot=!0}catch(e){return s(new n(e,a,l.filename))}var y=h.end();if(!y.isFinished){var w=y.furthestPossibleErrorMessage;w||(w="Unrecognised input","}"===y.furthestChar?w+=". Possibly missing opening '{'":")"===y.furthestChar?w+=". Possibly missing opening '('":y.furthestReachedEnd&&(w+=". Possibly missing something")),f=new n({type:"Parse",message:w,index:y.furthest,filename:l.filename},a)}var k=function(e){return e=f||e||a.error,e?(e instanceof n||(e=new n(e,a,l.filename)),s(e)):s(null,u)};return t.processImports===!1?k():void new o.ImportVisitor(a,k).run(u)},parsers:p={primary:function(){for(var e,t=this.mixin,n=[];;){for(;e=this.comment(),e;)n.push(e);if(h.finished)break;if(h.peek("}"))break;if(e=this.extendRule())n=n.concat(e);else if(e=t.definition()||this.rule()||this.ruleset()||t.call()||this.rulesetCall()||this.directive())n.push(e);else{for(var i=!1;h.$char(";");)i=!0;if(!i)break}}return n},comment:function(){if(h.commentStore.length){var e=h.commentStore.shift();return new i.Comment(e.text,e.isLineComment,e.index,l)}},entities:{quoted:function(){var e,t=h.i,n=!1;return h.save(),h.$char("~")&&(n=!0),(e=h.$quoted())?(h.forget(),new i.Quoted(e.charAt(0),e.substr(1,e.length-2),n,t,l)):void h.restore()},keyword:function(){var e=h.$char("%")||h.$re(/^[_A-Za-z-][_A-Za-z0-9-]*/);return e?i.Color.fromKeyword(e)||new i.Keyword(e):void 0},call:function(){var e,t,n,o,r=h.i;if(!h.peek(/^url\(/i))return h.save(),(e=h.$re(/^([\w-]+|%|progid:[\w\.]+)\(/))?(e=e[1],t=e.toLowerCase(),"alpha"===t&&(o=p.alpha())?(h.forget(),o):(n=this.arguments(),h.$char(")")?(h.forget(),new i.Call(e,n,r,l)):void h.restore("Could not parse call arguments or missing ')'"))):void h.forget()},arguments:function(){for(var e,t=[];(e=this.assignment()||p.expression(),e)&&(t.push(e),h.$char(",")););return t},literal:function(){return this.dimension()||this.color()||this.quoted()||this.unicodeDescriptor()},assignment:function(){var e,t;return h.save(),(e=h.$re(/^\w+(?=\s?=)/i))&&h.$char("=")&&(t=p.entity())?(h.forget(),new i.Assignment(e,t)):void h.restore()},url:function(){var e,t=h.i;return h.autoCommentAbsorb=!1,h.$str("url(")?(e=this.quoted()||this.variable()||h.$re(/^(?:(?:\\[\(\)'"])|[^\(\)'"])+/)||"",h.autoCommentAbsorb=!0,u(")"),new i.URL(null!=e.value||e instanceof i.Variable?e:new i.Anonymous(e),t,l)):void(h.autoCommentAbsorb=!0)},variable:function(){var e,t=h.i;return"@"===h.currentChar()&&(e=h.$re(/^@@?[\w-]+/))?new i.Variable(e,t,l):void 0},variableCurly:function(){var e,t=h.i;return"@"===h.currentChar()&&(e=h.$re(/^@\{([\w-]+)\}/))?new i.Variable("@"+e[1],t,l):void 0},color:function(){var e;if("#"===h.currentChar()&&(e=h.$re(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})/))){var t=e.input.match(/^#([\w]+).*/);return t=t[1],t.match(/^[A-Fa-f0-9]+$/)||d("Invalid HEX color code"),new i.Color(e[1])}},dimension:function(){if(!h.peekNotNumeric()){var e=h.$re(/^([+-]?\d*\.?\d+)(%|[a-z]+)?/i);return e?new i.Dimension(e[1],e[2]):void 0}},unicodeDescriptor:function(){var e;return e=h.$re(/^U\+[0-9a-fA-F?]+(\-[0-9a-fA-F?]+)?/),e?new i.UnicodeDescriptor(e[0]):void 0},javascript:function(){var e,t=h.i;h.save();var n=h.$char("~"),o=h.$char("`");return o?(e=h.$re(/^[^`]*`/))?(h.forget(),new i.JavaScript(e.substr(0,e.length-1),Boolean(n),t,l)):void h.restore("invalid javascript definition"):void h.restore()}},variable:function(){var e;return"@"===h.currentChar()&&(e=h.$re(/^(@[\w-]+)\s*:/))?e[1]:void 0},rulesetCall:function(){var e;return"@"===h.currentChar()&&(e=h.$re(/^(@[\w-]+)\s*\(\s*\)\s*;/))?new i.RulesetCall(e[1]):void 0},extend:function(e){var t,n,o,r,s,a=h.i;if(h.$str(e?"&:extend(":":extend(")){do{for(o=null,t=null;!(o=h.$re(/^(all)(?=\s*(\)|,))/))&&(n=this.element());)t?t.push(n):t=[n];o=o&&o[1],t||d("Missing target selector for :extend()."),s=new i.Extend(new i.Selector(t),o,a),r?r.push(s):r=[s]}while(h.$char(","));return c(/^\)/),e&&c(/^;/),r}},extendRule:function(){return this.extend(!0)},mixin:{call:function(){var e,t,n,o,r,s,a=h.currentChar(),c=!1,d=h.i;if("."===a||"#"===a){for(h.save();e=h.i,o=h.$re(/^[#.](?:[\w-]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+/),o;)n=new i.Element(r,o,e,l),t?t.push(n):t=[n],r=h.$char(">");return t&&(h.$char("(")&&(s=this.args(!0).args,u(")")),p.important()&&(c=!0),p.end())?(h.forget(),new i.mixin.Call(t,s,d,l,c)):void h.restore()}},args:function(e){var t,n,o,r,s,a,l=p.entities,c={args:null,variadic:!1},u=[],m=[],f=[];for(h.save();;){if(e)a=p.detachedRuleset()||p.expression();else{if(h.commentStore.length=0,h.$str("...")){c.variadic=!0,h.$char(";")&&!t&&(t=!0),(t?m:f).push({variadic:!0});break}a=l.variable()||l.literal()||l.keyword()}if(!a)break;r=null,a.throwAwayComments&&a.throwAwayComments(),s=a;var g=null;if(e?a.value&&1==a.value.length&&(g=a.value[0]):g=a,g&&g instanceof i.Variable)if(h.$char(":")){if(u.length>0&&(t&&d("Cannot mix ; and , as delimiter types"),n=!0),s=p.detachedRuleset()||p.expression(),!s){if(!e)return h.restore(),c.args=[],c;d("could not understand value for named argument")}r=o=g.name}else{if(!e&&h.$str("...")){c.variadic=!0,h.$char(";")&&!t&&(t=!0),(t?m:f).push({name:a.name,variadic:!0});break}e||(o=r=g.name,s=null)}s&&u.push(s),f.push({name:r,value:s}),h.$char(",")||(h.$char(";")||t)&&(n&&d("Cannot mix ; and , as delimiter types"),t=!0,u.length>1&&(s=new i.Value(u)),m.push({name:o,value:s}),o=null,u=[],n=!1)}return h.forget(),c.args=t?m:f,c},definition:function(){var e,t,n,o,r=[],s=!1;if(!("."!==h.currentChar()&&"#"!==h.currentChar()||h.peek(/^[^{]*\}/)))if(h.save(),t=h.$re(/^([#.](?:[\w-]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+)\s*\(/)){e=t[1];var a=this.args(!1);if(r=a.args,s=a.variadic,!h.$char(")"))return void h.restore("Missing closing ')'");if(h.commentStore.length=0,h.$str("when")&&(o=c(p.conditions,"expected condition")),n=p.block())return h.forget(),new i.mixin.Definition(e,r,n,o,s);h.restore()}else h.forget()}},entity:function(){var e=this.entities;return this.comment()||e.literal()||e.variable()||e.url()||e.call()||e.keyword()||e.javascript()},end:function(){return h.$char(";")||h.peek("}")},alpha:function(){var e;if(h.$re(/^opacity=/i))return e=h.$re(/^\d+/),e||(e=c(this.entities.variable,"Could not parse alpha")),u(")"),new i.Alpha(e)},element:function(){var e,t,n,o=h.i;return t=this.combinator(),e=h.$re(/^(?:\d+\.\d+|\d+)%/)||h.$re(/^(?:[.#]?|:*)(?:[\w-]|[^\x00-\x9f]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+/)||h.$char("*")||h.$char("&")||this.attribute()||h.$re(/^\([^&()@]+\)/)||h.$re(/^[\.#:](?=@)/)||this.entities.variableCurly(),e||(h.save(),h.$char("(")?(n=this.selector())&&h.$char(")")?(e=new i.Paren(n),h.forget()):h.restore("Missing closing ')'"):h.forget()),e?new i.Element(t,e,o,l):void 0},combinator:function(){var e=h.currentChar();if("/"===e){h.save();var t=h.$re(/^\/[a-z]+\//i);if(t)return h.forget(),new i.Combinator(t);h.restore()}if(">"===e||"+"===e||"~"===e||"|"===e||"^"===e){for(h.i++,"^"===e&&"^"===h.currentChar()&&(e="^^",h.i++);h.isWhitespace();)h.i++;return new i.Combinator(e)}return new i.Combinator(h.isWhitespace(-1)?" ":null)},lessSelector:function(){return this.selector(!0)},selector:function(e){for(var t,n,o,r,s,a,u,m=h.i;(e&&(n=this.extend())||e&&(a=h.$str("when"))||(r=this.element()))&&(a?u=c(this.conditions,"expected condition"):u?d("CSS guard can only be used at the end of selector"):n?s=s?s.concat(n):n:(s&&d("Extend can only be used at the end of selector"),o=h.currentChar(),t?t.push(r):t=[r],r=null),"{"!==o&&"}"!==o&&";"!==o&&","!==o&&")"!==o););return t?new i.Selector(t,s,u,m,l):void(s&&d("Extend must be used to extend a selector, it cannot be used on its own"))},attribute:function(){if(h.$char("[")){var e,t,n,o=this.entities;return(e=o.variableCurly())||(e=c(/^(?:[_A-Za-z0-9-\*]*\|)?(?:[_A-Za-z0-9-]|\\.)+/)),n=h.$re(/^[|~*$^]?=/),n&&(t=o.quoted()||h.$re(/^[0-9]+%/)||h.$re(/^[\w-]+/)||o.variableCurly()),u("]"),new i.Attribute(e,n,t)}},block:function(){var e;return h.$char("{")&&(e=this.primary())&&h.$char("}")?e:void 0},blockRuleset:function(){var e=this.block();return e&&(e=new i.Ruleset(null,e)),e},detachedRuleset:function(){var e=this.blockRuleset();return e?new i.DetachedRuleset(e):void 0},ruleset:function(){var e,n,o,r;for(h.save(),t.dumpLineNumbers&&(r=m(h.i));(n=this.lessSelector(),n)&&(e?e.push(n):e=[n],h.commentStore.length=0,n.condition&&e.length>1&&d("Guards are only currently allowed on a single selector."),h.$char(","));)n.condition&&d("Guards are only currently allowed on a single selector."),h.commentStore.length=0;if(e&&(o=this.block())){h.forget();var s=new i.Ruleset(e,o,t.strictImports);return t.dumpLineNumbers&&(s.debugInfo=r),s}h.restore()},rule:function(e){var n,o,r,s,a,c=h.i,u=h.currentChar();if("."!==u&&"#"!==u&&"&"!==u&&":"!==u)if(h.save(),n=this.variable()||this.ruleProperty()){if(a="string"==typeof n,a&&(o=this.detachedRuleset()),h.commentStore.length=0,!o){s=!a&&n.length>1&&n.pop().value;var d=!e&&(t.compress||a);if(d&&(o=this.value()),!o&&(o=this.anonymousValue()))return h.forget(),new i.Rule(n,o,!1,s,c,l);d||o||(o=this.value()),r=this.important()}if(o&&this.end())return h.forget(),new i.Rule(n,o,r,s,c,l);if(h.restore(),o&&!e)return this.rule(!0)}else h.forget()},anonymousValue:function(){var e=h.$re(/^([^@+\/'"*`(;{}-]*);/);return e?new i.Anonymous(e[1]):void 0},import:function(){var e,t,n=h.i,o=h.$re(/^@import?\s+/);if(o){var r=(o?this.importOptions():null)||{};if(e=this.entities.quoted()||this.entities.url())return t=this.mediaFeatures(),h.$char(";")||(h.i=n,d("missing semi-colon or unrecognised media features on import")),t=t&&new i.Value(t),new i.Import(e,t,r,n,l);h.i=n,d("malformed import statement")}},importOptions:function(){var e,t,n,i={};if(!h.$char("("))return null;do if(e=this.importOption()){switch(t=e,n=!0,t){case"css":t="less",n=!1;break;case"once":t="multiple",n=!1}if(i[t]=n,!h.$char(","))break}while(e);return u(")"),i},importOption:function(){var e=h.$re(/^(less|css|multiple|once|inline|reference|optional)/);return e?e[1]:void 0},mediaFeature:function(){var e,t,n=this.entities,o=[];h.save();do if(e=n.keyword()||n.variable())o.push(e);else if(h.$char("(")){if(t=this.property(),e=this.value(),!h.$char(")"))return h.restore("Missing closing ')'"),null;if(t&&e)o.push(new i.Paren(new i.Rule(t,e,null,null,h.i,l,!0)));else{if(!e)return h.restore("badly formed media feature definition"),null;o.push(new i.Paren(e))}}while(e);return h.forget(),o.length>0?new i.Expression(o):void 0},mediaFeatures:function(){var e,t=this.entities,n=[];do if(e=this.mediaFeature()){if(n.push(e),!h.$char(","))break}else if(e=t.variable(),e&&(n.push(e),!h.$char(",")))break;while(e);return n.length>0?n:null},media:function(){var e,n,o,r;return t.dumpLineNumbers&&(r=m(h.i)),h.save(),h.$str("@media")?(e=this.mediaFeatures(),(n=this.block())?(h.forget(),o=new i.Media(n,e,h.i,l),t.dumpLineNumbers&&(o.debugInfo=r),o):void h.restore("media definitions require block statements after any features")):void h.restore();
},plugin:function(){var e,t=h.i,n=h.$re(/^@plugin?\s+/);if(n){var o={plugin:!0};if(e=this.entities.quoted()||this.entities.url())return h.$char(";")||(h.i=t,d("missing semi-colon on plugin")),new i.Import(e,null,o,t,l);h.i=t,d("malformed plugin statement")}},directive:function(){var e,n,o,r,s,a,c,u=h.i,p=!0,f=!0;if("@"===h.currentChar()){if(n=this.import()||this.plugin()||this.media())return n;if(h.save(),e=h.$re(/^@[a-z-]+/)){switch(r=e,"-"==e.charAt(1)&&e.indexOf("-",2)>0&&(r="@"+e.slice(e.indexOf("-",2)+1)),r){case"@counter-style":s=!0,p=!0;break;case"@charset":s=!0,p=!1;break;case"@namespace":a=!0,p=!1;break;case"@keyframes":s=!0;break;case"@host":case"@page":c=!0;break;case"@document":case"@supports":c=!0,f=!1}return h.commentStore.length=0,s?(n=this.entity(),n||d("expected "+e+" identifier")):a?(n=this.expression(),n||d("expected "+e+" expression")):c&&(n=(h.$re(/^[^{;]+/)||"").trim(),n&&(n=new i.Anonymous(n))),p&&(o=this.blockRuleset()),o||!p&&n&&h.$char(";")?(h.forget(),new i.Directive(e,n,o,u,l,t.dumpLineNumbers?m(u):null,!1,f)):void h.restore("directive options not recognised")}}},value:function(){var e,t=[];do if(e=this.expression(),e&&(t.push(e),!h.$char(",")))break;while(e);return t.length>0?new i.Value(t):void 0},important:function(){return"!"===h.currentChar()?h.$re(/^! *important/):void 0},sub:function(){var e,t;return h.save(),h.$char("(")?(e=this.addition(),e&&h.$char(")")?(h.forget(),t=new i.Expression([e]),t.parens=!0,t):void h.restore("Expected ')'")):void h.restore()},multiplication:function(){var e,t,n,o,r;if(e=this.operand()){for(r=h.isWhitespace(-1);!h.peek(/^\/[*\/]/);){if(h.save(),n=h.$char("/")||h.$char("*"),!n){h.forget();break}if(t=this.operand(),!t){h.restore();break}h.forget(),e.parensInOp=!0,t.parensInOp=!0,o=new i.Operation(n,[o||e,t],r),r=h.isWhitespace(-1)}return o||e}},addition:function(){var e,t,n,o,r;if(e=this.multiplication()){for(r=h.isWhitespace(-1);(n=h.$re(/^[-+]\s+/)||!r&&(h.$char("+")||h.$char("-")),n)&&(t=this.multiplication(),t);)e.parensInOp=!0,t.parensInOp=!0,o=new i.Operation(n,[o||e,t],r),r=h.isWhitespace(-1);return o||e}},conditions:function(){var e,t,n,o=h.i;if(e=this.condition()){for(;h.peek(/^,\s*(not\s*)?\(/)&&h.$char(",")&&(t=this.condition(),t);)n=new i.Condition("or",n||e,t,o);return n||e}},condition:function(){var e,t,n,o,r=this.entities,s=h.i,a=!1;return h.$str("not")&&(a=!0),u("("),e=this.addition()||r.keyword()||r.quoted(),e?(h.$char(">")?o=h.$char("=")?">=":">":h.$char("<")?o=h.$char("=")?"<=":"<":h.$char("=")&&(o=h.$char(">")?"=>":h.$char("<")?"=<":"="),o?(t=this.addition()||r.keyword()||r.quoted(),t?n=new i.Condition(o,e,t,s,a):d("expected expression")):n=new i.Condition("=",e,new i.Keyword("true"),s,a),u(")"),h.$str("and")?new i.Condition("and",n,this.condition()):n):void 0},operand:function(){var e,t=this.entities;h.peek(/^-[@\(]/)&&(e=h.$char("-"));var n=this.sub()||t.dimension()||t.color()||t.variable()||t.call();return e&&(n.parensInOp=!0,n=new i.Negative(n)),n},expression:function(){var e,t,n=[];do e=this.comment(),e?n.push(e):(e=this.addition()||this.entity(),e&&(n.push(e),h.peek(/^\/[\/*]/)||(t=h.$char("/"),t&&n.push(new i.Anonymous(t)))));while(e);return n.length>0?new i.Expression(n):void 0},property:function(){var e=h.$re(/^(\*?-?[_a-zA-Z0-9-]+)\s*:/);return e?e[1]:void 0},ruleProperty:function(){function e(e){var t=h.i,n=h.$re(e);return n?(r.push(t),o.push(n[1])):void 0}var t,n,o=[],r=[];h.save();var s=h.$re(/^([_a-zA-Z0-9-]+)\s*:/);if(s)return o=[new i.Keyword(s[1])],h.forget(),o;for(e(/^(\*?)/);e(/^((?:[\w-]+)|(?:@\{[\w-]+\}))/););if(o.length>1&&e(/^((?:\+_|\+)?)\s*:/)){for(h.forget(),""===o[0]&&(o.shift(),r.shift()),n=0;o.length>n;n++)t=o[n],o[n]="@"!==t.charAt(0)?new i.Keyword(t):new i.Variable("@"+t.slice(2,-1),r[n],l);return o}h.restore()}}}};a.serializeVars=function(e){var t="";for(var n in e)if(Object.hasOwnProperty.call(e,n)){var i=e[n];t+=("@"===n[0]?"":"@")+n+": "+i+(";"===String(i).slice(-1)?"":";")}return t},t.exports=a},{"../less-error":30,"../tree":60,"../utils":81,"../visitors":85,"./parser-input":35}],37:[function(e,t){var n=function(e){this.less=e,this.visitors=[],this.preProcessors=[],this.postProcessors=[],this.installedPlugins=[],this.fileManagers=[]};n.prototype.addPlugins=function(e){if(e)for(var t=0;e.length>t;t++)this.addPlugin(e[t])},n.prototype.addPlugin=function(e){this.installedPlugins.push(e),e.install(this.less,this)},n.prototype.addVisitor=function(e){this.visitors.push(e)},n.prototype.addPreProcessor=function(e,t){var n;for(n=0;this.preProcessors.length>n&&!(this.preProcessors[n].priority>=t);n++);this.preProcessors.splice(n,0,{preProcessor:e,priority:t})},n.prototype.addPostProcessor=function(e,t){var n;for(n=0;this.postProcessors.length>n&&!(this.postProcessors[n].priority>=t);n++);this.postProcessors.splice(n,0,{postProcessor:e,priority:t})},n.prototype.addFileManager=function(e){this.fileManagers.push(e)},n.prototype.getPreProcessors=function(){for(var e=[],t=0;this.preProcessors.length>t;t++)e.push(this.preProcessors[t].preProcessor);return e},n.prototype.getPostProcessors=function(){for(var e=[],t=0;this.postProcessors.length>t;t++)e.push(this.postProcessors[t].postProcessor);return e},n.prototype.getVisitors=function(){return this.visitors},n.prototype.getFileManagers=function(){return this.fileManagers},t.exports=n},{}],38:[function(e,t){var n=e("../less-error"),i=e("../tree"),o=t.exports=function(e,t){this.fileInfo=t};o.prototype.eval=function(e,t){var o,r,s={};r={add:function(e,t){s[e]=t},addMultiple:function(e){Object.keys(e).forEach(function(t){s[t]=e[t]})}};try{(o=new Function("functions","tree","fileInfo",e))(r,i,this.fileInfo)}catch(e){t(new n({message:"Plugin evaluation error: '"+e.name+": "+e.message.replace(/["]/g,"'")+"'",filename:this.fileInfo.filename}),null)}t(null,{functions:s})}},{"../less-error":30,"../tree":60}],39:[function(e,t){var n;t.exports=function(t,i){var o=function(t,r,s){if("function"==typeof r&&(s=r,r={}),!s){n||(n="undefined"==typeof Promise?e("promise"):Promise);var a=this;return new n(function(e,n){o.call(a,t,r,function(t,i){t?n(t):e(i)})})}this.parse(t,r,function(e,t,n,o){if(e)return s(e);var r;try{var a=new i(t,n);r=a.toCSS(o)}catch(e){return s(e)}s(null,r)})};return o}},{promise:void 0}],40:[function(e,t){t.exports=function(e,t){var n=function(e){this.options=e};return n.prototype.toCSS=function(t,n,i){var o=new e({contentsIgnoredCharsMap:i.contentsIgnoredChars,rootNode:t,contentsMap:i.contents,sourceMapFilename:this.options.sourceMapFilename,sourceMapURL:this.options.sourceMapURL,outputFilename:this.options.sourceMapOutputFilename,sourceMapBasepath:this.options.sourceMapBasepath,sourceMapRootpath:this.options.sourceMapRootpath,outputSourceFiles:this.options.outputSourceFiles,sourceMapGenerator:this.options.sourceMapGenerator,sourceMapFileInline:this.options.sourceMapFileInline}),r=o.toCSS(n);return this.sourceMap=o.sourceMap,this.sourceMapURL=o.sourceMapURL,this.options.sourceMapInputFilename&&(this.sourceMapInputFilename=o.normalizeFilename(this.options.sourceMapInputFilename)),r+this.getCSSAppendage()},n.prototype.getCSSAppendage=function(){var e=this.sourceMapURL;if(this.options.sourceMapFileInline){if(void 0===this.sourceMap)return"";e="data:application/json;base64,"+t.encodeBase64(this.sourceMap)}return e?"/*# sourceMappingURL="+e+" */":""},n.prototype.getExternalSourceMap=function(){return this.sourceMap},n.prototype.setExternalSourceMap=function(e){this.sourceMap=e},n.prototype.isInline=function(){return this.options.sourceMapFileInline},n.prototype.getSourceMapURL=function(){return this.sourceMapURL},n.prototype.getOutputFilename=function(){return this.options.sourceMapOutputFilename},n.prototype.getInputFilename=function(){return this.sourceMapInputFilename},n}},{}],41:[function(e,t){t.exports=function(e){var t=function(t){this._css=[],this._rootNode=t.rootNode,this._contentsMap=t.contentsMap,this._contentsIgnoredCharsMap=t.contentsIgnoredCharsMap,t.sourceMapFilename&&(this._sourceMapFilename=t.sourceMapFilename.replace(/\\/g,"/")),this._outputFilename=t.outputFilename,this.sourceMapURL=t.sourceMapURL,t.sourceMapBasepath&&(this._sourceMapBasepath=t.sourceMapBasepath.replace(/\\/g,"/")),t.sourceMapRootpath?(this._sourceMapRootpath=t.sourceMapRootpath.replace(/\\/g,"/"),"/"!==this._sourceMapRootpath.charAt(this._sourceMapRootpath.length-1)&&(this._sourceMapRootpath+="/")):this._sourceMapRootpath="",this._outputSourceFiles=t.outputSourceFiles,this._sourceMapGeneratorConstructor=e.getSourceMapGenerator(),this._lineNumber=0,this._column=0};return t.prototype.normalizeFilename=function(e){return e=e.replace(/\\/g,"/"),this._sourceMapBasepath&&0===e.indexOf(this._sourceMapBasepath)&&(e=e.substring(this._sourceMapBasepath.length),("\\"===e.charAt(0)||"/"===e.charAt(0))&&(e=e.substring(1))),(this._sourceMapRootpath||"")+e},t.prototype.add=function(e,t,n,i){if(e){var o,r,s,a,l;if(t){var c=this._contentsMap[t.filename];this._contentsIgnoredCharsMap[t.filename]&&(n-=this._contentsIgnoredCharsMap[t.filename],0>n&&(n=0),c=c.slice(this._contentsIgnoredCharsMap[t.filename])),c=c.substring(0,n),r=c.split("\n"),a=r[r.length-1]}if(o=e.split("\n"),s=o[o.length-1],t)if(i)for(l=0;o.length>l;l++)this._sourceMapGenerator.addMapping({generated:{line:this._lineNumber+l+1,column:0===l?this._column:0},original:{line:r.length+l,column:0===l?a.length:0},source:this.normalizeFilename(t.filename)});else this._sourceMapGenerator.addMapping({generated:{line:this._lineNumber+1,column:this._column},original:{line:r.length,column:a.length},source:this.normalizeFilename(t.filename)});1===o.length?this._column+=s.length:(this._lineNumber+=o.length-1,this._column=s.length),this._css.push(e)}},t.prototype.isEmpty=function(){return 0===this._css.length},t.prototype.toCSS=function(e){if(this._sourceMapGenerator=new this._sourceMapGeneratorConstructor({file:this._outputFilename,sourceRoot:null}),this._outputSourceFiles)for(var t in this._contentsMap)if(this._contentsMap.hasOwnProperty(t)){var n=this._contentsMap[t];this._contentsIgnoredCharsMap[t]&&(n=n.slice(this._contentsIgnoredCharsMap[t])),this._sourceMapGenerator.setSourceContent(this.normalizeFilename(t),n)}if(this._rootNode.genCSS(e,this),this._css.length>0){var i,o=JSON.stringify(this._sourceMapGenerator.toJSON());this.sourceMapURL?i=this.sourceMapURL:this._sourceMapFilename&&(i=this._sourceMapFilename),this.sourceMapURL=i,this.sourceMap=o}return this._css.join("")},t}},{}],42:[function(e,t){var n=e("./contexts"),i=e("./visitors"),o=e("./tree");t.exports=function(e,t){t=t||{};var r,s=t.variables,a=new n.Eval(t);"object"!=typeof s||Array.isArray(s)||(s=Object.keys(s).map(function(e){var t=s[e];return t instanceof o.Value||(t instanceof o.Expression||(t=new o.Expression([t])),t=new o.Value([t])),new o.Rule("@"+e,t,!1,null,0)}),a.frames=[new o.Ruleset(null,s)]);var l,c=[],u=[new i.JoinSelectorVisitor,new i.ExtendVisitor,new i.ToCSSVisitor({compress:Boolean(t.compress)})];if(t.pluginManager){var d=t.pluginManager.getVisitors();for(l=0;d.length>l;l++){var m=d[l];m.isPreEvalVisitor?c.push(m):m.isPreVisitor?u.splice(0,0,m):u.push(m)}}for(l=0;c.length>l;l++)c[l].run(e);for(r=e.eval(a),l=0;u.length>l;l++)u[l].run(r);return r}},{"./contexts":10,"./tree":60,"./visitors":85}],43:[function(e,t){var n=e("./node"),i=function(e){this.value=e};i.prototype=new n,i.prototype.type="Alpha",i.prototype.accept=function(e){this.value=e.visit(this.value)},i.prototype.eval=function(e){return this.value.eval?new i(this.value.eval(e)):this},i.prototype.genCSS=function(e,t){t.add("alpha(opacity="),this.value.genCSS?this.value.genCSS(e,t):t.add(this.value),t.add(")")},t.exports=i},{"./node":68}],44:[function(e,t){var n=e("./node"),i=function(e,t,n,i,o){this.value=e,this.index=t,this.mapLines=i,this.currentFileInfo=n,this.rulesetLike="undefined"!=typeof o&&o};i.prototype=new n,i.prototype.type="Anonymous",i.prototype.eval=function(){return new i(this.value,this.index,this.currentFileInfo,this.mapLines,this.rulesetLike)},i.prototype.compare=function(e){return e.toCSS&&this.toCSS()===e.toCSS()?0:void 0},i.prototype.isRulesetLike=function(){return this.rulesetLike},i.prototype.genCSS=function(e,t){t.add(this.value,this.currentFileInfo,this.index,this.mapLines)},t.exports=i},{"./node":68}],45:[function(e,t){var n=e("./node"),i=function(e,t){this.key=e,this.value=t};i.prototype=new n,i.prototype.type="Assignment",i.prototype.accept=function(e){this.value=e.visit(this.value)},i.prototype.eval=function(e){return this.value.eval?new i(this.key,this.value.eval(e)):this},i.prototype.genCSS=function(e,t){t.add(this.key+"="),this.value.genCSS?this.value.genCSS(e,t):t.add(this.value)},t.exports=i},{"./node":68}],46:[function(e,t){var n=e("./node"),i=function(e,t,n){this.key=e,this.op=t,this.value=n};i.prototype=new n,i.prototype.type="Attribute",i.prototype.eval=function(e){return new i(this.key.eval?this.key.eval(e):this.key,this.op,this.value&&this.value.eval?this.value.eval(e):this.value)},i.prototype.genCSS=function(e,t){t.add(this.toCSS(e))},i.prototype.toCSS=function(e){var t=this.key.toCSS?this.key.toCSS(e):this.key;return this.op&&(t+=this.op,t+=this.value.toCSS?this.value.toCSS(e):this.value),"["+t+"]"},t.exports=i},{"./node":68}],47:[function(e,t){var n=e("./node"),i=e("../functions/function-caller"),o=function(e,t,n,i){this.name=e,this.args=t,this.index=n,this.currentFileInfo=i};o.prototype=new n,o.prototype.type="Call",o.prototype.accept=function(e){this.args&&(this.args=e.visitArray(this.args))},o.prototype.eval=function(e){var t,n=this.args.map(function(t){return t.eval(e)}),r=new i(this.name,e,this.index,this.currentFileInfo);if(r.isValid())try{if(t=r.call(n),null!=t)return t}catch(e){throw{type:e.type||"Runtime",message:"error evaluating function `"+this.name+"`"+(e.message?": "+e.message:""),index:this.index,filename:this.currentFileInfo.filename}}return new o(this.name,n,this.index,this.currentFileInfo)},o.prototype.genCSS=function(e,t){t.add(this.name+"(",this.currentFileInfo,this.index);for(var n=0;this.args.length>n;n++)this.args[n].genCSS(e,t),this.args.length>n+1&&t.add(", ");t.add(")")},t.exports=o},{"../functions/function-caller":20,"./node":68}],48:[function(e,t){function n(e,t){return Math.min(Math.max(e,0),t)}function i(e){return"#"+e.map(function(e){return e=n(Math.round(e),255),(16>e?"0":"")+e.toString(16)}).join("")}var o=e("./node"),r=e("../data/colors"),s=function(e,t){this.rgb=Array.isArray(e)?e:6==e.length?e.match(/.{2}/g).map(function(e){return parseInt(e,16)}):e.split("").map(function(e){return parseInt(e+e,16)}),this.alpha="number"==typeof t?t:1};s.prototype=new o,s.prototype.type="Color",s.prototype.luma=function(){var e=this.rgb[0]/255,t=this.rgb[1]/255,n=this.rgb[2]/255;return e=.03928>=e?e/12.92:Math.pow((e+.055)/1.055,2.4),t=.03928>=t?t/12.92:Math.pow((t+.055)/1.055,2.4),n=.03928>=n?n/12.92:Math.pow((n+.055)/1.055,2.4),.2126*e+.7152*t+.0722*n},s.prototype.genCSS=function(e,t){t.add(this.toCSS(e))},s.prototype.toCSS=function(e,t){var i,o,r=e&&e.compress&&!t;if(this.value)return this.value;if(o=this.fround(e,this.alpha),1>o)return"rgba("+this.rgb.map(function(e){return n(Math.round(e),255)}).concat(n(o,1)).join(","+(r?"":" "))+")";if(i=this.toRGB(),r){var s=i.split("");s[1]===s[2]&&s[3]===s[4]&&s[5]===s[6]&&(i="#"+s[1]+s[3]+s[5])}return i},s.prototype.operate=function(e,t,n){for(var i=[],o=this.alpha*(1-n.alpha)+n.alpha,r=0;3>r;r++)i[r]=this._operate(e,t,this.rgb[r],n.rgb[r]);return new s(i,o)},s.prototype.toRGB=function(){return i(this.rgb)},s.prototype.toHSL=function(){var e,t,n=this.rgb[0]/255,i=this.rgb[1]/255,o=this.rgb[2]/255,r=this.alpha,s=Math.max(n,i,o),a=Math.min(n,i,o),l=(s+a)/2,c=s-a;if(s===a)e=t=0;else{switch(t=l>.5?c/(2-s-a):c/(s+a),s){case n:e=(i-o)/c+(o>i?6:0);break;case i:e=(o-n)/c+2;break;case o:e=(n-i)/c+4}e/=6}return{h:360*e,s:t,l:l,a:r}},s.prototype.toHSV=function(){var e,t,n=this.rgb[0]/255,i=this.rgb[1]/255,o=this.rgb[2]/255,r=this.alpha,s=Math.max(n,i,o),a=Math.min(n,i,o),l=s,c=s-a;if(t=0===s?0:c/s,s===a)e=0;else{switch(s){case n:e=(i-o)/c+(o>i?6:0);break;case i:e=(o-n)/c+2;break;case o:e=(n-i)/c+4}e/=6}return{h:360*e,s:t,v:l,a:r}},s.prototype.toARGB=function(){return i([255*this.alpha].concat(this.rgb))},s.prototype.compare=function(e){return e.rgb&&e.rgb[0]===this.rgb[0]&&e.rgb[1]===this.rgb[1]&&e.rgb[2]===this.rgb[2]&&e.alpha===this.alpha?0:void 0},s.fromKeyword=function(e){var t,n=e.toLowerCase();return r.hasOwnProperty(n)?t=new s(r[n].slice(1)):"transparent"===n&&(t=new s([0,0,0],0)),t?(t.value=e,t):void 0},t.exports=s},{"../data/colors":11,"./node":68}],49:[function(e,t){var n=e("./node"),i=function(e){" "===e?(this.value=" ",this.emptyOrWhitespace=!0):(this.value=e?e.trim():"",this.emptyOrWhitespace=""===this.value)};i.prototype=new n,i.prototype.type="Combinator";var o={"":!0," ":!0,"|":!0};i.prototype.genCSS=function(e,t){var n=e.compress||o[this.value]?"":" ";t.add(n+this.value+n)},t.exports=i},{"./node":68}],50:[function(e,t){var n=e("./node"),i=e("./debug-info"),o=function(e,t,n,i){this.value=e,this.isLineComment=t,this.currentFileInfo=i};o.prototype=new n,o.prototype.type="Comment",o.prototype.genCSS=function(e,t){this.debugInfo&&t.add(i(e,this),this.currentFileInfo,this.index),t.add(this.value)},o.prototype.isSilent=function(e){var t=this.currentFileInfo&&this.currentFileInfo.reference&&!this.isReferenced,n=e.compress&&"!"!==this.value[2];return this.isLineComment||t||n},o.prototype.markReferenced=function(){this.isReferenced=!0},t.exports=o},{"./debug-info":52,"./node":68}],51:[function(e,t){var n=e("./node"),i=function(e,t,n,i,o){this.op=e.trim(),this.lvalue=t,this.rvalue=n,this.index=i,this.negate=o};i.prototype=new n,i.prototype.type="Condition",i.prototype.accept=function(e){this.lvalue=e.visit(this.lvalue),this.rvalue=e.visit(this.rvalue)},i.prototype.eval=function(e){var t=function(e,t,i){switch(e){case"and":return t&&i;case"or":return t||i;default:switch(n.compare(t,i)){case-1:return"<"===e||"=<"===e||"<="===e;case 0:return"="===e||">="===e||"=<"===e||"<="===e;case 1:return">"===e||">="===e;default:return!1}}}(this.op,this.lvalue.eval(e),this.rvalue.eval(e));return this.negate?!t:t},t.exports=i},{"./node":68}],52:[function(e,t){var n=function(e,t,i){var o="";if(e.dumpLineNumbers&&!e.compress)switch(e.dumpLineNumbers){case"comments":o=n.asComment(t);break;case"mediaquery":o=n.asMediaQuery(t);break;case"all":o=n.asComment(t)+(i||"")+n.asMediaQuery(t)}return o};n.asComment=function(e){return"/* line "+e.debugInfo.lineNumber+", "+e.debugInfo.fileName+" */\n"},n.asMediaQuery=function(e){var t=e.debugInfo.fileName;return/^[a-z]+:\/\//i.test(t)||(t="file://"+t),"@media -sass-debug-info{filename{font-family:"+t.replace(/([.:\/\\])/g,function(e){return"\\"==e&&(e="/"),"\\"+e})+"}line{font-family:\\00003"+e.debugInfo.lineNumber+"}}\n"},t.exports=n},{}],53:[function(e,t){var n=e("./node"),i=e("../contexts"),o=function(e,t){this.ruleset=e,this.frames=t};o.prototype=new n,o.prototype.type="DetachedRuleset",o.prototype.evalFirst=!0,o.prototype.accept=function(e){this.ruleset=e.visit(this.ruleset)},o.prototype.eval=function(e){var t=this.frames||e.frames.slice(0);return new o(this.ruleset,t)},o.prototype.callEval=function(e){return this.ruleset.eval(this.frames?new i.Eval(e,this.frames.concat(e.frames)):e)},t.exports=o},{"../contexts":10,"./node":68}],54:[function(e,t){var n=e("./node"),i=e("../data/unit-conversions"),o=e("./unit"),r=e("./color"),s=function(e,t){this.value=parseFloat(e),this.unit=t&&t instanceof o?t:new o(t?[t]:void 0)};s.prototype=new n,s.prototype.type="Dimension",s.prototype.accept=function(e){this.unit=e.visit(this.unit)},s.prototype.eval=function(){return this},s.prototype.toColor=function(){return new r([this.value,this.value,this.value])},s.prototype.genCSS=function(e,t){if(e&&e.strictUnits&&!this.unit.isSingular())throw new Error("Multiple units in dimension. Correct the units or use the unit function. Bad unit: "+this.unit.toString());var n=this.fround(e,this.value),i=String(n);if(0!==n&&1e-6>n&&n>-1e-6&&(i=n.toFixed(20).replace(/0+$/,"")),e&&e.compress){if(0===n&&this.unit.isLength())return void t.add(i);n>0&&1>n&&(i=i.substr(1))}t.add(i),this.unit.genCSS(e,t)},s.prototype.operate=function(e,t,n){var i=this._operate(e,t,this.value,n.value),o=this.unit.clone();if("+"===t||"-"===t)if(0===o.numerator.length&&0===o.denominator.length)o=n.unit.clone(),this.unit.backupUnit&&(o.backupUnit=this.unit.backupUnit);else if(0===n.unit.numerator.length&&0===o.denominator.length);else{if(n=n.convertTo(this.unit.usedUnits()),e.strictUnits&&n.unit.toString()!==o.toString())throw new Error("Incompatible units. Change the units or use the unit function. Bad units: '"+o.toString()+"' and '"+n.unit.toString()+"'.");i=this._operate(e,t,this.value,n.value)}else"*"===t?(o.numerator=o.numerator.concat(n.unit.numerator).sort(),o.denominator=o.denominator.concat(n.unit.denominator).sort(),o.cancel()):"/"===t&&(o.numerator=o.numerator.concat(n.unit.denominator).sort(),o.denominator=o.denominator.concat(n.unit.numerator).sort(),o.cancel());return new s(i,o)},s.prototype.compare=function(e){var t,i;if(e instanceof s){if(this.unit.isEmpty()||e.unit.isEmpty())t=this,i=e;else if(t=this.unify(),i=e.unify(),0!==t.unit.compare(i.unit))return;return n.numericCompare(t.value,i.value)}},s.prototype.unify=function(){return this.convertTo({length:"px",duration:"s",angle:"rad"})},s.prototype.convertTo=function(e){var t,n,o,r,a,l=this.value,c=this.unit.clone(),u={};if("string"==typeof e){for(t in i)i[t].hasOwnProperty(e)&&(u={},u[t]=e);e=u}a=function(e,t){return o.hasOwnProperty(e)?(t?l/=o[e]/o[r]:l*=o[e]/o[r],r):e};for(n in e)e.hasOwnProperty(n)&&(r=e[n],o=i[n],c.map(a));return c.cancel(),new s(l,c)},t.exports=s},{"../data/unit-conversions":13,"./color":48,"./node":68,"./unit":77}],55:[function(e,t){var n=e("./node"),i=e("./selector"),o=e("./ruleset"),r=function(e,t,n,o,r,s,a,l){var c;if(this.name=e,this.value=t,n)for(Array.isArray(n)?this.rules=n:(this.rules=[n],this.rules[0].selectors=new i([],null,null,this.index,r).createEmptySelectors()),c=0;this.rules.length>c;c++)this.rules[c].allowImports=!0;this.index=o,this.currentFileInfo=r,this.debugInfo=s,this.isReferenced=a,this.isRooted=l||!1};r.prototype=new n,r.prototype.type="Directive",r.prototype.accept=function(e){var t=this.value,n=this.rules;n&&(this.rules=e.visitArray(n)),t&&(this.value=e.visit(t))},r.prototype.isRulesetLike=function(){return this.rules||!this.isCharset()},r.prototype.isCharset=function(){return"@charset"===this.name},r.prototype.genCSS=function(e,t){var n=this.value,i=this.rules;t.add(this.name,this.currentFileInfo,this.index),n&&(t.add(" "),n.genCSS(e,t)),i?this.outputRuleset(e,t,i):t.add(";")},r.prototype.eval=function(e){var t,n,i=this.value,o=this.rules;return t=e.mediaPath,n=e.mediaBlocks,e.mediaPath=[],e.mediaBlocks=[],i&&(i=i.eval(e)),o&&(o=[o[0].eval(e)],o[0].root=!0),e.mediaPath=t,e.mediaBlocks=n,new r(this.name,i,o,this.index,this.currentFileInfo,this.debugInfo,this.isReferenced,this.isRooted)},r.prototype.variable=function(e){return this.rules?o.prototype.variable.call(this.rules[0],e):void 0},r.prototype.find=function(){return this.rules?o.prototype.find.apply(this.rules[0],arguments):void 0},r.prototype.rulesets=function(){return this.rules?o.prototype.rulesets.apply(this.rules[0]):void 0},r.prototype.markReferenced=function(){var e,t;if(this.isReferenced=!0,this.rules)for(t=this.rules,e=0;t.length>e;e++)t[e].markReferenced&&t[e].markReferenced()},r.prototype.getIsReferenced=function(){return!this.currentFileInfo||!this.currentFileInfo.reference||this.isReferenced},r.prototype.outputRuleset=function(e,t,n){var i,o=n.length;if(e.tabLevel=(0|e.tabLevel)+1,e.compress){for(t.add("{"),i=0;o>i;i++)n[i].genCSS(e,t);return t.add("}"),void e.tabLevel--}var r="\n"+Array(e.tabLevel).join("  "),s=r+"  ";if(o){for(t.add(" {"+s),n[0].genCSS(e,t),i=1;o>i;i++)t.add(s),n[i].genCSS(e,t);t.add(r+"}")}else t.add(" {"+r+"}");e.tabLevel--},t.exports=r},{"./node":68,"./ruleset":74,"./selector":75}],56:[function(e,t){var n=e("./node"),i=e("./paren"),o=e("./combinator"),r=function(e,t,n,i){this.combinator=e instanceof o?e:new o(e),this.value="string"==typeof t?t.trim():t?t:"",this.index=n,this.currentFileInfo=i};r.prototype=new n,r.prototype.type="Element",r.prototype.accept=function(e){var t=this.value;this.combinator=e.visit(this.combinator),"object"==typeof t&&(this.value=e.visit(t))},r.prototype.eval=function(e){return new r(this.combinator,this.value.eval?this.value.eval(e):this.value,this.index,this.currentFileInfo)},r.prototype.genCSS=function(e,t){t.add(this.toCSS(e),this.currentFileInfo,this.index)},r.prototype.toCSS=function(e){e=e||{};var t=this.value,n=e.firstSelector;return t instanceof i&&(e.firstSelector=!0),t=t.toCSS?t.toCSS(e):t,e.firstSelector=n,""===t&&"&"===this.combinator.value.charAt(0)?"":this.combinator.toCSS(e)+t},t.exports=r},{"./combinator":49,"./node":68,"./paren":70}],57:[function(e,t){var n=e("./node"),i=e("./paren"),o=e("./comment"),r=function(e){if(this.value=e,!e)throw new Error("Expression requires an array parameter")};r.prototype=new n,r.prototype.type="Expression",r.prototype.accept=function(e){this.value=e.visitArray(this.value)},r.prototype.eval=function(e){var t,n=this.parens&&!this.parensInOp,o=!1;return n&&e.inParenthesis(),this.value.length>1?t=new r(this.value.map(function(t){return t.eval(e)})):1===this.value.length?(this.value[0].parens&&!this.value[0].parensInOp&&(o=!0),t=this.value[0].eval(e)):t=this,n&&e.outOfParenthesis(),this.parens&&this.parensInOp&&!e.isMathOn()&&!o&&(t=new i(t)),t},r.prototype.genCSS=function(e,t){for(var n=0;this.value.length>n;n++)this.value[n].genCSS(e,t),this.value.length>n+1&&t.add(" ")},r.prototype.throwAwayComments=function(){this.value=this.value.filter(function(e){return!(e instanceof o)})},t.exports=r},{"./comment":50,"./node":68,"./paren":70}],58:[function(e,t){var n=e("./node"),i=function e(t,n,i){switch(this.selector=t,this.option=n,this.index=i,this.object_id=e.next_id++,this.parent_ids=[this.object_id],n){case"all":this.allowBefore=!0,this.allowAfter=!0;break;default:this.allowBefore=!1,this.allowAfter=!1}};i.next_id=0,i.prototype=new n,i.prototype.type="Extend",i.prototype.accept=function(e){this.selector=e.visit(this.selector)},i.prototype.eval=function(e){return new i(this.selector.eval(e),this.option,this.index)},i.prototype.clone=function(){return new i(this.selector,this.option,this.index)},i.prototype.findSelfSelectors=function(e){var t,n,i=[];for(t=0;e.length>t;t++)n=e[t].elements,t>0&&n.length&&""===n[0].combinator.value&&(n[0].combinator.value=" "),i=i.concat(e[t].elements);this.selfSelectors=[{elements:i}]},t.exports=i},{"./node":68}],59:[function(e,t){var n=e("./node"),i=e("./media"),o=e("./url"),r=e("./quoted"),s=e("./ruleset"),a=e("./anonymous"),l=function(e,t,n,i,o){if(this.options=n,this.index=i,this.path=e,this.features=t,this.currentFileInfo=o,void 0!==this.options.less||this.options.inline)this.css=!this.options.less||this.options.inline;else{var r=this.getPath();r&&/[#\.\&\?\/]css([\?;].*)?$/.test(r)&&(this.css=!0)}};l.prototype=new n,l.prototype.type="Import",l.prototype.accept=function(e){this.features&&(this.features=e.visit(this.features)),this.path=e.visit(this.path),this.options.plugin||this.options.inline||!this.root||(this.root=e.visit(this.root))},l.prototype.genCSS=function(e,t){this.css&&void 0===this.path.currentFileInfo.reference&&(t.add("@import ",this.currentFileInfo,this.index),this.path.genCSS(e,t),this.features&&(t.add(" "),this.features.genCSS(e,t)),t.add(";"))},l.prototype.getPath=function(){return this.path instanceof o?this.path.value.value:this.path.value},l.prototype.isVariableImport=function(){var e=this.path;return e instanceof o&&(e=e.value),!(e instanceof r)||e.containsVariables()},l.prototype.evalForImport=function(e){var t=this.path;return t instanceof o&&(t=t.value),new l(t.eval(e),this.features,this.options,this.index,this.currentFileInfo)},l.prototype.evalPath=function(e){var t=this.path.eval(e),n=this.currentFileInfo&&this.currentFileInfo.rootpath;if(!(t instanceof o)){if(n){var i=t.value;i&&e.isPathRelative(i)&&(t.value=n+i)}t.value=e.normalizePath(t.value)}return t},l.prototype.eval=function(e){var t,n,o=this.features&&this.features.eval(e);if(this.options.plugin)return n=e.frames[0]&&e.frames[0].functionRegistry,n&&this.root&&this.root.functions&&n.addMultiple(this.root.functions),[];if(this.skip&&("function"==typeof this.skip&&(this.skip=this.skip()),this.skip))return[];if(this.options.inline){var r=new a(this.root,0,{filename:this.importedFilename},!0,!0);return this.features?new i([r],this.features.value):[r]}if(this.css){var c=new l(this.evalPath(e),o,this.options,this.index);if(!c.css&&this.error)throw this.error;return c}return t=new s(null,this.root.rules.slice(0)),t.evalImports(e),this.features?new i(t.rules,this.features.value):t.rules},t.exports=l},{"./anonymous":44,"./media":64,"./node":68,"./quoted":71,"./ruleset":74,"./url":78}],60:[function(e,t){var n={};n.Node=e("./node"),n.Alpha=e("./alpha"),n.Color=e("./color"),n.Directive=e("./directive"),n.DetachedRuleset=e("./detached-ruleset"),n.Operation=e("./operation"),n.Dimension=e("./dimension"),n.Unit=e("./unit"),n.Keyword=e("./keyword"),n.Variable=e("./variable"),n.Ruleset=e("./ruleset"),n.Element=e("./element"),n.Attribute=e("./attribute"),n.Combinator=e("./combinator"),n.Selector=e("./selector"),n.Quoted=e("./quoted"),n.Expression=e("./expression"),n.Rule=e("./rule"),n.Call=e("./call"),n.URL=e("./url"),n.Import=e("./import"),n.mixin={Call:e("./mixin-call"),Definition:e("./mixin-definition")},n.Comment=e("./comment"),n.Anonymous=e("./anonymous"),n.Value=e("./value"),n.JavaScript=e("./javascript"),n.Assignment=e("./assignment"),n.Condition=e("./condition"),n.Paren=e("./paren"),n.Media=e("./media"),n.UnicodeDescriptor=e("./unicode-descriptor"),n.Negative=e("./negative"),n.Extend=e("./extend"),n.RulesetCall=e("./ruleset-call"),t.exports=n},{"./alpha":43,"./anonymous":44,"./assignment":45,"./attribute":46,"./call":47,"./color":48,"./combinator":49,"./comment":50,"./condition":51,"./detached-ruleset":53,"./dimension":54,"./directive":55,"./element":56,"./expression":57,"./extend":58,"./import":59,"./javascript":61,"./keyword":63,"./media":64,"./mixin-call":65,"./mixin-definition":66,"./negative":67,"./node":68,"./operation":69,"./paren":70,"./quoted":71,"./rule":72,"./ruleset":74,"./ruleset-call":73,"./selector":75,"./unicode-descriptor":76,"./unit":77,"./url":78,"./value":79,"./variable":80}],61:[function(e,t){var n=e("./js-eval-node"),i=e("./dimension"),o=e("./quoted"),r=e("./anonymous"),s=function(e,t,n,i){this.escaped=t,this.expression=e,this.index=n,this.currentFileInfo=i};s.prototype=new n,s.prototype.type="JavaScript",s.prototype.eval=function(e){var t=this.evaluateJavaScript(this.expression,e);return"number"==typeof t?new i(t):"string"==typeof t?new o('"'+t+'"',t,this.escaped,this.index):new r(Array.isArray(t)?t.join(", "):t)},t.exports=s},{"./anonymous":44,"./dimension":54,"./js-eval-node":62,"./quoted":71}],62:[function(e,t){var n=e("./node"),i=e("./variable"),o=function(){};o.prototype=new n,o.prototype.evaluateJavaScript=function(e,t){var n,o=this,r={};if(void 0!==t.javascriptEnabled&&!t.javascriptEnabled)throw{message:"You are using JavaScript, which has been disabled.",filename:this.currentFileInfo.filename,index:this.index};e=e.replace(/@\{([\w-]+)\}/g,function(e,n){return o.jsify(new i("@"+n,o.index,o.currentFileInfo).eval(t))});try{e=new Function("return ("+e+")")}catch(t){throw{message:"JavaScript evaluation error: "+t.message+" from `"+e+"`",filename:this.currentFileInfo.filename,index:this.index}}var s=t.frames[0].variables();for(var a in s)s.hasOwnProperty(a)&&(r[a.slice(1)]={value:s[a].value,toJS:function(){return this.value.eval(t).toCSS()}});try{n=e.call(r)}catch(e){throw{message:"JavaScript evaluation error: '"+e.name+": "+e.message.replace(/["]/g,"'")+"'",filename:this.currentFileInfo.filename,index:this.index
}}return n},o.prototype.jsify=function(e){return Array.isArray(e.value)&&e.value.length>1?"["+e.value.map(function(e){return e.toCSS()}).join(", ")+"]":e.toCSS()},t.exports=o},{"./node":68,"./variable":80}],63:[function(e,t){var n=e("./node"),i=function(e){this.value=e};i.prototype=new n,i.prototype.type="Keyword",i.prototype.genCSS=function(e,t){if("%"===this.value)throw{type:"Syntax",message:"Invalid % without number"};t.add(this.value)},i.True=new i("true"),i.False=new i("false"),t.exports=i},{"./node":68}],64:[function(e,t){var n=e("./ruleset"),i=e("./value"),o=e("./selector"),r=e("./anonymous"),s=e("./expression"),a=e("./directive"),l=function(e,t,r,s){this.index=r,this.currentFileInfo=s;var a=new o([],null,null,this.index,this.currentFileInfo).createEmptySelectors();this.features=new i(t),this.rules=[new n(a,e)],this.rules[0].allowImports=!0};l.prototype=new a,l.prototype.type="Media",l.prototype.isRulesetLike=!0,l.prototype.accept=function(e){this.features&&(this.features=e.visit(this.features)),this.rules&&(this.rules=e.visitArray(this.rules))},l.prototype.genCSS=function(e,t){t.add("@media ",this.currentFileInfo,this.index),this.features.genCSS(e,t),this.outputRuleset(e,t,this.rules)},l.prototype.eval=function(e){e.mediaBlocks||(e.mediaBlocks=[],e.mediaPath=[]);var t=new l(null,[],this.index,this.currentFileInfo);this.debugInfo&&(this.rules[0].debugInfo=this.debugInfo,t.debugInfo=this.debugInfo);var n=!1;e.strictMath||(n=!0,e.strictMath=!0);try{t.features=this.features.eval(e)}finally{n&&(e.strictMath=!1)}return e.mediaPath.push(t),e.mediaBlocks.push(t),this.rules[0].functionRegistry=e.frames[0].functionRegistry.inherit(),e.frames.unshift(this.rules[0]),t.rules=[this.rules[0].eval(e)],e.frames.shift(),e.mediaPath.pop(),0===e.mediaPath.length?t.evalTop(e):t.evalNested(e)},l.prototype.evalTop=function(e){var t=this;if(e.mediaBlocks.length>1){var i=new o([],null,null,this.index,this.currentFileInfo).createEmptySelectors();t=new n(i,e.mediaBlocks),t.multiMedia=!0}return delete e.mediaBlocks,delete e.mediaPath,t},l.prototype.evalNested=function(e){var t,o,a=e.mediaPath.concat([this]);for(t=0;a.length>t;t++)o=a[t].features instanceof i?a[t].features.value:a[t].features,a[t]=Array.isArray(o)?o:[o];return this.features=new i(this.permute(a).map(function(e){for(e=e.map(function(e){return e.toCSS?e:new r(e)}),t=e.length-1;t>0;t--)e.splice(t,0,new r("and"));return new s(e)})),new n([],[])},l.prototype.permute=function(e){if(0===e.length)return[];if(1===e.length)return e[0];for(var t=[],n=this.permute(e.slice(1)),i=0;n.length>i;i++)for(var o=0;e[0].length>o;o++)t.push([e[0][o]].concat(n[i]));return t},l.prototype.bubbleSelectors=function(e){e&&(this.rules=[new n(e.slice(0),[this.rules[0]])])},t.exports=l},{"./anonymous":44,"./directive":55,"./expression":57,"./ruleset":74,"./selector":75,"./value":79}],65:[function(e,t){var n=e("./node"),i=e("./selector"),o=e("./mixin-definition"),r=e("../functions/default"),s=function(e,t,n,o,r){this.selector=new i(e),this.arguments=t&&t.length?t:null,this.index=n,this.currentFileInfo=o,this.important=r};s.prototype=new n,s.prototype.type="MixinCall",s.prototype.accept=function(e){this.selector&&(this.selector=e.visit(this.selector)),this.arguments&&(this.arguments=e.visitArray(this.arguments))},s.prototype.eval=function(e){function t(t,n){var i,o;for(u=0;2>u;u++){for(_[u]=!0,r.value(u),i=0;n.length>i&&_[u];i++)o=n[i],o.matchCondition&&(_[u]=_[u]&&o.matchCondition(null,e));t.matchCondition&&(_[u]=_[u]&&t.matchCondition(a,e))}return _[0]||_[1]?_[0]!=_[1]?_[1]?C:I:S:x}var n,i,s,a,l,c,u,d,m,p,h,f,g,v,b,y=[],w=!1,k=[],_=[],x=-1,S=0,C=1,I=2;for(a=this.arguments&&this.arguments.map(function(t){return{name:t.name,value:t.value.eval(e)}}),b=function(t){return t.matchArgs(null,e)},l=0;e.frames.length>l;l++)if((n=e.frames[l].find(this.selector,null,b)).length>0){for(m=!0,c=0;n.length>c;c++){for(i=n[c].rule,s=n[c].path,d=!1,u=0;e.frames.length>u;u++)if(!(i instanceof o)&&i===(e.frames[u].originalRuleset||e.frames[u])){d=!0;break}d||i.matchArgs(a,e)&&(h={mixin:i,group:t(i,s)},h.group!==x&&k.push(h),w=!0)}for(r.reset(),g=[0,0,0],c=0;k.length>c;c++)g[k[c].group]++;if(g[S]>0)f=I;else if(f=C,g[C]+g[I]>1)throw{type:"Runtime",message:"Ambiguous use of `default()` found when matching for `"+this.format(a)+"`",index:this.index,filename:this.currentFileInfo.filename};for(c=0;k.length>c;c++)if(h=k[c].group,h===S||h===f)try{i=k[c].mixin,i instanceof o||(v=i.originalRuleset||i,i=new o("",[],i.rules,null,!1),i.originalRuleset=v),Array.prototype.push.apply(y,i.evalCall(e,a,this.important).rules)}catch(e){throw{message:e.message,index:this.index,filename:this.currentFileInfo.filename,stack:e.stack}}if(w){if(!this.currentFileInfo||!this.currentFileInfo.reference)for(l=0;y.length>l;l++)p=y[l],p.markReferenced&&p.markReferenced();return y}}throw m?{type:"Runtime",message:"No matching definition was found for `"+this.format(a)+"`",index:this.index,filename:this.currentFileInfo.filename}:{type:"Name",message:this.selector.toCSS().trim()+" is undefined",index:this.index,filename:this.currentFileInfo.filename}},s.prototype.format=function(e){return this.selector.toCSS().trim()+"("+(e?e.map(function(e){var t="";return e.name&&(t+=e.name+":"),t+=e.value.toCSS?e.value.toCSS():"???"}).join(", "):"")+")"},t.exports=s},{"../functions/default":19,"./mixin-definition":66,"./node":68,"./selector":75}],66:[function(e,t){var n=e("./selector"),i=e("./element"),o=e("./ruleset"),r=e("./rule"),s=e("./expression"),a=e("../contexts"),l=function(e,t,o,r,s,a){this.name=e,this.selectors=[new n([new i(null,e,this.index,this.currentFileInfo)])],this.params=t,this.condition=r,this.variadic=s,this.arity=t.length,this.rules=o,this._lookups={},this.required=t.reduce(function(e,t){return!t.name||t.name&&!t.value?e+1:e},0),this.frames=a};l.prototype=new o,l.prototype.type="MixinDefinition",l.prototype.evalFirst=!0,l.prototype.accept=function(e){this.params&&this.params.length&&(this.params=e.visitArray(this.params)),this.rules=e.visitArray(this.rules),this.condition&&(this.condition=e.visit(this.condition))},l.prototype.evalParams=function(e,t,n,i){var l,c,u,d,m,p,h,f,g=new o(null,null),v=this.params.slice(0),b=0;if(t.frames&&t.frames[0]&&t.frames[0].functionRegistry&&(g.functionRegistry=t.frames[0].functionRegistry.inherit()),t=new a.Eval(t,[g].concat(t.frames)),n)for(n=n.slice(0),b=n.length,u=0;b>u;u++)if(c=n[u],p=c&&c.name){for(h=!1,d=0;v.length>d;d++)if(!i[d]&&p===v[d].name){i[d]=c.value.eval(e),g.prependRule(new r(p,c.value.eval(e))),h=!0;break}if(h){n.splice(u,1),u--;continue}throw{type:"Runtime",message:"Named argument for "+this.name+" "+n[u].name+" not found"}}for(f=0,u=0;v.length>u;u++)if(!i[u]){if(c=n&&n[f],p=v[u].name)if(v[u].variadic){for(l=[],d=f;b>d;d++)l.push(n[d].value.eval(e));g.prependRule(new r(p,new s(l).eval(e)))}else{if(m=c&&c.value)m=m.eval(e);else{if(!v[u].value)throw{type:"Runtime",message:"wrong number of arguments for "+this.name+" ("+b+" for "+this.arity+")"};m=v[u].value.eval(t),g.resetCache()}g.prependRule(new r(p,m)),i[u]=m}if(v[u].variadic&&n)for(d=f;b>d;d++)i[d]=n[d].value.eval(e);f++}return g},l.prototype.makeImportant=function(){var e=this.rules?this.rules.map(function(e){return e.makeImportant?e.makeImportant(!0):e}):this.rules,t=new l(this.name,this.params,e,this.condition,this.variadic,this.frames);return t},l.prototype.eval=function(e){return new l(this.name,this.params,this.rules,this.condition,this.variadic,this.frames||e.frames.slice(0))},l.prototype.evalCall=function(e,t,n){var i,l,c=[],u=this.frames?this.frames.concat(e.frames):e.frames,d=this.evalParams(e,new a.Eval(e,u),t,c);return d.prependRule(new r("@arguments",new s(c).eval(e))),i=this.rules.slice(0),l=new o(null,i),l.originalRuleset=this,l=l.eval(new a.Eval(e,[this,d].concat(u))),n&&(l=l.makeImportant()),l},l.prototype.matchCondition=function(e,t){return!(this.condition&&!this.condition.eval(new a.Eval(t,[this.evalParams(t,new a.Eval(t,this.frames?this.frames.concat(t.frames):t.frames),e,[])].concat(this.frames||[]).concat(t.frames))))},l.prototype.matchArgs=function(e,t){var n,i=e&&e.length||0;if(this.variadic){if(this.required-1>i)return!1}else{if(this.required>i)return!1;if(i>this.params.length)return!1}n=Math.min(i,this.arity);for(var o=0;n>o;o++)if(!this.params[o].name&&!this.params[o].variadic&&e[o].value.eval(t).toCSS()!=this.params[o].value.eval(t).toCSS())return!1;return!0},t.exports=l},{"../contexts":10,"./element":56,"./expression":57,"./rule":72,"./ruleset":74,"./selector":75}],67:[function(e,t){var n=e("./node"),i=e("./operation"),o=e("./dimension"),r=function(e){this.value=e};r.prototype=new n,r.prototype.type="Negative",r.prototype.genCSS=function(e,t){t.add("-"),this.value.genCSS(e,t)},r.prototype.eval=function(e){return e.isMathOn()?new i("*",[new o(-1),this.value]).eval(e):new r(this.value.eval(e))},t.exports=r},{"./dimension":54,"./node":68,"./operation":69}],68:[function(e,t){var n=function(){};n.prototype.toCSS=function(e){var t=[];return this.genCSS(e,{add:function(e){t.push(e)},isEmpty:function(){return 0===t.length}}),t.join("")},n.prototype.genCSS=function(e,t){t.add(this.value)},n.prototype.accept=function(e){this.value=e.visit(this.value)},n.prototype.eval=function(){return this},n.prototype._operate=function(e,t,n,i){switch(t){case"+":return n+i;case"-":return n-i;case"*":return n*i;case"/":return n/i}},n.prototype.fround=function(e,t){var n=e&&e.numPrecision;return null==n?t:Number((t+2e-16).toFixed(n))},n.compare=function(e,t){if(e.compare&&"Quoted"!==t.type&&"Anonymous"!==t.type)return e.compare(t);if(t.compare)return-t.compare(e);if(e.type===t.type){if(e=e.value,t=t.value,!Array.isArray(e))return e===t?0:void 0;if(e.length===t.length){for(var i=0;e.length>i;i++)if(0!==n.compare(e[i],t[i]))return;return 0}}},n.numericCompare=function(e,t){return t>e?-1:e===t?0:e>t?1:void 0},t.exports=n},{}],69:[function(e,t){var n=e("./node"),i=e("./color"),o=e("./dimension"),r=function(e,t,n){this.op=e.trim(),this.operands=t,this.isSpaced=n};r.prototype=new n,r.prototype.type="Operation",r.prototype.accept=function(e){this.operands=e.visit(this.operands)},r.prototype.eval=function(e){var t=this.operands[0].eval(e),n=this.operands[1].eval(e);if(e.isMathOn()){if(t instanceof o&&n instanceof i&&(t=t.toColor()),n instanceof o&&t instanceof i&&(n=n.toColor()),!t.operate)throw{type:"Operation",message:"Operation on an invalid type"};return t.operate(e,this.op,n)}return new r(this.op,[t,n],this.isSpaced)},r.prototype.genCSS=function(e,t){this.operands[0].genCSS(e,t),this.isSpaced&&t.add(" "),t.add(this.op),this.isSpaced&&t.add(" "),this.operands[1].genCSS(e,t)},t.exports=r},{"./color":48,"./dimension":54,"./node":68}],70:[function(e,t){var n=e("./node"),i=function(e){this.value=e};i.prototype=new n,i.prototype.type="Paren",i.prototype.genCSS=function(e,t){t.add("("),this.value.genCSS(e,t),t.add(")")},i.prototype.eval=function(e){return new i(this.value.eval(e))},t.exports=i},{"./node":68}],71:[function(e,t){var n=e("./node"),i=e("./js-eval-node"),o=e("./variable"),r=function(e,t,n,i,o){this.escaped=null==n||n,this.value=t||"",this.quote=e.charAt(0),this.index=i,this.currentFileInfo=o};r.prototype=new i,r.prototype.type="Quoted",r.prototype.genCSS=function(e,t){this.escaped||t.add(this.quote,this.currentFileInfo,this.index),t.add(this.value),this.escaped||t.add(this.quote)},r.prototype.containsVariables=function(){return this.value.match(/(`([^`]+)`)|@\{([\w-]+)\}/)},r.prototype.eval=function(e){function t(e,t,n){var i=e;do e=i,i=e.replace(t,n);while(e!==i);return i}var n=this,i=this.value,s=function(t,i){return String(n.evaluateJavaScript(i,e))},a=function(t,i){var s=new o("@"+i,n.index,n.currentFileInfo).eval(e,!0);return s instanceof r?s.value:s.toCSS()};return i=t(i,/`([^`]+)`/g,s),i=t(i,/@\{([\w-]+)\}/g,a),new r(this.quote+i+this.quote,i,this.escaped,this.index,this.currentFileInfo)},r.prototype.compare=function(e){return"Quoted"!==e.type||this.escaped||e.escaped?e.toCSS&&this.toCSS()===e.toCSS()?0:void 0:n.numericCompare(this.value,e.value)},t.exports=r},{"./js-eval-node":62,"./node":68,"./variable":80}],72:[function(e,t){function n(e,t){var n,i="",o=t.length,r={add:function(e){i+=e}};for(n=0;o>n;n++)t[n].eval(e).genCSS(e,r);return i}var i=e("./node"),o=e("./value"),r=e("./keyword"),s=function(e,t,n,r,s,a,l,c){this.name=e,this.value=t instanceof i?t:new o([t]),this.important=n?" "+n.trim():"",this.merge=r,this.index=s,this.currentFileInfo=a,this.inline=l||!1,this.variable=void 0!==c?c:e.charAt&&"@"===e.charAt(0)};s.prototype=new i,s.prototype.type="Rule",s.prototype.genCSS=function(e,t){t.add(this.name+(e.compress?":":": "),this.currentFileInfo,this.index);try{this.value.genCSS(e,t)}catch(e){throw e.index=this.index,e.filename=this.currentFileInfo.filename,e}t.add(this.important+(this.inline||e.lastRule&&e.compress?"":";"),this.currentFileInfo,this.index)},s.prototype.eval=function(e){var t,i=!1,o=this.name,a=this.variable;"string"!=typeof o&&(o=1===o.length&&o[0]instanceof r?o[0].value:n(e,o),a=!1),"font"!==o||e.strictMath||(i=!0,e.strictMath=!0);try{if(e.importantScope.push({}),t=this.value.eval(e),!this.variable&&"DetachedRuleset"===t.type)throw{message:"Rulesets cannot be evaluated on a property.",index:this.index,filename:this.currentFileInfo.filename};var l=this.important,c=e.importantScope.pop();return!l&&c.important&&(l=c.important),new s(o,t,l,this.merge,this.index,this.currentFileInfo,this.inline,a)}catch(e){throw"number"!=typeof e.index&&(e.index=this.index,e.filename=this.currentFileInfo.filename),e}finally{i&&(e.strictMath=!1)}},s.prototype.makeImportant=function(){return new s(this.name,this.value,"!important",this.merge,this.index,this.currentFileInfo,this.inline)},t.exports=s},{"./keyword":63,"./node":68,"./value":79}],73:[function(e,t){var n=e("./node"),i=e("./variable"),o=function(e){this.variable=e};o.prototype=new n,o.prototype.type="RulesetCall",o.prototype.eval=function(e){var t=new i(this.variable).eval(e);return t.callEval(e)},t.exports=o},{"./node":68,"./variable":80}],74:[function(e,t){var n=e("./node"),i=e("./rule"),o=e("./selector"),r=e("./element"),s=e("./paren"),a=e("../contexts"),l=e("../functions/function-registry"),c=e("../functions/default"),u=e("./debug-info"),d=function(e,t,n){this.selectors=e,this.rules=t,this._lookups={},this.strictImports=n};d.prototype=new n,d.prototype.type="Ruleset",d.prototype.isRuleset=!0,d.prototype.isRulesetLike=!0,d.prototype.accept=function(e){this.paths?e.visitArray(this.paths,!0):this.selectors&&(this.selectors=e.visitArray(this.selectors)),this.rules&&this.rules.length&&(this.rules=e.visitArray(this.rules))},d.prototype.eval=function(e){var t,n,o,r,s=this.selectors,a=!1;if(s&&(n=s.length)){for(t=[],c.error({type:"Syntax",message:"it is currently only allowed in parametric mixin guards,"}),r=0;n>r;r++)o=s[r].eval(e),t.push(o),o.evaldCondition&&(a=!0);c.reset()}else a=!0;var u,m,p=this.rules?this.rules.slice(0):null,h=new d(t,p,this.strictImports);h.originalRuleset=this,h.root=this.root,h.firstRoot=this.firstRoot,h.allowImports=this.allowImports,this.debugInfo&&(h.debugInfo=this.debugInfo),a||(p.length=0),h.functionRegistry=function(e){for(var t,n=0,i=e.length;n!==i;++n)if(t=e[n].functionRegistry)return t;return l}(e.frames).inherit();var f=e.frames;f.unshift(h);var g=e.selectors;g||(e.selectors=g=[]),g.unshift(this.selectors),(h.root||h.allowImports||!h.strictImports)&&h.evalImports(e);var v=h.rules,b=v?v.length:0;for(r=0;b>r;r++)v[r].evalFirst&&(v[r]=v[r].eval(e));var y=e.mediaBlocks&&e.mediaBlocks.length||0;for(r=0;b>r;r++)"MixinCall"===v[r].type?(p=v[r].eval(e).filter(function(e){return!(e instanceof i&&e.variable)||!h.variable(e.name)}),v.splice.apply(v,[r,1].concat(p)),b+=p.length-1,r+=p.length-1,h.resetCache()):"RulesetCall"===v[r].type&&(p=v[r].eval(e).rules.filter(function(e){return!(e instanceof i&&e.variable)}),v.splice.apply(v,[r,1].concat(p)),b+=p.length-1,r+=p.length-1,h.resetCache());for(r=0;v.length>r;r++)u=v[r],u.evalFirst||(v[r]=u=u.eval?u.eval(e):u);for(r=0;v.length>r;r++)if(u=v[r],u instanceof d&&u.selectors&&1===u.selectors.length&&u.selectors[0].isJustParentSelector()){v.splice(r--,1);for(var w=0;u.rules.length>w;w++)m=u.rules[w],m instanceof i&&m.variable||v.splice(++r,0,m)}if(f.shift(),g.shift(),e.mediaBlocks)for(r=y;e.mediaBlocks.length>r;r++)e.mediaBlocks[r].bubbleSelectors(t);return h},d.prototype.evalImports=function(e){var t,n,i=this.rules;if(i)for(t=0;i.length>t;t++)"Import"===i[t].type&&(n=i[t].eval(e),n&&n.length?(i.splice.apply(i,[t,1].concat(n)),t+=n.length-1):i.splice(t,1,n),this.resetCache())},d.prototype.makeImportant=function(){var e=new d(this.selectors,this.rules.map(function(e){return e.makeImportant?e.makeImportant():e}),this.strictImports);return e},d.prototype.matchArgs=function(e){return!e||0===e.length},d.prototype.matchCondition=function(e,t){var n=this.selectors[this.selectors.length-1];return!!n.evaldCondition&&!(n.condition&&!n.condition.eval(new a.Eval(t,t.frames)))},d.prototype.resetCache=function(){this._rulesets=null,this._variables=null,this._lookups={}},d.prototype.variables=function(){return this._variables||(this._variables=this.rules?this.rules.reduce(function(e,t){if(t instanceof i&&t.variable===!0&&(e[t.name]=t),"Import"===t.type&&t.root&&t.root.variables){var n=t.root.variables();for(var o in n)n.hasOwnProperty(o)&&(e[o]=n[o])}return e},{}):{}),this._variables},d.prototype.variable=function(e){return this.variables()[e]},d.prototype.rulesets=function(){if(!this.rules)return[];var e,t,n=[],i=this.rules,o=i.length;for(e=0;o>e;e++)t=i[e],t.isRuleset&&n.push(t);return n},d.prototype.prependRule=function(e){var t=this.rules;t?t.unshift(e):this.rules=[e]},d.prototype.find=function(e,t,n){t=t||this;var i,r,s=[],a=e.toCSS();return a in this._lookups?this._lookups[a]:(this.rulesets().forEach(function(a){if(a!==t)for(var l=0;a.selectors.length>l;l++)if(i=e.match(a.selectors[l])){if(e.elements.length>i){if(!n||n(a)){r=a.find(new o(e.elements.slice(i)),t,n);for(var c=0;r.length>c;++c)r[c].path.push(a);Array.prototype.push.apply(s,r)}}else s.push({rule:a,path:[]});break}}),this._lookups[a]=s,s)},d.prototype.genCSS=function(e,t){function n(e){return"boolean"==typeof e.isRulesetLike?e.isRulesetLike:"function"==typeof e.isRulesetLike&&e.isRulesetLike()}var i,o,r,s,a,l=[],c=[];e.tabLevel=e.tabLevel||0,this.root||e.tabLevel++;var d,m=e.compress?"":Array(e.tabLevel+1).join("  "),p=e.compress?"":Array(e.tabLevel).join("  "),h=0,f=0;for(i=0;this.rules.length>i;i++)s=this.rules[i],"Comment"===s.type?(f===i&&f++,c.push(s)):s.isCharset&&s.isCharset()?(c.splice(h,0,s),h++,f++):"Import"===s.type?(c.splice(f,0,s),f++):c.push(s);if(c=l.concat(c),!this.root){r=u(e,this,p),r&&(t.add(r),t.add(p));var g,v=this.paths,b=v.length;for(d=e.compress?",":",\n"+p,i=0;b>i;i++)if(a=v[i],g=a.length)for(i>0&&t.add(d),e.firstSelector=!0,a[0].genCSS(e,t),e.firstSelector=!1,o=1;g>o;o++)a[o].genCSS(e,t);t.add((e.compress?"{":" {\n")+m)}for(i=0;c.length>i;i++){s=c[i],i+1===c.length&&(e.lastRule=!0);var y=e.lastRule;n(s)&&(e.lastRule=!1),s.genCSS?s.genCSS(e,t):s.value&&t.add(s.value.toString()),e.lastRule=y,e.lastRule?e.lastRule=!1:t.add(e.compress?"":"\n"+m)}this.root||(t.add(e.compress?"}":"\n"+p+"}"),e.tabLevel--),t.isEmpty()||e.compress||!this.firstRoot||t.add("\n")},d.prototype.markReferenced=function(){var e;if(this.selectors)for(e=0;this.selectors.length>e;e++)this.selectors[e].markReferenced();if(this.rules)for(e=0;this.rules.length>e;e++)this.rules[e].markReferenced&&this.rules[e].markReferenced()},d.prototype.getIsReferenced=function(){var e,t,n,i;if(this.paths)for(e=0;this.paths.length>e;e++)for(n=this.paths[e],t=0;n.length>t;t++)if(n[t].getIsReferenced&&n[t].getIsReferenced())return!0;if(this.selectors)for(e=0;this.selectors.length>e;e++)if(i=this.selectors[e],i.getIsReferenced&&i.getIsReferenced())return!0;return!1},d.prototype.joinSelectors=function(e,t,n){for(var i=0;n.length>i;i++)this.joinSelector(e,t,n[i])},d.prototype.joinSelector=function(e,t,n){function i(e,t){var n,i;if(0===e.length)n=new s(e[0]);else{var a=[];for(i=0;e.length>i;i++)a.push(new r(null,e[i],t.index,t.currentFileInfo));n=new s(new o(a))}return n}function a(e,t){var n,i;return n=new r(null,e,t.index,t.currentFileInfo),i=new o([n])}function l(e,t,n){function o(e){var t;return"Paren"!==e.value.type?null:(t=e.value.value,"Selector"!==t.type?null:t)}var s,m,p,h,f,g,v,b,y,w,k=!1;for(h=[],f=[[]],s=0;n.elements.length>s;s++)if(b=n.elements[s],"&"!==b.value){var _=o(b);if(null!=_){d(h,f);var x,S=[],C=[];for(x=l(S,t,_),k=k||x,p=0;S.length>p;p++){var I=a(i(S[p],b),b);u(f,[I],b,n,C)}f=C,h=[]}else h.push(b)}else{for(k=!0,g=[],d(h,f),m=0;f.length>m;m++)if(v=f[m],0===t.length)v.length>0&&v[0].elements.push(new r(b.combinator,"",b.index,b.currentFileInfo)),g.push(v);else for(p=0;t.length>p;p++){var T=c(v,t[p],b,n);g.push(T)}f=g,h=[]}for(d(h,f),s=0;f.length>s;s++)y=f[s].length,y>0&&(e.push(f[s]),w=f[s][y-1],f[s][y-1]=w.createDerived(w.elements,n.extendList));return k}function c(e,t,n,i){var o,s,a;if(o=[],e.length>0?(o=e.slice(0),s=o.pop(),a=i.createDerived(s.elements.slice(0))):a=i.createDerived([]),t.length>0){var l=n.combinator,c=t[0].elements[0];l.emptyOrWhitespace&&!c.combinator.emptyOrWhitespace&&(l=c.combinator),a.elements.push(new r(l,c.value,n.index,n.currentFileInfo)),a.elements=a.elements.concat(t[0].elements.slice(1))}return 0!==a.elements.length&&o.push(a),t.length>1&&(o=o.concat(t.slice(1))),o}function u(e,t,n,i,o){var r;for(r=0;e.length>r;r++){var s=c(e[r],t,n,i);o.push(s)}return o}function d(e,t){var n,i;if(0!==e.length){if(0===t.length)return void t.push([new o(e)]);for(n=0;t.length>n;n++)i=t[n],i.length>0?i[i.length-1]=i[i.length-1].createDerived(i[i.length-1].elements.concat(e)):i.push(new o(e))}}var m,p,h;if(p=[],h=l(p,t,n),!h)if(t.length>0)for(p=[],m=0;t.length>m;m++)p.push(t[m].concat(n));else p=[[n]];for(m=0;p.length>m;m++)e.push(p[m])},t.exports=d},{"../contexts":10,"../functions/default":19,"../functions/function-registry":21,"./debug-info":52,"./element":56,"./node":68,"./paren":70,"./rule":72,"./selector":75}],75:[function(e,t){var n=e("./node"),i=e("./element"),o=function(e,t,n,i,o,r){this.elements=e,this.extendList=t,this.condition=n,this.currentFileInfo=o||{},this.isReferenced=r,n||(this.evaldCondition=!0)};o.prototype=new n,o.prototype.type="Selector",o.prototype.accept=function(e){this.elements&&(this.elements=e.visitArray(this.elements)),this.extendList&&(this.extendList=e.visitArray(this.extendList)),this.condition&&(this.condition=e.visit(this.condition))},o.prototype.createDerived=function(e,t,n){n=null!=n?n:this.evaldCondition;var i=new o(e,t||this.extendList,null,this.index,this.currentFileInfo,this.isReferenced);return i.evaldCondition=n,i.mediaEmpty=this.mediaEmpty,i},o.prototype.createEmptySelectors=function(){var e=new i("","&",this.index,this.currentFileInfo),t=[new o([e],null,null,this.index,this.currentFileInfo)];return t[0].mediaEmpty=!0,t},o.prototype.match=function(e){var t,n,i=this.elements,o=i.length;if(e.CacheElements(),t=e._elements.length,0===t||t>o)return 0;for(n=0;t>n;n++)if(i[n].value!==e._elements[n])return 0;return t},o.prototype.CacheElements=function(){if(!this._elements){var e=this.elements.map(function(e){return e.combinator.value+(e.value.value||e.value)}).join("").match(/[,&#\*\.\w-]([\w-]|(\\.))*/g);e?"&"===e[0]&&e.shift():e=[],this._elements=e}},o.prototype.isJustParentSelector=function(){return!this.mediaEmpty&&1===this.elements.length&&"&"===this.elements[0].value&&(" "===this.elements[0].combinator.value||""===this.elements[0].combinator.value)},o.prototype.eval=function(e){var t=this.condition&&this.condition.eval(e),n=this.elements,i=this.extendList;return n=n&&n.map(function(t){return t.eval(e)}),i=i&&i.map(function(t){return t.eval(e)}),this.createDerived(n,i,t)},o.prototype.genCSS=function(e,t){var n,i;if(e&&e.firstSelector||""!==this.elements[0].combinator.value||t.add(" ",this.currentFileInfo,this.index),!this._css)for(n=0;this.elements.length>n;n++)i=this.elements[n],i.genCSS(e,t)},o.prototype.markReferenced=function(){this.isReferenced=!0},o.prototype.getIsReferenced=function(){return!this.currentFileInfo.reference||this.isReferenced},o.prototype.getIsOutput=function(){return this.evaldCondition},t.exports=o},{"./element":56,"./node":68}],76:[function(e,t){var n=e("./node"),i=function(e){this.value=e};i.prototype=new n,i.prototype.type="UnicodeDescriptor",t.exports=i},{"./node":68}],77:[function(e,t){var n=e("./node"),i=e("../data/unit-conversions"),o=function(e,t,n){this.numerator=e?e.slice(0).sort():[],this.denominator=t?t.slice(0).sort():[],n?this.backupUnit=n:e&&e.length&&(this.backupUnit=e[0])};o.prototype=new n,o.prototype.type="Unit",o.prototype.clone=function(){return new o(this.numerator.slice(0),this.denominator.slice(0),this.backupUnit)},o.prototype.genCSS=function(e,t){var n=e&&e.strictUnits;1===this.numerator.length?t.add(this.numerator[0]):!n&&this.backupUnit?t.add(this.backupUnit):!n&&this.denominator.length&&t.add(this.denominator[0])},o.prototype.toString=function(){var e,t=this.numerator.join("*");for(e=0;this.denominator.length>e;e++)t+="/"+this.denominator[e];return t},o.prototype.compare=function(e){return this.is(e.toString())?0:void 0},o.prototype.is=function(e){return this.toString().toUpperCase()===e.toUpperCase()},o.prototype.isLength=function(){return Boolean(this.toCSS().match(/px|em|%|in|cm|mm|pc|pt|ex/))},o.prototype.isEmpty=function(){return 0===this.numerator.length&&0===this.denominator.length},o.prototype.isSingular=function(){return 1>=this.numerator.length&&0===this.denominator.length},o.prototype.map=function(e){var t;for(t=0;this.numerator.length>t;t++)this.numerator[t]=e(this.numerator[t],!1);for(t=0;this.denominator.length>t;t++)this.denominator[t]=e(this.denominator[t],!0)},o.prototype.usedUnits=function(){var e,t,n={};t=function(t){return e.hasOwnProperty(t)&&!n[o]&&(n[o]=t),t};for(var o in i)i.hasOwnProperty(o)&&(e=i[o],this.map(t));return n},o.prototype.cancel=function(){var e,t,n={};for(t=0;this.numerator.length>t;t++)e=this.numerator[t],n[e]=(n[e]||0)+1;for(t=0;this.denominator.length>t;t++)e=this.denominator[t],n[e]=(n[e]||0)-1;this.numerator=[],this.denominator=[];for(e in n)if(n.hasOwnProperty(e)){var i=n[e];if(i>0)for(t=0;i>t;t++)this.numerator.push(e);else if(0>i)for(t=0;-i>t;t++)this.denominator.push(e)}this.numerator.sort(),this.denominator.sort()},t.exports=o},{"../data/unit-conversions":13,"./node":68}],78:[function(e,t){var n=e("./node"),i=function(e,t,n,i){this.value=e,this.currentFileInfo=n,this.index=t,this.isEvald=i};i.prototype=new n,i.prototype.type="Url",i.prototype.accept=function(e){this.value=e.visit(this.value)},i.prototype.genCSS=function(e,t){t.add("url("),this.value.genCSS(e,t),t.add(")")},i.prototype.eval=function(e){var t,n=this.value.eval(e);if(!this.isEvald&&(t=this.currentFileInfo&&this.currentFileInfo.rootpath,t&&"string"==typeof n.value&&e.isPathRelative(n.value)&&(n.quote||(t=t.replace(/[\(\)'"\s]/g,function(e){return"\\"+e})),n.value=t+n.value),n.value=e.normalizePath(n.value),e.urlArgs&&!n.value.match(/^\s*data:/))){var o=-1===n.value.indexOf("?")?"?":"&",r=o+e.urlArgs;-1!==n.value.indexOf("#")?n.value=n.value.replace("#",r+"#"):n.value+=r}return new i(n,this.index,this.currentFileInfo,!0)},t.exports=i},{"./node":68}],79:[function(e,t){var n=e("./node"),i=function(e){if(this.value=e,!e)throw new Error("Value requires an array argument")};i.prototype=new n,i.prototype.type="Value",i.prototype.accept=function(e){this.value&&(this.value=e.visitArray(this.value))},i.prototype.eval=function(e){return 1===this.value.length?this.value[0].eval(e):new i(this.value.map(function(t){return t.eval(e)}))},i.prototype.genCSS=function(e,t){var n;for(n=0;this.value.length>n;n++)this.value[n].genCSS(e,t),this.value.length>n+1&&t.add(e&&e.compress?",":", ")},t.exports=i},{"./node":68}],80:[function(e,t){var n=e("./node"),i=function(e,t,n){this.name=e,this.index=t,this.currentFileInfo=n||{}};i.prototype=new n,i.prototype.type="Variable",i.prototype.eval=function(e){var t,n=this.name;if(0===n.indexOf("@@")&&(n="@"+new i(n.slice(1),this.index,this.currentFileInfo).eval(e).value),this.evaluating)throw{type:"Name",message:"Recursive variable definition for "+n,filename:this.currentFileInfo.filename,index:this.index};if(this.evaluating=!0,t=this.find(e.frames,function(t){var i=t.variable(n);if(i){if(i.important){var o=e.importantScope[e.importantScope.length-1];o.important=i.important}return i.value.eval(e)}}))return this.evaluating=!1,t;throw{type:"Name",message:"variable "+n+" is undefined",filename:this.currentFileInfo.filename,index:this.index}},i.prototype.find=function(e,t){for(var n,i=0;e.length>i;i++)if(n=t.call(e,e[i]))return n;return null},t.exports=i},{"./node":68}],81:[function(e,t){t.exports={getLocation:function(e,t){for(var n=e+1,i=null,o=-1;--n>=0&&"\n"!==t.charAt(n);)o++;return"number"==typeof e&&(i=(t.slice(0,e).match(/\n/g)||"").length),{line:i,column:o}}}},{}],82:[function(e,t){var n=e("../tree"),i=e("./visitor"),o=e("../logger"),r=function(){this._visitor=new i(this),this.contexts=[],this.allExtendsStack=[[]]};r.prototype={run:function(e){return e=this._visitor.visit(e),e.allExtends=this.allExtendsStack[0],e},visitRule:function(e,t){t.visitDeeper=!1},visitMixinDefinition:function(e,t){t.visitDeeper=!1},visitRuleset:function(e){if(!e.root){var t,i,o,r,s=[],a=e.rules,l=a?a.length:0;for(t=0;l>t;t++)e.rules[t]instanceof n.Extend&&(s.push(a[t]),e.extendOnEveryPath=!0);var c=e.paths;for(t=0;c.length>t;t++){var u=c[t],d=u[u.length-1],m=d.extendList;for(r=m?m.slice(0).concat(s):s,r&&(r=r.map(function(e){return e.clone()})),i=0;r.length>i;i++)this.foundExtends=!0,o=r[i],o.findSelfSelectors(u),o.ruleset=e,0===i&&(o.firstExtendOnThisSelectorPath=!0),this.allExtendsStack[this.allExtendsStack.length-1].push(o)}this.contexts.push(e.selectors)}},visitRulesetOut:function(e){e.root||(this.contexts.length=this.contexts.length-1)},visitMedia:function(e){e.allExtends=[],this.allExtendsStack.push(e.allExtends)},visitMediaOut:function(){this.allExtendsStack.length=this.allExtendsStack.length-1},visitDirective:function(e){e.allExtends=[],this.allExtendsStack.push(e.allExtends)},visitDirectiveOut:function(){this.allExtendsStack.length=this.allExtendsStack.length-1}};var s=function(){this._visitor=new i(this)};s.prototype={run:function(e){var t=new r;if(this.extendIndicies={},t.run(e),!t.foundExtends)return e;e.allExtends=e.allExtends.concat(this.doExtendChaining(e.allExtends,e.allExtends)),this.allExtendsStack=[e.allExtends];var n=this._visitor.visit(e);return this.checkExtendsForNonMatched(e.allExtends),n},checkExtendsForNonMatched:function(e){var t=this.extendIndicies;e.filter(function(e){return!e.hasFoundMatches&&1==e.parent_ids.length}).forEach(function(e){var n="_unknown_";try{n=e.selector.toCSS({})}catch(e){}t[e.index+" "+n]||(t[e.index+" "+n]=!0,o.warn("extend '"+n+"' has no matches"))})},doExtendChaining:function(e,t,i){var o,r,s,a,l,c,u,d,m=[],p=this;for(i=i||0,o=0;e.length>o;o++)for(r=0;t.length>r;r++)c=e[o],u=t[r],c.parent_ids.indexOf(u.object_id)>=0||(l=[u.selfSelectors[0]],s=p.findMatch(c,l),s.length&&(c.hasFoundMatches=!0,c.selfSelectors.forEach(function(e){a=p.extendSelector(s,l,e),d=new n.Extend(u.selector,u.option,0),d.selfSelectors=a,a[a.length-1].extendList=[d],m.push(d),d.ruleset=u.ruleset,d.parent_ids=d.parent_ids.concat(u.parent_ids,c.parent_ids),u.firstExtendOnThisSelectorPath&&(d.firstExtendOnThisSelectorPath=!0,u.ruleset.paths.push(a))})));if(m.length){if(this.extendChainCount++,i>100){var h="{unable to calculate}",f="{unable to calculate}";try{h=m[0].selfSelectors[0].toCSS(),f=m[0].selector.toCSS()}catch(e){}throw{message:"extend circular reference detected. One of the circular extends is currently:"+h+":extend("+f+")"}}return m.concat(p.doExtendChaining(m,t,i+1))}return m},visitRule:function(e,t){t.visitDeeper=!1},visitMixinDefinition:function(e,t){t.visitDeeper=!1},visitSelector:function(e,t){t.visitDeeper=!1;
},visitRuleset:function(e){if(!e.root){var t,n,i,o,r=this.allExtendsStack[this.allExtendsStack.length-1],s=[],a=this;for(i=0;r.length>i;i++)for(n=0;e.paths.length>n;n++)if(o=e.paths[n],!e.extendOnEveryPath){var l=o[o.length-1].extendList;l&&l.length||(t=this.findMatch(r[i],o),t.length&&(r[i].hasFoundMatches=!0,r[i].selfSelectors.forEach(function(e){s.push(a.extendSelector(t,o,e))})))}e.paths=e.paths.concat(s)}},findMatch:function(e,t){var n,i,o,r,s,a,l,c=this,u=e.selector.elements,d=[],m=[];for(n=0;t.length>n;n++)for(i=t[n],o=0;i.elements.length>o;o++)for(r=i.elements[o],(e.allowBefore||0===n&&0===o)&&d.push({pathIndex:n,index:o,matched:0,initialCombinator:r.combinator}),a=0;d.length>a;a++)l=d[a],s=r.combinator.value,""===s&&0===o&&(s=" "),!c.isElementValuesEqual(u[l.matched].value,r.value)||l.matched>0&&u[l.matched].combinator.value!==s?l=null:l.matched++,l&&(l.finished=l.matched===u.length,l.finished&&!e.allowAfter&&(i.elements.length>o+1||t.length>n+1)&&(l=null)),l?l.finished&&(l.length=u.length,l.endPathIndex=n,l.endPathElementIndex=o+1,d.length=0,m.push(l)):(d.splice(a,1),a--);return m},isElementValuesEqual:function(e,t){if("string"==typeof e||"string"==typeof t)return e===t;if(e instanceof n.Attribute)return e.op===t.op&&e.key===t.key&&(e.value&&t.value?(e=e.value.value||e.value,t=t.value.value||t.value,e===t):!e.value&&!t.value);if(e=e.value,t=t.value,e instanceof n.Selector){if(!(t instanceof n.Selector)||e.elements.length!==t.elements.length)return!1;for(var i=0;e.elements.length>i;i++){if(e.elements[i].combinator.value!==t.elements[i].combinator.value&&(0!==i||(e.elements[i].combinator.value||" ")!==(t.elements[i].combinator.value||" ")))return!1;if(!this.isElementValuesEqual(e.elements[i].value,t.elements[i].value))return!1}return!0}return!1},extendSelector:function(e,t,i){var o,r,s,a,l,c=0,u=0,d=[];for(o=0;e.length>o;o++)a=e[o],r=t[a.pathIndex],s=new n.Element(a.initialCombinator,i.elements[0].value,i.elements[0].index,i.elements[0].currentFileInfo),a.pathIndex>c&&u>0&&(d[d.length-1].elements=d[d.length-1].elements.concat(t[c].elements.slice(u)),u=0,c++),l=r.elements.slice(u,a.index).concat([s]).concat(i.elements.slice(1)),c===a.pathIndex&&o>0?d[d.length-1].elements=d[d.length-1].elements.concat(l):(d=d.concat(t.slice(c,a.pathIndex)),d.push(new n.Selector(l))),c=a.endPathIndex,u=a.endPathElementIndex,u>=t[c].elements.length&&(u=0,c++);return t.length>c&&u>0&&(d[d.length-1].elements=d[d.length-1].elements.concat(t[c].elements.slice(u)),c++),d=d.concat(t.slice(c,t.length))},visitRulesetOut:function(){},visitMedia:function(e){var t=e.allExtends.concat(this.allExtendsStack[this.allExtendsStack.length-1]);t=t.concat(this.doExtendChaining(t,e.allExtends)),this.allExtendsStack.push(t)},visitMediaOut:function(){var e=this.allExtendsStack.length-1;this.allExtendsStack.length=e},visitDirective:function(e){var t=e.allExtends.concat(this.allExtendsStack[this.allExtendsStack.length-1]);t=t.concat(this.doExtendChaining(t,e.allExtends)),this.allExtendsStack.push(t)},visitDirectiveOut:function(){var e=this.allExtendsStack.length-1;this.allExtendsStack.length=e}},t.exports=s},{"../logger":31,"../tree":60,"./visitor":88}],83:[function(e,t){function n(e){this.imports=[],this.variableImports=[],this._onSequencerEmpty=e,this._currentDepth=0}n.prototype.addImport=function(e){var t=this,n={callback:e,args:null,isReady:!1};return this.imports.push(n),function(){n.args=Array.prototype.slice.call(arguments,0),n.isReady=!0,t.tryRun()}},n.prototype.addVariableImport=function(e){this.variableImports.push(e)},n.prototype.tryRun=function(){this._currentDepth++;try{for(;;){for(;this.imports.length>0;){var e=this.imports[0];if(!e.isReady)return;this.imports=this.imports.slice(1),e.callback.apply(null,e.args)}if(0===this.variableImports.length)break;var t=this.variableImports[0];this.variableImports=this.variableImports.slice(1),t()}}finally{this._currentDepth--}0===this._currentDepth&&this._onSequencerEmpty&&this._onSequencerEmpty()},t.exports=n},{}],84:[function(e,t){var n=e("../contexts"),i=e("./visitor"),o=e("./import-sequencer"),r=function(e,t){this._visitor=new i(this),this._importer=e,this._finish=t,this.context=new n.Eval,this.importCount=0,this.onceFileDetectionMap={},this.recursionDetector={},this._sequencer=new o(this._onSequencerEmpty.bind(this))};r.prototype={isReplacing:!1,run:function(e){try{this._visitor.visit(e)}catch(e){this.error=e}this.isFinished=!0,this._sequencer.tryRun()},_onSequencerEmpty:function(){this.isFinished&&this._finish(this.error)},visitImport:function(e,t){var i=e.options.inline;if(!e.css||i){var o=new n.Eval(this.context,this.context.frames.slice(0)),r=o.frames[0];this.importCount++,e.isVariableImport()?this._sequencer.addVariableImport(this.processImportNode.bind(this,e,o,r)):this.processImportNode(e,o,r)}t.visitDeeper=!1},processImportNode:function(e,t,n){var i,o=e.options.inline;try{i=e.evalForImport(t)}catch(t){t.filename||(t.index=e.index,t.filename=e.currentFileInfo.filename),e.css=!0,e.error=t}if(!i||i.css&&!o)this.importCount--,this.isFinished&&this._sequencer.tryRun();else{i.options.multiple&&(t.importMultiple=!0);for(var r=void 0===i.css,s=0;n.rules.length>s;s++)if(n.rules[s]===e){n.rules[s]=i;break}var a=this.onImported.bind(this,i,t),l=this._sequencer.addImport(a);this._importer.push(i.getPath(),r,i.currentFileInfo,i.options,l)}},onImported:function(e,t,n,i,o,r){n&&(n.filename||(n.index=e.index,n.filename=e.currentFileInfo.filename),this.error=n);var s=this,a=e.options.inline,l=e.options.plugin,c=o||r in s.recursionDetector;if(t.importMultiple||(e.skip=!!c||function(){return r in s.onceFileDetectionMap||(s.onceFileDetectionMap[r]=!0,!1)}),i&&(e.root=i,e.importedFilename=r,!(a||l||!t.importMultiple&&c))){s.recursionDetector[r]=!0;var u=this.context;this.context=t;try{this._visitor.visit(i)}catch(e){this.error=e}this.context=u}s.importCount--,s.isFinished&&s._sequencer.tryRun()},visitRule:function(e,t){"DetachedRuleset"===e.value.type?this.context.frames.unshift(e):t.visitDeeper=!1},visitRuleOut:function(e){"DetachedRuleset"===e.value.type&&this.context.frames.shift()},visitDirective:function(e){this.context.frames.unshift(e)},visitDirectiveOut:function(){this.context.frames.shift()},visitMixinDefinition:function(e){this.context.frames.unshift(e)},visitMixinDefinitionOut:function(){this.context.frames.shift()},visitRuleset:function(e){this.context.frames.unshift(e)},visitRulesetOut:function(){this.context.frames.shift()},visitMedia:function(e){this.context.frames.unshift(e.rules[0])},visitMediaOut:function(){this.context.frames.shift()}},t.exports=r},{"../contexts":10,"./import-sequencer":83,"./visitor":88}],85:[function(e,t){var n={Visitor:e("./visitor"),ImportVisitor:e("./import-visitor"),ExtendVisitor:e("./extend-visitor"),JoinSelectorVisitor:e("./join-selector-visitor"),ToCSSVisitor:e("./to-css-visitor")};t.exports=n},{"./extend-visitor":82,"./import-visitor":84,"./join-selector-visitor":86,"./to-css-visitor":87,"./visitor":88}],86:[function(e,t){var n=e("./visitor"),i=function(){this.contexts=[[]],this._visitor=new n(this)};i.prototype={run:function(e){return this._visitor.visit(e)},visitRule:function(e,t){t.visitDeeper=!1},visitMixinDefinition:function(e,t){t.visitDeeper=!1},visitRuleset:function(e){var t,n=this.contexts[this.contexts.length-1],i=[];this.contexts.push(i),e.root||(t=e.selectors,t&&(t=t.filter(function(e){return e.getIsOutput()}),e.selectors=t.length?t:t=null,t&&e.joinSelectors(i,n,t)),t||(e.rules=null),e.paths=i)},visitRulesetOut:function(){this.contexts.length=this.contexts.length-1},visitMedia:function(e){var t=this.contexts[this.contexts.length-1];e.rules[0].root=0===t.length||t[0].multiMedia},visitDirective:function(e){var t=this.contexts[this.contexts.length-1];e.rules&&e.rules.length&&(e.rules[0].root=e.isRooted||0===t.length||null)}},t.exports=i},{"./visitor":88}],87:[function(e,t){var n=e("../tree"),i=e("./visitor"),o=function(e){this._visitor=new i(this),this._context=e};o.prototype={isReplacing:!0,run:function(e){return this._visitor.visit(e)},visitRule:function(e){return e.variable?void 0:e},visitMixinDefinition:function(e){e.frames=[]},visitExtend:function(){},visitComment:function(e){return e.isSilent(this._context)?void 0:e},visitMedia:function(e,t){return e.accept(this._visitor),t.visitDeeper=!1,e.rules.length?e:void 0},visitImport:function(e){return void 0!==e.path.currentFileInfo.reference&&e.css?void 0:e},visitDirective:function(e,t){function i(e){var t,n=e.rules;1!==n.length||n[0].paths&&0!==n[0].paths.length||(n=n[0].rules);for(var i=0;n.length>i;i++)if(t=n[i],t.getIsReferenced&&t.getIsReferenced())return!0;return!1}if("@charset"===e.name){if(!e.getIsReferenced())return;if(this.charset){if(e.debugInfo){var o=new n.Comment("/* "+e.toCSS(this._context).replace(/\n/g,"")+" */\n");return o.debugInfo=e.debugInfo,this._visitor.visit(o)}return}this.charset=!0}if(e.rules&&e.rules.length){if(this._mergeRules(e.rules[0].rules),e.accept(this._visitor),t.visitDeeper=!1,e.getIsReferenced())return e;if(!e.rules||!e.rules.length)return;if(i(e))return e.markReferenced(),e}else if(e.getIsReferenced())return e},checkPropertiesInRoot:function(e){for(var t,i=0;e.length>i;i++)if(t=e[i],t instanceof n.Rule&&!t.variable)throw{message:"properties must be inside selector blocks, they cannot be in the root.",index:t.index,filename:t.currentFileInfo?t.currentFileInfo.filename:null}},visitRuleset:function(e,t){var i,o=[];if(e.firstRoot&&this.checkPropertiesInRoot(e.rules),e.root)e.accept(this._visitor),t.visitDeeper=!1,(e.firstRoot||e.rules&&e.rules.length>0)&&o.splice(0,0,e);else{e.paths&&(e.paths=e.paths.filter(function(e){var t;for(" "===e[0].elements[0].combinator.value&&(e[0].elements[0].combinator=new n.Combinator("")),t=0;e.length>t;t++)if(e[t].getIsReferenced()&&e[t].getIsOutput())return!0;return!1}));for(var r=e.rules,s=r?r.length:0,a=0;s>a;)i=r[a],i&&i.rules?(o.push(this._visitor.visit(i)),r.splice(a,1),s--):a++;s>0?e.accept(this._visitor):e.rules=null,t.visitDeeper=!1,r=e.rules,r&&(this._mergeRules(r),r=e.rules),r&&(this._removeDuplicateRules(r),r=e.rules),r&&r.length>0&&e.paths.length>0&&o.splice(0,0,e)}return 1===o.length?o[0]:o},_removeDuplicateRules:function(e){if(e){var t,i,o,r={};for(o=e.length-1;o>=0;o--)if(i=e[o],i instanceof n.Rule)if(r[i.name]){t=r[i.name],t instanceof n.Rule&&(t=r[i.name]=[r[i.name].toCSS(this._context)]);var s=i.toCSS(this._context);-1!==t.indexOf(s)?e.splice(o,1):t.push(s)}else r[i.name]=i}},_mergeRules:function(e){if(e){for(var t,i,o,r={},s=0;e.length>s;s++)i=e[s],i instanceof n.Rule&&i.merge&&(o=[i.name,i.important?"!":""].join(","),r[o]?e.splice(s--,1):r[o]=[],r[o].push(i));Object.keys(r).map(function(e){function o(e){return new n.Expression(e.map(function(e){return e.value}))}function s(e){return new n.Value(e.map(function(e){return e}))}if(t=r[e],t.length>1){i=t[0];var a=[],l=[];t.map(function(e){"+"===e.merge&&(l.length>0&&a.push(o(l)),l=[]),l.push(e)}),a.push(o(l)),i.value=s(a)}})}}},t.exports=o},{"../tree":60,"./visitor":88}],88:[function(e,t){function n(e){return e}function i(e,t){var n,o;for(n in e)if(e.hasOwnProperty(n))switch(o=e[n],typeof o){case"function":o.prototype&&o.prototype.type&&(o.prototype.typeIndex=t++);break;case"object":t=i(o,t)}return t}var o=e("../tree"),r={visitDeeper:!0},s=!1,a=function(e){this._implementation=e,this._visitFnCache=[],s||(i(o,1),s=!0)};a.prototype={visit:function(e){if(!e)return e;var t=e.typeIndex;if(!t)return e;var i,o=this._visitFnCache,s=this._implementation,a=t<<1,l=1|a,c=o[a],u=o[l],d=r;if(d.visitDeeper=!0,c||(i="visit"+e.type,c=s[i]||n,u=s[i+"Out"]||n,o[a]=c,o[l]=u),c!==n){var m=c.call(s,e,d);s.isReplacing&&(e=m)}return d.visitDeeper&&e&&e.accept&&e.accept(this),u!=n&&u.call(s,e),e},visitArray:function(e,t){if(!e)return e;var n,i=e.length;if(t||!this._implementation.isReplacing){for(n=0;i>n;n++)this.visit(e[n]);return e}var o=[];for(n=0;i>n;n++){var r=this.visit(e[n]);void 0!==r&&(r.splice?r.length&&this.flatten(r,o):o.push(r))}return o},flatten:function(e,t){t||(t=[]);var n,i,o,r,s,a;for(i=0,n=e.length;n>i;i++)if(o=e[i],void 0!==o)if(o.splice)for(s=0,r=o.length;r>s;s++)a=o[s],void 0!==a&&(a.splice?a.length&&this.flatten(a,t):t.push(a));else t.push(o);return t}},t.exports=a},{"../tree":60}],89:[function(e,t){function n(){if(!s){s=!0;for(var e,t=r.length;t;){e=r,r=[];for(var n=-1;++n<t;)e[n]();t=r.length}s=!1}}function i(){}var o=t.exports={},r=[],s=!1;o.nextTick=function(e){r.push(e),s||setTimeout(n,0)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=i,o.addListener=i,o.once=i,o.off=i,o.removeListener=i,o.removeAllListeners=i,o.emit=i,o.binding=function(){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],90:[function(e,t){"use strict";function n(e){function t(e){return null===l?void u.push(e):void r(function(){var t=l?e.onFulfilled:e.onRejected;if(null===t)return void(l?e.resolve:e.reject)(c);var n;try{n=t(c)}catch(t){return void e.reject(t)}e.resolve(n)})}function n(e){try{if(e===d)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var t=e.then;if("function"==typeof t)return void o(t.bind(e),n,s)}l=!0,c=e,a()}catch(e){s(e)}}function s(e){l=!1,c=e,a()}function a(){for(var e=0,n=u.length;n>e;e++)t(u[e]);u=null}if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");var l=null,c=null,u=[],d=this;this.then=function(e,n){return new d.constructor(function(o,r){t(new i(e,n,o,r))})},o(e,n,s)}function i(e,t,n,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=i}function o(e,t,n){var i=!1;try{e(function(e){i||(i=!0,t(e))},function(e){i||(i=!0,n(e))})}catch(e){if(i)return;i=!0,n(e)}}var r=e("asap");t.exports=n},{asap:92}],91:[function(e,t){"use strict";function n(e){this.then=function(t){return"function"!=typeof t?this:new i(function(n,i){o(function(){try{n(t(e))}catch(e){i(e)}})})}}var i=e("./core.js"),o=e("asap");t.exports=i,n.prototype=i.prototype;var r=new n(!0),s=new n(!1),a=new n(null),l=new n(void 0),c=new n(0),u=new n("");i.resolve=function(e){if(e instanceof i)return e;if(null===e)return a;if(void 0===e)return l;if(e===!0)return r;if(e===!1)return s;if(0===e)return c;if(""===e)return u;if("object"==typeof e||"function"==typeof e)try{var t=e.then;if("function"==typeof t)return new i(t.bind(e))}catch(e){return new i(function(t,n){n(e)})}return new n(e)},i.all=function(e){var t=Array.prototype.slice.call(e);return new i(function(e,n){function i(r,s){try{if(s&&("object"==typeof s||"function"==typeof s)){var a=s.then;if("function"==typeof a)return void a.call(s,function(e){i(r,e)},n)}t[r]=s,0===--o&&e(t)}catch(e){n(e)}}if(0===t.length)return e([]);for(var o=t.length,r=0;t.length>r;r++)i(r,t[r])})},i.reject=function(e){return new i(function(t,n){n(e)})},i.race=function(e){return new i(function(t,n){e.forEach(function(e){i.resolve(e).then(t,n)})})},i.prototype.catch=function(e){return this.then(null,e)}},{"./core.js":90,asap:92}],92:[function(e,t){(function(e){function n(){for(;o.next;){o=o.next;var e=o.task;o.task=void 0;var t=o.domain;t&&(o.domain=void 0,t.enter());try{e()}catch(e){if(l)throw t&&t.exit(),setTimeout(n,0),t&&t.enter(),e;setTimeout(function(){throw e},0)}t&&t.exit()}s=!1}function i(t){r=r.next={task:t,domain:l&&e.domain,next:null},s||(s=!0,a())}var o={task:void 0,next:null},r=o,s=!1,a=void 0,l=!1;if("undefined"!=typeof e&&e.nextTick)l=!0,a=function(){e.nextTick(n)};else if("function"==typeof setImmediate)a="undefined"!=typeof window?setImmediate.bind(window,n):function(){setImmediate(n)};else if("undefined"!=typeof MessageChannel){var c=new MessageChannel;c.port1.onmessage=n,a=function(){c.port2.postMessage(0)}}else a=function(){setTimeout(n,0)};t.exports=i}).call(this,e("_process"))},{_process:89}],93:[function(){"function"!=typeof Promise.prototype.done&&(Promise.prototype.done=function(){var e=arguments.length?this.then.apply(this,arguments):this;e.then(null,function(e){setTimeout(function(){throw e},0)})})},{}],94:[function(e){e("asap"),"undefined"==typeof Promise&&(Promise=e("./lib/core.js"),e("./lib/es6-extensions.js")),e("./polyfill-done.js")},{"./lib/core.js":90,"./lib/es6-extensions.js":91,"./polyfill-done.js":93,asap:92}]},{},[2])(2)}),define("modules/emailbuilder/services/dynamicStyle",["jquery","vendor/angular","modules/emailbuilder/module","ts/modules/emailbuilder/services/email","vendor/es5-shim","vendor/less-2.5.1","underscore"],function(e,t,n,i,o,r,s){function a(e){return e.toLowerCase().indexOf("color")>-1}function l(e){return"#"!==e[0]}function c(e,t){return(a(e)&&l(t)?"#":"")+t}function u(e){return 0===e.trim().toLowerCase().indexOf("'")||"none"!==e}function d(e,t){return e.toLowerCase().indexOf("href")>-1?null===t||void 0===t||"null"===t||"none"===t?f:0===t.length?f:u(t)?"'"+t+"'":t:t}function m(n,i){t.forEach(n,function(t,n){var o=(i?i+v:"")+n;e.inArray(o,h)>-1||("object"==typeof t?m(t,o):"string"==typeof t?(t="body-backgroundLayoutImage-href"===o?d(o,t):c(o,t),g["@"+o]=t):g["@"+o]=c(o,t))})}function p(e){m(e.model.styles,""),this.build()}var h=["body-backgroundLayoutImage-displayType","body-backgroundLayoutImage-fileName","body-backgroundLayoutImage-isBackground","body-backgroundLayoutImage-originalHeight","body-backgroundLayoutImage-originalWidth","body-backgroundLayoutImage-type"],f="'data:image/png;base64,'",g={},v="-";p.prototype.build=function(){s.isEmpty(g)||r.modifyVars(g)},p.prototype.update=function(e){var t=Object.keys(e)[0],n=e[t];n=c(t,n),n=d(t,n),g[t]=n,this.build()},n.service("DynamicStylesSrv",["EmailSvc",p])}),define("modules/emailbuilder/services/messages",["modules/emailbuilder/module"],function(e){e.value("Messages",{invalidType:{title:"Please upload an image",message:"Only image files can be uploaded. Please select a JPG, PNG or GIF file."},invalidSize:{title:"Image file too big",message:"That image wasn't added because it's too big to use in an email. Please keep images less than 20MB in size."},uploadError:{title:"Server Error",message:"Unable to upload file."},btnNoText:{title:"Your button is missing text",message:"Buttons need to contain text in order to display correctly in your email."},btnNoLink:{title:"Your button is missing a link",message:"Where would you like recipients to be directed when they click this button?"},btnInvalidLink:{title:"Invalid URL",message:"Your button needs to contain a valid URL."},btnNoLinkNoText:{title:"Missing content",message:"Your button needs to contain some text and a link."},surveyNoText:{title:"Your button is missing text",message:"Buttons need to contain text in order to display correctly in your email."},surveyNoLink:{title:"Your survey is missing",message:"You need to select a GetFeedback survey which this button links to."},surveyNoLinkNoText:{title:"Missing content",message:"Your button needs to contain some text and a GetFeedback survey link."},videoNoLink:{title:"Your video is missing a link",message:"Please enter a Vimeo or YouTube URL for your video"},videoInvalidLink:{title:"Invalid URL",message:"Please enter a valid Vimeo or YouTube URL, e.g. https://www.vimeo.com/0123 or https://www.youtube.com/watch?v=sWYV_qO9Uxw"},videoNotFoundLink:{title:"Video not found",message:"Please ensure the URL is typed correctly, e.g. https://www.vimeo.com/0123 or https://www.youtube.com/watch?v=sWYV_qO9Uxw"},videoNotSupportedLink:{title:"Invalid Format",message:"Please enter a valid Vimeo or YouTube URL, e.g. https://www.vimeo.com/0123 or https://www.youtube.com/watch?v=sWYV_qO9Uxw"},videoProviderDown:{title:"Vimeo not responsive",message:"Vimeo is not responding right now, so we are not able to load the thumbnail. Please try again in a minute."}})}),define("vendor/text!modules/emailbuilder/templates/validationMsg.html",[],function(){return'<div>\r\n    <div ng-show="message && !model.tempIsNew" class="emb-reset emb-js-validation-msg emb-validation-msg emb-reset">\r\n        <header ng-show="message.title">\r\n            <h2>{{message.title}}</h2>\r\n        </header>\r\n        <p>{{message.message}}</p>\r\n    </div>\r\n</div>'}),define("modules/emailbuilder/directives/validationMessages",["vendor/angular","modules/emailbuilder/module","modules/emailbuilder/services/messages","vendor/text!modules/emailbuilder/templates/validationMsg.html"],function(e,t,n,i){function o(e){return{restrict:"E",replace:!0,template:i,scope:{model:"="},link:function(t,n,i){var o=!!i.clearOnInactive;!!i.clearOnActive;t.$watch("model.tempValidation",function(n){t.message=n?e[n[0]]:null,t.model.tempIsValid=!t.message}),t.$watch("model.isActive",function(e){t.model.tempIsNew=e&&!!t.model.tempIsNew,o&&!e&&delete t.model.tempValidation})}}}t.directive("embValidationMessages",["Messages",o])}),define("modules/emailbuilder/services/textCalc",["jqueryui","vendor/angular","modules/emailbuilder/module"],function(e,t,n){function i(e){var t,n,i,o,r=e.get(0),s={};if(r.ownerDocument.defaultView.getComputedStyle){var a=function(e,t){return t.toUpperCase()};o=r.ownerDocument.defaultView.getComputedStyle(r,null);for(var l=0,c=o.length;l<c;l++)t=o[l],n=t.replace(/\-([a-z])/g,a),i=o.getPropertyValue(t),s[n]=i;return s}if(r.currentStyle){for(t in o)s[t]=o[t];return s}return e.css()}function o(t){var n,o=0,r=t.text().split(" "),s=i.call(this,e(t)),a=e("<span></span>"),l=e("<div></div>");for(s.position="absolute",s.top="-900px",s.overflow="auto",l.css(s),l.empty(),e(this.doc.body).append(l),a.addClass("js-detect-height"),o;o<r.length;o++)n=a.clone(),n.text(r[o]),l.append(n),l.append(" ");return l}function r(t){var n,i=o.call(this,t),r=null,s=i.find(".js-detect-height"),a=[],l=[],c=0,u=0,d=0;return s.each(function(t,i){r=e(i),u=r.offset().top,d=r.outerHeight(),c=u+d,void 0===n||c===n?a.push(r.text()):(l.push(a.join(" ")),a=[r.text()]),n=c,t===s.length-1&&l.push(a.join(" "))}),i.remove(),l}function s(e){this.doc=e[0]}s.prototype.getLines=r,n.service("TextCalcSvc",["$document",s])}),define("modules/emailbuilder/directives/buttonBlock",["config","vendor/angular","modules/emailbuilder/module","modules/emailbuilder/services/textCalc","modules/emailbuilder/services/nextButtonStyleSvc"],function(e,t,n){function i(t,n){var i=e.template.name.toLowerCase();if(!e.runOnceButtonColorMigrationKey&&("broadsheet"===i||"tint"===i)){var o=e.email.styles.button.backgroundColor&&e.email.styles.button.color&&e.email.styles.button.backgroundColor.toLowerCase()!==e.email.styles.button.color.toLowerCase();if(o)return void(e.runOnceButtonColorMigrationKey=!0);"broadsheet"===i&&(e.email.styles.button.color="FEFEFE"),"tint"===i&&(e.email.styles.button.color="FFFFFF"),n.update({"@button-color":e.email.styles.button.color}),e.runOnceButtonColorMigrationKey=!0}}function o(n,o,r,s,c){return{restrict:"A",replace:!1,link:function(u,d){function m(){u.block.height=Math.round(d.outerHeight()),u.block.lines=o.getLines(d),u.block.updateButtonAlignment(u.block.halign)}var p=d[0].style,h=function(){var e=u.block.tempContainer;return["emb-js-button-",e.section,"-",e.column].join("")};d.attr("id",h()),null!==u.block.halign&&""!==u.block.halign||(u.block.halign=d.parent().css("text-align")),u.$watch("block.text",m),u.block.updateButtonAlignment=function(e){if(e){var t=d.parent();"full"===e?(t.addClass("fullwidth"),d.css("display","block"),s(function(){u.block.vmlWidth=Math.round(d.innerWidth())},0)):(t.removeClass("fullwidth"),d.css("width",""),d.css("display","inline-block"),u.block.vmlWidth=Math.round(d.innerWidth()))}},e.buttonFlexibilityEnabled&&(u.block.fontFamily?p.fontFamily=l[u.block.fontFamily]:(u.block.fontFamily=e.email.styles.p.fontFamily,p.fontFamily=l[e.email.styles.p.fontFamily]),null!==u.block.borderRadius?p.borderRadius=u.block.borderRadius:(u.block.borderRadius=e.settings.borderRadiusForRoundedButtonCorners,p.borderRadius=e.settings.borderRadiusForRoundedButtonCorners),u.block.updateButtonBorderRadius=function(e){(e||0===e)&&(p.borderRadius=e,s(m,0))},u.block.updateFontFamilyInlineStyle=function(e){u.block.fontFamily!==e&&(p.fontFamily=l[e],s(m,0))},u.block.fullWidthValue&&(d.hide(),s(function(){u.block.updateButtonAlignment("full")},100)),u.block.buttonStyleAppearanceChanged=function(e,t){"ghost"===t?(p.borderColor=p.backgroundColor,p.backgroundColor=a):"ghost"===e&&(p.backgroundColor=p.borderColor,p.borderColor=a),s(m,0)},u.block.buttonSizeChanged=function(e,t){u.block.buttonSize=t,"small"===t&&(d.parent().addClass("btn--small"),d.parent().removeClass("btn--medium"),d.parent().removeClass("btn--large")),"medium"===t&&(d.parent().addClass("btn--medium"),d.parent().removeClass("btn--small"),d.parent().removeClass("btn--large")),"large"===t&&(d.parent().addClass("btn--large"),d.parent().removeClass("btn--small"),d.parent().removeClass("btn--medium")),s(m,0),u.block.vmlWidth=Math.round(d.outerWidth()),u.block.width=Math.round(d.width())},u.block.fullWidthValue&&(d.hide(),s(function(){u.block.updateButtonAlignment("full")},100)),u.block.buttonSizeChanged("",u.block.buttonSize||"large")),i(u,r),null===u.block.backgroundColor&&(u.block.backgroundColor=a),null===u.block.color&&(u.block.color=a),u.block.tempBackgroundColor=u.block.backgroundColor||e.email.styles.button.backgroundColor,u.block.tempTextColor=u.block.color||e.email.styles.button.color,u.$watch("block.tempBackgroundColor",function(){var t=d[0].style,n=e.email.styles.button.backgroundColor,i=u.block.tempBackgroundColor;i&&(i!==n?(u.block.backgroundColor=i,"ghost"===u.block.buttonStyleAppearance?t.borderColor="#"+i:t.backgroundColor="#"+i):(u.block.backgroundColor=a,t.backgroundColor=a,t.borderColor=a))}),u.$watch(function(){return e.email.styles.button.backgroundColor},function(){var t=e.email.styles.button.backgroundColor;u.block.backgroundColor||(u.block.tempBackgroundColor=t)}),u.$watch("block.tempTextColor",function(){var t=d[0].style,n=e.email.styles.button.color,i=u.block.tempTextColor;i&&(i!==n?(u.block.color=i,t.setProperty?t.setProperty("color","#"+i,"important"):t.color="#"+i):(u.block.color=a,t.color=a))}),u.$watch(function(){return e.email.styles.button.color},function(){var t=e.email.styles.button.color;u.block.color||(u.block.tempTextColor=t)}),s(function(){u.block.updateButtonAlignment(u.block.halign)},100),n.current.isIE9&&d.on("click",function(e){e.preventDefault()}),c.setNextButtonStyle(u.block,!0),u.$watch(function(){var e={text:u.block.text,href:u.block.href,backgroundColor:u.block.backgroundColor,color:u.block.color,fontFamily:u.block.fontFamily,halign:u.block.halign,borderRadius:u.block.borderRadius,buttonStyleAppearance:u.block.buttonStyleAppearance};return e},function(e,n){t.equals(e,n)||c.setNextButtonStyle(e,!1)},!0)}}}for(var r,s,a="",l={},c=0;c<e.email.config.availableFonts.length;c+=1)r=e.email.config.availableFonts[c],s=r.cssValues["font-family"],l[r.value]=s;n.directive("embButton",["BrowserSrv","TextCalcSvc","DynamicStylesSrv","$timeout","nextButtonStyleSvc",o])}),define("modules/emailbuilder/services/heightMonitor",["underscore","vendor/angular","modules/emailbuilder/module"],function(e,t,n){function i(e){var t=e.filter(function(e){var t=e.control;return t&&t.hasContent()}).map(function(e){return e.$.height()}),n=0;return t.forEach(function(e){e>n&&(n=e)}),n||Number.MAX_VALUE}function o(e,n){var i=e.find(".emb-js-height-determinator").get().map(function(e){var n=t.element(e);return{$:n,control:n.controller("embDropzone")}});this.d=i,this.s=n,this.updateMaxHeight()}function r(){var e=this._.items.filter(function(e){return e.isDirty});e.forEach(function(e){e.updateMaxHeight()})}function s(e){var t=this._.items,n=e.map(function(e){if(e)return t[e.section]});n.forEach(function(e){e&&e.markDirty()}),this._.clean()}function a(){this._.items.sort(function(e,t){return e.getIndex()-t.getIndex()})}function l(t){this._={items:[],clean:e.throttle(r.bind(this),50,{leading:!1})},t.subscribe("content.#",s).withContext(this),t.subscribe("section.#",a).withContext(this)}o.prototype={getIndex:function(){return this.s.$index},updateMaxHeight:function(){var e=this.s.maxHeight,t=i(this.d);this.isDirty=!1,e!==t&&(this.s.maxHeight=t,this.s.safeDigest())},markDirty:function(){this.isDirty=!0}},l.prototype.monitor=function(e,t){var n=new o(e,t);return this._.items.push(n),a.call(this),n},l.prototype.remove=function(e){this._.items.splice(this._.items.indexOf(e),1)},n.service("HeightMonitor",["ModelActivity",l])}),define("modules/emailbuilder/directives/monitorHeight",["modules/emailbuilder/module","modules/emailbuilder/services/heightMonitor"],function(e,t){function n(e,t){return function(n,i){var o;n.$on("$includeContentLoaded",function(r){o||(o=e.monitor(i,n),t(function(){o.updateMaxHeight()}),n.$watch("maxHeight",function(e){i.toggleClass("emb-small-content",!!e&&e<66)}))}),n.$on("$destroy",function(){o&&e.remove(o)})}}e.directive("embMonitorHeight",["HeightMonitor","$timeout",n])}),define("vendor/text!modules/emailbuilder/templates/guidance.html",[],function(){return'<div class="emb-guidance-inner" bindonce="darkBg">\r\n    <p class="emb-guidance-content" relation="#emb-js-sidebar" position="right top" offset="5 206" bo-class="{\'emb-dark-bg\': darkBg, \'emb-light-bg\': !darkBg}">Drag and Drop Content Tiles To Build Your Email</p>\r\n    <p class="emb-guidance-layout" relation="#emb-new-section-btn" position="center bottom" offset="90 25" bo-class="{\'emb-dark-bg\': darkBg, \'emb-light-bg\': !darkBg}">Layouts Are pre-designed areas where you can drag content</p>\r\n</div>\r\n'}),define("modules/emailbuilder/directives/guidance",["config","jqueryui","vendor/jquery.colorpicker","vendor/angular","modules/emailbuilder/module","vendor/text!modules/emailbuilder/templates/guidance.html"],function(e,t,n,i,o,r){function s(n,o){return{restrict:"A",replace:!0,template:r,link:function(r,s,a){function l(e){var t=e.split(" ");return{xpos:t[0],ypos:t[1]}}function c(e){var t=e.rel.offset(),n=0,i=0;switch(e.pos.xpos){case"right":n=e.rel.width()+t.left;break;case"center":n=t.left+e.rel.height()/2}switch(e.pos.ypos){case"bottom":i=t.top+e.rel.height();break;case"top":i=t.top}return{top:i+e.offset.y,left:n+e.offset.x}}function u(e){var t=c(e),n=e.elem[0];n.style.left=t.left+"px",n.style.top=t.top+"px",n.style.display=t.top>0?"block":"none"}function d(e){var t,n={x:0,y:0};return void 0!==e&&(t=e.split(" "),n.x=parseInt(t[0],10),2==t.length&&(n.y=parseInt(t[1],10))),n}function m(){y.each(function(e,t){var n=i.element(t);u({elem:n,rel:i.element(n.attr("relation")),pos:l(n.attr("position")),offset:d(n.attr("offset"))})})}function p(){y.fadeOut("slow"),h(),f(),g(),v()}var h,f,g,v,b=e.email.styles?e.email.styles.body.backgroundColor:"ffffff",y=s.find("p:visible"),w=t.fn.ColorPickerHex2HSB(b);r.darkBg=w.s>30||w.b<80,o(function(){m(),t(".emb-guidance-content").hide().css("opacity","1").delay(500).fadeIn("slow"),t(".emb-guidance-settings").hide().css("opacity","1").delay(500).fadeIn("slow"),t(".emb-guidance-layout").hide().css("opacity","1").delay(1e3).fadeIn("slow"),t(".emb-guidance-logo").hide().css("opacity","1").delay(1e3).fadeIn("slow")}),g=n.$on("content.activated",p),v=n.$on("content:deactivated",p),h=n.$on("tile.content.pushed",p),f=n.$on("currentPane.switched",p)}}}o.directive("embGuidance",["$rootScope","$timeout",s])}),define("ts/modules/emailbuilder/directives/disableDrag",["vendor/angular","modules/emailbuilder/module"],function(e,t){var n=function(){function t(){this.link=function(t,n,i){var o=!!i.embDisableDrag;n.attr({unselectable:"on",draggable:"false"}).on("dragstart",function(t){if(o){var n=e.element(t.target);return n.hasClass("ui-draggable")}return!1})}}return t.factory=function(){return new t},t}();t.directive("embDisableDrag",n.factory)}),define("modules/emailbuilder/directives/activeContentWatcher",["vendor/angular","config","modules/emailbuilder/module","modules/emailbuilder/services/activeContentManager","modules/emailbuilder/services/performanceSvc","modules/emailbuilder/services/safeDigest"],function(e,t,n,i){
function o(n,i,o,r,s,a){return{restrict:"A",link:function(l,c,u){function d(t){var n=e.element(t.target),i=n.scope()||n.isolateScope();i&&i.block?h(i.block):i&&i.section&&!i.section.readOnly?h(i.section):f(),o.safeDigest()}var m=27,p=!1,h=function(e){if(a.createMark("contentActivatedStart"),!n.isDisabled(e)){if(n.hasActiveContent()){var t=n.active.content;if(t===e)return;o.$emit("content:replaced",{block:t})}n.setActiveContent(e),o.$emit("content:activated",{block:e}),l.$$postDigest(function(){a.createMark("contentActivatedEnd"),a.createMeasure("contentActivation","contentActivatedStart","contentActivatedEnd"),a.logDuration("contentActivation")})}},f=function(e){e=e||{};var t=e.tab||void 0;if(n.hasActiveContent()){var i=n.active.content;n.clearActiveContent(),o.$emit("content:deactivated",{block:i,tab:"content-tiles"})}else o.$emit("content:deactivated",{block:void 0,tab:t})};o.$on("content:activate",function(e,t){h(t.block)}),o.$on("content:deactivate",function(e,t){f(t)}),r.on("keydown keypress",function(e){e.which===m&&(f(),o.safeDigest())}),r.on("mousedown",function(e){p=!(!e.target||!("emb-js-email-body"===e.target.id||e.target.id.indexOf("section-options-")>=0))}),r.on("click",function(e){var n=s.getSelection();n.toString()?p&&t.selectionBreakerEnabled&&(n.empty?n.empty():n.removeAllRanges&&n.removeAllRanges(),p=!1):"body"!==e.target.tagName.toLowerCase()&&d(e)}),i.subscribe("content.start",function(){o.$emit("content:deactivate")})}}}n.directive("embActiveContentWatcher",["ActiveContentManager","DraggingSvc","$rootScope","$document","$window","performanceSvc",o])}),define("modules/emailbuilder/directives/socialTag",["vendor/angular","config","modules/emailbuilder/module","ts/modules/emailbuilder/services/lockLevelSvc"],function(e,t,n,i){function o(e,n,i){return{restrict:"A",link:function(o,r,s){switch(s.cmTagType){case"webversion":if(t.canvasSectionPermissions){var a=i.getLocks(o.$parent.block.permissions);a.anyLocking||r.parent().addClass("emb-hoverable"),o.$on("permissionsChanged:header",function(e,t){var n=i.getLocks(t);n.anyLocking?r.parent().removeClass("emb-hoverable"):r.parent().addClass("emb-hoverable")})}r.parent().addClass("emb-content-inner"),r.on("click",function(t){n(function(){e.$emit("content:activate",{block:{id:(new Date).valueOf(),type:"header",subType:"logo"}})},0)});break;case"preferences":o&&o.block&&(o.block.subType="otherSettings",o.$parent.block.subType="otherSettings"),r.on("click",function(t){n(function(){e.$emit("content:activate",{block:{id:(new Date).valueOf(),type:"footer",subType:"otherSettings"}})},0)});break;case"tweet":case"fblike":case"forwardtoafriend":o&&o.block&&(o.block.subType="sharingEmail"),r.addClass("emb-content-inner"),r.on("click",function(t){n(function(){e.$emit("content:activate",{block:{id:(new Date).valueOf(),type:"footer",subType:"sharingEmail"}})},0),t.stopPropagation()})}}}}n.directive("cmTagType",["$rootScope","$timeout","LockLevelSvc",o])}),define("modules/emailbuilder/directives/warnUser",["vendor/angular","modules/emailbuilder/module"],function(e,t){function n(t,n,i){return{restrict:"A",replace:!1,link:function(o,r,s){var a=!1,l=!1;i.$on("upload:start",function(){a=!0}),i.$on("upload:end",function(){a=!1}),e.element(n).on("beforeunload",function(e){if(!l&&(t.isDirty||t.isSaving||a)){var i="We're still saving your latest changes. Please wait until these changes have been saved";return(e||n.event).returnValue=i,i}}),t.subscribe("redirect",function(){l=!0})}}}t.directive("embWarnBeforeClosing",["SaveSvc","$window","$rootScope",n])}),define("vendor/text!modules/emailbuilder/templates/switchButton.html",[],function(){return'<div>\r\n    <span class="section-switch__label section-switch__label--left" ng-class="{\'is-active\': buttonLeft}" ng-click="switchSides(true)" ng-if="leftText">{{leftText}}</span>\r\n    <span class="section-switch__inner js-switch" ng-click="switchSides(!buttonLeft)">\r\n        <span class="section-switch__handle js-switch-handle"></span>\r\n    </span>\r\n    <span class="section-switch__label section-switch__label--right" ng-class="{\'is-active\': !buttonLeft}" ng-click="switchSides(false)" ng-if="rightText">{{rightText}}</span>\r\n</div>'}),define("modules/emailbuilder/directives/switchButton",["jqueryui","modules/emailbuilder/module","vendor/text!modules/emailbuilder/templates/switchButton.html"],function(e,t,n){function i(e){var t={restrict:"A",template:n,replace:!1,require:"ngModel",link:function(t,n,i,r){o(t,n,i,r,e)}};return t}function o(e,t,n,i,o){var r=t.find(".js-switch-handle"),s=t.find(".js-switch"),a=s.width(),l=r.width(),c=0,u=Math.round(a/2)-Math.round(l/2),d=a-l;e.buttonLeft=!0,e.leftText=n.switchLeftText,e.rightText=n.switchRightText,i.$render=function(){o(function(){e.buttonLeft=i.$modelValue,r.css({left:e.buttonLeft?c:d})})},e.switchSides=function(t){o(function(){var n=t?c:d;e.buttonLeft=t,r.animate({left:n},100),i.$setViewValue(t)})},t.on({click:function(e){e.stopPropagation()}}),r.draggable({axis:"x",containment:"parent",stop:function(){var t=parseInt(r.css("left"),10),n=t<=u;e.switchSides(n)}})}t.directive("csSwitch",["$timeout",i])}),define("modules/emailbuilder/services/translation",["vendor/angular","modules/emailbuilder/module","config"],function(e,t,n){function i(){}var o="English";i.prototype.getValue=function(e,t,n){var i=this.getLanguage(e);if(void 0!==i){var r=i.resources.filter(function(e){if(e.key.toLowerCase()===t.toLowerCase())return e});return r.length>0?r[0].text:void 0!==n?this.getValue(o,t,1):"No Translation"}},i.prototype.getLanguage=function(e){if(void 0!==n.translations){var t=n.translations.filter(function(t){if(t.language.toLowerCase()===e.toLowerCase())return t});if(0!==t.length)return t[0]}},t.service("TranslationSvc",[i])}),define("modules/emailbuilder/directives/translate",["vendor/angular","modules/emailbuilder/module","ts/modules/emailbuilder/services/email","modules/emailbuilder/services/translation"],function(e,t,n,i){function o(e,t,n){return{restrict:"A",link:function(i,o,r){var s=function(){var i=e.model.language,s=t.getValue(i,r.embTranslate);o.text(s),n.$emit("checkbox:value-changed")};i.$watch(function(){return e.model.language},s),s()}}}t.directive("embTranslate",["EmailSvc","TranslationSvc","$rootScope",o])}),define("modules/emailbuilder/services/kmqWrapper",["modules/emailbuilder/module"],function(e){function t(e){return{record:function(t){""!==t&&e._kmq&&e._kmq.push(["record",t])}}}e.factory("KmqWrapperSvc",["$window",t])}),define("modules/emailbuilder/services/kmEvents",["modules/emailbuilder/module"],function(e){function t(){}var n={preview:{prev:"Continued Editing Canvas Content",next:"Finished Editing Canvas Content"},default:{prev:"Returned to Canvas Template Gallery",next:""}};t.prototype.getEvent=function(e){return n[e]||n.default},e.service("KmEventsSvc",[t])}),define("modules/emailbuilder/directives/kissMetrics",["modules/emailbuilder/module","modules/emailbuilder/services/kmqWrapper","modules/emailbuilder/services/kmEvents","config"],function(e,t,n,i){function o(e,t){return function(n,o,r){i.settings.isKissMetricsEnabled&&o.on("click",function(){var n=e.getEvent(r.kissMetric)[r.flag]||r.kissMetric;t.record(n)})}}e.directive("kissMetric",["KmEventsSvc","KmqWrapperSvc",o])}),define("modules/emailbuilder/directives/validateOnSubmit",["jquery","vendor/angular","modules/emailbuilder/module"],function(e,t,n){function i(n){return{restrict:"A",link:function(i,o,r){var s=e(o);s.attr("novalidate","novalidate"),s.bind("submit",function(o){o.preventDefault();var a=s.clone();return t.forEach(a.find("[ng-model-on-blur]"),function(t){var n=e(t);n.attr("ng-model",n.attr("ng-model-on-blur")),n.removeAttr("ng-model-on-blur")}),n(a.get(0).outerHTML)(i),t.forEach(a.find("[ng-model]"),function(t){var n,o=e(t),a=[r.name,".",o.attr("name")].join(""),l=(o.attr("ng-model"),i.$eval(a)),c=s.find("[name="+o.attr("name")+"]");switch(c.attr("type")){case"checkbox":case"radio":n=c.prop("checked");break;default:n=c.val()}l.$setViewValue(n),l.$submittedOn=(new Date).valueOf()}),i.$apply(),i[r.name].$invalid?void a.find(".ng-invalid:first").focus():(i.$eval(r.validateOnSubmit),void i.$apply())})}}}n.directive("validateOnSubmit",["$compile",i])}),define("modules/emailbuilder/directives/modelOnBlur",["jquery","vendor/angular","modules/emailbuilder/module"],function(e,t,n){function i(){return{restrict:"A",priority:1,require:"^form",link:function(e,t,n,i){function o(n){var i=e.$eval(r),o=n||!1;i&&(i.$invalid||o)&&(i.$invalid=!1,i.$dirty=!1,i.$error={},t.removeClass("ng-invalid"),e.safeDigest())}if("radio"!==n.type&&"checkbox"!==n.type){var r=[i.$name,".",t.attr("name")].join(""),s=function(){e[n.ngModelOnBlur]=t.val()};t.on("blur",s).on("keydown",function(e){13===e.keyCode&&s()}),t.on("input propertychange paste",o),e.$watch(function(){var t=e.$eval(r);return t&&t.$submittedOn},function(){var n=e.$eval(r);if(n){var i=n.$invalid?"ng-invalid":"ng-valid";t.removeClass("ng-invalid ng-valid").addClass(i)}}),e.$watch(function(){return e.$eval(n.ngModelOnBlur)},function(e){void 0!==e&&(t.val(e),o(!0))})}}}}n.directive("ngModelOnBlur",[i])}),define("vendor/text!modules/emailbuilder/templates/backgroundEmailImageUploader.html",[],function(){return'<div>\r\n    <div class="c-image-controls-container">\r\n        <figure ng-click="$event.stopPropagation()" ng-class="{ \'is-empty\' : !emailBackgroundStatus.hasSrc,  \'has-uploaded\' : emailBackgroundStatus.hasSrc, \'is-uploading\' : emailBackgroundStatus.loading }" class="c-image-controls__uploaded-image hmb-uploaded-image--background hmb-uploaded-image">\r\n            <div id="emb-js-message"></div>\r\n            <form>\r\n                <input emb-file-upload file="backgroundImage" class="emb-invisible-input" name="file" type="file" id="sidebar-image-chooser-figure" accepts="image/*">\r\n            </form>\r\n            <button class="c-button c-button--choose-file">Choose file\r\n            </button>\r\n            <div ng-show="emailBackgroundStatus.loading" aria-hidden="true" class="loading-circle">\r\n                <span class="loading-circle__spinner"></span>\r\n            </div>\r\n            <div ng-show="emailBackgroundStatus.hasSrc" class="c-image-controls__image-container emb-js-preview-holder">\r\n            </div>\r\n        </figure>\r\n        <div ng-show="emailBackgroundStatus.hasSrc" class="c-image-controls__actions">\r\n            <button class="c-image-controls__button c-image-controls__button--edit" ng-click="launchAviary()">Edit</button>\r\n            <div class="emb-replacer" ng-click="$event.stopPropagation()">\r\n                <form class="c-image-controls__upload-container">\r\n                    <input emb-file-upload file="backgroundImage" class="c-image-controls__upload-area" name="file" type="file" id="sidebar-image-chooser-replace" accepts="image/*">\r\n                    <button class="c-image-controls__button c-image-controls__button--replace">Replace</button>\r\n                </form>\r\n            </div>\r\n            <button class="c-image-controls__button c-image-controls__button--delete" ng-click="deleteBackgroundEmailImage()">Delete</button>\r\n        </div>\r\n    </div>\r\n    <p class="c-sidebar__text l-gap--top-medium">Some email clients don\'t load background images. We recommend picking a color similar to the image as a fallback.</p>\r\n    <hr ng-show="emailBackgroundStatus.hasSrc" class="c-sidebar__rule">\r\n    <div class="checkbox-options c-image-controls__checkbox-option-container" ng-show="emailBackgroundStatus.hasSrc">\r\n        <input class="checkbox-options__input emb-checkbox" id="email-background-repeat" type="checkbox"\r\n            ng-true-value="repeat" ng-false-value="no-repeat"\r\n            ng-checked="email.styles.body.backgroundLayoutImage.backgroundRepeat === \'repeat\'"\r\n            ng-model="email.styles.body.backgroundLayoutImage.backgroundRepeat"\r\n            ng-change="emailBackgroundStatus.updateRepeat(\'body-backgroundLayoutImage-backgroundRepeat\', email.styles.body.backgroundLayoutImage.backgroundRepeat)"\r\n            emb-save-on-model-change />\r\n        <label class="c-sidebar__label checkbox-options__label c-image-controls__checkbox-option" for="email-background-repeat">Repeat the background image</label>\r\n    </div>\r\n</div>\r\n'}),define("ts/modules/emailbuilder/directives/backgroundEmailImageUploader",["vendor/angular","modules/emailbuilder/module","modules/emailbuilder/services/browser","modules/emailbuilder/services/imageManager","modules/emailbuilder/services/thumbnail","modules/emailbuilder/services/imageBuilder","modules/emailbuilder/services/safeDigest","modules/emailbuilder/services/content","modules/emailbuilder/services/aviary","vendor/text!modules/emailbuilder/templates/backgroundEmailImageUploader.html","modules/emailbuilder/services/styleFactory"],function(e,t,n,i,o,r,s,a,l,c,u){function d(e,t){e.backgroundImage.href!==t.$modelValue&&t.$setViewValue(e.backgroundImage.href)}function m(e,t,n,i){void 0!==i.tempWidth&&void 0!==i.tempHeight||t.resize(i),e.create({image:i,container:n,width:134,height:85,direction:{v:"center",h:"center"}})}function p(e){e.each(function(){this.reset()})}function h(e,t,n){this.reset(),p.call(this,e),this.href=null,this.fileName=null,this.backgroundRepeat="no-repeat",d(t,n),t.emailBackgroundStatus.hasSrc=!1,t.safeDigest()}function f(t,n,i,o,r,s,a,l){var c=i.find("form");n.launchAviary=function(e){a.launchEditor(o,e,function(){n.uploadCount=0})},n.deleteBackgroundEmailImage=e.bind(o,h,c,n,l),o.hasOwnProperty("type")&&"image"===o.type&&(n.$on("upload:start",function(e,t){o===t.block&&(n.emailBackgroundStatus.loading=!0,n.safeDigest(),n.uploadCount=0)}),n.$watch("backgroundImage.getSrc()",function(){var t=i.find(".emb-js-preview-holder"),a=e.bind(n,m,r,s,t),u=o.hasSrc();if(p(c),u){n.uploadCount+=1;var h=o.getSrc();o.href=h,1===n.uploadCount&&(a(o),d(n,l))}else t.empty(),n.uploadCount=0;n.emailBackgroundStatus.loading=!1,n.emailBackgroundStatus.hasSrc=u}))}function g(e,t,n,i,o,r){return{restrict:"AE",replace:!0,require:"ngModel",template:c,scope:{backgroundImage:"=",emailBackgroundStatus:"="},link:function(s,a,l,c){s.uploadCount=0,e.$on("content:email-background-activated",function(l,u){u.email.styles.body=r.addBackgroundEmailStyle(u.email.styles.body,i);var d=u.email.styles.body.backgroundLayoutImage;f(e,s,a,d,t,n,o,c)})}}}t.directive("embBackgroundEmailImageUploader",["$rootScope","ThumbnailSrv","ImageBuilderSvc","ContentSvc","AviarySvc","StyleFactory",g])}),define("vendor/text!modules/emailbuilder/templates/backgroundLayoutImageUploader.html",[],function(){return'<div>\r\n    <div class="c-image-controls-container">\r\n        <figure ng-click="$event.stopPropagation()" ng-class="{ \'is-empty\' : !layoutBackgroundStatus.hasSrc,  \'has-uploaded\' : layoutBackgroundStatus.hasSrc, \'is-uploading\' : layoutBackgroundStatus.loading }" class="c-image-controls__uploaded-image hmb-uploaded-image--background hmb-uploaded-image">\r\n            <div id="emb-js-message">\r\n            </div>\r\n            <form>\r\n                <input emb-file-upload file="backgroundImage" class="emb-invisible-input" name="file" type="file" id="sidebar-image-chooser-figure" accepts="image/*">\r\n            </form>\r\n            <button class="c-button c-button--choose-file">Choose file</button>\r\n            <div ng-show="layoutBackgroundStatus.loading" aria-hidden="true" class="loading-circle">\r\n                <span class="loading-circle__spinner"></span>\r\n            </div>\r\n            <div ng-show="layoutBackgroundStatus.hasSrc" class="c-image-controls__image-container emb-js-preview-holder">\r\n            </div>\r\n        </figure>\r\n        <div ng-show="layoutBackgroundStatus.hasSrc && !layoutBackgroundStatus.loading " class="c-image-controls__actions">\r\n            <button class="c-image-controls__button c-image-controls__button--edit" ng-click="launchAviary(); $event.preventDefault();"\r\n            ng-hide="sectionBackgroundMissing">Edit</button>\r\n            <div class="emb-replacer" ng-click="$event.stopPropagation()">\r\n                <form class="c-image-controls__upload-container">\r\n                    <input emb-file-upload file="backgroundImage" class="c-image-controls__upload-area" name="file" type="file" id="sidebar-image-chooser-replace" accepts="image/*">\r\n                    <button class="c-image-controls__button c-image-controls__button--replace">Replace\r\n                </button>\r\n                </form>\r\n            </div>\r\n            <button class="c-image-controls__button c-image-controls__button--delete" ng-click="deleteBackgroundLayoutImage()">Delete</button>\r\n        </div>\r\n    </div>\r\n    <p class="c-sidebar__text l-gap--top-medium">Some email clients don\'t load background images. We recommend picking a color similar to the image as a fallback.</p>\r\n    <hr ng-show="sectionBorderEnabled || layoutBackgroundStatus.hasSrc" class="c-sidebar__rule">\r\n    <div class="checkbox-options c-image-controls__checkbox-option-container" ng-show="layoutBackgroundStatus.hasSrc">\r\n        <input id="section-background-repeat" class="checkbox-options__input" type="checkbox"\r\n            ng-true-value="repeat" ng-false-value="no-repeat"\r\n            ng-checked="backgroundImage.backgroundRepeat === \'repeat\'"\r\n            ng-model="backgroundImage.backgroundRepeat"\r\n            ng-change="updateSectionBackground()"\r\n            emb-save-on-model-change />\r\n        <label class="c-sidebar__label checkbox-options__label c-image-controls__checkbox-option" for="section-background-repeat">Repeat the background image</label>\r\n    </div>\r\n</div>\r\n'}),define("ts/modules/emailbuilder/directives/backgroundLayoutImageUploader",["vendor/angular","modules/emailbuilder/module","modules/emailbuilder/services/browser","modules/emailbuilder/services/imageManager","modules/emailbuilder/services/thumbnail","modules/emailbuilder/services/imageBuilder","modules/emailbuilder/services/safeDigest","modules/emailbuilder/services/content","modules/emailbuilder/services/aviary","vendor/text!modules/emailbuilder/templates/backgroundLayoutImageUploader.html","modules/emailbuilder/services/styleFactory"],function(e,t,n,i,o,r,s,a,l,c,u){function d(e,t,n,i){void 0!==i.tempWidth&&void 0!==i.tempHeight||t.resize(i),e.create({image:i,container:n,width:134,height:85,direction:{v:"center",h:"center"}})}function m(e){e.each(function(){this.reset()})}function p(e,t){this.reset(),m.call(this,e),this.href=null,this.fileName=null,this.backgroundRepeat="repeat",t.layoutBackgroundStatus.hasSrc=!1,t.safeDigest(),t.updateSectionBackground()}function h(t,n,i,o,r,s,a){var l,c,u=i.find("form");if(n.launchAviary=function(e){a.launchEditor(o,e)},n.updateSectionBackground=function(){var e=n.placeholder.scope().section;t.$emit("section.updateBackground"+e.uiId,e),n.sectionBackgroundMissing=e.hasMissingBackground},n.deleteBackgroundLayoutImage=e.bind(o,p,u,n),o.hasOwnProperty("type")&&"image"===o.type){c=n.$on("upload:start",function(e,t){o===t.block&&(n.layoutBackgroundStatus.loading=!0,n.safeDigest())}),l=n.$watch("backgroundImage.getSrc()",function(){var t=e.bind(n,d,r,s,n.placeholder),i=o.hasSrc();if(m(u),i){t(o);var a=o.getSrc();o.href=a,n.backgroundImage&&n.backgroundImage.tempSrc&&(n.backgroundImage.backgroundRepeat="repeat")}else n.placeholder.empty();n.layoutBackgroundStatus.loading=!1,n.layoutBackgroundStatus.hasSrc=i,n.updateSectionBackground()});var h=function(){c&&(c(),c=void 0),l&&(l(),l=void 0)};t.$on("content:deactivated",h),t.$on("content:replaced",h)}}function f(e,t,n,i,o,r,s){return{restrict:"AE",replace:!0,template:c,scope:{backgroundImage:"=",layoutBackgroundStatus:"="},link:function(a,l,c){a.sectionBorderEnabled=s.model.isBlueprint,a.placeholder=l.find(".emb-js-preview-holder"),e.$on("content:set-layout-background",function(s,c){c.style=o.addBackgroundLayoutStyle(c.style,i);var u=c.style.backgroundLayoutImage;h(e,a,l,u,t,n,r)})}}}t.directive("embBackgroundLayoutImageUploader",["$rootScope","ThumbnailSrv","ImageBuilderSvc","ContentSvc","StyleFactory","AviarySvc","EmailSvc",f])}),define("modules/emailbuilder/directives/webLinks",["vendor/angular","modules/emailbuilder/module"],function(e,t){function n(t){return{restrict:"C",replace:!1,scope:!0,link:function(n,i,o){n.block=e.copy(t.model.webLinks),n.block.type="footer",n.block.subType="companyDetails"}}}t.directive("embWebLinks",["EmailSvc",n])}),define("vendor/text!modules/emailbuilder/templates/trashcan.html",[],function(){return'<div class="js-delete-controls emb-content-controls emb-reset" ng-show="hovered && canDelete">\r\n    <span id="content-confirm-optional-text"\r\n          class="c-button-delete"\r\n          ng-click="showConfirmation(); $event.stopPropagation();"\r\n          ng-class="{ \'is-selected\' : confirmation,  \'is-active\' : activeNotDragged(), \'is-inactive\' : !(activeNotDragged()) }">\r\n        <a class="c-button-delete__confirm" ng-click="remove(); $event.stopPropagation();">Delete</a>\r\n        <a class="c-button-delete__cancel" ng-click="hideConfirmation(); $event.stopPropagation()">Cancel</a>\r\n    </span>\r\n</div>\r\n'}),define("modules/emailbuilder/directives/trashcan",["vendor/angular","modules/emailbuilder/module","vendor/text!modules/emailbuilder/templates/trashcan.html","ts/modules/emailbuilder/services/email","ts/modules/emailbuilder/services/lockLevelSvc"],function(e,t,n,i,o){function r(e,t,i,o,r){return{restrict:"A",scope:{trashcanKey:"@",tagType:"@"},template:n,replace:!0,link:function(n,s,a){function l(e){var t=r.getLocks(e);n.canDelete=t.canDeleteContentItems}var c=s.parent();n.canDelete=!0,o.model.footer.permissions&&("webversion"===n.trashcanKey?(l(o.model.header.permissions),n.$on("permissionsChanged:header",function(e,t){l(t)})):(l(o.model.footer.permissions),n.$on("permissionsChanged:footer",function(e,t){l(t)}))),"inline"===c.css("display")&&c.css("display","inline-block"),c.on("mouseenter",function(){n.setTrashcanPlace(s),n.hovered=!0,n.$apply()}),c.on("mouseleave",function(){n.hovered=!1,n.$apply()}),n.showReleativeSidebar=function(n){t(function(){e.$emit("content:activate",{block:{id:(new Date).valueOf(),type:n.type,subType:n.subType}})},0)},n.showConfirmation=function(){n.confirmation=!0,n.$parent.block&&n.showReleativeSidebar(n.$parent.block)},n.hideConfirmation=function(){n.confirmation=!1,n.$parent.block&&n.showReleativeSidebar(n.$parent.block)},n.setTrashcanPlace=function(e){e.parent().offset().top<65&&e.css("top","-10px")},n.remove=function(){n.$parent.block&&n.showReleativeSidebar(n.$parent.block),e.$emit(n.tagType+":removed",n.trashcanKey),e.$emit("checkbox:value-changed"),i.contentUpdated()}}}}t.directive("embTrashcan",["$rootScope","$timeout","ModelActivity","EmailSvc","LockLevelSvc",r])}),define("vendor/text!modules/emailbuilder/templates/reverseCheckbox.html",[],function(){return'<input class="checkbox-options__input" ng-change="checkboxChanged(originalValue)"\r\n       type="checkbox" id="emb-form-{{id}}" ng-model="originalValue"\r\n       ng-true-value="false" ng-false-value="true" />\r\n<label class="c-sidebar__label checkbox-options__label" for="emb-form-{{id}}">{{label}}</label>'}),define("modules/emailbuilder/directives/reversecheckbox",["modules/emailbuilder/module","vendor/text!modules/emailbuilder/templates/reverseCheckbox.html"],function(e,t){function n(e,t){var n=/\s+/;return n.test(e)&&t>0?"-":""}function i(e,i){return{restrict:"A",replace:!1,template:t,require:"ngModel",scope:{mainModel:"=ngModel"},link:function(t,o,r,s){t.label=r.label,t.originalValue=s.$viewValue&&!0,r.checkboxId&&""!==r.checkboxId?t.id=r.checkboxId:t.id=r.label.toLowerCase().replace(/[^a-z]+/g,n),t.checkboxChanged=function(n){s.$setViewValue("true"===n),i(function(){e.$emit("checkbox:value-changed",t.activeSection,t.id)},0)},s.$render=function(){t.originalValue=s.$viewValue+""}}}}e.directive("csReverseCheckbox",["$rootScope","$timeout",i])}),define("modules/emailbuilder/directives/scrollContainerIf",["vendor/angular","modules/emailbuilder/module"],function(e,t){function n(){return{restrict:"A",scope:{embScrollContainerIf:"=",embScrollContainerOffset:"="},link:function(e,t,n){for(var i=t.parent(),o=0;o<n.embScrollContainerParent;o++)i=i.parent();e.$watch("embScrollContainerIf",function(n,o){if(n){var r=t.position().top,s=i.scrollTop();if(r>0&&r<2*t.height())return;i.scrollTop(s+r-e.embScrollContainerOffset)}})}}}t.directive("embScrollContainerIf",[n])}),define("modules/emailbuilder/components/promo/promo.controller",["modules/emailbuilder/module"],function(e){function t(){var e=this;e.item={classModifier:"getfeedback",heading:"Introducing GetFeedback, our new survey builder.",description:"<p>Easily create engaging, mobile-ready online surveys in minutes.</p>",imageSrc:"/img/emailbuilder/promo/promo-image.png",imageSrc2x:"/img/emailbuilder/promo/promo-image@2x.png",imageAlt:"Get Feedback",buttonText:"Get started now",linkURL:"http://www.google.com"}}e.controller("promoController",t)}),define("vendor/text!modules/emailbuilder/components/promo/promo.html",[],function(){return'<div class="integration-promo" ng-cloak ng-class="\'integration-promo--\' + promoCtrl.item.classModifier">\r\n    <div class="integration-promo__inner" emb-connect-get-feedback-popup emb-connection-started="onStartConnecting()" emb-connection-completed="onCompleteConnecting(cancelled, succeeded, errors, completedCallback)">\r\n        <div class="integration-promo__image-container u-image-shadow">\r\n            <a href="#">\r\n                <img class="integration-promo__image" ng-src="{{ imageDomain }}{{ promoCtrl.item.imageSrc }}" alt="{{ promoCtrl.item.imageAlt }}" ng-srcset="{{ imageDomain }}{{ promoCtrl.item.imageSrc }}, {{ imageDomain }}{{ promoCtrl.item.imageSrc2x }} 2x" />\r\n            </a>\r\n        </div>\r\n        <div class="integration-promo__content">\r\n            <h2 class="integration-promo__heading">{{ promoCtrl.item.heading }}</h2>\r\n            <div class="integration-promo__description" ng-bind-html="promoCtrl.item.description">\r\n            </div>\r\n            <button ng-disabled="connectionInProgress" class="integration-promo__button">{{ connectionInProgress ? \'Connecting...\' : promoCtrl.item.buttonText }}</button>\r\n            <div ng-show="showConnectionErrorMessage" class="c-error c-error--from-top c-error--connection">\r\n                <h2 class="c-error__heading">There was an error</h2>\r\n                <p class="c-error__message">{{connectionErrorMessage}}</p>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("modules/emailbuilder/components/promo/promo.directive",["vendor/angular","config","modules/emailbuilder/module","vendor/text!modules/emailbuilder/components/promo/promo.html"],function(e,t,n,i){function o(){function e(e,n,i){e.imageDomain=t.urls.staticResourceBase}var n={restrict:"EA",link:e,replace:!0,template:i,controller:"promoController",controllerAs:"promoCtrl"};return n}n.directive("cmPromo",o)}),define("modules/emailbuilder/components/modals/modals.controller",["modules/emailbuilder/module"],function(e){function t(e){function t(){i.isActive=!0}function n(){i.isActive=!i.isActive}var i=this;i.isActive=!1,i.url=e.trustAsResourceUrl(""),i.open=t,i.toggle=n}e.controller("modalController",t),t.$inject=["$sce"]}),define("vendor/text!modules/emailbuilder/components/modals/modals.html",[],function(){return'\r\n<div class="modal" ng-class="{ \'is-visible\' : modalCtrl.isActive, \'is-hidden\' : !modalCtrl.isActive }">\r\n\r\n    <div class="modal__box">\r\n\r\n        <div class="modal__inner">\r\n            <button class="modal__button" ng-click="modalCtrl.toggle()">\r\n                <svg class="c-icon c-icon--close-btn" width="11px" height="11px" version="1.1" viewBox="0 0 21.9 21.7">\r\n                    <g>\r\n                        <title>Close Button</title>\r\n                        <rect fill="currentColor" x="-2.6" y="9.2" transform="matrix(0.6986 -0.7156 0.7156 0.6986 -4.5423 11.1551)" width="27.2" height="3.6"/>\r\n                        <rect fill="currentColor" x="-2.6" y="9.2" transform="matrix(0.7156 0.6986 -0.6986 0.7156 10.7824 -4.5423)" width="27.2" height="3.6"/>\r\n                    </g>\r\n                </svg>\r\n            </button>\r\n            <div class="modal__iframe-container intrinsic-container intrinsic-container--16x9">\r\n                <iframe frameborder="0" class="modal__iframe" scrolling="no" ng-src="{{ modalCtrl.url }}"></iframe>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="modal__overlay"></div>\r\n</div>\r\n'}),define("modules/emailbuilder/components/modals/modals.directive",["vendor/angular","modules/emailbuilder/module","vendor/text!modules/emailbuilder/components/modals/modals.html"],function(e,t,n){function i(){function e(e,t,n,i){}var t={restrict:"EA",link:e,replace:!0,template:n,controller:"modalController",controllerAs:"modalCtrl"};return t}t.directive("cmModal",i)}),define("modules/emailbuilder/services/errorLoggingSvc",["config","vendor/angular","modules/emailbuilder/module"],function(e,t,n){function i(t){function n(n,i){return t.post(e.urls.logErrorsUrl,{moduleName:n,errorDetails:i})}this.logUiErrors=n}n.service("errorLoggingSvc",i),i.$inject=["$http"]}),define("modules/emailbuilder/components/notification/notification-item.controller",["modules/emailbuilder/module"],function(e){function t(){}e.controller("notificationItemController",t)}),define("vendor/text!modules/emailbuilder/components/notification/notification-item.html",[],function(){return'<div class="notification__item l-contained-notification">\r\n  <div class="notification__image-container">\r\n    <img class="notification__image" ng-src="{{ item.image }}" alt="{{ item.heading }}" />\r\n  </div>\r\n  <div class="notification__content">\r\n    <h2 class="notification__heading">{{ item.heading }}</h2>\r\n    <div class="notification__description" ng-bind-html="item.description"></div>\r\n  </div>\r\n</div>'}),define("modules/emailbuilder/components/notification/notification-item.directive",["modules/emailbuilder/module","vendor/text!modules/emailbuilder/components/notification/notification-item.html"],function(e,t){function n(){function e(e,t,n,i){}var n={restrict:"EA",link:e,replace:!0,template:t,controller:"notificationItemController",controllerAs:"notifyItemCtrl",scope:{item:"="}};return n}e.directive("cmNotifyItem",n)}),define("ts/modules/emailbuilder/components/notification/notification.service",["config","vendor/angular","modules/emailbuilder/module","modules/emailbuilder/services/errorLoggingSvc","ts/modules/emailbuilder/services/lockLevelSvc"],function(e,t,n,i,o){var r=function(){function n(n,i,o){var r=this;this.getNotifications=function(){var n={params:{hasLocking:r.lockingLevelSvc.anyLocking()}},i=function(e){var n=[];return e&&e.data&&Array.isArray(e.data)&&e.data.length>0&&t.forEach(e.data,function(e){n.push({id:e.NotificationId,heading:e.Heading,image:e.Image,description:e.Description,openByDefault:e.OpenByDefault,read:!1})}),n},o=function(e){r.errorLoggingSvc.logUiErrors("notification.service.js",e.statusText?e.statusText:e.status)};return r.$http.get(e.urls.notifications.getLatestUrl,n).then(i).catch(o)},this.markNotificationAsRead=function(t){return r.$http.post(e.urls.notifications.markAsReadUrl,{notificationId:t})},this.markNotificationAsOpened=function(t){return r.$http.post(e.urls.notifications.markAsOpenedUrl,{notificationId:t})},this.$http=n,this.errorLoggingSvc=i,this.lockingLevelSvc=o}return n}();n.service("notificationSrv",["$http","errorLoggingSvc","LockLevelSvc",r])}),define("modules/emailbuilder/components/notification/notification.controller",["config","modules/emailbuilder/module","ts/modules/emailbuilder/components/notification/notification.service","modules/emailbuilder/services/trackingSvc","vendor/angular"],function(e,t,n,i,o){function r(t,n,i,r,s){
function a(e){var t=o.element(e.target).inheritedData("notifier");t||(m(),o.element("body").off("click",a))}function l(e){var t=100*(e-1);t*=-1,y.position=t,y.transform="translateX("+t+"%)"}function c(e){y.currentItem=e,l(y.currentItem)}function u(e){return y.currentItem===e}function d(){y.isActive=!y.isActive,o.element("body").on("click",a),y.setFocus(),r.logAction(e.userActions.notificationClicked),c(y.currentItem?y.currentItem:1)}function m(){y.isActive=!1,t(function(){s.$digest()})}function p(){y.items[y.currentItem-1].read===!1&&(i.markNotificationAsRead(y.items[y.currentItem-1].id),y.numberOfNewNotifications--,y.items[y.currentItem-1].read=!0),y.currentItem=y.currentItem===y.items.length?1:y.currentItem+1,l(y.currentItem),0===y.numberOfNewNotifications&&m()}function h(){y.currentItem=1===y.currentItem?y.items.length:y.currentItem-1,l(y.currentItem)}function f(e){var t={37:function(){h()},39:function(){p()},27:function(){m()}};return"function"==typeof t[e]&&t[e]()}function g(e){f(e.keyCode.toString())}function v(){var e,n;n=y.isActive?".js-notification":".js-notify",e=document.querySelector(n),t(function(){e.focus()})}function b(){t(function(){return i.getNotifications().then(function(e){if(e&&e.length>0)return y.items=e,y.numberOfNewNotifications=y.items.length,l(1),y.items[0].openByDefault&&(y.isActive=!0,t(function(){i.markNotificationAsOpened(y.items[0].id)},5e3)),y.items})},5e3)}var y=this;y.isActive=!1,y.currentItem=1,y.items=[],y.position=0,y.transform="translateX(0%)",y.setPositionX=l,y.isSelected=u,y.selectItem=c,y.toggleActive=d,y.next=p,y.back=h,y.closeNotifications=m,y.navigateKeys=g,y.keyControl=f,y.setFocus=v,y.getItems=b,y.numberOfNewNotifications=0,y.getItems(),n(function(){y.getItems()},18e5)}t.controller("notificationController",r),r.$inject=["$timeout","$interval","notificationSrv","trackingSvc","$scope"]}),define("vendor/text!modules/emailbuilder/components/notification/notification.html",[],function(){return'<div class="notification-wrapper" ng-hide="notifyCtrl.numberOfNewNotifications === 0" ng-class="{ \'a-reveal-scale\' : notifyCtrl.numberOfNewNotifications >= 1 }">\r\n\r\n    <button class="c-button-pill js-notify" ng-class="{ \'is-active\' : notifyCtrl.isActive }" ng-click="notifyCtrl.toggleActive()">\r\n        <span>{{ notifyCtrl.numberOfNewNotifications }}</span> New Update{{notifyCtrl.numberOfNewNotifications === 1 ? \'\':\'s\'}}\r\n    </button>\r\n    <div aria-hidden="{{ !notifyCtrl.isActive }}" tabindex="{{ notifyCtrl.isActive ? 0 : -1 }}" class="notification-position sibling-toggle js-notification" ng-keyup="notifyCtrl.navigateKeys($event)">\r\n      <div class="notification">\r\n        <div class="arrow-top" aria-hidden="true"></div>\r\n          <div class="notification__inner">\r\n            <ul class="notification__list flex-column-wrap">\r\n                <li ng-repeat="item in notifyCtrl.items | limitTo: 9" class="notification__list-item" ng-style="{ transform : notifyCtrl.transform }" id="{{ \'notification_\' + $index }}">\r\n                  <cm-notify-item item="item"></cm-notify-item>\r\n                </li>\r\n            </ul>\r\n              <div class="notification__navigation-wrapper">\r\n\r\n                    <div class="notification__navigation-inner l-flex l-flex-align-items-center l-flex-justify-space-between">\r\n                        <nav class="notification__navigation l-flex-justify-start l-percentage-100">\r\n\r\n                            <button ng-disabled="notifyCtrl.currentItem === 1" aria-controls="{ \'notification_\' + (notifyCtrl.currentItem - 1) }" class="c-button c-button--grey" ng-click="notifyCtrl.back()">Previous</button>\r\n\r\n\r\n                            <button aria-controls="{ \'notification_\' + (notifyCtrl.currentItem + 1) }"\r\n                                    ng-show="notifyCtrl.currentItem !== notifyCtrl.items.length"\r\n                                    class="c-button c-button--primary" ng-click="notifyCtrl.next()">\r\n                                Next\r\n                            </button>\r\n\r\n                            <button ng-show="notifyCtrl.currentItem === notifyCtrl.items.length"\r\n                                    class="c-button c-button--primary" ng-click="notifyCtrl.next()">\r\n                                Close\r\n                            </button>\r\n\r\n                            <span class="text-alternative">or</span>\r\n                            <button class="c-button c-button--link-grey" ng-click="notifyCtrl.closeNotifications()">Read later</button>\r\n                        </nav>\r\n\r\n\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("modules/emailbuilder/components/notification/notification.directive",["config","vendor/angular","modules/emailbuilder/module","vendor/text!modules/emailbuilder/components/notification/notification.html"],function(e,t,n,i){function o(){function e(e,t,n,i){t.data("notifier",!0)}var t={restrict:"EA",link:e,replace:!0,template:i,controller:"notificationController",controllerAs:"notifyCtrl"};return t}n.directive("cmNotify",o)}),define("modules/emailbuilder/components/popover/popover-item.controller",["modules/emailbuilder/module"],function(e){function t(){}e.controller("popoverItemController",t)}),define("vendor/text!modules/emailbuilder/components/popover/popover-item.html",[],function(){return'<div class="c-popover__content">\r\n    <h2 class="c-popover__title">{{ item.heading }}</h2>\r\n    <div class="c-popover__text" ng-bind-html="item.description"></div>\r\n</div>\r\n'}),define("modules/emailbuilder/components/popover/popover-item.directive",["modules/emailbuilder/module","vendor/text!modules/emailbuilder/components/popover/popover-item.html"],function(e,t){function n(){function e(e,t,n,i){}var n={restrict:"EA",link:e,replace:!0,template:t,controller:"popoverItemController",controllerAs:"popoverItemCtrl",scope:{item:"="}};return n}e.directive("cmPopoverItem",n)}),define("modules/emailbuilder/components/popover/popover.controller",["vendor/angular","modules/emailbuilder/module"],function(e,t){function n(t,n,i){function o(e){var t=100*(e-1);t*=-1,d.position=t,d.transform="translateX("+t+"%)"}function r(t){var n=e.element(t.target).inheritedData("popoverTarget");n||(c(),e.element("body").off("click",r))}function s(e){return d.currentItem===e}function a(){d.isActive=!d.isActive,e.element("body").on("click",r)}function l(e){d.currentItem=e,o(d.currentItem)}function c(){d.isActive=!1,l(1),i(function(){n.$digest()})}function u(){d.currentItem=d.currentItem===d.items.length?1:d.currentItem+1,o(d.currentItem)}var d=this;d.isActive=!1,d.currentItem=1,d.items=[],d.position=0,d.transform="translateX(0%)",d.setPositionX=o,d.toggleActive=a,d.isSelected=s,d.selectItem=l,d.next=u,d.closePopover=c,t.$on("displayPopover",function(){d.isActive=!0,e.element("body").on("click",r)}),d.items=[{from_direction:"left",position_top:"160px",position_left:"305px",heading:"Select or create a new survey",description:"<p>Your Campaign Monitor and GetFeedback accounts are connected. Select a survey or create a new survey from here.</p>"}]}t.controller("popoverController",n),n.$inject=["$rootScope","$scope","$timeout"]}),define("vendor/text!modules/emailbuilder/components/popover/popover.html",[],function(){return'<div class="c-popover" ng-show="popoverCtrl.isActive" tabindex="{{ popoverCtrl.isActive ? 0 : -1 }}" ng-style="{ top: popoverCtrl.items[(popoverCtrl.currentItem - 1)].position_top, left: popoverCtrl.items[(popoverCtrl.currentItem - 1)].position_left }">\r\n    <div class="u-arrow" ng-class="{{ \'u-arrow--\' + popoverCtrl.items[(popoverCtrl.currentItem - 1)].from_direction }}"></div>\r\n    <div class="c-popover__inner">\r\n        <ul class="flex-column-wrap">\r\n            <li ng-repeat="item in popoverCtrl.items" class="c-popover__item" ng-style="{ transform : popoverCtrl.transform }" id="{{ \'popover_\' + $index }}">\r\n                <cm-popover-item item="item"></cm-popover-item>\r\n            </li>\r\n        </ul>\r\n        <nav class="c-popover__navigation">\r\n\r\n            <button ng-show="popoverCtrl.currentItem !== popoverCtrl.items.length" aria-controls="{ \'popover_\' + (popoverCtrl.currentItem + 1) }" class="c-button c-button--grey" ng-click="popoverCtrl.next();$event.preventDefault();">Next</button>\r\n\r\n            <button ng-show="popoverCtrl.currentItem === popoverCtrl.items.length" aria-controls="{ \'popover_\' + (popoverCtrl.currentItem + 1) }" class="c-button c-button--grey" ng-click="popoverCtrl.closePopover();$event.preventDefault();">OK, Got it</button>\r\n        </nav>\r\n    </div>\r\n</div>\r\n'});define("modules/emailbuilder/components/popover/popover.directive",["config","vendor/angular","modules/emailbuilder/module","vendor/text!modules/emailbuilder/components/popover/popover.html"],function(e,t,n,i){function o(){function e(e,t,n,i){t.data("popoverTarget",!0)}var t={restrict:"EA",link:e,replace:!0,template:i,controller:"popoverController",controllerAs:"popoverCtrl"};return t}n.directive("cmPopover",o)});define("modules/emailbuilder/components/segmented-control/segmented-control-item.controller",["vendor/angular","modules/emailbuilder/module"],function(e,t){function n(){var e=this;e.init=function(t,n,i,o){e.groupName=function(){return t.groupName},e.itemValue=n,e.segmentId=i,e.classNames=o}}t.controller("segmentedControlItemController",n)}),define("vendor/text!modules/emailbuilder/components/segmented-control/segmented-control-item.html",[],function(){return'<li role="presentation" class="c-segmented-control__list-item {{segmentedControlItemCtrl.classNames}}">\r\n    <input class="c-segmented-control__radio" id="{{segmentedControlItemCtrl.segmentId}}" type="radio" name="{{segmentedControlItemCtrl.groupName()}}" value="{{segmentedControlItemCtrl.itemValue}}" />\r\n    <label class="c-segmented-control__label" for="{{segmentedControlItemCtrl.segmentId}}">\r\n        <span class="c-segmented-control__icon" ng-transclude></span>\r\n    </label>\r\n</li>'}),define("modules/emailbuilder/components/segmented-control/segmented-control-item.directive",["config","vendor/angular","modules/emailbuilder/module","vendor/text!modules/emailbuilder/components/segmented-control/segmented-control-item.html"],function(e,t,n,i){function o(){function e(e,t,n,i){var o=i[0],r=i[1],s=t.find("input");s.on("change",function(){e.$apply(function(){o.valueSelected(e.itemValue)})}),r.init(o,e.itemValue,e.segmentId,e.classNames),o.addItem(e.itemValue,s,n.hasOwnProperty("isDefault"))}var t={restrict:"EA",link:e,require:["^cmSegmentedControl","cmSegmentedControlItem"],transclude:!0,replace:!0,template:i,controller:"segmentedControlItemController",controllerAs:"segmentedControlItemCtrl",scope:{itemValue:"@",segmentId:"@",classNames:"@"}};return t}n.directive("cmSegmentedControlItem",o)}),define("modules/emailbuilder/components/segmented-control/segmented-control.controller",["vendor/angular","modules/emailbuilder/module"],function(e,t){function n(){var e,t=this,n={},i=null;t.init=function(o,r,s,a,l){t.modelCtrl=o,t.modelCtrl.$render=function(){if(void 0===t.modelCtrl.$modelValue&&i)i.prop("checked",!0);else{var e=!1;Object.keys(n).forEach(function(i){var o=n[i];o&&(o.prop("checked",i===t.modelCtrl.$modelValue),e=!0)}),!e&&i&&i.prop("checked",!0)}},t.groupClassName=r,t.groupLegend=s,t.groupName=a,e=l},t.addItem=function(e,t,o){n[e]=t,o&&(i=t)},t.valueSelected=function(n){var i=t.modelCtrl.$viewValue;t.modelCtrl.$setViewValue(n),e({prevValue:i,newValue:n})}}t.controller("segmentedControlController",n)}),define("vendor/text!modules/emailbuilder/components/segmented-control/segmented-control.html",[],function(){return'<div class="c-segmented-control__container">\r\n    <fieldset class="c-segmented-control__fieldset">\r\n        <legend id="{{segmentedControlCtrl.groupClassName}}" class="c-sidebar__label">{{segmentedControlCtrl.groupLegend}}</legend>\r\n        <ul role="tablist" aria-labelledby="{{segmentedControlCtrl.groupClassName}}" class="c-segmented-control {{segmentedControlCtrl.groupClassName}}" ng-transclude></ul>\r\n    </fieldset>\r\n</div>'}),define("modules/emailbuilder/components/segmented-control/segmented-control.directive",["config","vendor/angular","modules/emailbuilder/module","vendor/text!modules/emailbuilder/components/segmented-control/segmented-control.html"],function(e,t,n,i){function o(){function e(e,t,n,i){var o=i[0],r=i[1];r.init(o,e.groupClassName,e.groupLegend,e.groupName,e.onSelect)}var t={restrict:"EA",link:e,require:["ngModel","cmSegmentedControl"],replace:!0,template:i,controller:"segmentedControlController",controllerAs:"segmentedControlCtrl",transclude:!0,scope:{groupClassName:"@",groupLegend:"@",groupName:"@",onSelect:"&"}};return t}n.directive("cmSegmentedControl",o)}),define("modules/emailbuilder/components/section-controls/section-controls.controller",["vendor/angular","modules/emailbuilder/module"],function(e,t){function n(e){function t(){r.isActive=!r.isActive}function n(){}function i(){}function o(){}var r=this;r.isActive=!1,r.toggleActive=t,r.removeSection=i,r.duplicateSection=n,r.moveSection=o}t.controller("sectionControlsController",n),n.$inject=["$rootScope"]}),define("vendor/text!modules/emailbuilder/components/section-controls/section-controls.html",[],function(){return'<div class="c-section-controls" ng-class="{ \'is-active\' : sectionControlsCtrl.isActive, \'\' : !sectionControlsCtrl.isActive }">\r\n    <div class="c-section-controls__button-container">\r\n        <a role="button" class="c-section-controls__button c-section-controls__button--move emb-js-section-reorder emb-section-reorder"></a>\r\n        <button class="c-section-controls__button c-section-controls__button--duplicate" ng-click="sectionControlsCtrl.duplicateSection()"></button>\r\n\r\n        <button class="c-section-controls__button c-section-controls__button--delete" ng-click="sectionControlsCtrl.toggleActive()"></button>\r\n    </div>\r\n    <div class="c-section-controls__confirm-button-panel" ng-show="sectionControlsCtrl.isActive">\r\n        <div class="c-section-controls__confirm-button-panel-inner">\r\n            <button class="c-section-controls__confirm-button c-section-controls__confirm-button--cancel" ng-click="sectionControlsCtrl.toggleActive()">\r\n                <span class="c-section-controls__confirm-button-text">Cancel</span>\r\n            </button>\r\n            <button class="c-section-controls__confirm-button c-section-controls__confirm-button--delete" ng-click="sectionControlsCtrl.removeSection()" id="section-delete-{{$parent.$index}}">\r\n                <span class="c-section-controls__confirm-button-text">Delete</span>\r\n            </button>\r\n        </div>\r\n    </div>\r\n</div>'}),define("modules/emailbuilder/components/section-controls/section-controls.directive",["config","vendor/angular","modules/emailbuilder/module","vendor/text!modules/emailbuilder/components/section-controls/section-controls.html"],function(e,t,n,i){function o(){function e(e,t,n,i){}var t={restrict:"EA",link:e,replace:!0,template:i,transclude:!0,controller:"sectionControlsController",controllerAs:"sectionControlsCtrl"};return t}n.directive("cmSectionControls",o)}),define("modules/emailbuilder/services/recentColorSvc",["vendor/angular","modules/emailbuilder/module","config","modules/emailbuilder/services/errorLoggingSvc"],function(e,t,n){function i(e,t,i){function o(){var e=[];return e.unshift(n.email.styles.h3.color),e.unshift(n.email.styles.h2.color),e.unshift(n.email.styles.button.backgroundColor),e.unshift(n.email.styles.headerAndFooter.color),e.unshift(n.email.styles.link.color),e.unshift(n.email.styles.button.color),e.unshift(n.email.styles.p.color),e.unshift(n.email.styles.h1.color),e.unshift(n.email.styles.body.backgroundColor),"text"===n.email.header.displayType&&e.unshift(n.email.styles.logo.color),e}function r(e){var i={method:"POST",url:n.urls.saveRecentColors,headers:{"Content-Type":"application/json"},data:{RecentColors:e}};t(i)}function s(){function o(t){t&&t.data&&t.data.RecentColors&&null!==t.data.RecentColors&&(n.recentlyUsedColors=t.data.RecentColors),e.$emit("recentColors:loaded")}function r(e){i.logUiErrors("recentColorSvc.js",e.statusText?e.statusText:e.status)}t.get(n.urls.getRecentColors).then(o).catch(r)}function a(e){var t=/#?([\da-fA-F]{6})|#([\d|a-f|A-F]){3}/i;return t.test(e)}function l(e){n.recentlyUsedColors.length>=c&&(n.recentlyUsedColors=n.recentlyUsedColors.slice(0,c-1)),n.recentlyUsedColors.unshift(e),r(n.recentlyUsedColors)}var c=8;n.recentlyUsedColors=o(),n.mode.publicCanvas||(e.$on("recentColors:addNew",function(t,i){if(null!==i){var o=i.replace("#","");n.recentlyUsedColors.indexOf(o)===-1&&a(o)&&(l(o),e.$emit("recentColors:loaded"))}}),n.recentColorsEnabled&&s())}t.service("recentColorSvc",i),i.$inject=["$rootScope","$http","errorLoggingSvc"]}),define("modules/emailbuilder/components/toolbar/toolbar-delete-control.controller",["vendor/angular","modules/emailbuilder/module"],function(e,t){function n(e){function t(e){o=e}function n(){o(),i()}function i(){r.isActive=!r.isActive,r.isActive&&e.$emit("toolbarItemActivated",r)}var o,r=this;r.isActive=!1,r.toggleActive=i,r.init=t,r.action=n,e.$on("toolbarItemActivated",function(e,t){r!==t&&(r.isActive=!1)})}t.controller("toolbarDeleteControlController",n),n.$inject=["$rootScope"]}),define("vendor/text!modules/emailbuilder/components/toolbar/toolbar-delete-control.html",[],function(){return'<div class="c-toolbar__item"\r\n     ng-class="{ \'is-active\' : toolbarDeleteControlCtrl.isActive, \'\' : !toolbarDeleteControlCtrl.isActive }">\r\n    <button class="c-button c-toolbar__button {{ buttonClass }}"\r\n            ng-click="toolbarDeleteControlCtrl.toggleActive()">\r\n    </button>\r\n    <div class="c-toolbar__confirm-button-panel" ng-show="toolbarDeleteControlCtrl.isActive">\r\n        <div class="c-toolbar__confirm-button-panel-inner">\r\n            <button class="c-button c-toolbar__confirm-button c-toolbar__confirm-button--cancel" ng-click="toolbarDeleteControlCtrl.toggleActive()">\r\n                <span class="c-toolbar__confirm-button-text">Cancel</span>\r\n            </button>\r\n            <button class="c-button c-toolbar__confirm-button c-toolbar__confirm-button--delete" ng-click="toolbarDeleteControlCtrl.action()">\r\n                <span class="c-toolbar__confirm-button-text">Delete</span>\r\n            </button>\r\n        </div>\r\n    </div>\r\n</div>'}),define("modules/emailbuilder/components/toolbar/toolbar-delete-control.directive",["config","vendor/angular","modules/emailbuilder/module","vendor/text!modules/emailbuilder/components/toolbar/toolbar-delete-control.html"],function(e,t,n,i){function o(){function e(e,t,n,i){i.init(e.action)}var t={restrict:"EA",link:e,transclude:!0,replace:!0,template:i,controller:"toolbarDeleteControlController",controllerAs:"toolbarDeleteControlCtrl",scope:{buttonClass:"@",action:"&"}};return t}n.directive("cmToolbarDeleteControl",o)}),define("modules/emailbuilder/components/toolbar/toolbar-item.controller",["vendor/angular","modules/emailbuilder/module"],function(e,t){function n(e){function t(){n.isActive=!n.isActive}var n=this;n.isActive=!1,n.toggleActive=t,e.$on("closeAllToolbarDropdowns",function(){n.isActive=!1})}t.controller("toolbarItemController",n),n.$inject=["$rootScope"]}),define("vendor/text!modules/emailbuilder/components/toolbar/toolbar-item.html",[],function(){return'<div class="c-toolbar__item">\r\n    <button ng-if="toolbarItemCtrl.dropdown == true" class="c-button c-toolbar__button {{ buttonClass }} has-dropdown"\r\n            ng-class="{ \'is-active\' : toolbarItemCtrl.isActive, \'\' : !toolbarItemCtrl.isActive }"\r\n            ng-click="$event.stopPropagation(); toolbarItemCtrl.toggleActive()"\r\n            ng-model="ngModel">\r\n            <span class="c-toolbar__button-text">\r\n                {{ itemValue }}\r\n            </span>\r\n    </button>\r\n    <div class="c-toolbar__dropdown-container" ng-show="toolbarItemCtrl.isActive" ng-if="toolbarItemCtrl.dropdown == true" ng-transclude></div>\r\n</div>'}),define("modules/emailbuilder/components/toolbar/toolbar-item.directive",["config","vendor/angular","modules/emailbuilder/module","vendor/text!modules/emailbuilder/components/toolbar/toolbar-item.html"],function(e,t,n,i){function o(){function e(e,t,n,i){void 0===e.dropdown&&(e.dropdown=!1),i.dropdown=e.dropdown}var t={restrict:"EA",link:e,transclude:!0,replace:!0,template:i,controller:"toolbarItemController",controllerAs:"toolbarItemCtrl",scope:{itemValue:"@",buttonClass:"@",classNames:"@",dropdown:"=",ngModel:"="}};return t}n.directive("cmToolbarItem",o)}),define("modules/emailbuilder/components/toolbar/toolbar.controller",["vendor/angular","modules/emailbuilder/module"],function(e,t){function n(){}t.controller("toolbarController",n)}),define("vendor/text!modules/emailbuilder/components/toolbar/toolbar.html",[],function(){return'<div class="c-toolbar" ng-transclude></div>'}),define("modules/emailbuilder/components/toolbar/toolbar.directive",["config","vendor/angular","modules/emailbuilder/module","vendor/text!modules/emailbuilder/components/toolbar/toolbar.html"],function(e,t,n,i){function o(){function e(e,t,n,i){}var t={restrict:"EA",link:e,replace:!0,template:i,controller:"toolbarController",controllerAs:"toolbarCtrl",transclude:!0,scope:{groupClassName:"@"}};return t}n.directive("cmToolbar",o)}),define("modules/emailbuilder/components/toolbar/toolbar-dropdown.controller",["vendor/angular","modules/emailbuilder/module"],function(e,t){function n(e){function t(e,t){s.text=e,r=t}function n(){s.isActive=!s.isActive,s.isActive&&e.$emit("toolbarItemActivated",s)}function i(e){s.items.push(e)}function o(e){r({command:e}),n()}var r,s=this;s.isActive=!1,s.toggleActive=n,s.addItem=i,s.itemSelected=o,s.items=[],s.init=t,e.$on("toolbarItemActivated",function(e,t){s!==t&&(s.isActive=!1)})}t.controller("toolbarDropdownController",n),n.$inject=["$rootScope"]}),define("vendor/text!modules/emailbuilder/components/toolbar/toolbar-dropdown.html",[],function(){return'<div class="c-toolbar__item">\r\n    <button class="c-button c-toolbar__button  has-dropdown" ng-click="toolbarDropdownCtrl.toggleActive()" ng-class="{ \'is-active\': toolbarDropdownCtrl.isActive }">\r\n        <span class="c-toolbar__button-text">{{ toolbarDropdownCtrl.text }}</span>\r\n    </button>\r\n    <div class="c-toolbar__dropdown-container" ng-show="toolbarDropdownCtrl.isActive">\r\n        <ul class="c-toolbar__dropdown" ng-transclude></ul>\r\n    </div>\r\n</div>\r\n'}),define("modules/emailbuilder/components/toolbar/toolbar-dropdown.directive",["vendor/angular","modules/emailbuilder/module","vendor/text!modules/emailbuilder/components/toolbar/toolbar-dropdown.html"],function(e,t,n){function i(){function e(e,t,n,i){i.init(e.text,e.itemSelected)}var t={restrict:"EA",link:e,transclude:!0,replace:!0,template:n,controller:"toolbarDropdownController",controllerAs:"toolbarDropdownCtrl",scope:{text:"@",itemSelected:"&"}};return t}t.directive("cmToolbarDropdown",i)}),define("modules/emailbuilder/components/toolbar/toolbar-dropdown-item.controller",["vendor/angular","modules/emailbuilder/module"],function(e,t){function n(){function e(e,t,i){n.dropdownCtrl=e,n.command=t,n.text=i}function t(){n.dropdownCtrl.itemSelected(n.command)}var n=this;n.selected=t,n.init=e}t.controller("toolbarDropdownItemController",n)}),define("vendor/text!modules/emailbuilder/components/toolbar/toolbar-dropdown-item.html",[],function(){return'<li class="c-toolbar__dropdown-item">\r\n    <button class="c-button c-toolbar__dropdown-button" ng-click="toolbarDropdownItemCtrl.selected()">{{ toolbarDropdownItemCtrl.text }}</button>\r\n</li>\r\n'}),define("modules/emailbuilder/components/toolbar/toolbar-dropdown-item.directive",["vendor/angular","modules/emailbuilder/module","vendor/text!modules/emailbuilder/components/toolbar/toolbar-dropdown-item.html"],function(e,t,n){function i(){function e(e,t,n,i){var o=i[0],r=i[1];o.addItem(r),r.init(o,e.command,e.text)}var t={restrict:"EA",link:e,replace:!0,require:["^cmToolbarDropdown","cmToolbarDropdownItem"],template:n,controller:"toolbarDropdownItemController",controllerAs:"toolbarDropdownItemCtrl",scope:{command:"@",text:"@"}};return t}t.directive("cmToolbarDropdownItem",i)}),define("modules/emailbuilder/services/colorConverterSvc",["vendor/angular","config","modules/emailbuilder/module"],function(e,t,n){function i(){function e(e,t,n){return"#"+((1<<24)+(e<<16)+(t<<8)+n).toString(16).slice(1)}function t(e){var t=e;if("#"===e[0]&&(t=e.substring(1)),3===t.length){var n=t[0]+t[0]+t[1]+t[1]+t[2]+t[2];t=n}var i=parseInt(t,16),o=i>>16&255,r=i>>8&255,s=i>>0&255;return{red:o,green:r,blue:s}}function n(e,t,n){e/=255,t/=255,n/=255;var i,o,r=Math.max(e,t,n),s=Math.min(e,t,n),a=(r+s)/2;if(r===s)i=o=0;else{var l=r-s;switch(o=a>.5?l/(2-r-s):l/(r+s),r){case e:i=(t-n)/l+(t<n?6:0);break;case t:i=(n-e)/l+2;break;case n:i=(e-t)/l+4}i/=6}return{hue:Math.round(360*i*100)/100,saturation:Math.round(100*o)/100,lightness:Math.round(100*a)/100}}function i(t){var n=r(t.hue,t.saturation,t.lightness);return e(n.red,n.green,n.blue)}function o(e,i,o){var r=t(e),s=n(r.red,r.green,r.blue);return s.saturation<o&&s.lightness<i*c||s.lightness<i}function r(e,t,n){function i(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}var o,r,s;if(e/=360,t=t,n=n,0===t)o=r=s=n;else{var a=n<.5?n*(1+t):n+t-n*t,l=2*n-a;o=i(l,a,e+1/3),r=i(l,a,e),s=i(l,a,e-1/3)}return{red:Math.round(255*o),green:Math.round(255*r),blue:Math.round(255*s)}}function s(e,t){var n=e;return n=Math.round(Math.min(Math.max(0,n+n*t),255)),n<30&&(n=30),n=n.toString(16),("00"+n).substr(n.length)}function a(e,t){var n="#";return n+=s(e.red,t),n+=s(e.green,t),n+=s(e.blue,t)}function l(e,i,o,r){var s=t(e),l=n(s.red,s.green,s.blue);return l.saturation<r&&l.lightness<o*c||l.lightness<o?a(s,i):a(s,-i)}this.hexToRgb=t,this.rgbToHsl=n,this.isDarkerThanThresholdFromHex=o,this.getContrastColor=l,this.hslToRgb=r,this.hslToHex=i;var c=.6666}n.service("colorConverterSvc",i),i.$inject=[]}),define("modules/emailbuilder/directives/templateBadge",["vendor/angular","config","modules/emailbuilder/module","ts/modules/emailbuilder/services/email","modules/emailbuilder/services/colorConverterSvc"],function(e,t,n){function i(n,i,o,r){return{restrict:"A",scope:!0,link:function(s,a,l){if(t.templateBadge===!0){s.block=e.copy(n.model.footer),a.css("position","relative"),a.addClass("c-section-highlight"),a.on("click",function(){s.block.type="footer",s.block.subType="otherSettings",i.$emit("content:activate",{block:s.block})}),a.on("mouseenter",function(){a.addClass("is-hovered")}),a.on("mouseleave",function(){a.removeClass("is-hovered")});var c=e.element('<div emb-item-controls item-type="templateBadge" item="block" item-hovered="hovered"  confirmation ="confirmation"></div>');a.prepend(c),r(c)(s),s.updateBackgroundColor=function(e){var t=o.isDarkerThanThresholdFromHex(e,.45,.7);t?(a.find("a > img").first().show(),a.find("a > img").last().hide(),n.model.templateBadge.isDark=!0):(a.find("a > img").first().hide(),a.find("a > img").last().show(),n.model.templateBadge.isDark=!1);var i=o.getContrastColor(e,.1,.45,.7);a.css("background-color",i),n.model.templateBadge.backgroundColor=i},i.$on("backgroundColor:changed",function(e,t){s.updateBackgroundColor(t)}),n.model.templateBadge&&s.updateBackgroundColor(n.model.styles.body.backgroundColor)}}}}n.directive("embTemplateBadge",["EmailSvc","$rootScope","colorConverterSvc","$compile",i])}),define("modules/emailbuilder/directives/preventBackspaceBack",["vendor/angular","modules/emailbuilder/module"],function(e,t){function n(e){return{restrict:"A",link:function(e,t){document.addEventListener("keydown",function(e){var t=e.target;8===e.keyCode&&("true"!==t.contentEditable&&"textarea"!==t.localName&&"input"!==t.localName||"input"==t.localName&&t.readOnly===!0)&&e.preventDefault()})}}}t.directive("embPreventBackspaceBack",["$document",n])}),define("vendor/text!modules/emailbuilder/templates/sidebarSettings.html",[],function(){return'<div class="c-sidebar__settings">\n    <div class="c-sidebar__intro">\n        <h2 class="c-sidebar__heading-primary">Settings</h2>\n    </div>\n    <h2 id="emb-js-customize-logo"\n        class="accordion__heading"\n        ng-class="{\'emb-selected\': currentCustomize == \'header\'}"\n        ng-click="currentCustomize = \'header\'">\n        Logo\n        <span class="l-sidebar__selector emb-header-selector" ng-show="currentCustomize == \'header\'" ng-click="setHeaderActive();" ng-model="email.header.displayType" emb-select-group emb-save-on-model-change>\n            <a id="emb-js-header-image" data-value="image" class="emb-option">Image</a>\n            <a id="emb-js-header-text" data-value="text" class="emb-option">Text</a>\n            <a id="emb-js-header-none" data-value="none" class="emb-option">None</a>\n        </span>\n    </h2>\n    <div class="hmb-image-sidebar emb-sidebar-accordion-header"\n         ng-if="currentCustomize == \'header\'"\n         ng-hide="hideHeaderSettings && email.header.displayType === \'none\'">\n        <form name="logo" novalidate="novalidate" ng-hide="email.header.displayType === \'none\'" class="c-sidebar__form form--logo" ng-class="{ \'is-disabled\' : email.header.displayType === \'none\'}">\n            <ul role="tablist" class="l-grid l-grid--inline-block l-grid--vertical-spacing">\n                <li role="presentation" class="l-grid__item l-grid__item--100" ng-if="email.header.displayType === \'image\' && email.header.hasSrc() && email.header.originalWidth > 10">\n                    <div class="c-slider">\n                        <label class="c-sidebar__label">Size</label>\n                        <div class="c-sidebar__label c-sidebar__label--slider">\n                            <div emb-image-dimensions="email.header.width" emb-image-dimensions-slave="email.header.height" emb-image-dimensions-numerator="email.header.originalHeight" emb-image-dimensions-denominator="email.header.originalWidth"></div>\n                        </div>\n                        <div cs-slider="email.header.width" cs-slider-min="10" cs-slider-max="maxLogoWidth" ng-model="email.header.width" ng-model-options="{ debounce: 100}" emb-save-on-model-change></div>\n                    </div>\n                </li>\n                <li role="presentation" class="l-grid__item l-grid__item--50">\n                    <!-- ng-show="configurableAlignment" -->\n                    <label class="c-sidebar__label">Alignment</label>\n                    <div class="l-grid l-grid--gutter">\n                        <div class="l-grid__item l-grid__item--100">\n                            <div class="l-grid enhance-flex l-fixed--align emb-segmented-buttons hmb-js-horizontal-alignment emb-alignment" ng-model="email.header.halign" emb-select-group emb-save-on-model-change>\n                                <button data-value="left" class="l-grid__item emb-btn emb-align-left">\n                                    <span class="c-segmented-control__icon"></span>\n                                </button>\n                                <button data-value="center" class="l-grid__item emb-btn emb-align-horizontal-middle">\n                                    <span class="c-segmented-control__icon"></span>\n                                </button>\n                                <button data-value="right" class="l-grid__item emb-btn emb-align-right">\n                                    <span class="c-segmented-control__icon"></span>\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </li>\n                <li role="presentation" class="l-grid__item l-grid__item--100" ng-if="email.header.displayType !== \'none\'">\n                    <label class="c-sidebar__label">Link <span class="c-sidebar__label--optional">(optional)</span></label>\n                    <input class="c-input" emb-sync-href="email.header" id="emb-js-header-link" ng-model="email.header.tempHref" cs-valid-url name="href" type="text" placeholder="http://" emb-save-on-model-change ng-keypress="handleEnter($event)" />\n                </li>\n                <li role="presentation" class="l-grid__item l-grid__item--100" ng-if="email.header.displayType == \'text\'">\n                    <label class="c-sidebar__label">Color and font</label>\n                    <div class="c-colorpicker ff-colorpicker--recent c-colorpicker--light c-colorpicker--select">\n                        <div cs-color-selector="email.config.defaultStyles.logo.color" cs-viewport="#emb-js-sidebar" ng-model="email.styles.logo.color" emb-update-style emb-save-on-model-change></div>\n                        <div cs-dropdown-class="l-select-container--font-family" cs-dropdown="email.config.availableFonts" ng-model="email.styles.logo.fontFamily" emb-update-style emb-save-on-model-change></div>\n                    </div>\n                </li>\n                <li ng-if="email.header.displayType === \'image\' && !email.header.hasSrc()" class="l-grid__item l-grid__item--100">\n                    <label class="c-sidebar__label">Image</label>\n                    <span class="emb-upload-img-text hmb-fake-input-box c-image-controls__uploaded-image hmb-uploaded-image is-empty">\n                        <span id="emb-js-message"></span>\n                        <input ng-click="setHeaderActive();" emb-file-upload file="email.header" class="emb-invisible-input" name="file" type="file" id="sidebar-image-chooser" accepts="image/*">\n                        <a class="c-button c-button--choose-file">\n                            Choose file\n                        </a>\n                        <span ng-show="showProgress" class="loading-circle">\n                            <span class="loading-circle__spinner"></span>\n                        </span>\n                    </span>\n                </li>\n                <li role="presentation" class="l-grid__item l-grid__item--100" ng-if="email.header.displayType === \'image\' && email.header.hasSrc()">\n                    <label class="c-sidebar__label">Alt text <span class="c-sidebar__label--optional">(shown when images are turned off)</span></label>\n                    <input class="c-input" name="alt" ng-model="email.header.alt" type="text" emb-save-on-model-change ng-keypress="handleEnter($event)" />\n                </li>\n            </ul>\n        </form>\n        <form ng-if="email.isBlueprint" ng-show="email.header.displayType !== \'none\'" class="c-sidebar__form" ng-class="{ \'is-disabled\' : email.header.displayType === \'none\'}">\n            <hr class="c-sidebar__rule">\n            <ul class="checkbox-options__list c-sidebar__form-list">\n                <li>\n                    <div class="checkbox-options" id="emb-js-logo-padding" cs-checkbox ng-model="email.header.hasHorizontalLogoPadding" label="Add horizontal spacing" emb-save-on-model-change></div>\n                </li>\n            </ul>\n        </form>\n        <form ng-hide="email.header.displayType === \'none\'" class="c-sidebar__form" ng-class="{ \'is-disabled\' : email.header.displayType === \'none\'}">\n\n            <hr class="c-sidebar__rule">\n\n            <ul role="tablist" class="l-grid l-grid--inline-block l-grid--vertical-spacing">\n                <li role="presentation" class="l-grid__item l-grid__item--100">\n                    <div class="c-slider">\n                        <label class="c-sidebar__label">Top spacing</label>\n                        <div class="c-sidebar__label c-sidebar__label--slider">{{email.header.paddingTop}}</div>\n                        <div cs-slider="email.header.paddingTop" cs-slider-min="0" cs-slider-max="maxLogoVerticalPadding" ng-model="email.header.paddingTop" emb-save-on-model-change></div>\n                    </div>\n                </li>\n                <li role="presentation" class="l-grid__item l-grid__item--100">\n                    <div class="c-slider">\n                        <label class="c-sidebar__label">Bottom spacing</label>\n                        <div class="c-sidebar__label c-sidebar__label--slider">{{email.header.paddingBottom}}</div>\n                        <div cs-slider="email.header.paddingBottom" cs-slider-min="0" cs-slider-max="maxLogoVerticalPadding" ng-model="email.header.paddingBottom" emb-save-on-model-change></div>\n                    </div>\n                </li>\n            </ul>\n        </form>\n        <form name="webversion" novalidate="novalidate" ng-if="template.optionalTexts.preheader || template.shareOptions.webversion" class="c-sidebar__form form--webversion"\n        ng-hide="hideHeaderSettings">\n                <hr class="c-sidebar__rule" ng-hide="email.header.displayType === \'none\'">\n\n                <ul class="checkbox-options__list l-grid l-grid--inline-block">\n                    <li role="presentation" class="l-grid__item l-grid__item--100" ng-if="template.shareOptions.webversion">\n                        <!-- link "No Images? Click here" i.e. go to web version -->\n                        <div class="checkbox-options" id="emb-js-share-webversion" cs-checkbox ng-model="email.social.webversion.on" label="{{template.shareOptions.webversion}}" emb-save-on-model-change></div>\n                    </li>\n\n                    <li role="presentation" class="l-grid__item l-grid__item--100" ng-if="template.optionalTexts.preheader">\n                        <!-- pre-header i.e. email summary -->\n                        <div class="checkbox-options" id="emb-js-optional-preheader" cs-reverse-checkbox ng-model="email.editableText.preheader.isDisabled"\n                             reverse-checkbox="true" label="{{template.optionalTexts.preheader}}" emb-save-on-model-change></div>\n                    </li>\n                </ul>\n        </form>\n    </div>\n\n    <h2 id="emb-js-customize-colorsAndFonts"\n        class="accordion__heading">\n        Colors and fonts\n    </h2>\n    <form class="c-sidebar__form" name="colorsAndFonts" novalidate="novalidate">\n        <ul role="tablist" class="l-grid l-grid--inline-block l-grid--vertical-spacing emb-colorpicker-parent" bindonce>\n            <li role="presentation" class="l-grid__item l-grid__item--100">\n                <label class="c-sidebar__label">Heading 1</label>\n                <div class="c-colorpicker ff-colorpicker--recent c-colorpicker--light c-colorpicker--select">\n                    <div cs-color-selector="email.config.defaultStyles.h1.color" cs-color-selector-upward-class="emb-upward" cs-viewport="#emb-js-sidebar" ng-model="email.styles.h1.color" emb-update-style emb-save-on-model-change></div>\n                    <div ng-model="email.styles.h1.fontSize" class="l-combined-select-container l-combined-select-container--font-size" cs-dropdown-class="l-select-container--font-size" cs-dropdown="email.config.availableFontSizes" cs-child emb-update-style emb-save-on-model-change></div>\n                    <div class="l-combined-select-container" cs-dropdown-class="l-select-container--font-family" cs-dropdown="email.config.availableFonts" cs-child ng-model="email.styles.h1.fontFamily" emb-update-style emb-save-on-model-change></div>\n                </div>\n            </li>\n            <li role="presentation" class="l-grid__item l-grid__item--100">\n                <label class="c-sidebar__label">Heading 2</label>\n                <div class="c-colorpicker ff-colorpicker--recent c-colorpicker--light c-colorpicker--select">\n                    <div cs-color-selector="email.config.defaultStyles.h2.color" cs-color-selector-upward-class="emb-upward" cs-viewport="#emb-js-sidebar" ng-model="email.styles.h2.color" emb-update-style emb-save-on-model-change></div>\n                    <div ng-model="email.styles.h2.fontSize" class="l-combined-select-container l-combined-select-container--font-size" cs-dropdown-class="l-select-container--font-size" cs-dropdown="email.config.availableFontSizes" cs-child emb-update-style emb-save-on-model-change></div>\n                    <div class="l-combined-select-container" cs-dropdown-class="l-select-container--font-family" cs-dropdown="email.config.availableFonts" cs-child ng-model="email.styles.h2.fontFamily" emb-update-style emb-save-on-model-change></div>\n                </div>\n            </li>\n            <li role="presentation" class="l-grid__item l-grid__item--100">\n                <label class="c-sidebar__label">Heading 3</label>\n                <div class="c-colorpicker ff-colorpicker--recent c-colorpicker--light c-colorpicker--select">\n                    <div cs-color-selector="email.config.defaultStyles.h3.color" cs-color-selector-upward-class="emb-upward" cs-viewport="#emb-js-sidebar" ng-model="email.styles.h3.color" emb-update-style emb-save-on-model-change></div>\n                    <div ng-model="email.styles.h3.fontSize" class="l-combined-select-container l-combined-select-container--font-size" cs-dropdown-class="l-select-container--font-size" cs-dropdown="email.config.availableFontSizes" cs-child emb-update-style emb-save-on-model-change></div>\n                    <div class="l-combined-select-container" cs-dropdown-class="l-select-container--font-family" cs-dropdown="email.config.availableFonts" cs-child ng-model="email.styles.h3.fontFamily" emb-update-style emb-save-on-model-change></div>\n                </div>\n            </li>\n            <li role="presentation" class="l-grid__item l-grid__item--100">\n                <label class="c-sidebar__label">Normal text</label>\n                <div class="c-colorpicker ff-colorpicker--recent c-colorpicker--light c-colorpicker--select">\n                    <div cs-color-selector="email.config.defaultStyles.p.color" cs-color-selector-upward-class="emb-upward" cs-viewport="#emb-js-sidebar" cs-child ng-model="email.styles.p.color" emb-update-style emb-save-on-model-change></div>\n                    <div ng-model="email.styles.p.fontSize" class="l-combined-select-container l-combined-select-container--font-size" cs-dropdown-class="l-select-container--font-size" cs-dropdown="email.config.availableFontSizes" cs-child emb-update-style emb-save-on-model-change></div>\n                    <div class="l-combined-select-container" cs-dropdown-class="l-select-container--font-family" cs-dropdown="email.config.availableFonts" cs-child ng-model="email.styles.p.fontFamily" emb-update-style emb-save-on-model-change></div>\n                </div>\n            </li>\n            <li role="presentation" class="l-grid__item l-grid__item--100">\n                <label class="c-sidebar__label">Header &amp; footer text</label>\n                <div class="c-colorpicker ff-colorpicker--recent c-colorpicker--light c-colorpicker--select">\n                    <div cs-color-selector="email.config.defaultStyles.headerAndFooter.color" cs-color-selector-upward-class="emb-upward" cs-viewport="#emb-js-sidebar" cs-child ng-model="email.styles.headerAndFooter.color" emb-update-style emb-save-on-model-change></div>\n                    <div cs-dropdown-class="l-select-container--font-family" cs-dropdown="email.config.availableFonts" cs-child ng-model="email.styles.headerAndFooter.fontFamily" emb-update-style emb-save-on-model-change></div>\n                </div>\n            </li>\n            <li role="presentation" class="l-grid__item l-grid__item--100">\n                <div class="l-grid l-grid--gutter l-grid--vertical-spacing">\n                    <div class="l-grid__item l-grid__item--100">\n                        <label class="c-sidebar__label">Button color</label>\n                        <div class="c-colorpicker ff-colorpicker--recent c-colorpicker--light c-colorpicker--input">\n                            <div cs-color-selector="email.config.defaultStyles.button.backgroundColor" cs-color-selector-upward-class="emb-upward" cs-viewport="#emb-js-sidebar" ng-model="email.styles.button.backgroundColor" emb-update-style emb-save-on-model-change></div>\n                        </div>\n                    </div>\n                    <div class="l-grid__item l-grid__item--100">\n                        <label class="c-sidebar__label">Link color</label>\n                        <div class="c-colorpicker ff-colorpicker--recent c-colorpicker--light c-colorpicker--input">\n                            <div cs-color-selector="email.config.defaultStyles.link.color" cs-color-selector-upward-class="emb-upward" cs-viewport="#emb-js-sidebar" ng-model="email.styles.link.color" emb-update-style emb-save-on-model-change></div>\n                        </div>\n                    </div>\n                </div>\n            </li>\n            <li role="presentation" class="l-grid__item l-grid__item--100">\n                <div class="l-grid l-grid--gutter l-grid--vertical-spacing">\n                    <div class="l-grid__item l-grid__item--100">\n                        <label class="c-sidebar__label">Button text</label>\n                        <div class="c-colorpicker ff-colorpicker--recent c-colorpicker--light c-colorpicker--input">\n                            <div cs-color-selector="email.config.defaultStyles.button.color" cs-color-selector-upward-class="emb-upward" cs-viewport="#emb-js-sidebar" ng-model="email.styles.button.color" emb-update-style emb-save-on-model-change></div>\n                        </div>\n                    </div>\n                    <div class="l-grid__item l-grid__item--100">\n                        <label class="c-sidebar__label">Background color</label>\n                        <div class="c-colorpicker ff-colorpicker--recent c-colorpicker--light c-colorpicker--input">\n                            <div cs-color-selector="email.config.defaultStyles.body.backgroundColor" cs-color-selector-upward-class="emb-upward" cs-viewport="#emb-js-sidebar" ng-model="email.styles.body.backgroundColor" emb-update-element-is-dark="#emb-body" emb-update-style="body, .wrapper, .emb-editor-canvas" emb-update-style-color-functions="[{ lessFunction: \'darken\', cssProperty: \'background-color\', cssSelector: \'.divider\' }, { lessFunction: \'mix\', cssProperty: \'background-color\', cssSelector: \'.footer__right a\' }, { lessFunction: \'darken\', cssProperty: \'border-left-color\', cssSelector: \'.emb-text-editor blockquote\' }]" emb-save-on-model-change></div>\n                        </div>\n                    </div>\n                </div>\n            </li>\n            <li role="presentation" class="l-grid__item l-grid__item--100" ng-show="mode.emailBackgroundImageFeature">\n                <label class="c-sidebar__label">Background image</label>\n                <div class="hmb-background-upload hmb-background-upload--customize" emb-background-email-image-uploader email-background-status="emailBackgroundStatus" background-image="email.styles.body.backgroundLayoutImage" ng-model="email.styles.body.backgroundLayoutImage.href" emb-update-style emb-save-on-model-change></div>\n            </li>\n\n            <li role="presentation" class="l-grid__item l-grid__item--100" bo-if="email.isBlueprint">\n                <label class="c-sidebar__label">Section background</label>\n                <div class="c-colorpicker ff-colorpicker--recent c-colorpicker--light c-colorpicker--input">\n                    <div cs-color-selector="email.config.defaultStyles.section.backgroundColor" cs-color-selector-upward-class="emb-upward"\n                         cs-viewport="#emb-js-sidebar" ng-change="updateSectionBackgroundColor()" ng-model="email.styles.section.backgroundColor" emb-update-style emb-save-on-model-change></div>\n                </div>\n            </li>\n        </ul>\n    </form>\n\n    <h2 id="emb-js-customize-spacing"\n        class="accordion__heading">\n        Section spacing\n    </h2>\n    <form class="c-sidebar__form" name="spacing" novalidate="novalidate">\n        <ul role="tablist" class="l-grid l-grid--inline-block l-grid--vertical-spacing" bindonce>\n            <li role="presentation" class="l-grid__item l-grid__item--100">\n                <div class="c-slider">\n                    <label class="c-sidebar__label">Vertical spacing</label>\n                    <div class="c-sidebar__label c-sidebar__label--slider">\n                        <div>{{email.spacing.verticalSpacing === 0 ? "None" : email.spacing.verticalSpacing === 1 ? "Medium" : "Large" }}</div>\n                    </div>\n                    <div ng-change="setVerticalPaddingStyle()" cs-slider="email.spacing.verticalSpacing" cs-slider-value="email.spacing.verticalSpacing" cs-slider-min="0" cs-slider-max="2" ng-model="email.spacing.verticalSpacing" ng-model-options="{ debounce: 100}" emb-save-on-model-change data-steps="3"></div>\n                </div>\n            </li>\n        </ul>\n    </form>\n\n    <div ng-show="canvasSectionPermissions && mode.templateWithContent">\n        <h2 id="emb-js-customize-spacing"\n            class="accordion__heading qa-header-content-locking">\n            Header content locking\n        </h2>\n        <form class="c-sidebar__form" name="permissions" novalidate="novalidate">\n            <ul role="tablist" class="l-grid l-grid--inline-block l-grid--vertical-spacing">\n                <li role="presentation" class="l-grid__item l-grid__item--100">\n                    <label class="c-sidebar__label">Header editing restrictions</label>\n                    <div class="c-dropdown-options-container" cs-dropdown-class="c-dropdown">\n                        <div cs-dropdown="headerLockLevels" cs-dropdown-class="l-select-container--small l-select-container--permissions"\n                             ng-model="email.header.permissions.lockLevel" emb-save-on-model-change\n                             ng-change="headerPermissionsChanged(email.header)"></div>\n                    </div>\n                    <p ng-show="email.header.permissions.lockLevel !== \'none\'" class="c-sidebar__text l-gap--top-medium">To make changes to the header, select â€œUnlock everythingâ€.</p>\n                </li>\n            </ul>\n        </form>\n    </div>\n\n    <h2 id="emb-js-customize-language"\n        class="accordion__heading">\n        Language\n    </h2>\n    <form name="general" novalidate="novalidate" class="c-sidebar__form">\n        <ul role="tablist" class="l-grid l-grid--inline-block l-grid--vertical-spacing">\n            <li role="presentation" class="l-grid__item l-grid__item--100">\n                <label class="c-sidebar__label">Global email language</label>\n                <div cs-dropdown="languages" ng-model="email.language" emb-save-on-model-change></div>\n            </li>\n        </ul>\n    </form>\n\n</div>';
}),define("ts/modules/emailbuilder/directives/sidebarSettings",["config","vendor/angular","modules/emailbuilder/module","vendor/text!modules/emailbuilder/templates/sidebarSettings.html"],function(e,t,n,i){var o=function(){function e(){this.restrict="E",this.replace=!0,this.template=i,this.link=function(e,t,n){}}return e.factory=function(){return new e},e}();n.directive("embSidebarSettings",o.factory)}),define("modules/emailbuilder/controllers/email",["config","vendor/angular","jquery","modules/emailbuilder/module","underscore","modules/emailbuilder/animations/preview","modules/emailbuilder/services/templateName","modules/emailbuilder/services/screenshot","ts/modules/emailbuilder/services/email","modules/emailbuilder/services/languages","modules/emailbuilder/services/template","modules/emailbuilder/services/activeContentManager","modules/emailbuilder/services/previewImage","modules/emailbuilder/services/imageManager","modules/emailbuilder/services/imageValidation","modules/emailbuilder/services/save","modules/emailbuilder/services/onBoarding","modules/emailbuilder/services/checkOnPreview","modules/emailbuilder/directives/positionControls","modules/emailbuilder/directives/sectionContainer","modules/emailbuilder/components/colorpicker/colorpicker.directive","modules/emailbuilder/directives/itemControls","ts/modules/emailbuilder/directives/sortable","modules/emailbuilder/directives/droplineContainer","modules/emailbuilder/directives/addSection","modules/emailbuilder/directives/uploader","modules/emailbuilder/directives/videoEmbedder","modules/emailbuilder/directives/dragHelper","modules/emailbuilder/directives/dragEvents","modules/emailbuilder/directives/textBlock","modules/emailbuilder/directives/slider","modules/emailbuilder/directives/imageDimensions","modules/emailbuilder/directives/logo","ts/modules/emailbuilder/directives/footer","ts/modules/emailbuilder/directives/preheader","ts/modules/emailbuilder/directives/sectionBackground","ts/modules/emailbuilder/services/ravenSvc","modules/emailbuilder/directives/focus","modules/emailbuilder/directives/dropdown","modules/emailbuilder/directives/checkbox","modules/emailbuilder/directives/headerLogo","modules/emailbuilder/directives/header","modules/emailbuilder/directives/spacer","modules/emailbuilder/directives/divider","modules/emailbuilder/directives/previewFrame","modules/emailbuilder/directives/previewAsDropdown","modules/emailbuilder/services/imageFileDragging","modules/emailbuilder/services/dynamicStyle","modules/emailbuilder/directives/validationMessages","modules/emailbuilder/directives/buttonBlock","modules/emailbuilder/directives/monitorHeight","modules/emailbuilder/directives/guidance","ts/modules/emailbuilder/directives/disableDrag","modules/emailbuilder/directives/activeContentWatcher","modules/emailbuilder/directives/socialTag","modules/emailbuilder/directives/warnUser","modules/emailbuilder/directives/switchButton","modules/emailbuilder/directives/translate","modules/emailbuilder/directives/kissMetrics","modules/emailbuilder/directives/validateOnSubmit","modules/emailbuilder/directives/modelOnBlur","ts/modules/emailbuilder/directives/backgroundEmailImageUploader","ts/modules/emailbuilder/directives/backgroundLayoutImageUploader","modules/emailbuilder/directives/webLinks","modules/emailbuilder/directives/trashcan","modules/emailbuilder/directives/reversecheckbox","modules/emailbuilder/directives/scrollContainerIf","modules/emailbuilder/components/promo/promo.controller","modules/emailbuilder/components/promo/promo.directive","modules/emailbuilder/components/modals/modals.controller","modules/emailbuilder/components/modals/modals.directive","modules/emailbuilder/services/errorLoggingSvc","modules/emailbuilder/services/trackingSvc","modules/emailbuilder/components/notification/notification-item.controller","modules/emailbuilder/components/notification/notification-item.directive","modules/emailbuilder/components/notification/notification.controller","modules/emailbuilder/components/notification/notification.directive","ts/modules/emailbuilder/components/notification/notification.service","modules/emailbuilder/components/popover/popover-item.controller","modules/emailbuilder/components/popover/popover-item.directive","modules/emailbuilder/components/popover/popover.controller","modules/emailbuilder/components/popover/popover.directive","modules/emailbuilder/components/segmented-control/segmented-control-item.controller","modules/emailbuilder/components/segmented-control/segmented-control-item.directive","modules/emailbuilder/components/segmented-control/segmented-control.controller","modules/emailbuilder/components/segmented-control/segmented-control.directive","modules/emailbuilder/components/section-controls/section-controls.controller","modules/emailbuilder/components/section-controls/section-controls.directive","modules/emailbuilder/services/recentColorSvc","modules/emailbuilder/components/toolbar/toolbar-delete-control.controller","modules/emailbuilder/components/toolbar/toolbar-delete-control.directive","modules/emailbuilder/components/toolbar/toolbar-item.controller","modules/emailbuilder/components/toolbar/toolbar-item.directive","modules/emailbuilder/components/toolbar/toolbar.controller","modules/emailbuilder/components/toolbar/toolbar.directive","modules/emailbuilder/components/toolbar/toolbar-dropdown.controller","modules/emailbuilder/components/toolbar/toolbar-dropdown.directive","modules/emailbuilder/components/toolbar/toolbar-dropdown-item.controller","modules/emailbuilder/components/toolbar/toolbar-dropdown-item.directive","modules/emailbuilder/directives/templateBadge","modules/emailbuilder/services/colorConverterSvc","modules/emailbuilder/services/performanceSvc","modules/emailbuilder/directives/preventBackspaceBack","ts/modules/emailbuilder/directives/sidebarSettings"],function(e,t,n,i,o,r,s,a,l,c,u,d,m,p,h,f,g,v,b,y,w,k,_,x,S,C,I,T,E,P,$,A,M,L,F,D,O,N,B,R,j,z,U,H,W,V,q,X,Y,G,K,Z,J,Q,ee,te,ne,ie,oe){function re(){try{return window.self!==window.top}catch(e){return!0}}function se(i,r,s,a,l,c,u,d,m,p,h,f,g,v,b,y,w,k,_){function x(e){t.forEach(e,function(e){var n=t.element(e),i=n.attr("cm-tag-type");a.model.social[i]&&(a.model.social[i].width=n.outerWidth())})}e.isFirstRun&&s.path("/firstrun"),i.email=a.model,i.active=u.active,i.languages=l.model,i.template=c,i.isPublicCanvas=e.mode.publicCanvas,i.mode=e.mode,i.surveysEnabled=e.surveysEnabled,i.canvasFastSection=e.canvasFastSection,i.canvasPerformanceMeasure=e.canvasPerformanceMeasure,i.canvasPredefinedSections=e.canvasPredefinedSections,i.canvasSentryMonitoring=e.canvasSentryMonitoring,i.canvasSectionPermissions=e.canvasSectionPermissions,i.emailBackgroundStatus={loading:!1,hasSrc:!1,updateRepeat:function(e,t){var n={};e=e.startsWith("@")?e:e="@"+e,n[e]=t,g.update(n),"@body-backgroundLayoutImage-backgroundRepeat"===e&&(i.email.styles.body.backgroundLayoutImage.backgroundRepeat=t)}},i.cssMyTemplateCreation=e.myTemplateCreation,i.isIFramed=re(),i.layoutBackgroundStatus={loading:!1,hasSrc:!1},i.$watch("email.header.originalWidth",function(t){var n=e.template.containerMaxWidth;e.email.isBlueprint&&i.email.header.hasHorizontalLogoPadding&&(n-=40),i.maxLogoWidth=Math.min(n||f.maxContainerWidth(),t)}),i.$watch("email.header.hasHorizontalLogoPadding",function(t){var n=e.template.containerMaxWidth;e.email.isBlueprint&&t&&(n-=40),i.maxLogoWidth=Math.min(n||f.maxContainerWidth(),i.email.header.originalWidth)}),i.$on("section.moved",function(e,t,n){a.reorderSection(t,n),i.$apply()}),i.$on("content.moved",function(e,t,n,o,s){var l=a.moveContent(o,t,n,s);l&&(r.$emit("content:activate",{block:l}),i.$apply())}),r.$on("content.add",function(e,t){var n=a.addContent(t);n&&(r.$emit("content:activate",{block:n}),i.$apply(),n.checkOffStage())}),r.$on("optionalText:removed",function(e,t){i.email.editableText[t].isDisabled=!0}),r.$on("socialTag:removed",function(e,t){i.email.social[t].on=!1}),r.$on("weblinkTag:removed",function(e,t){i.email.webLinks[t].on=!1}),r.$on("templateBadge:removed",function(e,t){i.email.templateBadge||(i.email.templateBadge={}),i.email.templateBadge.displayBadge=!1}),r.$on("section.add",function(e,t){a.addSection(t),i.$apply()}),r.$on("customize:updateSectionBackgroundColor",function(e){i.email.sections.forEach(function(e){r.$emit("section.updateBackground"+e.uiId,e)})}),r.$on("checkbox:value-changed",function(n,i,o){if(e.email.isBlueprint){var r=t.element("#emb-js-email-body .footer__share-button");r.length&&x(r),r=t.element("#emb-js-email-body .c-social-tag--alignment > a[cs-button]"),r.length&&x(r)}else{var s=t.element("#emb-js-email-body .footer .sharing");s.length&&x(s.find("[cs-button]"))}"show-a-border-for-this-section"===o&&i&&v.updateBorderForSection(i)});var S=o.throttle(p.move.bind(p),50);i.handleDragOver=function(e){var t=e.originalEvent,n={mouseX:t.pageX,mouseY:t.pageY,type:"content",contentType:"file"};t.dataTransfer&&(t.dataTransfer.dropEffect="copy"),clearTimeout(C),p.start(n),S(n)},i.handleDrop=function(e){clearTimeout(C),d.handleDrop(e),p.stop()},i.setVerticalPaddingStyle=function(){var e=i.email.spacing.verticalSpacing;e=i.email.spacing.verticalSpacing=parseInt(e,10),0===e&&(i.email.spacing.isDefined=!0,n("body").removeClass("half-padding"),n("body").removeClass("full-padding"),n("body").addClass("no-padding")),1===e&&(i.email.spacing.isDefined=!0,n("body").removeClass("no-padding"),n("body").removeClass("full-padding"),n("body").addClass("half-padding")),2===e&&(n("body").removeClass("no-padding"),n("body").removeClass("half-padding"),n("body").addClass("full-padding"))};var C,I=p.stop.bind(p);i.dragLeave=function(){clearTimeout(C),C=setTimeout(I,200)},i.closePreview=function(){"preview"===i.embState&&i.showSaveTemplateAs?i.showSaveTemplateAs=!1:"preview"===i.embState&&i.showSignupForm?i.showSignupForm=!1:"preview"===i.embState&&s.path("#/editor")},i.hasListsSegmentsSelected=function(){if(!i.email.sections||0===i.email.sections.length)return!1;if(!e.listsAndSegments||0===e.listsAndSegments.length)return!1;for(var t=0;t<i.email.sections.length;t++){var n=i.email.sections[t];if(n.lists&&n.lists.length>0)return!0;if(n.segments&&n.segments.length>0)return!0}return!1},h.runCheck(),m.update(),i.postDigest=function(){w(function(){i.captureTheLoadTime()},0,!1)},i.captureTheLoadTime=function(){try{_.logDuration("Peformance_AngularFirstDigest",Math.round((Date.now()-k.timerStart)/1e3))}catch(e){}},i.postDigest()}i.controller("EmailCtrl",["$scope","$rootScope","$location","EmailSvc","LanguagesSvc","TemplateOptions","ActiveContentManager","ImageFileDraggingSvc","OnBoardingSvc","DraggingSvc","CheckOnPreviewSvc","ImageManagerSrv","DynamicStylesSrv","SectionIdSvc","recentColorSvc","colorConverterSvc","$timeout","$window","trackingSvc",se])}),define("modules/emailbuilder/services/getFeedbackConnector",["modules/emailbuilder/module","config","jquery"],function(e,t,n){function i(e){this._={$h:e}}var o=t.urls.getFeedbackEncryptedOAuthApplicationIDForUrl,r=t.urls.retrieveGetFeedbackSurveys,s=t.urls.completeOAuthHandshakeWithGetFeedback,a=t.urls.revokeOAuthConnectionWithGetFeedback;i.prototype.loadSurveys=function(){return this._.$h({method:"POST",url:r})},i.prototype.completeOauthHandshake=function(e,t){return this._.$h({method:"POST",url:s,data:{oauthApplicationID:o,authorizationCode:e,oauthState:t},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return n.param(e)}})},i.prototype.revokeConnection=function(){return this._.$h({method:"POST",url:a,data:{oauthApplicationID:o},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:function(e){return n.param(e)}})},e.service("GetFeedbackConnectorSvc",["$http",i])}),define("modules/emailbuilder/services/getFeedbackMetrics",["modules/emailbuilder/module","config","jquery"],function(e,t,n){function i(e){this._={$h:e}}var o=t.urls.trackGetFeedbackConnectionStart,r=t.urls.trackGetFeedbackConnectionSuccess;i.prototype.trackConnectionStart=function(){return this._.$h({method:"POST",url:o})},i.prototype.trackConnectionSuccess=function(){return this._.$h({method:"POST",url:r})},e.service("GetFeedbackMetricsSvc",["$http",i])}),define("modules/emailbuilder/animations/sidebarAccordion",["modules/emailbuilder/module","vendor/jquery.easing"],function(e,t){function n(){var e=300;return{enter:function(t,n){t.show();var i=t.height();t.css({height:0}).addClass("emb-selected").animate({height:i},e,"easeOutQuad",function(){t.css({height:"auto"}),n()})},leave:function(t,n){t.animate({height:0},e,"easeOutQuad",function(){t.removeClass("emb-selected").hide().css({height:"auto"}),n()})}}}return e.animation(".emb-accordion-item",n),n}),define("modules/emailbuilder/animations/sidebar",["modules/emailbuilder/module","modules/emailbuilder/animations/sidebarAccordion","vendor/jquery.easing"],function(e,t,n){function i(e,t,n){var i,o;"ng-hide"===t?(i=e.width()-10,e.animate({left:0-i},function(){n(),e.addClass("emb-closed")})):"emb-hovered"===t&&e.hasClass("emb-closed")?(o=e.width()-26,e.stop().animate({left:0-o},200,"easeOutQuad",function(){n()})):n()}function o(e,t,n){var i;"ng-hide"===t?(e.removeClass("emb-closed"),e.animate({left:0},n)):"emb-hovered"===t&&e.hasClass("emb-closed")?(i=e.width()-10,e.stop().animate({left:0-i},200,"easeOutQuad",function(){n()})):n()}function r(){return{addClass:i,removeClass:o}}return e.animation(".emb-sidebar-anim",r),r}),define("vendor/text!modules/emailbuilder/templates/imageProperties.html",[],function(){return'<section class="emb-js-property-pane hmb-image-sidebar emb-pane emb-reset" ng-show="editor == \'image\'">\r\n    <form name="form-image-properties" novalidate="novalidate" ng-submit="close()" class="l-sidebar-inner">\r\n        <h2 class="c-sidebar__heading-primary hmb-empty">\r\n            <span ng-show="active.content.state.initial">Add an image</span>\r\n            <span ng-show="active.content.state.fileUploaded || active.content.state.thirdPartyUrl || active.content.state.thirdPartyUrlError || active.content.state.thirdPartyUrlTyping">Edit image</span>\r\n            <span ng-show="active.content.state.uploading">Uploading&hellip;</span>\r\n        </h2>\r\n        <div class="sidebar__accordion-item">\r\n            <div class="sidebar__form--accordion">\r\n                <header class="p hmb-empty">\r\n                    <div emb-uploader></div>\r\n                </header>\r\n                <div class="l-gap--bottom-small" ng-show="!active.content.state.fileUploaded && !active.content.state.uploading && thirdPartyImagesEnabled" ng-class="{ \'l-gap--top-medium\': !active.content.state.fileUploaded && thirdPartyImagesEnabled, \'l-gap--bottom-medium\': imageFlexibilityEnabled }">\r\n                    <span class="u-separator-text" ng-show="active.content.state.initial">OR</span>\r\n                    <label class="c-sidebar__label ">Enter image URL</label>\r\n                    <input class="c-input" emb-sync-href="active.content" targetModel="thirdPartyUrl" ng-model="active.content.tempThirdPartyUrl" cs-valid-url name="thirdPartyUrl" type="text" placeholder="http://" emb-save-on-model-change />\r\n                </div>\r\n                <section class="emb-secondary-container">\r\n                    <hr class="c-sidebar__rule" ng-if="imageFlexibilityEnabled">\r\n                    <ul role="tablist" class="l-grid l-grid--inline-block l-grid--vertical-spacing" ng-class="{ \'hmb-secondary-actions\' : !active.content.state.initial, \'hmb-secondary-actions u-hide-all\' : active.content.state.initial, \'hmb-top-override\' : !active.content.state.fileUploaded && !active.content.state.uploading && thirdPartyImagesEnabled }" style="width: 100%">\r\n                        <li role="presentation" class="l-grid__item l-grid__item--100" ng-if="imageFlexibilityEnabled">\r\n                            <div class="c-slider">\r\n                                <label class="c-sidebar__label">Image size</label>\r\n                                <div class="c-sidebar__label c-sidebar__label--slider">\r\n                                    <div emb-image-dimensions="email.header.width" emb-image-dimensions-slave="email.header.height" emb-image-dimensions-numerator="email.header.originalHeight" emb-image-dimensions-denominator="email.header.originalWidth"></div>\r\n                                </div>\r\n                                <div cs-slider="email.header.width" cs-slider-min="10" cs-slider-max="maxLogoWidth" ng-model="email.header.width" ng-model-options="{ debounce: 100}" emb-save-on-model-change></div>\r\n                            </div>\r\n                        </li>\r\n                        <li role="presentation" class="l-grid__item l-grid__item--100">\r\n                            <label class="c-sidebar__label ">Link <span class="c-sidebar__label--optional">(optional)</span></label>\r\n                            <input class="c-input" emb-sync-href="active.content" ng-model="active.content.tempHref" cs-valid-url name="href" type="text" placeholder="http://" emb-save-on-model-change/>\r\n                        </li>\r\n                        <li role="presentation" class="l-grid__item l-grid__item--100">\r\n                            <label class="c-sidebar__label ">Alt text</label>\r\n                            <input class="c-input" name="alt" ng-model="active.content.alt" type="text" emb-save-on-model-change/>\r\n                        </li>\r\n                        <li role="presentation" class="l-grid__item l-grid__item--100" ng-show="configurableWidth"\r\n                        ng-if="canEditStyles">\r\n                            <label class="c-sidebar__label">Alignment</label>\r\n                            <div class="l-grid enhance-flex l-fixed--align hmb-js-horizontal-alignment emb-segmented-buttons emb-alignment" ng-model="active.content.halign" emb-select-group emb-save-on-model-change>\r\n                                <button data-value="left" class="l-grid__item emb-btn emb-align-left">\r\n                                    <div class="c-segmented-control__icon-container">\r\n                                        <span class="c-segmented-control__icon"></span>\r\n                                    </div>\r\n                                </button>\r\n                                <button data-value="center" class="l-grid__item emb-btn emb-align-horizontal-middle">\r\n                                    <div class="c-segmented-control__icon-container">\r\n                                        <span class="c-segmented-control__icon"></span>\r\n                                    </div>\r\n                                </button>\r\n                                <button data-value="right" class="l-grid__item emb-btn emb-align-right">\r\n                                    <div class="c-segmented-control__icon-container">\r\n                                        <span class="c-segmented-control__icon"></span>\r\n                                    </div>\r\n                                </button>\r\n                            </div>\r\n                        </li>\r\n                        <li role="presentation" class="l-grid__item l-grid__item--100" ng-show="canEditStyles">\r\n                            <div class="checkbox-options" cs-checkbox ng-model="addSpacing" label="Add image spacing" emb-save-on-model-change></div>\r\n                        </li>\r\n                    </ul>\r\n                    <hr class="c-sidebar__rule" ng-if="imageFlexibilityEnabled" ng-class="{ \'l-offset--top-large\': !configurableWidth }">\r\n                    <ul role="tablist" class="l-grid l-grid--inline-block l-grid--vertical-spacing" ng-if="imageFlexibilityEnabled">\r\n                        <li role="presentation" class="l-grid__item l-grid__item--100">\r\n                            <div class="l-grid l-grid--gutter">\r\n                                <div class="l-grid__item l-grid__item--50">\r\n                                    <label class="c-sidebar__label">Horizontal spacing</label>\r\n                                    <div cs-dropdown="languages" ng-model="email.language" cs-dropdown-class="l-select-container--image-spacing" emb-save-on-model-change></div>\r\n                                </div>\r\n                                <div class="l-grid__item l-grid__item--50">\r\n                                    <label class="c-sidebar__label">Vertical spacing</label>\r\n                                    <div cs-dropdown="languages" ng-model="email.language" cs-dropdown-class="l-select-container--image-spacing" emb-save-on-model-change></div>\r\n                                </div>\r\n                            </div>\r\n                        </li>\r\n                    </ul>\r\n                </section>\r\n            </div>\r\n        </div>\r\n    </form>\r\n    <footer class="hmb-dismiss-container">\r\n        <input type="submit" value="Done editing" class="c-button c-button--primary c-button--large" ng-click="close()">\r\n    </footer>\r\n</section>'}),define("modules/emailbuilder/directives/imageProperties",["vendor/angular","config","modules/emailbuilder/module","ts/modules/emailbuilder/services/email","modules/emailbuilder/services/itemWidth","vendor/text!modules/emailbuilder/templates/imageProperties.html","ts/modules/emailbuilder/services/lockLevelSvc"],function(e,t,n,i,o,r,s){function a(e){this.addSpacing=!e.isFullWidth,this.src=e.hasSrc()?e.getSrc():""}function l(e,t){var n=e.getBlockWidth(t);this.configurableWidth=t.hasSrc()&&t.tempWidth<n&&!t.state.thirdPartyUrlError}function c(e){e.addSpacing=!1,e.configurableWidth=!1,e.thirdPartyImagesEnabled=t.canvasThirdPartyImageUrlEnabled,e.imageFlexibilityEnabled=t.canvasImageFlexibility&&t.email.isBlueprint}function u(e,t,n,i){return{restrict:"E",replace:!0,template:r,link:function(o){c(o);var r=new d;e.$on("content:activated",function(s,c){var u=c.block;if(u.hasOwnProperty("type")&&"image"===u.type){var d=u.tempContainer,m=i.getLocks(o.email.sections[d.section].permissions);o.canEditStyles=m.canEditContentItemStyles,o.canDelete=m.canDeleteContentItems,a.call(o,u),l.call(o,n,u),r.add(o.$watch("addSpacing",function(){u.isFullWidth=!o.addSpacing;var e=o.email.sections[d.section].content[d.column];t.dropzoneHasPadding(e)})),r.add(o.$watch("active.content.tempWidth",function(){l.call(o,n,u)})),r.add(o.$watch("active.content.getSrc()",function(){u.hasSrc()||e.$broadcast("image:deleted",{block:u})}))}}),e.$on("content:deactivated",r.clear),e.$on("content:replaced",r.clear)}}}function d(){var e=[],t=function(t){e.push(t)},n=function(){for(var t=0;t<e.length;t++)e[t]&&e[t]();e=[]};return{add:t,clear:n}}n.directive("embImageProperties",["$rootScope","EmailSvc","ItemWidthSvc","LockLevelSvc",u])}),define("vendor/text!modules/emailbuilder/templates/buttonProperties.html",[],function(){return'<section class="emb-js-property-pane emb-pane emb-reset emb-button-properties" ng-show="editor == \'button\'">\r\n    <form name="contentFormButton" novalidate="novalidate" ng-submit="close()" bindonce="buttonStyleAppearanceEnabled && buttonFlexibilityEnabled" class="l-sidebar-inner">\r\n        <h2 class="c-sidebar__heading-primary">Edit button</h2>\r\n        <div class="sidebar__accordion-item">\r\n            <div class="sidebar__form--accordion">\r\n                <ul role="tablist" class="l-grid l-grid--inline-block l-grid--vertical-spacing">\r\n                    <li role="presentation" class="l-grid__item l-grid__item--100">\r\n                        <label class="c-sidebar__label" for="emb-form-btn-text">Button text</label>\r\n\r\n                        <input class="c-input" cs-focus="editor == \'button\' && !showContent && !contentFormButton.btnLink.focused && (active.content.tempIsNew || contentFormButton.btnTxt.$invalid || contentFormButton.btnLink.$valid)"\r\n                               select-when="Text here"\r\n                               ng-focus="contentFormButton.btnTxt.focused = true"\r\n                               ng-blur="contentFormButton.btnTxt.focused = false"\r\n                               ng-model="active.content.text"\r\n                               emb-save-on-model-change\r\n                               ng-required="true"\r\n                               id="emb-form-btn-text"\r\n                               name="btnTxt" type="text" />\r\n                    </li>\r\n\r\n                    <li role="presentation" class="l-grid__item l-grid__item--100">\r\n                        <label class="c-sidebar__label" for="emb-form-btn-url">Button link</label>\r\n                        <input class="ng-dirty c-input"\r\n                               cs-focus="editor == \'button\' && !showContent && !active.content.tempIsNew && contentFormButton.btnTxt.$valid && !contentFormButton.btnTxt.focused && contentFormButton.btnLink.$invalid"\r\n                               emb-sync-href="active.content"\r\n                               ng-focus="contentFormButton.btnLink.focused = true"\r\n                               ng-blur="contentFormButton.btnLink.focused = false"\r\n                               ng-change="active.content.tempIsNew = false"\r\n                               ng-model="active.content.tempHref"\r\n                               emb-save-on-model-change\r\n                               ng-required="true"\r\n                               cs-valid-url\r\n                               name="btnLink"\r\n                               id="emb-form-btn-url"\r\n                               type="text"\r\n                               placeholder="http://" />\r\n                    </li>\r\n\r\n                    <!-- NEW BUTTON STYLES AFTER BUTTON FLEXIBILITY IS SWITCHED ON (The Blueprint only) -->\r\n\r\n                    <li role="presentation" class="l-grid__item l-grid__item--100 c-segmented-control--button-size" bo-if="buttonSizeAppearanceEnabled"\r\n                        ng-if="canEditStyles">\r\n                        <cm-segmented-control group-name="button-size"\r\n                                              group-legend="Button size"\r\n                                              group-class-name="c-segmented-control--button-size"\r\n                                              on-select="onButtonSizeChange(prevValue, newValue)"\r\n                                              ng-model="active.content.buttonSize"\r\n                                              emb-save-on-model-change>\r\n                            <cm-segmented-control-item item-value="small"\r\n                                                       segment-id="small"\r\n                                                       class-names="c-segmented-control--button-size-small"\r\n                                                       is-default>\r\n                            </cm-segmented-control-item>\r\n                            <cm-segmented-control-item item-value="medium"\r\n                                                       segment-id="medium"\r\n                                                       class-names="c-segmented-control--button-size-medium">\r\n                            </cm-segmented-control-item>\r\n                            <cm-segmented-control-item item-value="large"\r\n                                                       segment-id="large"\r\n                                                       class-names="c-segmented-control--button-size-large">\r\n                            </cm-segmented-control-item>\r\n                        </cm-segmented-control>\r\n                    </li>\r\n\r\n                    <li role="presentation" class="l-grid__item l-grid__item--100 c-segmented-control--button-properties" bo-if="buttonStyleAppearanceEnabled"\r\n                        ng-show="canEditStyles">\r\n                        <cm-segmented-control group-name="button-style-appearance"\r\n                                              group-legend="Button style"\r\n                                              group-class-name="c-segmented-control--button-style"\r\n                                              on-select="onButtonStyleAppearanceChange(prevValue, newValue)"\r\n                                              ng-model="active.content.buttonStyleAppearance"\r\n                                              emb-save-on-model-change>\r\n                            <cm-segmented-control-item item-value="flat"\r\n                                                       segment-id="flat"\r\n                                                       class-names="c-segmented-control--button-style-flat"\r\n                                                       is-default>\r\n                            </cm-segmented-control-item>\r\n                            <cm-segmented-control-item item-value="shadow"\r\n                                                       segment-id="shadow"\r\n                                                       class-names="c-segmented-control--button-style-shadow">\r\n                            </cm-segmented-control-item>\r\n                            <cm-segmented-control-item item-value="depth"\r\n                                                       segment-id="depth"\r\n                                                       class-names="c-segmented-control--button-style-depth">\r\n                            </cm-segmented-control-item>\r\n                            <cm-segmented-control-item item-value="ghost"\r\n                                                       segment-id="ghost"\r\n                                                       class-names="c-segmented-control--button-style-ghost">\r\n                            </cm-segmented-control-item>\r\n                        </cm-segmented-control>\r\n                    </li>\r\n\r\n                    <!-- BUTTON CORNERS AND ALIGNMENT AFTER BUTTON FLEXIBILITY IS SWITCHED ON -->\r\n\r\n                    <li role="presentation" class="l-grid__item l-grid__item--100"\r\n                        bo-if="buttonFlexibilityEnabled"\r\n                        ng-show="canEditStyles">\r\n                        <div class="l-grid l-grid--gutter">\r\n                            <div class="l-grid__item l-grid__item--50">\r\n                                <cm-segmented-control group-name="button-border-radius"\r\n                                                      group-legend="Corner"\r\n                                                      group-class-name="c-segmented-control--button-corner-style"\r\n                                                      ng-model="active.content.borderRadius"\r\n                                                      on-select="onButtonBorderRadiusChange(active.content.borderRadius)"\r\n                                                      emb-save-on-model-change>\r\n                                    <cm-segmented-control-item group-name="button-corner"\r\n                                                               item-value="0"\r\n                                                               segment-id="corner-square"\r\n                                                               class-names="c-segmented-control--button-corner-square">\r\n                                    </cm-segmented-control-item>\r\n                                    <cm-segmented-control-item group-name="button-corner"\r\n                                                               item-value="{{borderRadiusForRoundedButtonCorners}}"\r\n                                                               segment-id="corner-round"\r\n                                                               class-names="c-segmented-control--button-corner-round"\r\n                                                               is-default>\r\n                                    </cm-segmented-control-item>\r\n                                </cm-segmented-control>\r\n                            </div>\r\n                            <div class="l-grid__item l-grid__item--50">\r\n                                <cm-segmented-control group-name="button-alignment"\r\n                                                      group-legend="Alignment"\r\n                                                      group-class-name="c-segmented-control--button-alignment"\r\n                                                      ng-model="active.content.halign"\r\n                                                      on-select="onButtonAlignmentChange(active.content.halign)"\r\n                                                      emb-save-on-model-change>\r\n                                    <cm-segmented-control-item group-name="button-alignment"\r\n                                                               item-value="left"\r\n                                                               segment-id="align-left"\r\n                                                               class-names="c-segmented-control--button-align-left">\r\n                                    </cm-segmented-control-item>\r\n                                    <cm-segmented-control-item group-name="button-alignment"\r\n                                                               item-value="center"\r\n                                                               segment-id="align-center"\r\n                                                               class-names="c-segmented-control--button-align-center">\r\n                                    </cm-segmented-control-item>\r\n                                    <cm-segmented-control-item group-name="button-alignment"\r\n                                                               item-value="right"\r\n                                                               segment-id="align-right"\r\n                                                               class-names="c-segmented-control--button-align-right">\r\n                                    </cm-segmented-control-item>\r\n                                    <cm-segmented-control-item group-name="button-alignment"\r\n                                                               item-value="full"\r\n                                                               segment-id="align-full"\r\n                                                               class-names="c-segmented-control--button-align-full">\r\n                                    </cm-segmented-control-item>\r\n                                </cm-segmented-control>\r\n                            </div>\r\n                        </div>\r\n                    </li>\r\n\r\n                    <!-- BUTTON COLOR AND TEXT COLOR BEFORE BUTTON FLEXIBILITY IS SWITCHED ON -->\r\n\r\n                    <li role="presentation" class="l-grid__item l-grid__item--100"\r\n                        bo-if="!buttonFlexibilityEnabled"\r\n                        ng-show="canEditStyles">\r\n                        <label class="c-sidebar__label">Button color</label>\r\n                        <div class="c-colorpicker ff-colorpicker--recent c-colorpicker--light c-colorpicker--input">\r\n                            <div cs-color-selector cs-color-selector-upward-class="emb-upward" cs-viewport="#emb-js-sidebar" ng-model="active.content.tempBackgroundColor" emb-save-on-model-change></div>\r\n                        </div>\r\n                    </li>\r\n                    <li role="presentation" class="l-grid__item l-grid__item--100"\r\n                        bo-if="!buttonFlexibilityEnabled"\r\n                        ng-show="canEditStyles">\r\n                        <label class="c-sidebar__label">Text color</label>\r\n                        <div class="c-colorpicker ff-colorpicker--recent c-colorpicker--light c-colorpicker--input">\r\n                            <div cs-color-selector cs-color-selector-upward-class="emb-upward" cs-viewport="#emb-js-sidebar" ng-model="active.content.tempTextColor" emb-save-on-model-change></div>\r\n                        </div>\r\n                    </li>\r\n\r\n                    <li role="presentation" class="l-grid__item l-grid__item--100"\r\n                        bo-if="!buttonFlexibilityEnabled"\r\n                        ng-show="canEditStyles">\r\n                        <label class="c-sidebar__label">Alignment</label>\r\n                        <div class="l-grid enhance-flex l-fixed--align hmb-js-horizontal-alignment emb-segmented-buttons emb-alignment" ng-click="onButtonAlignmentChange(active.content.halign)" ng-model="active.content.halign" emb-select-group emb-save-on-model-change>\r\n                            <button data-value="left" class="l-grid__item emb-btn emb-align-left">\r\n                                <div class="c-segmented-control__icon-container">\r\n                                    <span class="c-segmented-control__icon"></span>\r\n                                </div>\r\n                            </button>\r\n                            <button data-value="center" class="l-grid__item emb-btn emb-align-horizontal-middle">\r\n                                <div class="c-segmented-control__icon-container">\r\n                                    <span class="c-segmented-control__icon"></span>\r\n                                </div>\r\n                            </button>\r\n                            <button data-value="right" class="l-grid__item emb-btn emb-align-right">\r\n                                <div class="c-segmented-control__icon-container">\r\n                                    <span class="c-segmented-control__icon"></span>\r\n                                </div>\r\n                            </button>\r\n                        </div>\r\n\r\n                    </li>\r\n\r\n                    <!-- BUTTON FONT AND TEXT COLOR AFTER BUTTON FLEXIBILITY IS SWITCHED ON -->\r\n\r\n                    <li role="presentation" class="l-grid__item l-grid__item--100"\r\n                        bo-if="buttonFlexibilityEnabled"\r\n                        ng-show="canEditStyles">\r\n                        <label class="c-sidebar__label">Text style</label>\r\n                        <div class="c-colorpicker ff-colorpicker--recent c-colorpicker--light c-colorpicker--select">\r\n                            <div cs-color-selector cs-color-selector-upward-class="emb-upward" cs-viewport="#emb-js-sidebar" ng-model="active.content.tempTextColor" emb-save-on-model-change></div>\r\n                            <!-- ng-model needs to be different (for the actual button) -->\r\n                            <div cs-dropdown-class="l-select-container--font-family" cs-dropdown="email.config.availableFonts" cs-child cs-dropdown-on-change="onSelectedFontFamilyChange(value, display)" ng-model="active.content.fontFamily" emb-save-on-model-change></div>\r\n                        </div>\r\n                    </li>\r\n\r\n                    <!-- BUTTON COLOR AFTER BUTTON FLEXIBILITY IS SWITCHED ON -->\r\n\r\n                    <li role="presentation" class="l-grid__item l-grid__item--100"\r\n                        bo-if="buttonFlexibilityEnabled"\r\n                        ng-show="canEditStyles">\r\n                        <label class="c-sidebar__label">Color</label>\r\n                        <div class="c-colorpicker ff-colorpicker--recent c-colorpicker--light c-colorpicker--input">\r\n                            <div cs-color-selector cs-color-selector-upward-class="emb-upward" cs-viewport="#emb-js-sidebar" ng-model="active.content.tempBackgroundColor" emb-save-on-model-change></div>\r\n                        </div>\r\n                    </li>\r\n                </ul>\r\n                <p bo-if="buttonStyleAppearanceEnabled" class="c-sidebar__text l-gap--top-medium" ng-show="canEditStyles">Some email clients may display buttons differently. We recommend testing before sending your campaign.</p>\r\n            </div>\r\n        </div>\r\n    </form>\r\n    <footer class="hmb-dismiss-container">\r\n        <input type="submit" value="Done editing" class="c-button c-button--primary c-button--large" ng-click="close()">\r\n    </footer>\r\n</section>';
}),define("modules/emailbuilder/directives/buttonProperties",["config","vendor/angular","modules/emailbuilder/module","vendor/text!modules/emailbuilder/templates/buttonProperties.html","ts/modules/emailbuilder/services/lockLevelSvc"],function(e,t,n,i,o){function r(t){t.buttonFlexibilityEnabled=e.buttonFlexibilityEnabled,t.buttonSizeAppearanceEnabled=t.buttonFlexibilityEnabled&&e.buttonSizeEnabled,t.buttonStyleAppearanceEnabled=t.buttonFlexibilityEnabled&&e.email.isBlueprint,t.borderRadiusForRoundedButtonCorners=e.settings.borderRadiusForRoundedButtonCorners,t.onButtonAlignmentChange=function(e){t.active&&t.active.content&&t.active.content.updateButtonAlignment&&t.active.content.updateButtonAlignment(e)},e.buttonFlexibilityEnabled&&(t.onButtonBorderRadiusChange=function(e){t.active&&t.active.content&&t.active.content.updateButtonBorderRadius&&t.active.content.updateButtonBorderRadius(e)},t.onSelectedFontFamilyChange=function(e,n){t.active&&t.active.content&&t.active.content.updateFontFamilyInlineStyle&&t.active.content.updateFontFamilyInlineStyle(e)},t.onButtonSizeChange=function(e,n){t.active&&t.active.content&&t.active.content.buttonSizeChanged&&t.active.content.buttonSizeChanged(e,n)},t.onButtonStyleAppearanceChange=function(e,n){t.active&&t.active.content&&t.active.content.buttonStyleAppearanceChanged&&t.active.content.buttonStyleAppearanceChanged(e,n)})}function s(e,t){return{restrict:"E",replace:!0,template:i,link:function(n,i,o){r(n),e.$on("content:activated",function(e,i){var o=i.block;if(o.hasOwnProperty("type")&&"button"===o.type){var r=t.getLocks(n.email.sections[o.tempContainer.section].permissions);n.canEditStyles=r.canEditContentItemStyles}});var s=function(){};e.$on("content:deactivated",s),e.$on("content:replaced",s)}}}n.directive("embButtonProperties",["$rootScope","LockLevelSvc",s])}),define("modules/emailbuilder/directives/validUrl",["modules/emailbuilder/module","modules/shared/fnutils","modules/emailbuilder/services/validation"],function(e,t,n){function i(e,t){var n=e.variable.isValid(t),i=e.url.isValid(t),o=e.email.isValid(t),r="",s="";if(this.raw=t,this.display=t,o){this.isValid=!0,this.isEmail=!0;var a=t.match(e.email.regExp);s=a[1],r="mailto:",s?this.display=a[2]:t=r+t}else if(i){this.isValid=!0,this.isEmail=!1;var l=t.match(e.url.regExp);s=l[1],r="http://","//"===t.substring(0,2)?this.display=l[0]:s?this.display=l[4]:t=r+t}else n?(this.isValid=!0,this.isEmail=!1):this.isValid=!1;this.href=t}function o(e){return{require:"ngModel",link:function(n,o,r,s){function a(e){var t;if(e)return t=e.isValid||!e.raw&&!r.required,s.$setValidity("url",t),t}var l=t.debounce(a,250);s.$parsers.push(function(t){var n=new i(e,t||""),o=!s.$modelValue;return(o?a:l)(n),n}),s.$formatters.push(function(e){return e?(a(e),e.raw):e}),o.on("blur",function(){var e;a(s.$modelValue),e=s.$modelValue&&s.$modelValue.raw?s.$modelValue.raw:"",s.$setViewValue(e)})}}}function r(e){this.valSrv=e}r.prototype.getModelFor=function(e){return new i(this.valSrv,e)},e.directive("csValidUrl",["ValidationSrv",o]),e.service("csLinkModelProvider",["ValidationSrv",r])}),define("modules/emailbuilder/directives/fileUpload",["vendor/angular","modules/emailbuilder/module","modules/emailbuilder/services/browser","modules/emailbuilder/services/imageManager"],function(e,t,n,i){function o(e){e&&e.tempValidation&&(e.tempValidation=null)}function r(e,t,n,i){var o=t?n[0].files[0]:n;e.uploadAsync({file:o,block:function(){return i}})}t.directive("embFileUpload",["BrowserSrv","ImageManagerSrv",function(t,n){return{restrict:"A",replace:!1,scope:{file:"="},link:function(i,s,a){var l=t.current.supports.html5UploadWithProgress(),c=e.bind(i,r,n,l,s),u=e.bind(i,o);s.bind("change",function(){""!==s.val()&&(u(i.file),c(i.file))})}}}])}),define("modules/emailbuilder/directives/syncHref",["vendor/angular","modules/emailbuilder/module"],function(e,t){function n(e){return{restrict:"A",scope:{embSyncHref:"="},priority:100,link:function(t,n,i){var o=i.targetmodel||"href",r="temp"+o[0].toUpperCase()+o.substring(1);t.$watch("embSyncHref."+r+".raw",function(e){void 0!==e&&(t.embSyncHref[o]=e)}),t.$watch("embSyncHref",function(n){n&&!t.embSyncHref[r]&&(t.embSyncHref[r]=e.getModelFor(n[o]||""))})}}}t.directive("embSyncHref",["csLinkModelProvider",n])}),define("modules/emailbuilder/directives/saveModel",["modules/emailbuilder/module"],function(e){function t(e){return{require:"ngModel",link:function(t,n,i,o){o.$viewChangeListeners.push(e.contentUpdated.bind(e))}}}e.directive("embSaveOnModelChange",["ModelActivity",t])}),define("modules/emailbuilder/directives/updateStyle",["vendor/angular","config","modules/emailbuilder/module","vendor/less-2.5.1"],function(e,t,n,i){function o(e){var t=e.substring(s.length);return"@"+t.replace(/\./g,"-")}function r(n,i,r,l){return{require:"ngModel",link:function(c,u,d,m){if(0!==d.ngModel.indexOf(s))throw"We only expect properties starting with "+s;var p={},h=function(){var e={},t=o(d.ngModel);e[t]=m.$viewValue,n.update(e)},f=function(){var t=d.ngModel.split(".").pop(),n=t.toLowerCase().indexOf("color")>-1;if(e.element(d.embUpdateStyle).css(t,(n?"#":"")+m.$viewValue),d.embUpdateStyleColorFunctions&&n)for(var o=i(d.embUpdateStyleColorFunctions)(c),s=0;s<o.length;s++){var u=o[s],f=a[u.lessFunction](m.$viewValue);e.element(u.cssSelector).css(u.cssProperty,f),l.$emit("backgroundColor:changed",m.$viewValue)}p[d.ngModel]&&r.cancel(p[d.ngModel]),p[d.ngModel]=r(function(){h()},1e3)},g=t.email.isBlueprint&&d.embUpdateStyle?f:h;m.$viewChangeListeners.push(g)}}}var s="email.styles.",a={darken:function(e){var t=new i.tree.Color(e),n=new i.tree.Value(20),o=i.functions.functionRegistry.get("darken"),r=o(t,n),s=r.toRGB();return s},mix:function(e){var t=new i.tree.Color(e),n=new i.tree.Color("000000"),o=new i.tree.Value(50),r=i.functions.functionRegistry.get("mix"),s=r(t,n,o),a=s.toRGB();return a}};n.directive("embUpdateStyle",["DynamicStylesSrv","$parse","$timeout","$rootScope",r])}),define("modules/emailbuilder/directives/selectGroup",["vendor/angular","modules/emailbuilder/module"],function(e,t){function n(){return{restrict:"A",replace:!1,require:"ngModel",link:function(t,n,i,o){var r,s=n.children("[data-value]");o.$render=function(){r&&r.removeClass("emb-selected"),r=s.filter('[data-value="'+o.$modelValue+'"]').addClass("emb-selected")},s.on("click",function(t){if(t.preventDefault(),r){if(r.is(this))return;r.removeClass("emb-selected")}r=e.element(this).addClass("emb-selected"),o.$setViewValue(r.data("value"))})}}}t.directive("embSelectGroup",n)}),define("modules/emailbuilder/directives/customScroll",["vendor/jquery.nicescroll","modules/emailbuilder/module"],function(e,t){function n(){return{restrict:"A",link:function(e,t){if("Win32"===navigator.platform){t.niceScroll({autohidemode:!0,cursoropacitymin:.25,cursoropacitymax:.6,cursorcolor:"#000",cursorwidth:"8px",cursorborder:"2px solid transparent",cursorborderradius:"10px",grabcursorenabled:!1,zindex:998}),t.css("overflow-y","hidden");var n=t.getNiceScroll();e.$watch(function(){return t.is(":visible")},function(){n.resize()}),e.$on("$destroy",function(){var e=t.getNiceScroll();e.remove()})}else t.css("overflow-y","auto")}}}t.directive("csCustomScroll",[n])}),define("modules/emailbuilder/directives/updateElementIsDark",["vendor/angular","modules/emailbuilder/module"],function(e,t){function n(){return{require:"ngModel",scope:{selector:"@embUpdateElementIsDark",model:"=ngModel"},link:function(t,n,o){function r(e){var t,n,i,o,r=e;return r.match(/^rgb/)?(r=r.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/),t=r[1],n=r[2],i=r[3]):(r=+("0x"+r.replace(r.length<5&&/./g,"$&$&")),t=r>>16,n=r>>8&255,i=255&r),o=Math.sqrt(.299*(t*t)+.587*(i*i)+.114*(n*n)),o<172.5}if(0!==o.ngModel.indexOf(i))throw"We only expect properties starting with "+i;var s=e.element(t.selector);t.$watch("model",function(e){e&&s.toggleClass("emb-dark",r(e))})}}}var i="email.styles.";t.directive("embUpdateElementIsDark",[n])}),define("modules/emailbuilder/directives/toggleCustomiseOnlyElements",["vendor/angular","modules/emailbuilder/module"],function(e,t){function n(){return{restrict:"A",scope:{customiseIsChosen:"="},link:function(t,n,i){var o=e.element(".emb-stage");t.$watch("customiseIsChosen",function(e){o.toggleClass("customise-only-show",e)})}}}t.directive("toggleCustomiseOnlyElements",[n])}),define("vendor/text!modules/emailbuilder/templates/segments.html",[],function(){return'<form novalidate="novalidate" ng-submit="close()" class="segments">\r\n    <ol class="checkbox-options__list">\r\n        <li>\r\n            <div ng-show="!isAutoresponder" class="checkbox-options all-subscribers">\r\n                <input id="segments-all-subscribers"\r\n                       type="checkbox"\r\n                       class="checkbox-options__input"\r\n                       ng-change="allChanged(allSelected)"\r\n                       ng-model="allSelected"\r\n                       ng-disabled="!hasMultipleListsOrSegments && !targetingDeletedOnly"\r\n                       emb-save-on-model-change />\r\n                <label class="c-sidebar__label checkbox-options__label"\r\n                       for="segments-all-subscribers">All recipients</label>\r\n            </div>\r\n        </li>\r\n    </ol>\r\n    <p ng-if="!isAutoresponder && hasMultipleListsOrSegments" class="c-sidebar__text c-sidebar__text--heading">Or, the subscribers of:</p>\r\n    <p class="emb-help" ng-if="!isAutoresponder && !hasMultipleListsOrSegments">You need to create multiple lists or segments to start targeting sections of your email.</p>\r\n    <a href="#" class="c-sidebar__link" ng-click="allSelected=!allSelected;allChanged(allSelected)" ng-hide="(lists.length <= maxNumberOfListsToShowByDefault || !allSelected || isAutoresponder)">\r\n        {{lists.length}} lists\r\n    </a>\r\n    <ol class="checkbox-options__list" ng-if="(lists.length <= maxNumberOfListsToShowByDefault || !allSelected ) && (isAutoresponder || hasMultipleListsOrSegments)">\r\n        <li ng-repeat="list in lists">\r\n            <span class="checkbox-options">\r\n                <input type="checkbox"\r\n                       id="list-header-item-{{$index}}"\r\n                       class="checkbox-options__input"\r\n                       ng-change="listChanged(list.listId, list.selected)"\r\n                       ng-model="list.selected"\r\n                       ng-disabled="isAutoresponder && !list.segments.length && !targetingDeletedOnly"\r\n                       emb-save-on-model-change />\r\n                <label class="c-sidebar__label checkbox-options__label"\r\n                       for="list-header-item-{{$index}}">{{ trim(list.title) }}</label>\r\n            </span>\r\n            <ol class="checkbox-options__list" ng-if="list.segments">\r\n                <li ng-repeat="segment in list.segments">\r\n                    <input id="segment-{{$parent.$index}}-item-{{$index}}"\r\n                           type="checkbox"\r\n                           class="checkbox-options__input"\r\n                           ng-change="segmentChanged(segment.segmentId, segment.selected)"\r\n                           ng-model="segment.selected"\r\n                           emb-save-on-model-change />\r\n                    <label class="c-sidebar__label checkbox-options__label"\r\n                           for="segment-{{$parent.$index}}-item-{{$index}}">{{ trim(segment.title) }}</label>\r\n                </li>\r\n            </ol>\r\n        </li>\r\n        <p class="emb-help" ng-if="isAutoresponder && !lists[0].segments.length">You need to create segments within this list to start targeting sections of your email.</p>\r\n    </ol>\r\n</form>'}),define("ts/modules/emailbuilder/directives/segments",["vendor/angular","config","modules/emailbuilder/module","ts/modules/emailbuilder/services/email","modules/emailbuilder/services/textTrim","modules/emailbuilder/services/safeDigest","vendor/text!modules/emailbuilder/templates/segments.html"],function(e,t,n,i,o,r,s){function a(n,i,o){return{restrict:"E",replace:!0,template:s,scope:{section:"="},link:function(n,r,s){n.lists=e.copy(t.listsAndSegments),n.isAutoresponder=t.mode.autoresponder,n.hasMultipleListsOrSegments=t.hasMultipleListsOrSegments,n.maxNumberOfListsToShowByDefault=t.settings.maxNumberOfListsToShowByDefault;var a=function(e,t){return!e.length&&!t.length&&(n.section.lists&&n.section.lists.length||n.section.segments&&n.section.segments.length)},l=function(o){void 0===o&&(o=!1);var r=[],s=[];e.forEach(n.lists,function(t){t.selected&&r.push(t.listId),e.forEach(t.segments,function(e){e.selected&&s.push(e.segmentId)})}),o||(n.isAutoresponder||(n.section.lists=0===r.length?null:r),n.section.segments=0===s.length?null:s,i.setUsedDynamicContent()),n.targetingDeletedOnly=a(r,s),n.allSelected=!(n.targetingDeletedOnly||(r.length||s.length)&&t.hasMultipleListsOrSegments),n.allSelectedActive=(n.allSelected||n.targetingDeletedOnly)&&n.hasMultipleListsOrSegments,n.allSelected&&(n.section.lists=null,n.section.segments=null),!n.isAutoresponder||s.length||n.targetingDeletedOnly||(n.lists[0].selected=!0)},c=function(t){e.forEach(n.lists,function(n){t===n.listId&&e.forEach(n.segments,function(e){e.selected=!1})})},u=function(t){e.forEach(n.lists,function(n){e.forEach(n.segments,function(e){t===e.segmentId&&(n.selected=!1)})})},d=function(){var t=!1;e.forEach(n.lists[0].segments,function(e){if(e.selected)return void(t=!0)}),t||(n.lists[0].selected=!0)},m=function(){n.lists[0].segments[0].selected=!0};n.trim=function(e){return o.ellipsis(e,32)},n.listChanged=function(e,t){t?c(e):n.isAutoresponder&&m(),l()},n.segmentChanged=function(e,t){t?u(e):n.isAutoresponder&&d(),l()},n.allChanged=function(t){t?(e.forEach(n.lists,function(t){t.selected=!1,e.forEach(t.segments,function(e){e.selected=!1})}),l()):n.lists&&n.lists.length?(n.lists[0].selected=!0,l()):n.allSelected=!0},n.$watch("section",function(t){t&&(e.forEach(n.lists,function(n){n.selected=t.lists&&-1!==t.lists.indexOf(n.listId),e.forEach(n.segments,function(e){e.selected=t.segments&&-1!==t.segments.indexOf(e.segmentId)})}),l(!0))})}}}n.directive("embSegments",["$rootScope","EmailSvc","TextTrimSvc",a])}),define("vendor/text!modules/emailbuilder/templates/surveyProperties.html",[],function(){return'<section class="emb-js-property-pane emb-pane emb-reset emb-button-pane emb-button-properties" ng-show="editor == \'survey\'">\r\n    <form name="contentFormSurvey" novalidate="novalidate" ng-submit="close()">\r\n        <cm-popover></cm-popover>\r\n        <div class="l-sidebar-inner">\r\n            <h2 class="c-sidebar__heading-primary">Survey settings</h2>\r\n            <div class="sidebar__accordion-item">\r\n                <div class="sidebar__form--accordion">\r\n                    <div ng-if="!isConnectedToGetFeedback && !isIFramed">\r\n                        <cm-promo></cm-promo>\r\n                    </div>\r\n                    <div class="c-error c-error--no-arrow" ng-if="!isConnectedToGetFeedback && isIFramed">\r\n                        <h2 class="c-error__heading">Button settings not available</h2>\r\n                        <p class="c-error__message">Please recreate this button to access its settings.</p>\r\n                    </div>\r\n                    <div ng-show="isConnectedToGetFeedback && isPermittedToConnect">\r\n                        <div ng-show="isConnectedToGetFeedback">\r\n                            <p class="c-sidebar__text c-sidebar__text--settings">{{ ConnectedMessage }}<span class="integration__connect-details" title="{{ ConnectedAccountEmail }}">{{ ConnectedAccountName }}</span>. <a class="integration__link" href="#" ng-click="disconnect()">Disconnect</a></p>\r\n                        </div>\r\n                        <div ng-hide="isPermittedToConnect">\r\n                            <p class="c-sidebar__text c-sidebar__text--settings">Connect to GetFeedback to select or create an engaging and mobile-ready survey.</p>\r\n                            <button ng-disabled="true" class="c-button c-button--grey">Connect to GetFeedback</button>\r\n                            <div class="c-error c-error--connection c-error--no-arrow">\r\n                                <h2 class="c-error__heading">There was an error</h2>\r\n                                <p class="c-error__message">{{connectionErrorMessage}}</p>\r\n                            </div>\r\n                        </div>\r\n                        <div ng-class="{ \'is-connected\': isConnectedToGetFeedback, \'has-errors--connection\' : showConnectionErrorMessage }">\r\n                            <ul role="tablist" class="l-grid l-grid--inline-block l-grid--vertical-spacing">\r\n                                <li role="presentation" class="l-grid__item l-grid__item--100" ng-show="isConnectedToGetFeedback">\r\n                                    <input type="hidden" ng-model="active.content.surveyId" emb-save-on-model-change ng-change="setActive(active.content)" />\r\n                                    <label class="c-sidebar__label">Select or create a survey</label>\r\n                                    <div class="integration__select" ng-class="{\'is-inactive\': active.content.surveyId ===\'\', \'is-active\': active.content.surveyId!=\'\' }">\r\n                                        <span class="integration__select__label">\r\n                                            <a target="_blank" ng-href="{{active.content.previewUrl}}" class="integration__link" ng-init="setActive(active.content)">Preview</a> or <a ng-href="{{active.content.editUrl}}" target="_blank" class="integration__link">Edit</a> selected survey\r\n                                        </span>\r\n                                        <button class="integration__select__button" ng-click="openNewSurvey();$event.preventDefault();">New</button>\r\n                                    </div>\r\n                                    <div class="integration__select__gallery">\r\n                                        <div class="loading__inner" ng-show="surveyLoadingInProgress">\r\n                                            <span class="loading__inner__dot"></span>\r\n                                            <span class="loading__inner__dot"></span>\r\n                                            <span class="loading__inner__dot"></span>\r\n                                        </div>\r\n                                        <ul class="integration__select__list" ng-hide="surveyLoadingInProgress">\r\n                                            <li ng-repeat="surveyDetails in availableSurveys">\r\n                                                <div class="integration__select__list-item-container" aria-hidden="true" ng-click="active.content.surveyId !== surveyDetails.value ? setActive(surveyDetails) : setInactive(surveyDetails)" ng-class="{\'is-active\' : active.content.surveyId === surveyDetails.value}"\r\n                                                     emb-scroll-container-if="active.content.surveyId === surveyDetails.value" emb-scroll-container-offset="10" emb-scroll-container-parent="2">\r\n                                                    <div class="integration__select__list-item" ng-style="{ backgroundImage: \'url(\' + surveyDetails.thumbnail + \')\' }">\r\n                                                        <span class="integration__select__list-item-border" aria-hidden="true"></span>\r\n                                                        <span class="integration__select__list-item-icon" aria-hidden="true" ng-if="active.content.surveyId === surveyDetails.value"></span>\r\n                                                        {{surveyDetails.display}}\r\n                                                    </div>\r\n                                                </div>\r\n                                            </li>\r\n                                        </ul>\r\n                                    </div>\r\n                                </li>\r\n                                <li role="presentation" class="l-grid__item l-grid__item--100">\r\n                                    <label class="c-sidebar__label " for="emb-form-survey-btn-text">Button text</label>\r\n                                    <input cs-focus="editor == \'survey\' && !showContent && (active.content.tempIsNew || contentFormSurvey.surveyBtnTxt.$invalid)"\r\n                                           select-when="Text here"\r\n                                           ng-focus="contentFormSurvey.surveyBtnTxt.focused = true"\r\n                                           ng-blur="contentFormSurvey.surveyBtnTxt.focused = false"\r\n                                           ng-model="active.content.text"\r\n                                           emb-save-on-model-change\r\n                                           ng-required="true"\r\n                                           id="emb-form-survey-btn-text"\r\n                                           class="c-input"\r\n                                           name="surveyBtnTxt" type="text" />\r\n                                </li>\r\n                                <li role="presentation" class="l-grid__item l-grid__item--100">\r\n                                    <label class="c-sidebar__label">Button color</label>\r\n                                    <div class="c-colorpicker-container">\r\n                                        <div class="c-colorpicker c-colorpicker--light c-colorpicker--input">\r\n                                            <div cs-color-selector cs-color-selector-upward-class="emb-upward" cs-viewport="#emb-js-sidebar" ng-model="active.content.tempBackgroundColor" emb-save-on-model-change></div>\r\n                                        </div>\r\n                                    </div>\r\n                                </li>\r\n                                <li role="presentation" class="l-grid__item l-grid__item--100">\r\n                                    <label class="c-sidebar__label">Text color</label>\r\n                                    <div class="c-colorpicker-container">\r\n                                        <div class="c-colorpicker c-colorpicker--light c-colorpicker--input">\r\n                                            <div cs-color-selector cs-color-selector-upward-class="emb-upward" cs-viewport="#emb-js-sidebar" ng-model="active.content.tempTextColor" emb-save-on-model-change></div>\r\n                                        </div>\r\n                                    </div>\r\n                                </li>\r\n                                <li role="presentation" class="l-grid__item l-grid__item--100">\r\n                                    <label class="c-sidebar__label">Alignment</label>\r\n                                    <div class="l-grid l-grid--gutter">\r\n                                        <div class="l-grid__item l-grid__item--100">\r\n                                            <div class="l-grid enhance-flex l-fixed--align hmb-js-horizontal-alignment emb-segmented-buttons emb-alignment" ng-model="active.content.halign" emb-select-group emb-save-on-model-change>\r\n                                                <button data-value="left" class="l-grid__item emb-btn emb-align-left">\r\n                                                    <div class="c-segmented-control__icon-container">\r\n                                                        <span class="c-segmented-control__icon"></span>\r\n                                                    </div>\r\n                                                </button>\r\n                                                <button data-value="center" class="l-grid__item emb-btn emb-align-horizontal-middle">\r\n                                                    <div class="c-segmented-control__icon-container">\r\n                                                        <span class="c-segmented-control__icon"></span>\r\n                                                    </div>\r\n                                                </button>\r\n                                                <button data-value="right" class="l-grid__item emb-btn emb-align-right">\r\n                                                    <div class="c-segmented-control__icon-container">\r\n                                                        <span class="c-segmented-control__icon"></span>\r\n                                                    </div>\r\n                                                </button>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </li>\r\n                            </ul>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </form>\r\n    <footer class="hmb-dismiss-container">\r\n        <input type="submit" value="Done editing" class="c-button c-button--primary c-button--large" ng-click="close()">\r\n    </footer>\r\n</section>'}),define("modules/emailbuilder/directives/surveyProperties",["config","vendor/angular","underscore","modules/emailbuilder/module","modules/emailbuilder/services/getFeedbackConnector","modules/emailbuilder/services/getFeedbackMetrics","modules/emailbuilder/services/modelActivity","vendor/text!modules/emailbuilder/templates/surveyProperties.html"],function(e,t,n,i,o,r,s,a){function l(){var e;return null!==x?x:(e=t.element("html"),x=e&&e.hasClass("ie9"))}function c(e,t){e.surveyListErrorMessage="The survey that was selected has changed or is no longer available. Please select another one.",e.showSurveyListErrorMessage=!0,e.active.content.href=null,e.active.content.surveyTitle=null,e.active.content.surveyId=null,e.active.content.previewUrl=null,e.active.content.editUrl=null,t.contentUpdated.call(t)}function u(e,t){t.display!==e.active.content.surveyTitle&&(e.active.content.surveyTitle=t.display)}function d(e,t){var i,o=e.active&&e.active.content;if(o&&(i=e.active.content.surveyId)){var r=n.find(e.availableSurveys,function(e){return e.value===i});r?u(e,r):c(e,t)}}function m(e){var t;return n.each(S,function(n){n.errorSearchRegex.test(e)&&(t=n.friendlyMessageReplacement)}),t||e}function p(e,t){var n=t.ConnectedAccountName&&t.ConnectedAccountName.length;t.ConnectedAccountEmail&&t.ConnectedAccountEmail.length;e.isConnectedToGetFeedback=!0,e.ConnectedAccountName=t.ConnectedAccountName,e.ConnectedAccountEmail=t.ConnectedAccountEmail,e.ConnectedMessage=n?"Currently connected to the GetFeedback account of ":"Currently connected to your GetFeedback account."}function h(e,t){e.isConnectedToGetFeedback=!1,e.surveyLoadingInProgress=!1,e.currentConnectionTitle="Connection error ",e.connectionErrorMessage=t?m(t[0]):"An error occurred connecting to GetFeedback. Please try again in a few minutes.",e.showConnectionErrorMessage=!0}function f(e,t){e.surveyLoadingInProgress=!1,e.surveyListErrorMessage=t?t[0]:"An error occurred retrieving your list of surveys. We will try again shortly.",e.showSurveyListErrorMessage=!0}function g(e){e.isConnectedToGetFeedback=!1,e.currentConnectionTitle="",e.surveyLoadingInProgress=!1}function v(e){}function b(e){e&&e()}function y(e,n,i,o){function r(n){if(e.connectionInProgress=!1,e.surveyLoadingInProgress=!1,!n.data.Data)return h(e),void b(o);if(n.data.Data.NoTokenAvailable||!e.isConnectedToGetFeedback)return e.surveyLoadingInProgress=!1,void b(o);if(n.data.Data.NotPermitted)return e.isPermittedToConnect=!1,h(e,[n.data.Data.Message]),void b(o);if(!n.data.Data.IsSuccessful)return h(e,[n.data.Data.Message]),void b(o);if(n.data.Data.IsSuccessful&&0===n.data.Data.Surveys.length)return p(e,n.data.Data),e.availableSurveys=[],f(e,["You have not created any surveys in GetFeedback yet."]),void b(o);if(n.data.Data.IsSuccessful){p(e,n.data.Data);var r=[];return t.forEach(n.data.Data.Surveys,function(e){r.push({display:e.display,value:e.value,thumbnail:e.thumbnail,href:e.href,editUrl:e.editUrl,previewUrl:e.previewUrl})}),e.availableSurveys=r,d(e,i),void b(o)}}function s(t){e.connectionInProgress=!1,e.surveyLoadingInProgress=!1,e.isConnectedToGetFeedback&&h(e),b(o)}return l()?(e.isPermittedToConnect=!1,h(e,["To connect to GetFeedback, please update your browser. You'll need to download the latest version of Chrome, Firefox, or Internet Explorer."]),void b(o)):(e.isConnectedToGetFeedback||(e.connectionInProgress=!0),e.surveyLoadingInProgress=!0,e.connectionErrorMessage=null,e.showConnectionErrorMessage=!1,e.surveyListErrorMessage=null,e.showSurveyListErrorMessage=!1,void n.loadSurveys().then(r).catch(s))}function w(e){var t=e.active&&e.active.content&&e.active.content.href&&e.active.content.href.length>"https://www.getfeedback.com/".length;e.connectionPrompt=t?"To change the selected survey, first connect to GetFeedback.":"Connect to GetFeedback to select or create an engaging and mobile-ready survey."}function k(n,i,o,r,s,a){i.availableSurveys=[],i.isPermittedToConnect=!0,i.isConnectedToGetFeedback=e.isConnectedToGetFeedback,i.currentConnectionTitle="",i.blurred=!1,i.connectionInProgress=!1,i.surveyLoadingInProgress=!1,i.connectionErrorMessage=null,i.showConnectionErrorMessage=!1,i.surveyListErrorMessage=null,i.showSurveyListErrorMessage=!1,i.clearSurveyListError=function(){i.showSurveyListErrorMessage=!1,i.surveyListErrorMessage=""},i.$watch("isConnectedToGetFeedback",function(){w(i)}),i.$watch("active.content.surveyId",function(){t.forEach(i.availableSurveys,function(e){if(e.value===i.active.content.surveyId)return void i.setActive(e)})}),n.onfocus=function(){!i.blurred||i.firstLoad||!i.isConnectedToGetFeedback||i.showSurveyListErrorMessage||a.focusFromOurDirective||(y(i,o,s),i.blurred=!1)},n.onblur=function(){i.blurred=!0,i.firstLoad=!1},i.onStartConnecting=function(){i.connectionInProgress=!0,i.showConnectionErrorMessage=!1,i.connectionErrorMessage=null,r.trackConnectionStart()},i.onCompleteConnecting=function(e,t,n,a){return i.connectionInProgress=!1,e?void b(a):void(t?(i.showConnectionErrorMessage=!1,i.isConnectedToGetFeedback=!0,r.trackConnectionSuccess(),y(i,o,s,a),i.$emit("displayPopover"),i.firstLoad=!0):(h(i,n),b(a)))},i.disconnect=function(){i.showSurveyListErrorMessage=!1,i.surveyListErrorMessage="",o.revokeConnection().then(function(){g(i)}).catch(function(){v(i)})},i.setInactive=function(e){e.isActive=!1,i.active.content.surveyTitle="",i.active.content.href="",i.active.content.surveyId="",i.active.content.previewUrl="",i.active.content.editUrl="",s.contentUpdated(),i.clearSurveyListError()},i.setActive=function(e){t.forEach(i.availableSurveys,function(e){e.isActive=!1}),e.isActive=!0,i.active.content.surveyTitle=e.display,i.active.content.href=e.href,i.active.content.surveyId=e.value,i.active.content.previewUrl=e.previewUrl,i.active.content.editUrl=e.editUrl,s.contentUpdated(),i.clearSurveyListError()},i.openNewSurvey=function(){n.open("https://www.getfeedback.com/campaign_monitor/create","_blank")},w(i),i.isConnectedToGetFeedback&&y(i,o,s)}function _(t,n,i,o,r){return{restrict:"E",replace:!0,template:a,link:function(s,a,l){return e.surveysEnabled?void k(t,s,n,i,o,r):void a.hide()}}}var x=null,S=[{errorSearchRegex:/denied.*request/,friendlyMessageReplacement:"The connection could not be completed since access to your accounts was not agreed to."}];i.directive("embSurveyProperties",["$window","GetFeedbackConnectorSvc","GetFeedbackMetricsSvc","ModelActivity","$rootScope",_])}),define("vendor/text!modules/emailbuilder/templates/footerProperties.html",[],function(){return'<section class="emb-js-property-pane emb-pane sidebar--footer-properties emb-reset" ng-show="editor == \'footer\'">\r\n    <div class="sidebar--footer-controls" ng-submit="close()" bindonce="mode && templateOptions">\r\n        <div class="c-sidebar__intro">\r\n            <h2 class="c-sidebar__heading-primary">Footer settings</h2>\r\n            <div ng-show="email.footer.permissions.lockLevel === \'full\' && showFooterPermissionsMessage">\r\n                <p class="c-sidebar__text c-sidebar__text--intro">The footer is <strong>locked</strong>.</p>\r\n                <p class="c-sidebar__text c-sidebar__text--intro">To make changes to the footer, please contact the template creator.</p>\r\n            </div>\r\n        </div>\r\n        <div class="emb-customize">\r\n            <h3 id="emb-js-footer-companyDetails" class="sidebar__heading sidebar__heading--secondary"\r\n                ng-class="{\'emb-selected\': currentFooterSetting == \'companyDetails\'}"\r\n                ng-click="currentFooterSetting = \'companyDetails\'" ng-hide="hideFooterSettings">\r\n                Company details\r\n            </h3>\r\n            <div class="sidebar__accordion-item emb-accordion-item hmb-image-sidebar emb-sidebar-accordion-header"\r\n                 ng-class="{\'emb-accordion-anim\': currentFooterSetting == \'companyDetails\'}"\r\n                 ng-show="currentFooterSetting === \'companyDetails\'">\r\n\r\n                <div class="emb-content-accordion-zoom">\r\n                    <form name="footerCompanyDetails" novalidate="novalidate" class="sidebar__form--accordion">\r\n                        <ul role="tablist" class="l-grid l-grid--inline-block checkbox-options__list checkbox-options__list--inputs" bindonce>\r\n                            <li role="presentation" class="l-grid__item l-grid__item--100 l-grid l-grid--inline-block" ng-repeat="(key, value) in templateOptions.webLinkOptions" bindonce="type" data-company-weblinks>\r\n                                <div class="l-grid__item l-fixed--checkbox l-offset--top-small l-offset--right-small">\r\n                                    <div id="emb-js-company-details-{{key | lowercase}}" cs-checkbox ng-model="emailModel.webLinks[key].on" checkbox-id="weblinks-{{key}}" class="checkbox-options" emb-save-on-model-change></div>\r\n                                </div>\r\n                                <div class="l-grid__item l-grid__item--100 l-max--checkbox-input">\r\n                                    <input id="emb-js-header-link" ng-disabled="!emailModel.webLinks[key].on" class="c-input input-url input-url--{{key | lowercase}}" ng-model="emailModel.webLinks[key].href" name="href" type="text" placeholder="http://" emb-save-on-model-change ng-keypress="handleEnter($event)" />\r\n                                </div>\r\n                            </li>\r\n                        </ul>\r\n                    </form>\r\n                </div>\r\n            </div>\r\n\r\n            <h3 id="emb-js-footer-sharingEmail" class="sidebar__heading sidebar__heading--secondary"\r\n                ng-class="{\'emb-selected\': currentFooterSetting == \'sharingEmail\'}"\r\n                ng-click="currentFooterSetting = \'sharingEmail\'" bo-show="!mode.isTransactional" ng-hide="hideFooterSettings">\r\n                Share this email\r\n            </h3>\r\n            <div class="sidebar__accordion-item emb-accordion-item hmb-image-sidebar"\r\n                 ng-class="{\'emb-accordion-anim\': currentFooterSetting == \'sharingEmail\'}"\r\n                 ng-show="currentFooterSetting === \'sharingEmail\' && !hideFooterSettings"\r\n                 bo-if="!mode.isTransactional">\r\n                <div class="emb-content-accordion-zoom">\r\n                    <form name="footerSharingEmail" novalidate="novalidate" class="sidebar__form--accordion">\r\n                        <ul class="checkbox-options__list" bindonce>\r\n                            <li ng-repeat="(type, label) in templateOptions.socialOptions" bindonce="type" data-social-type>\r\n                                <!-- share by social networks -->\r\n                                <div id="emb-js-social-{{type}}" cs-checkbox ng-model="emailModel.social[type].on"\r\n                                class="checkbox-options checkbox-options--facebook-share"\r\n                                label="{{label}}" emb-save-on-model-change></div>\r\n                                <div bo-if="type == \'fblike\'" ng-class="{\'c-dropdown-options-container\': emailModel.social.fblike.on}" cs-dropdown-class="c-dropdown-">\r\n                                    <div ng-init="likeList = [\'Like a URL\', \'Like this email\']" cs-dropdown="likeList" cs-dropdown-class="c-dropdown-container" ng-model="emailModel.social.fblike.type" ng-show="emailModel.social.fblike.on"></div>\r\n                                    <input name="facebook-url"\r\n                                           placeholder="http://"\r\n                                           type="text"\r\n                                           class="c-input"\r\n                                           cs-valid-url\r\n                                           ng-model="emailModel.social.fblike.tempHref"\r\n                                           emb-sync-href="emailModel.social.fblike"\r\n                                           emb-save-on-model-change\r\n                                           ng-show="emailModel.social.fblike.on && emailModel.social.fblike.type == \'Like a URL\'"\r\n                                           cs-focus="emailModel.social.fblike.on && emailModel.social.fblike.type == \'Like a URL\'">\r\n                                </div>\r\n                            </li>\r\n                            <li>\r\n                                <!-- share by email i.e. forward to a friend -->\r\n                                <div id="emb-js-share-forwardtoafriend" cs-checkbox ng-model="emailModel.social.forwardtoafriend.on"\r\n                                class="checkbox-options"\r\n                                label="{{templateOptions.shareOptions.forwardtoafriend}}" emb-save-on-model-change></div>\r\n                            </li>\r\n                        </ul>\r\n                    </form>\r\n                </div>\r\n            </div>\r\n\r\n            <h3 id="emb-js-footer-otherSettings" class="sidebar__heading sidebar__heading--secondary"\r\n                ng-class="{\'emb-selected\': currentFooterSetting == \'otherSettings\'}"\r\n                ng-click="currentFooterSetting = \'otherSettings\'" ng-hide="hideFooterSettings">\r\n                Other settings\r\n            </h3>\r\n            <div class="sidebar__accordion-item emb-accordion-item hmb-image-sidebar"\r\n                 ng-class="{\'emb-accordion-anim\': currentFooterSetting == \'otherSettings\'}"\r\n                 ng-show="currentFooterSetting === \'otherSettings\'">\r\n                <div class="emb-content-accordion-zoom">\r\n                    <form name="footerOtherSettings" novalidate="novalidate" class="sidebar__form--accordion">\r\n                        <ul class="checkbox-options__list">\r\n                            <li ng-if="templateOptions.optionalTexts.permission">\r\n                                <!-- explanation text -->\r\n                                <div id="emb-js-explanation-text" cs-reverse-checkbox ng-model="emailModel.editableText.permission.isDisabled"\r\n                                     class="checkbox-options"\r\n                                     label="{{templateOptions.optionalTexts.permission}}" emb-save-on-model-change></div>\r\n                            </li>\r\n                            <li bo-if="!mode.isTransactional">\r\n                                <!-- preferences link -->\r\n                                <div id="emb-js-share-preferences" cs-checkbox ng-model="emailModel.social.preferences.on"\r\n                                     class="checkbox-options"\r\n                                     label="{{templateOptions.shareOptions.preferences}}" emb-save-on-model-change></div>\r\n                            </li>\r\n                            <li ng-if="templateBadgeFeatureFlag">\r\n                                <!-- template badge -->\r\n                                <div id="emb-js-optional-template-badge" cs-checkbox ng-model="emailModel.templateBadge.displayBadge"\r\n                                     class="checkbox-options"\r\n                                     label="Made with Campaign Monitor" emb-save-on-model-change></div>\r\n                            </li>\r\n                        </ul>\r\n                    </form>\r\n                </div>\r\n            </div>\r\n\r\n            <h3 id="emb-js-footer-otherSettings" class="sidebar__heading sidebar__heading--secondary qa-footer-content-locking"\r\n                ng-class="{\'emb-selected\': currentFooterSetting == \'permissions\'}"\r\n                ng-click="currentFooterSetting = \'permissions\'"\r\n                ng-show="showFooterPermissions">\r\n                Footer content locking\r\n            </h3>\r\n            <div class="sidebar__accordion-item emb-accordion-item hmb-image-sidebar"\r\n                 ng-class="{\'emb-accordion-anim\': currentFooterSetting == \'permissions\'}"\r\n                 ng-show="currentFooterSetting === \'permissions\' && showFooterPermissions">\r\n                <div class="emb-content-accordion-zoom">\r\n                    <form class="sidebar__form--accordion" name="permissions" novalidate="novalidate">\r\n                        <ul role="tablist" class="l-grid l-grid--inline-block l-grid--vertical-spacing">\r\n                            <li role="presentation" class="l-grid__item l-grid__item--100">\r\n                                <label class="c-sidebar__label">Footer editing restrictions</label>\r\n                                <div class="c-dropdown-options-container" cs-dropdown-class="c-dropdown">\r\n                                    <div cs-dropdown="footerLockLevels" cs-dropdown-class="l-select-container--small l-select-container--permissions"\r\n                                         ng-model="email.footer.permissions.lockLevel" emb-save-on-model-change\r\n                                         ng-change="footerPermissionsChanged(email.footer)"></div>\r\n                                </div>\r\n                                <p ng-show="email.footer.permissions.lockLevel !== \'none\'" class="c-sidebar__text l-gap--top-medium">To make changes to the footer, select â€œUnlock everythingâ€.</p>\r\n                            </li>\r\n                        </ul>\r\n                    </form>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</section>';
}),define("ts/modules/emailbuilder/directives/footerProperties",["vendor/angular","modules/emailbuilder/module","modules/emailbuilder/services/template","ts/modules/emailbuilder/services/email","modules/emailbuilder/services/safeDigest","ts/modules/emailbuilder/services/lockLevelSvc","vendor/text!modules/emailbuilder/templates/footerProperties.html","config"],function(e,t,n,i,o,r,s,a){function l(e,t,n,i){return{restrict:"E",replace:!0,template:s,link:function(e){function o(t){var n=i.getLocks(t);e.hideFooterSettings=n.anyLocking}e.templateOptions=n,e.emailModel=t.model,e.templateBadgeFeatureFlag=a.templateBadge,e.footerLockLevels=a.footerLockLevels,e.showFooterPermissions=a.canvasSectionPermissions&&a.mode.templateWithContent,e.showFooterPermissionsMessage=a.canvasSectionPermissions&&!a.mode.templateWithContent,o(t.model.footer.permissions),e.footerPermissionsChanged=function(e){i.permissionsChanged("footer",e.permissions),o(e.permissions)}}}}t.directive("embFooterProperties",["$rootScope","EmailSvc","TemplateOptions","LockLevelSvc",l])}),define("modules/emailbuilder/directives/connectGetFeedbackPopup",["config","vendor/angular","modules/emailbuilder/module","modules/emailbuilder/services/getFeedbackConnector"],function(e,t,n,i){function o(){d=!1}function r(e,n){n&&n.close(),t.isDefined(u)&&(e.cancel(u),u=void 0)}function s(e,t){e.embConnectionCompleted({cancelled:!1,succeeded:!1,errors:t||["There was an error connecting to GetFeedback. Please try again in a few minutes."],completedCallback:o})}function a(t){return t===e.urls.apiSecureRootUrl}function l(e,t,n,i){t.addEventListener("message",function(t){if("deliverOauthFinished"===t.data.message&&!d){var l=t.data.result.authorizationCode,c=t.data.result.oauthState,u=t.data.result.errorDescription;if(d=!0,r(n,t.source),u)return void s(e,[u]);if(!a(t.origin))return void s(e);i.completeOauthHandshake(l,c).then(function(t){var n="Success"===t.data.Status;e.embConnectionCompleted({cancelled:!1,succeeded:n,errors:t.data.Errors,completedCallback:o})}).catch(function(t){s(e)})}},!1)}function c(t,n,i,r,s){return{restrict:"A",scope:{embConnectionStarted:"&",embConnectionCompleted:"&"},link:function(i,a){function c(e){var t=u+"?oauthApplicationID="+d+"&videoplay="+e;i.$emit("getFeedbackConnectStart",t),i.embConnectionStarted()}var u=(r.defaults.xsrfCookieName,e.urls.startOAuthToGetFeedback),d=e.urls.getFeedbackEncryptedOAuthApplicationIDForUrl;l(i,t,n,s),i.$on("getFeedbackConnectEnd",function(e,t){t||i.embConnectionCompleted({cancelled:!0,succeeded:!1,errors:[],completedCallback:o})}),a.find("button").on("click",function(e){e.preventDefault(),c(!1)}),a.find("a").on("click",function(e){e.preventDefault(),c(!0)})}}}var u,d=!1;n.directive("embConnectGetFeedbackPopup",["$window","$interval","$browser","$http","GetFeedbackConnectorSvc",c])}),define("vendor/text!modules/emailbuilder/templates/imageEditor.html",[],function(){return'<div ng-if="!uploading">\r\n    <button id="emb-js-aviary" class="c-image-controls__button c-image-controls__button--edit">\r\n        Edit\r\n    </button>\r\n</div>'}),define("ts/modules/emailbuilder/directives/imageEditor",["config","vendor/angular","modules/emailbuilder/module","modules/emailbuilder/services/aviary","vendor/text!modules/emailbuilder/templates/imageEditor.html"],function(e,t,n,i,o){var r=function(){function e(e){var t=this;this.template=o,this.restrict="A",this.scope={image:"=",uploading:"="},this.link=function(e,n,i){n.bind("click",function(n){return n.preventDefault(),t.aviarySvc.launchEditor(e.image,null,null,!0)})},this.aviarySvc=e}return e.factory=function(t){return new e(t)},e}();n.directive("embImageEditor",["AviarySvc",r.factory])}),define("modules/emailbuilder/components/spacingProperties/spacingProperties.controller",["config","vendor/angular","modules/emailbuilder/module"],function(e,t,n){function i(n,i){var o=this;o.maxVerticalSpacingValue=e.settings.maxVerticalSpacingValue,o.selectionChanged=function(){o.section.id=n.propertiesToId(o.section.id,o.layoutMode),o.section.content.forEach(function(e,t){e.content.forEach(function(e){e.tempContainer.sectionID=o.section.id})})},o.isSingleColumn=function(){return o.section&&o.section.id&&0===o.section.id.indexOf("1-col")},o.verticalSpacingChanged=function(e){if(e&&e.settings&&!isNaN(e.settings.verticalSpacing)){var o=t.element("#js_section_separator_after_"+e.uiId+" > div");o.css("line-height",e.settings.verticalSpacing+"px"),o.css("font-size",e.settings.verticalSpacing+"px"),n.updateTopBorderForNextSection(e,i.model.sections)}}}n.controller("spacingPropertiesController",i),i.$inject=["SectionIdSvc","EmailSvc"]}),define("vendor/text!modules/emailbuilder/components/spacingProperties/spacingProperties.html",[],function(){return'<ul ng-if="layoutspacing" class="l-grid">\r\n    <li class="{{spacingPropertiesCtrl.isSingleColumn() ? \'l-grid__item--50\' : \'l-grid__item--75\'}}">\r\n        <cm-segmented-control group-name="layout"\r\n                              ng-model="spacingPropertiesCtrl.layoutMode"\r\n                              ng-class="{ \'c-segmented-control--layout\': true, \'is-single-column\': spacingPropertiesCtrl.isSingleColumn() }"\r\n                              group-legend="Layout"\r\n                              group-class-name="c-segmented-control--layout-multi"\r\n                              on-select="spacingPropertiesCtrl.selectionChanged()"\r\n                              emb-save-on-model-change>\r\n            <cm-segmented-control-item item-value="fullWidth"\r\n                                       segment-id="edgetoedge"\r\n                                       class-names="{{spacingPropertiesCtrl.isSingleColumn() ? \'c-segmented-control--layout-single-full\' :\'c-segmented-control--layout-multi-full\'}}">\r\n            </cm-segmented-control-item>\r\n            <cm-segmented-control-item item-value="halfWidth"\r\n                                       segment-id="normal"\r\n                                       class-names="{{spacingPropertiesCtrl.isSingleColumn() ? \'c-segmented-control--layout-single-fixed\' :\'c-segmented-control--layout-multi-fixed\'}}">\r\n            </cm-segmented-control-item>\r\n            <cm-segmented-control-item ng-hide="spacingPropertiesCtrl.isSingleColumn()"\r\n                                       item-value="spacing"\r\n                                       segment-id="spacing"\r\n                                       class-names="c-segmented-control--layout-multi-gutter">\r\n            </cm-segmented-control-item>\r\n        </cm-segmented-control>\r\n    </li>\r\n\r\n    <li class="l-grid-full">\r\n      <div class="u-pos-relative">\r\n        <label class="c-sidebar__label">Bottom spacing</label>\r\n        <div class="c-sidebar__label c-sidebar__label--slider">\r\n            <div>{{spacingPropertiesCtrl.section.settings.verticalSpacing}}</div>\r\n        </div>\r\n\r\n        <div cs-slider-value="spacingPropertiesCtrl.section.settings.verticalSpacing"\r\n             cs-slider="spacingPropertiesCtrl.section.settings.verticalSpacing"\r\n             cs-slider-min="0" cs-slider-max="spacingPropertiesCtrl.maxVerticalSpacingValue"\r\n             ng-model="spacingPropertiesCtrl.section.settings.verticalSpacing"\r\n             ng-change="spacingPropertiesCtrl.verticalSpacingChanged(spacingPropertiesCtrl.section)"\r\n             ng-model-options="{ debounce: 100}"\r\n             emb-save-on-model-change\r\n             data-steps="1">\r\n        </div>\r\n      </div>\r\n\r\n    </li>\r\n</ul>'}),define("modules/emailbuilder/components/spacingProperties/spacingProperties.directive",["vendor/angular","modules/emailbuilder/module","vendor/text!modules/emailbuilder/components/spacingProperties/spacingProperties.html","config"],function(e,t,n,i){function o(e,t,i){function o(n,o,r,s){n.$watch("section",function(t){t&&(s.layoutMode=e.idToProperties(t.id),s.section=n.section)}),i(function(){t.model.sections.forEach(function(e){s.verticalSpacingChanged(e)})},500)}var r={restrict:"E",link:o,scope:{section:"=",layoutspacing:"=",border:"="},template:n,controller:"spacingPropertiesController",controllerAs:"spacingPropertiesCtrl"};return r}t.directive("embSpacingProperties",o),o.$inject=["SectionIdSvc","EmailSvc","$timeout"]}),define("vendor/text!modules/emailbuilder/templates/videoProperties.html",[],function(){return'<section class="emb-js-property-pane hmb-image-sidebar emb-pane emb-reset" ng-show="editor == \'video\'">\r\n    <form name="contentFormVideo" novalidate="novalidate" ng-submit="close()" class="l-sidebar-inner">\r\n        <h2 class="c-sidebar__heading-primary hmb-empty">\r\n            <span ng-show="active.content.state.initial">Add a video</span>\r\n            <span ng-show="active.content.state.fileUploaded || active.content.state.videoThumbnailLoaded || active.content.state.videoThumbnailError">Edit video</span>\r\n            <span ng-show="active.content.state.uploading">Uploading&hellip;</span>\r\n        </h2>\r\n        <div class="sidebar__accordion-item">\r\n            <div class="sidebar__form--accordion">\r\n                <div class="l-gap--bottom-large" ng-show="!active.content.state.fileUploaded && !active.content.state.uploading">\r\n                        <label class="c-sidebar__label ">Enter Video URL</label>\r\n                        <input class="c-input" emb-sync-href="active.content" targetmodel="videoUrl" ng-model="active.content.tempVideoUrl" cs-valid-url name="videoUrlTxt" ng-required="true" type="text" placeholder="https://vimeo.com/97889197" emb-save-on-model-change/>\r\n                </div>\r\n                <header class="p hmb-empty c-image-controls-container l-gap--bottom-large" ng-show="active.content.state.fileUploaded || active.content.state.videoThumbnailLoaded || active.content.state.videoThumbnailError">\r\n                    <div emb-video-embedder class="emb-video-embedder"></div>\r\n                </header>\r\n                <section class="emb-secondary-container">\r\n                    <ul role="tablist" class="l-grid l-grid--inline-block l-grid--vertical-spacing " ng-class="{ \'hmb-secondary-actions\' : !active.content.state.initial, \'u-hide-all\' : active.content.state.initial, \'hmb-top-override\' : !active.content.state.fileUploaded && !active.content.state.uploading }" style="width: 100%">\r\n                        <li role="presentation" class="l-grid__item l-grid__item--100">\r\n                            <label class="c-sidebar__label ">Alt text</label>\r\n                            <input class="c-input" name="alt" ng-model="active.content.alt" type="text" emb-save-on-model-change/>\r\n                        </li>\r\n                        <li role="presentation" class="l-grid__item l-grid__item--100" ng-show="configurableWidth">\r\n                            <label class="c-sidebar__label">Alignment</label>\r\n                            <div class="l-grid enhance-flex l-fixed--align hmb-js-horizontal-alignment emb-segmented-buttons emb-alignment" ng-model="active.content.halign" emb-select-group emb-save-on-model-change>\r\n                                <button data-value="left" class="l-grid__item emb-btn emb-align-left">\r\n                                    <div class="c-segmented-control__icon-container">\r\n                                        <span class="c-segmented-control__icon"></span>\r\n                                    </div>\r\n                                </button>\r\n                                <button data-value="center" class="l-grid__item emb-btn emb-align-horizontal-middle">\r\n                                    <div class="c-segmented-control__icon-container">\r\n                                        <span class="c-segmented-control__icon"></span>\r\n                                    </div>\r\n                                </button>\r\n                                <button data-value="right" class="l-grid__item emb-btn emb-align-right">\r\n                                    <div class="c-segmented-control__icon-container">\r\n                                        <span class="c-segmented-control__icon"></span>\r\n                                    </div>\r\n                                </button>\r\n                            </div>\r\n                        </li>\r\n                        <li role="presentation" class="l-grid__item l-grid__item--100" ng-show="canEditStyles">\r\n                            <div class="checkbox-options" cs-checkbox ng-model="addSpacing" label="Add video spacing" emb-save-on-model-change></div>\r\n                        </li>\r\n                    </ul>\r\n                </section>\r\n            </div>\r\n        </div>\r\n    </form>\r\n    <footer class="hmb-dismiss-container">\r\n        <input type="submit" value="Done editing" class="c-button c-button--primary c-button--large" ng-click="close()">\r\n    </footer>\r\n</section>'}),define("modules/emailbuilder/directives/videoProperties",["vendor/angular","config","modules/emailbuilder/module","ts/modules/emailbuilder/services/email","modules/emailbuilder/services/itemWidth","modules/emailbuilder/services/safeDigest","vendor/text!modules/emailbuilder/templates/videoProperties.html","ts/modules/emailbuilder/services/lockLevelSvc"],function(e,t,n,i,o,r,s,a){function l(e){this.addSpacing=!e.isFullWidth,this.src=e.hasSrc()?e.getSrc():""}function c(e,t){var n=e.getBlockWidth(t);this.configurableWidth=t.hasSrc()&&t.tempWidth<n}function u(e){e.addSpacing=!1,e.configurableWidth=!1,e.videoThumbnailFailed=function(e){e.state=p.videoThumbnailError()},e.videoThumbnailSucceeded=function(e){e.state=p.videoThumbnailLoaded()},e.fileUploaded=function(e){e.state=p.fileUploaded()},e.fileUploading=function(e){e.state=p.uploading()},e.setInitialState=function(e){e.state=p.initial()}}function d(e,t,n,i){return{restrict:"E",replace:!0,template:s,link:function(o){u(o);var r=new m;e.$on("content:activated",function(e,s){var a=s.block;if(a.hasOwnProperty("type")&&"video"===a.type){a.state=p.current(a),l.call(o,a),c.call(o,n,a);var u=i.getLocks(o.email.sections[a.tempContainer.section].permissions);o.canDelete=u.canDeleteContentItems,r.add(o.$watch("addSpacing",function(){a.isFullWidth=!o.addSpacing;var e=a.tempContainer,n=o.email.sections[e.section].content[e.column];t.dropzoneHasPadding(n)})),r.add(o.$watch("active.content.tempWidth",function(){c.call(o,n,a)})),r.add(o.$on("upload:start",function(){o.fileUploading(a),o.safeDigest()})),r.add(o.$on("upload:end",function(){o.fileUploaded(a),o.safeDigest()}))}}),e.$on("content:deactivated",r.clear),e.$on("content:replaced",r.clear)}}}function m(){var e=[],t=function(t){e.push(t)},n=function(){for(var t=0;t<e.length;t++)e[t]&&e[t]();e=[]};return{add:t,clear:n}}function p(e){return{initial:e===p.values.initial,uploading:e===p.values.uploading,fileUploaded:e===p.values.fileUploaded,videoThumbnailLoaded:e===p.values.videoThumbnailLoaded,videoThumbnailError:e===p.values.videoThumbnailError,hasSrc:e===p.values.fileUploaded||e===p.values.videoThumbnailLoaded||e===p.values.videoThumbnailError,value:e}}p.values={initial:"initial",uploading:"uploading",fileUploaded:"fileUploaded",videoThumbnailLoaded:"videoThumbnailLoaded",videoThumbnailError:"videoThumbnailError"},p.current=function(e){return e.state?e.state:e.fileName?p.fileUploaded():e.videoThumbnailLoaded?p.videoThumbnailLoaded():p.initial()},p.initial=function(){return new p(p.values.initial)},p.uploading=function(){return new p(p.values.uploading)},p.fileUploaded=function(){return new p(p.values.fileUploaded)},p.videoThumbnailLoaded=function(){return new p(p.values.videoThumbnailLoaded)},p.videoThumbnailError=function(){return new p(p.values.videoThumbnailError)},n.directive("embVideoProperties",["$rootScope","EmailSvc","ItemWidthSvc","LockLevelSvc",d])}),define("vendor/text!modules/emailbuilder/templates/generalProperties.html",[],function(){return'<section bindonce="mode" class="c-sidebar__build emb-pane emb-js-property-pane emb-reset emb-top emb-sidebar-anim" ng-mouseenter="hovered = true" ng-mouseleave="hovered = false" ng-show="showContent" ng-click="close();" ng-class="{\'emb-hovered\' : hovered }">\r\n    <div class="c-sidebar__intro">\r\n        <h2 class="c-sidebar__heading-primary">Build</h2>\r\n        <button ng-click="switchPanes(\'customize\');$event.stopPropagation()" class="c-sidebar-settings-icon qa-customize-tab" bo-if="mode.customisable">\r\n            <span class="c-sidebar-settings-icon__text">Settings</span>\r\n        </button>\r\n    </div>\r\n    <ol id="emb-content-tiles" class="l-parent-offset--right-small l-parent-offset--bottom-medium l-tiles-container l-gap--side-left l-gap--top" ng-show="currentPane == \'content-tiles\'">\r\n        <li class="l-tile-container emb-content-tile-wrap"\r\n            ng-repeat="content in template.contentTypes"\r\n            ng-hide="content.title == \'Survey\' && (!surveysEnabled || isIFramed)"\r\n            ng-mousedown="item.tileActive = \'active\'"\r\n            ng-mouseout="item.tileActive = \'inactive\'">\r\n            <div emb-tile\r\n                    item="content"\r\n                    name="{{content.title}}"\r\n                    type="content"\r\n                    subtype="{{content.type}}"\r\n                    class="l-tile emb-content-tile"\r\n                    connect-to=".emb-js-content-container,.emb-js-content-dropzone"></div>\r\n        </li>\r\n    </ol>\r\n    <div cs-custom-scroll1 ng-class="{ \'emb-customize-colorsAndFonts\': currentCustomize == \'colorsAndFonts\' }" class="ng-hide" ng-show="currentPane == \'customize\'" ng-click="$event.stopPropagation()">\r\n        <emb-sidebar-settings></emb-sidebar-settings>\r\n        <footer class="hmb-dismiss-container">\r\n            <input type="submit" value="Done editing" class="c-button c-button--primary c-button--large" ng-click="switchPanes(\'content-tiles\');$event.stopPropagation()">\r\n        </footer>\r\n    </div>\r\n</section>'}),define("ts/modules/emailbuilder/directives/generalProperties",["vendor/angular","modules/emailbuilder/module","ts/modules/emailbuilder/services/lockLevelSvc","vendor/text!modules/emailbuilder/templates/generalProperties.html"],function(e,t,n,i){var o=function(){function e(e){var t=this;this.template=i,this.restrict="E",this.replace=!0,this.link=function(e,n,i){function o(t){var n=r.lockLevelSvc.getLocks(t);e.hideHeaderSettings=n.anyLocking}var r=t;o(e.email.header.permissions),e.$on("permissionsChanged:header",function(e,t){o(t)})},this.lockLevelSvc=e}return e.factory=function(t){return new e(t)},e}();t.directive("embGeneralProperties",["LockLevelSvc",o.factory])}),define("vendor/text!modules/emailbuilder/templates/sectionProperties.html",[],function(){return'<section class="emb-js-property-pane emb-pane sidebar--section-properties emb-reset" ng-show="editor == \'section\'">\r\n    <div class="sidebar--section-controls" ng-submit="close()">\r\n\r\n        <div class="c-sidebar__intro">\r\n            <h2 class="c-sidebar__heading-primary">Section settings</h2>\r\n\r\n            <div ng-show="!mode.publicCanvas && !mode.templateWithContent && canvasSectionPermissions">\r\n                <div ng-show="section.permissions.lockLevel == \'partial\' || section.permissions.lockLevel == \'partial-removable\'">\r\n                    <p class="c-sidebar__text c-sidebar__text--intro">This section allows you to edit <strong>content only</strong>.</p>\r\n                    <p class="c-sidebar__text c-sidebar__text--intro">To make changes to this sectionâ€™s settings and design, please contact the template creator.</p>\r\n                </div>\r\n                <div ng-show="section.permissions.lockLevel == \'full\'">\r\n                    <p class="c-sidebar__text c-sidebar__text--intro">This section is <strong>locked</strong>.</p>\r\n                    <p class="c-sidebar__text c-sidebar__text--intro">To make changes to this sectionâ€™s settings and design, please contact the template creator.</p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="emb-customize">\r\n            <h3 id="emb-js-section-spacing" class="sidebar__heading sidebar__heading--secondary"\r\n                ng-class="{\'emb-selected\': currentLayoutSetting == \'spacing\'}"\r\n                ng-click="currentLayoutSetting = \'spacing\'"\r\n                ng-hide="!email.isBlueprint || section.hideSectionSettings">\r\n                Layout and spacing\r\n            </h3>\r\n            <div class="sidebar__accordion-item emb-accordion-item"\r\n                 ng-class="{\'emb-accordion-anim\': currentLayoutSetting == \'spacing\'}"\r\n                 ng-show="currentLayoutSetting === \'spacing\' && email.isBlueprint">\r\n                <div class="emb-content-accordion-zoom">\r\n\r\n                    <form name="footerCompanyDetails" novalidate="novalidate" class="sidebar__form--accordion">\r\n                        <emb-spacing-properties section="section" layoutspacing="true" />\r\n                    </form>\r\n\r\n                </div>\r\n            </div>\r\n            <h3 id="emb-js-section-bg" class="sidebar__heading sidebar__heading--secondary"\r\n                ng-class="{\'emb-selected\': currentLayoutSetting == \'bg\' || !currentLayoutSetting }"\r\n                ng-click="currentLayoutSetting = \'bg\'"\r\n                ng-hide="section.hideSectionSettings">\r\n                {{ email.isBlueprint ? "Background and border" : "Background" }}\r\n            </h3>\r\n            <div class="sidebar__accordion-item emb-accordion-item"\r\n                 ng-class="{\'emb-accordion-anim\': currentLayoutSetting == \'bg\' || !currentLayoutSetting }"\r\n                 ng-show="currentLayoutSetting === \'bg\' || !currentLayoutSetting">\r\n                <div class="emb-content-accordion-zoom">\r\n\r\n                    <form name="bg" novalidate="novalidate" class="sidebar__form--accordion">\r\n\r\n                        <ul role="tablist" class="l-grid l-grid--inline-block l-grid--vertical-spacing">\r\n                            <li role="presentation" class="l-grid__item l-grid__item--100">\r\n                                <label class="c-sidebar__label">Background color</label>\r\n                                <div class="c-colorpicker ff-colorpicker--recent c-colorpicker--light c-colorpicker--input">\r\n                                    <div cs-color-selector cs-viewport="#emb-js-sidebar" ng-model="section.style.backgroundColor"\r\n                                         emb-save-on-model-change ng-change="updateSectionBackground(section)"></div>\r\n                                </div>\r\n                            </li>\r\n                            <li role="presentation" class="l-grid__item l-grid__item--100">\r\n                                <label class="c-sidebar__label">Background image</label>\r\n                                <div layout-background-status="layoutBackgroundStatus" emb-background-layout-image-uploader background-image="section.style.backgroundLayoutImage"></div>\r\n                                <div ng-show="email.isBlueprint" cs-checkbox cs-section="section" ng-model="section.bordered" label="Show a border for this section" class="checkbox-options" emb-save-on-model-change></div>\r\n                            </li>\r\n                        </ul>\r\n\r\n                    </form>\r\n                </div>\r\n            </div>\r\n\r\n            <div ng-show="!mode.publicCanvas && !mode.isTransactional && !mode.templateWithContent">\r\n                <h3 id="emb-js-section-segments" class="sidebar__heading sidebar__heading--secondary"\r\n                    ng-class="{\'emb-selected\': currentLayoutSetting == \'segments\' }"\r\n                    ng-click="currentLayoutSetting = \'segments\'">\r\n                    Who should see this?\r\n                </h3>\r\n                <div class="sidebar__accordion-item sidebar__accordion-item--last emb-accordion-item"\r\n                     ng-class="{\'emb-accordion-anim\': currentLayoutSetting == \'segments\' }"\r\n                     ng-show="currentLayoutSetting == \'segments\'">\r\n                    <div class="emb-content-accordion-zoom">\r\n\r\n                        <form name="segments" novalidate="novalidate" class="sidebar__form--accordion">\r\n                            <div>\r\n                                <header class="emb-header-pane">\r\n                                    <p class="c-sidebar__text c-sidebar__text--settings">Target this part of your email at specific recipients and we\'ll only show it to them.</p>\r\n                                </header>\r\n                                <div class="emb-content sidebar-recipients__content">\r\n                                    <emb-segments section="section"></emb-segments>\r\n                                </div>\r\n                            </div>\r\n                        </form>\r\n\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div ng-show="mode.templateWithContent && canvasSectionPermissions">\r\n                <h3 id="emb-js-section-permissions" class="sidebar__heading sidebar__heading--secondary qa-section-content-locking"\r\n                    ng-class="{\'emb-selected\': currentLayoutSetting == \'permissions\'}"\r\n                    ng-click="currentLayoutSetting = \'permissions\'">\r\n                    Content locking\r\n                </h3>\r\n                <div class="sidebar__accordion-item emb-accordion-item"\r\n                     ng-class="{\'emb-accordion-anim\': currentLayoutSetting == \'permissions\'}"\r\n                     ng-show="currentLayoutSetting === \'permissions\'">\r\n                    <div class="emb-content-accordion-zoom">\r\n                        <form name="permissions" novalidate="novalidate" class="sidebar__form--accordion">\r\n                            <ul role="tablist" class="l-grid l-grid--inline-block l-grid--vertical-spacing">\r\n                                <li role="presentation" class="l-grid__item l-grid__item--100">\r\n                                    <label class="c-sidebar__label">Section editing restrictions</label>\r\n                                    <div class="c-dropdown-options-container" cs-dropdown-class="c-dropdown">\r\n                                        <div cs-dropdown="lockLevels" cs-dropdown-class="l-select-container--small l-select-container--permissions"\r\n                                             ng-model="section.permissions.lockLevel" emb-save-on-model-change\r\n                                             ng-change="sectionPermissionsChanged(section)"></div>\r\n                                    </div>\r\n                                    <p ng-show="section.permissions.lockLevel !== \'none\'" class="c-sidebar__text l-gap--top-medium">To make changes to this section, select â€œUnlock everythingâ€.</p>\r\n                                </li>\r\n                            </ul>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n    </div>\r\n</section>\r\n'}),define("ts/modules/emailbuilder/directives/sectionProperties",["vendor/angular","modules/emailbuilder/module","vendor/text!modules/emailbuilder/templates/sectionProperties.html"],function(e,t,n){function i(){var e={};return e.restrict="E",e.replace=!0,e.template=n,e}t.directive("embSectionProperties",i)}),define("ts/modules/emailbuilder/controllers/sidebar",["vendor/angular","config","modules/emailbuilder/module","modules/emailbuilder/services/template","modules/emailbuilder/services/safeDigest","modules/emailbuilder/services/getFeedbackConnector","modules/emailbuilder/services/getFeedbackMetrics","modules/emailbuilder/services/sectionId","modules/emailbuilder/animations/sidebar","modules/emailbuilder/directives/imageProperties","modules/emailbuilder/directives/buttonProperties","modules/emailbuilder/directives/validUrl","modules/emailbuilder/directives/fileUpload","modules/emailbuilder/directives/syncHref","modules/emailbuilder/directives/saveModel","modules/emailbuilder/directives/updateStyle","modules/emailbuilder/directives/selectGroup","modules/emailbuilder/directives/customScroll","modules/emailbuilder/directives/updateElementIsDark","modules/emailbuilder/directives/toggleCustomiseOnlyElements","ts/modules/emailbuilder/directives/segments","modules/emailbuilder/directives/surveyProperties","ts/modules/emailbuilder/directives/footerProperties","modules/emailbuilder/directives/connectGetFeedbackPopup","ts/modules/emailbuilder/directives/imageEditor","modules/emailbuilder/components/spacingProperties/spacingProperties.controller","modules/emailbuilder/components/spacingProperties/spacingProperties.directive","modules/emailbuilder/services/performanceSvc","modules/emailbuilder/directives/videoProperties","ts/modules/emailbuilder/directives/generalProperties","ts/modules/emailbuilder/directives/sectionProperties","ts/modules/emailbuilder/services/lockLevelSvc"],function(e,t,n,i,o,r,s){var a=function(){function e(e,n,i,o,r,s){function a(i){var r,a,l={address:"companyDetails",permission:"otherSettings"};if(r=i.editableTextKey&&("address"===i.editableTextKey||"permission"===i.editableTextKey),a=i.editableTextKey&&"preheader"===i.editableTextKey||"webversion"===i.editableTextKey||"header"===i.type,i.tempSidebarEditor)e.showContent=!1,e.editor=i.type;else switch(i.type){case"footer":e.showContent=!1,e.editor=i.type,e.currentFooterSetting=i.subType,e.currentFooterSetting||(e.currentFooterSetting="companyDetails");var c=s.getLocks(e.email.footer.permissions);c.anyLocking&&(t.mode.templateWithContent?e.currentFooterSetting="permissions":e.currentFooterSetting="");break;case"header":if(e.showContent=!0,t.mode.templateWithContent&&t.canvasSectionPermissions&&"preheader"===i.subType){var u=s.getLocks(e.email.header.permissions);u.anyLocking&&(e.currentPane="customize",e.currentCustomize="header-permissions")}else(i.displayType||"logo"===i.subType)&&(e.currentPane="customize",e.currentCustomize="header");break;case"floating":r&&(e.showContent=!1,e.editor="footer",e.currentFooterSetting=l[i.editableTextKey]),a&&t.mode.customisable&&(e.showContent=!0,e.currentPane="customize",e.currentCustomize="header");break;case"section":if(e.editor="section",e.showContent=!1,e.safeDigest(),e.section=i,i.subType&&(e.currentLayoutSetting=i.subType),t.canvasSectionPermissions){var d=s.getLocks(e.section.permissions);d.anyLocking&&(t.mode.templateWithContent?e.currentLayoutSetting="permissions":e.currentLayoutSetting="segments")}n.showMissingBackgroundModal===!0&&(e.currentLayoutSetting="bg",o.ensureTheElementInViewport("#"+e.section.uiId));break;default:e.showContent=!0}"customize"===e.currentPane&&n.$emit("content:email-background-activated",{email:e.email}),e.safeDigest()}function l(){var t=e.contentFormButton,n=[];e.active.content&&"button"===e.active.content.type&&(t.btnTxt.$error.required&&!t.btnLink.$error.required&&n.push("btnNoText"),t.btnLink.$error.required&&!t.btnTxt.$error.required&&n.push("btnNoLink"),t.btnLink.$error.url&&n.push("btnInvalidLink"),t.btnTxt.$error.required&&t.btnLink.$error.required&&n.push("btnNoLinkNoText"),e.active.content.tempValidation=n,e.active.content.tempIsValid=!n.length)}function c(e){return!e.active.content.href}function u(){var t=e.contentFormSurvey,n=[];e.active.content&&"survey"===e.active.content.type&&(t.surveyBtnTxt.$error.required&&!c(e)&&n.push("surveyNoText"),c(e)&&!t.surveyBtnTxt.$error.required&&n.push("surveyNoLink"),t.surveyBtnTxt.$error.required&&c(e)&&n.push("surveyNoLinkNoText"),e.active.content.tempValidation=n,e.active.content.tempIsValid=!n.length)}function d(){if(e&&e.contentFormVideo&&e.contentFormVideo.$dirty){var t=e.contentFormVideo,n=[];if(!e.active.content||"video"!==e.active.content.type)return;
t.videoUrlTxt.$error.url&&n.push("videoInvalidLink"),t.videoUrlTxt.$error.required&&n.push("videoNoLink"),e.active.content.tempValidation=n,e.active.content.tempIsValid=!n.length}}function m(t){e.showContent=!0,e.currentPane=t.tab||e.currentPane}e.template=i,e.showContent=!0,e.hovered=!1,e.currentPane="content-tiles",e.currentCustomize="header",e.showLangList=!1,e.showFBList=!1,e.maxLogoVerticalPadding=100,e.headerLockLevels=t.headerLockLevels,e.initializeColorsAndFonts=function(){e.currentCustomize="colorsAndFonts",n.$emit("content:email-background-activated",{email:e.email})},e.initializeSpacing=function(){e.currentCustomize="spacing"},e.close=function(){n.$emit("content:deactivate")},e.setHeaderActive=function(){n.$emit("content:activate",{block:e.email.header})},e.switchLogoType=function(t){e.email.header.displayType=t,e.setHeaderActive()},e.switchPanes=function(e){n.$emit("content:deactivate",{tab:e})},e.handleEnter=function(e){13===e.which&&(e.target.blur(),e.preventDefault())},e.$watch("currentPane",function(e){n.$broadcast("currentPane.switched",e)}),e.sectionPermissionsChanged=function(e){s.permissionsChanged("section-"+e.uiId,e.permissions)},e.headerPermissionsChanged=function(e){s.permissionsChanged("header",e.permissions)},e.updateSectionBackgroundColor=function(){n.$emit("customize:updateSectionBackgroundColor")},n.$on("content:deactivated",function(e,t){m(t)}),n.$on("content:activated",function(t,i){var o=i.block;a(o),l(),u(),d(),e.section&&n.$emit("content:set-layout-background",e.section)}),e.$watch("contentFormButton.$error",l,!0),e.$watch(function(){return e.active&&e.active.content&&e.active.content.href},u),n.$on("content.add",function(t,n){if("button"===n.type){var i=e.contentFormButton;i.$setPristine()}if("survey"===n.type){var o=e.contentFormSurvey;o.$setPristine()}if("video"===n.type){var r=e.contentFormVideo;r.$setPristine()}}),e.updateSectionBackground=function(e){n.$emit("section.updateBackground"+e.uiId,e)}}return e}();n.controller("SidebarCtrl",["$scope","$rootScope","TemplateOptions","ViewPortSrv","performanceSvc","LockLevelSvc",a])}),define("modules/emailbuilder/controllers/templateNaming",["modules/emailbuilder/module","modules/emailbuilder/services/templateName","config"],function(e,t,n){function i(e,t,i,o,r){e.templateName=t.name,e.userCreatedTemplateName="",e.buttonText="Save and continue",e.inputPlaceholderText="Template name",e.inputBorderStyle={},e.saveInProgress=!1,e.updateUserCreatedTemplateName=function(){t.setName(e.userCreatedTemplateName)},r.$on("template:trySave",function(){e.saveTemplateAndContinue(!0)}),r.$on("template:closeDialog",function(){e.inputBorderStyle={},e.inputPlaceholderText="Template name"}),e.saveTemplateAndContinue=function(o){if(!e.saveInProgress){if(e.saveInProgress=!0,!e.userCreatedTemplateName&&o)return e.inputPlaceholderText="Please enter a template name",e.inputBorderStyle="1px solid red !important",e.inputBorderStyle={border:"1px solid red"},void(e.saveInProgress=!1);e.buttonText="Saving... ";var r=t.save();r&&r.then(function(e){var t=e.data.Data,o=n.urls.stepForward;t&&Object.keys(t).forEach(function(e){var n=new RegExp(e+"=[^&]*"),i=[e,"=",encodeURIComponent(t[e])].join("");o=o.replace(n,i)}),i.location=o})}},e.$watch("showSaveTemplateAs",function(n){n||(e.userCreatedTemplateName="",t.resetName())})}e.controller("TemplateNamingCtrl",["$scope","embTemplateNameProvider","$window","$document","$rootScope",i])}),define("modules/emailbuilder/services/publicCanvas",["modules/emailbuilder/module","config"],function(e,t){function n(e){this.$http=e}n.prototype={createAccount:function(e){return this.$http.post(t.urls.createAccount,{user:e})},sendDownloadLink:function(e){return this.$http.post(t.urls.downloadEmail,{emailAddress:e})}},e.service("PublicCanvasSvc",["$http",n])}),define("modules/emailbuilder/services/timeZone",["modules/shared/module","config"],function(e,t){function n(){this.detect=function(e,t){if(e){var n=i(e);if(n.length>0)return n.length>1&&t&&t(n),n[0].DisplayName}return null}}function i(e){var t,n=new Date,i=[],o=!1;for(t=0;t<e.length;t++){var r=e[t];if(r.DaylightSavingTimeStartDate||n.getTimezoneOffset()!=-r.UtcOffset||o){var s=new Date(r.DaylightSavingTimeStartDate),a=new Date(r.DaylightSavingTimeEndDate),l=new Date(r.DaylightSavingTimeStartDate),c=new Date(r.DaylightSavingTimeStartDate),u=new Date(r.DaylightSavingTimeEndDate),d=new Date(r.DaylightSavingTimeEndDate);l.setDate(s.getDate()-1),c.setDate(s.getDate()+1),u.setDate(a.getDate()-1),d.setDate(a.getDate()+1),l.getTimezoneOffset()==-r.StandardTimeOffset&&c.getTimezoneOffset()==-r.DaylightSavingTimeOffset&&u.getTimezoneOffset()==-r.DaylightSavingTimeOffset&&d.getTimezoneOffset()==-r.StandardTimeOffset&&(o=!0,i.push(r))}else i.push(r)}if(o)for(t=0;t<i.length;t++)i[t].DaylightSavingTimeStartDate||(i.splice(t,1),t--);return i}e.service("timeZoneSvc",[n])}),define("modules/emailbuilder/controllers/newAccount",["config","vendor/angular","modules/emailbuilder/module","modules/emailbuilder/services/publicCanvas","modules/emailbuilder/services/timeZone"],function(e,t,n,i,o){function r(n,i,o,r,s,a){function l(){a.saveInProgress=!1,a.accountCreated=!1,a.downloadSent=!1,a.newAccountSubmitted=!1,a.downloadSubmitted=!1}a.user={enCampaignId:e.enEntityId,timeZone:i.detect(e.timeZones),enDbId:e.enOverrideDbId,email:e.emailAddress},a.showNewAccount=!0,a.newAccountSubmitted=!1,a.downloadSubmitted=!1,a.downloadStep="idle",a.emailRegex=o.email.regExp,l(),a.showDownloadPanel=function(){a.showNewAccount=!1,a.downloadSent=!1},a.showAccountPanel=function(){a.showNewAccount=!0},a.$watch("showSignupForm",function(){a.showSignupForm||r(function(){a.showNewAccount=!0},500)}),a.sendDownloadLink=function(e){l(),a.downloadSubmitted=!0,a.downloadStep="sending",n.sendDownloadLink(a.user.email,a.user.subscribeDownload).success(function(){r(function(){a.downloadStep="sent"},2e3)})},a.saveAccount=function(){l(),a.newAccountSubmitted=!0,a.saveInProgress=!0,n.createAccount(a.user).success(function(e){a.success=!0,e.success?r(function(){s.location.href=e.accountLandingPageUrl},500):(a.saveInProgress=!1,t.forEach(e.data,function(e,t){a.newAccount[e.Key].$error.custom=e.Value,a.newAccount[e.Key].$invalid=!0}))})}}n.controller("NewAccountCtrl",["PublicCanvasSvc","timeZoneSvc","ValidationSrv","$timeout","$window","$scope",r])}),define("modules/emailbuilder/services/login",["modules/emailbuilder/module","config"],function(e,t){function n(e){this.$http=e}n.prototype={signUp:function(e){return this.$http.post(t.urls.login,{email:e.username,password:e.password,rememberMe:e.remember})}},e.service("LoginSvc",["$http",n])}),define("modules/emailbuilder/controllers/login",["modules/emailbuilder/module","modules/emailbuilder/services/login"],function(e,t){function n(e,t,n,i,o){var r=function(){n.success=!1,n.failure=!1},s=function(){n.account={username:"",password:"",rememberMe:!1},n.loginInProgress=!1,r()};s();var a=function(e,t){return e.indexOf(t,e.length-t.length)!==-1};n.signIn=function(){r(),n.loginInProgress=!0,e.signUp(n.account).then(function(e){"Success"===e.data.status?(n.success=!0,o(function(){i.showLoginForm=!1,s(),t.retry()},1e3)):a(e.data.status,"Lockout")?(n.failure=!1,n.lockout=!0,n.loginInProgress=!1):(n.failure=!0,n.loginInProgress=!1)})}}e.controller("LoginCtrl",["LoginSvc","RetryRequestSrv","$scope","$rootScope","$timeout",n])}),define("modules/emailbuilder/controllers/getFeedback",["modules/emailbuilder/module","vendor/angular"],function(e,t){function n(e,n,i,o,r,s){function a(e,t){d&&(r.cancel(d),d=void 0),d=r(function(){t.postMessage({message:"requestOauthResult"},"*")},500)}function l(e){n.closeGetFeedbackForm(!0),e.data&&e.data.result&&"ephemeral_session_detected"===e.data.result.error&&(c=!0)}var c=!1,u=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);u&&(c=!0,s({data:"",method:"GET",url:"https://www.getfeedback.com/oauth/preflight",headers:{"Content-Type":"application/json; charset=utf-8"},withCredentials:!0}).then(function(e){e.data.has_session&&(c=!1)})),n.showGetFeedbackForm=!1,e.frameUrl="";var d;n.$on("getFeedbackConnectStart",function(s,l){var u=function(){n.showGetFeedbackForm=!0,o(function(){e.frameUrl=l,o(function(){a(e,t.element("#emb-get-feedback-dialog iframe")[0].contentWindow)})})};if(c)var d=i.open("https://www.getfeedback.com/campaign_monitor/start_session","GetFeedback","width=100,height=100,left=0,top=0,menubar=no,location=no,scrollbars=no,status=no"),m=r(function(){d.closed&&(r.cancel(m),c=!1,u())},100);else u()}),n.closeGetFeedbackForm=function(i){e.frameUrl="",t.isDefined(d)&&(r.cancel(d),d=void 0),n.showGetFeedbackForm=!1,n.$broadcast("getFeedbackConnectEnd",!!i)},i.addEventListener("message",l,!1)}e.controller("GetFeedbackCtrl",["$scope","$rootScope","$window","$timeout","$interval","$http",n])}),define("modules/emailbuilder/services/testEmail",["modules/emailbuilder/module","config"],function(e,t){function n(e){this.$http=e}n.prototype={sendTestEmail:function(e){return this.$http.post(t.urls.testEmailUrl,{txtTestCampaign:e.email})},getTestEmailAddress:function(){return t.supportTestEmail?void 0!==t.previousTestEmails[0]?t.previousTestEmails[0]:t.loggedInMemberEmail:""}},e.service("testEmailSvc",["$http",n])}),define("modules/emailbuilder/controllers/sendTestEmail",["config","vendor/angular","modules/emailbuilder/module","modules/emailbuilder/services/testEmail"],function(e,t,n,i){function o(t,n,i,o,r){function s(){r.sendInProgress=!1,r.testEmailSent=!1}r.user={enCampaignId:e.enEntityId,enDbId:e.enOverrideDbId,email:t.getTestEmailAddress()},r.emailRegex=n.email.regExp,s(),r.sendTestEmail=function(){s(),r.sendInProgress=!0,t.sendTestEmail(r.user).success(function(e){"Success"===e.Status?(r.testEmailSent=!0,i(function(){r.$parent.showTestEmailForm=!1,s()},2e3)):(r.testEmailSendErrorMessage="Error...unable to send test email.",r.$parent.showTestEmailForm=!1,s())})}}n.controller("SendTestEmailCtrl",["testEmailSvc","ValidationSrv","$timeout","$window","$scope",o])}),define("ts/modules/emailbuilder/controllers/sectionCtrl",["modules/emailbuilder/module","vendor/angular","config","ts/modules/emailbuilder/services/lockLevelSvc"],function(e,t,n,i){var o=function(){function e(e,t,i){function o(t){var n=i.getLocks(t);e.section.hideSectionSettings=n.anyLocking,r=n.anyLocking}e.canvasSectionPermissions=n.canvasSectionPermissions;var r=!1;o(e.section.permissions),e.$on("permissionsChanged:section-"+e.section.uiId,function(e,t){o(t)});var s=$(".emb-js-section-outer-wrapper",t);e.hasIcon=function(){return r&&s.innerHeight()>35}}return e}();e.controller("SectionCtrl",["$scope","$element","LockLevelSvc",o])}),define("modules/emailbuilder/main",["vendor/angular","vendor/domReady!","modules/emailbuilder/config/routeConfig","ts/modules/emailbuilder/directives/dropzone","modules/emailbuilder/controllers/email","ts/modules/emailbuilder/controllers/sidebar","modules/emailbuilder/controllers/templateNaming","modules/emailbuilder/controllers/newAccount","modules/emailbuilder/controllers/login","modules/emailbuilder/controllers/getFeedback","modules/emailbuilder/controllers/sendTestEmail","ts/modules/emailbuilder/controllers/sectionCtrl"],function(e,t,n,i,o,r,s,a,l){e.bootstrap(t,["emailbuilder"])});